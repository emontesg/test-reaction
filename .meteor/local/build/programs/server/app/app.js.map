{"version":3,"sources":["meteor://ğŸ’»app/imports/plugins/core/discounts/lib/collections/schemas/config.js","meteor://ğŸ’»app/imports/plugins/core/discounts/lib/collections/schemas/discounts.js","meteor://ğŸ’»app/imports/plugins/core/discounts/lib/collections/schemas/index.js","meteor://ğŸ’»app/imports/plugins/core/discounts/lib/collections/collections.js","meteor://ğŸ’»app/imports/plugins/core/discounts/lib/collections/index.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/api/import.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/api/index.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/hooks/cart.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/publications/discounts.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/security/discounts.js","meteor://ğŸ’»app/imports/plugins/core/discounts/server/index.js","meteor://ğŸ’»app/imports/plugins/core/discounts/register.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/schemas/config.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/schemas/index.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/schemas/taxcodes.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/schemas/taxes.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/schemas/taxrates.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/collections.js","meteor://ğŸ’»app/imports/plugins/core/taxes/lib/collections/index.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/api/import.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/api/index.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/hooks/taxes.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/publications/taxes.js","meteor://ğŸ’»app/imports/plugins/core/taxes/server/index.js","meteor://ğŸ’»app/imports/plugins/core/taxes/register.js","meteor://ğŸ’»app/imports/plugins/core/templates/lib/collections/schemas/emailtemplates.js","meteor://ğŸ’»app/imports/plugins/core/templates/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/templates/server/index.js","meteor://ğŸ’»app/imports/plugins/core/templates/server/methods.js","meteor://ğŸ’»app/imports/plugins/core/templates/register.js","meteor://ğŸ’»app/imports/plugins/core/connectors/server/lib/roles.js","meteor://ğŸ’»app/imports/plugins/core/connectors/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/connectors/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/core/connectors/server/index.js","meteor://ğŸ’»app/imports/plugins/core/connectors/register.js","meteor://ğŸ’»app/imports/plugins/core/revisions/lib/api/index.js","meteor://ğŸ’»app/imports/plugins/core/revisions/lib/api/revisions.js","meteor://ğŸ’»app/imports/plugins/core/revisions/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/revisions/server/functions.js","meteor://ğŸ’»app/imports/plugins/core/revisions/server/hooks.js","meteor://ğŸ’»app/imports/plugins/core/revisions/server/index.js","meteor://ğŸ’»app/imports/plugins/core/revisions/server/methods.js","meteor://ğŸ’»app/imports/plugins/core/revisions/server/publications.js","meteor://ğŸ’»app/imports/plugins/core/revisions/register.js","meteor://ğŸ’»app/imports/plugins/core/shipping/server/lib/roles.js","meteor://ğŸ’»app/imports/plugins/core/shipping/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/shipping/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/core/shipping/server/index.js","meteor://ğŸ’»app/imports/plugins/core/shipping/register.js","meteor://ğŸ’»app/imports/plugins/core/components/lib/components.js","meteor://ğŸ’»app/imports/plugins/core/job-collection/lib/index.js","meteor://ğŸ’»app/imports/plugins/core/job-collection/register.js","meteor://ğŸ’»app/imports/plugins/core/router/lib/hooks.js","meteor://ğŸ’»app/imports/plugins/core/router/lib/index.js","meteor://ğŸ’»app/imports/plugins/core/router/lib/router.js","meteor://ğŸ’»app/imports/plugins/core/router/register.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Account/addressBook.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Account/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Group/createdBy.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Group/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/addAccountAddressBookEntry.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/addAccountToGroup.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/inviteShopMember.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/removeAccountAddressBookEntry.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/removeAccountFromGroup.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/setAccountProfileCurrency.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Mutation/updateAccountAddressBookEntry.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/account.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/administrators.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/group.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/groups.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/roles.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/Query/viewer.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/AccountConnection.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/AccountEdge.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/AddAccountAddressBookEntryPayload.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/GroupConnection.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/GroupEdge.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/RoleConnection.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/RoleEdge.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/account/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogItemProduct/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogItemProduct/positions.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogItemProduct/product.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogProduct/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogProduct/tagIds.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogProduct/tags.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogProduct/variants.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogProductVariant/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/Query/catalogItems.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/Query/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogItemConnection.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/CatalogItemEdge.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/catalog/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Query/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Query/primaryShopId.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Query/shop.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Shop/administrators.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Shop/groups.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Shop/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Shop/roles.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/Shop/tags.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/shop/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/Query/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/Query/tags.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/Tag/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/Tag/subTags.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/TagConnection.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/TagEdge.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/tag/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/core/Address.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/core/Currency.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/core/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/scalar/ConnectionCursor.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/scalar/ConnectionLimitInt.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/scalar/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/applyBeforeAfterToFilter.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/applyPaginationToMongoCursor.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/getCollectionFromCursor.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/getMongoSort.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/getPaginatedResponse.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/namespaces.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/optimizeIdOnly.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/util/resolveShopFromShopId.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/account.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/address.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/catalogItem.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/catalogProduct.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/catalogProductVariant.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/connection.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/currency.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/group.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/id.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/product.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/ramda-ext.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/shop.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/xforms/tag.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/resolvers/ping.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/schemas/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/ReactionError.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/buildContext.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/createApolloServer.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/defineCollections.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/getErrorFormatter.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/getUserFromToken.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/index.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/logger.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/meteorTokenMiddleware.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/methods.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/queries.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/runMeteorMethodWithContext.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/schema.js","meteor://ğŸ’»app/imports/plugins/core/graphql/server/tokenExpiration.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/methods/groupQuery.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/methods/rolesQuery.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/methods/shopAdministratorsQuery.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/methods/userAccountQuery.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/no-meteor/getShopIdByDomain.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/no-meteor/getShopIdForContext.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/no-meteor/hasPermission.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/index.js","meteor://ğŸ’»app/imports/plugins/core/accounts/server/init.js","meteor://ğŸ’»app/imports/plugins/core/accounts/register.js","meteor://ğŸ’»app/imports/plugins/core/catalog/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/catalog/server/methods/catalog.js","meteor://ğŸ’»app/imports/plugins/core/catalog/server/queries/catalogItems.js","meteor://ğŸ’»app/imports/plugins/core/catalog/server/queries/tags.js","meteor://ğŸ’»app/imports/plugins/core/catalog/server/queries/tagsByIds.js","meteor://ğŸ’»app/imports/plugins/core/catalog/server/index.js","meteor://ğŸ’»app/imports/plugins/core/catalog/register.js","meteor://ğŸ’»app/imports/plugins/core/checkout/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/checkout/server/methods/workflow.js","meteor://ğŸ’»app/imports/plugins/core/checkout/server/index.js","meteor://ğŸ’»app/imports/plugins/core/checkout/register.js","meteor://ğŸ’»app/imports/plugins/core/dashboard/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/dashboard/server/index.js","meteor://ğŸ’»app/imports/plugins/core/dashboard/register.js","meteor://ğŸ’»app/imports/plugins/core/email/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/email/server/index.js","meteor://ğŸ’»app/imports/plugins/core/email/register.js","meteor://ğŸ’»app/imports/plugins/core/i18n/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/i18n/server/index.js","meteor://ğŸ’»app/imports/plugins/core/i18n/register.js","meteor://ğŸ’»app/imports/plugins/core/layout/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/layout/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/core/layout/server/methods/templates.js","meteor://ğŸ’»app/imports/plugins/core/layout/server/publications/templates.js","meteor://ğŸ’»app/imports/plugins/core/layout/server/index.js","meteor://ğŸ’»app/imports/plugins/core/layout/register.js","meteor://ğŸ’»app/imports/plugins/core/orders/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/orders/server/index.js","meteor://ğŸ’»app/imports/plugins/core/orders/server/startup.js","meteor://ğŸ’»app/imports/plugins/core/orders/register.js","meteor://ğŸ’»app/imports/plugins/core/payments/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/payments/server/index.js","meteor://ğŸ’»app/imports/plugins/core/payments/register.js","meteor://ğŸ’»app/imports/plugins/core/ui/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/ui/server/index.js","meteor://ğŸ’»app/imports/plugins/core/ui/server/policy.js","meteor://ğŸ’»app/imports/plugins/core/ui/register.js","meteor://ğŸ’»app/imports/plugins/core/ui-navbar/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/ui-navbar/server/index.js","meteor://ğŸ’»app/imports/plugins/core/ui-navbar/register.js","meteor://ğŸ’»app/imports/plugins/core/ui-tagnav/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/ui-tagnav/server/index.js","meteor://ğŸ’»app/imports/plugins/core/ui-tagnav/register.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/10_set_primary_shop.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/11_add_product_to_cart_items.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/12_add_shopId_on_billing.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/13_add_shopId_on_shipping.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/14_rebuild_order_search_collection.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/15_update_shipping_status_to_workflow.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/16_update_billing_paymentMethod.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/17_set_shop_uols.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/18_use_react_for_header_and_footer_layout.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/19_remove_admin_from_shop_manager.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/1_rebuild_account_and_order_search_collections.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/20_add_shop_to_marketplace.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/21_clean_cart_shipment_method.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/22_register_verify_account.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/23_drop_tempstore_collections.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/24_publish_all_existing_visible_products.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/2_add_key_to_search_ui.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/3_reset_package_registry.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/4_update_templates_priority.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/5_update_defaultRoles_to_groups.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/6_update_tags_is_visible.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/7_add_shop_slugs_to_schema.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/8_update_registry_provides_to_array.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/9_update_metrics.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/migrations/index.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/index.js","meteor://ğŸ’»app/imports/plugins/core/versions/server/startup.js","meteor://ğŸ’»app/imports/plugins/core/versions/register.js","meteor://ğŸ’»app/imports/plugins/core/files/server/fileCollections.js","meteor://ğŸ’»app/imports/plugins/core/files/server/index.js","meteor://ğŸ’»app/imports/plugins/core/files/server/methods.js","meteor://ğŸ’»app/imports/plugins/core/logging/server/index.js","meteor://ğŸ’»app/imports/plugins/core/logging/server/methods.js","meteor://ğŸ’»app/imports/plugins/core/logging/server/publications.js","meteor://ğŸ’»app/imports/plugins/core/logging/register.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/lib/collections/schemas/codes.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/lib/collections/schemas/config.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/lib/collections/schemas/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/hooks/orders.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/publications/discounts.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/security/discounts.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/server/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-codes/register.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/lib/collections/schemas/config.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/lib/collections/schemas/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/lib/collections/schemas/rates.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/server/publications/discounts.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/server/security/discounts.js","meteor://ğŸ’»app/imports/plugins/included/discount-rates/server/index.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/lib/collections/schemas/index.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/lib/collections/schemas/search.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/hooks/search.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/jobs/buildSearchCollections.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/jobs/index.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/methods/common.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/methods/formHandler.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/methods/searchcollections.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/methods/transformations.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/publications/searchresults.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/server/index.js","meteor://ğŸ’»app/imports/plugins/included/search-mongo/register.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/lib/collections/schemas/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/lib/collections/schemas/shippo.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/lib/roles.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/lib/shippoApiSchema.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/hooks/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/hooks/rates.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/hooks/tracking.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/jobs/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/jobs/shippo.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/methods/carriers.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/methods/shippo.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/methods/shippoapi.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/server/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-shippo/register.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/lib/roles.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/api/api.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/api/credentials.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/api/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/api/products.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/export/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/export/orders.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/import/customers.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/import/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/import/products.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/sync/hooks.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/sync/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/sync/orders.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/sync/sync.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/webhooks/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/webhooks/webhooks.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/collections/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/collections/shopifyCustomer.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/collections/shopifyProduct.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/endpoints/webhooks.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/hooks/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/hooks/orders.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/jobs/image-import.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/jobs/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/jobs/order-export.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/server/index.js","meteor://ğŸ’»app/imports/plugins/included/connectors-shopify/register.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/lib/api/express.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/lib/api/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/lib/api/payflow.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/methods/express.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/methods/payflow.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/methods/payflowproApi.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/methods/payflowproMethods.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/security/paypal.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/startup/startup.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/server/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-paypal/register.js","meteor://ğŸ’»app/imports/plugins/included/product-detail-simple/lib/layout/simple.js","meteor://ğŸ’»app/imports/plugins/included/product-detail-simple/lib/layout/twoColumn.js","meteor://ğŸ’»app/imports/plugins/included/product-detail-simple/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/product-detail-simple/server/index.js","meteor://ğŸ’»app/imports/plugins/included/product-detail-simple/register.js","meteor://ğŸ’»app/imports/plugins/included/shipping-rates/server/lib/roles.js","meteor://ğŸ’»app/imports/plugins/included/shipping-rates/server/hooks/hooks.js","meteor://ğŸ’»app/imports/plugins/included/shipping-rates/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-rates/server/methods/rates.js","meteor://ğŸ’»app/imports/plugins/included/shipping-rates/server/index.js","meteor://ğŸ’»app/imports/plugins/included/shipping-rates/register.js","meteor://ğŸ’»app/imports/plugins/included/email-templates/lib/paths.js","meteor://ğŸ’»app/imports/plugins/included/email-templates/server/index.js","meteor://ğŸ’»app/imports/plugins/included/marketplace/lib/constants.js","meteor://ğŸ’»app/imports/plugins/included/marketplace/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/marketplace/server/index.js","meteor://ğŸ’»app/imports/plugins/included/marketplace/server/methods.js","meteor://ğŸ’»app/imports/plugins/included/marketplace/server/publications.js","meteor://ğŸ’»app/imports/plugins/included/marketplace/register.js","meteor://ğŸ’»app/imports/plugins/included/default-theme/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/default-theme/server/index.js","meteor://ğŸ’»app/imports/plugins/included/default-theme/register.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/hooks/hooks.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/methods/inventory.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/methods/statusChanges.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/publications/inventory.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/startup/init.js","meteor://ğŸ’»app/imports/plugins/included/inventory/server/index.js","meteor://ğŸ’»app/imports/plugins/included/inventory/register.js","meteor://ğŸ’»app/imports/plugins/included/jobcontrol/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/jobcontrol/server/jobs/cart.js","meteor://ğŸ’»app/imports/plugins/included/jobcontrol/server/jobs/cleanup.js","meteor://ğŸ’»app/imports/plugins/included/jobcontrol/server/jobs/exchangerates.js","meteor://ğŸ’»app/imports/plugins/included/jobcontrol/server/index.js","meteor://ğŸ’»app/imports/plugins/included/jobcontrol/register.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/hooks/notification.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/methods/notifications.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/publications/notifications.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/index.js","meteor://ğŸ’»app/imports/plugins/included/notifications/server/init.js","meteor://ğŸ’»app/imports/plugins/included/notifications/register.js","meteor://ğŸ’»app/imports/plugins/included/payments-authnet/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-authnet/server/methods/authnet.js","meteor://ğŸ’»app/imports/plugins/included/payments-authnet/server/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-authnet/register.js","meteor://ğŸ’»app/imports/plugins/included/payments-braintree/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-braintree/server/methods/braintree.js","meteor://ğŸ’»app/imports/plugins/included/payments-braintree/server/methods/braintreeApi.js","meteor://ğŸ’»app/imports/plugins/included/payments-braintree/server/methods/braintreeMethods.js","meteor://ğŸ’»app/imports/plugins/included/payments-braintree/server/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-braintree/register.js","meteor://ğŸ’»app/imports/plugins/included/payments-stripe/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-stripe/server/methods/stripe-connect.js","meteor://ğŸ’»app/imports/plugins/included/payments-stripe/server/methods/stripe.js","meteor://ğŸ’»app/imports/plugins/included/payments-stripe/server/startup/startup.js","meteor://ğŸ’»app/imports/plugins/included/payments-stripe/server/index.js","meteor://ğŸ’»app/imports/plugins/included/payments-stripe/register.js","meteor://ğŸ’»app/imports/plugins/included/product-admin/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/product-admin/server/index.js","meteor://ğŸ’»app/imports/plugins/included/product-admin/register.js","meteor://ğŸ’»app/imports/plugins/included/product-variant/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/product-variant/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/product-variant/server/methods/populateTaxCodes.js","meteor://ğŸ’»app/imports/plugins/included/product-variant/server/index.js","meteor://ğŸ’»app/imports/plugins/included/product-variant/register.js","meteor://ğŸ’»app/imports/plugins/included/sms/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/sms/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/sms/server/methods/sms.js","meteor://ğŸ’»app/imports/plugins/included/sms/server/publications/smsPublication.js","meteor://ğŸ’»app/imports/plugins/included/sms/server/index.js","meteor://ğŸ’»app/imports/plugins/included/sms/register.js","meteor://ğŸ’»app/imports/plugins/included/social/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/social/server/index.js","meteor://ğŸ’»app/imports/plugins/included/social/server/methods.js","meteor://ğŸ’»app/imports/plugins/included/social/server/policy.js","meteor://ğŸ’»app/imports/plugins/included/social/register.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/hooks/hooks.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/hooks/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/jobs/cleanup.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/methods/avalogger.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/methods/taxCalc.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/server/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-avalara/register.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/server/hooks/hooks.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/server/hooks/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/server/methods/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/server/methods/methods.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/server/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxcloud/register.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxjar/server/hooks/hooks.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxjar/server/hooks/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxjar/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/taxes-taxjar/server/index.js","meteor://ğŸ’»app/imports/plugins/included/ui-search/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/included/ui-search/server/index.js","meteor://ğŸ’»app/imports/plugins/included/ui-search/register.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-payments/server/i18n/index.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-payments/server/methods/authorize.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-payments/server/methods/example.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-payments/server/methods/exampleapi.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-payments/server/index.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-payments/register.js","meteor://ğŸ’»app/imports/plugins/custom/knowledge-theme/register.js","meteor://ğŸ’»app/lib/api/router/metadata.js","meteor://ğŸ’»app/lib/api/account-validation.js","meteor://ğŸ’»app/lib/api/catalog.js","meteor://ğŸ’»app/lib/api/core.js","meteor://ğŸ’»app/lib/api/helpers.js","meteor://ğŸ’»app/lib/api/index.js","meteor://ğŸ’»app/lib/api/match.js","meteor://ğŸ’»app/lib/api/products.js","meteor://ğŸ’»app/lib/api/prop-types.js","meteor://ğŸ’»app/lib/collections/schemas/accounts.js","meteor://ğŸ’»app/lib/collections/schemas/address.js","meteor://ğŸ’»app/lib/collections/schemas/assets.js","meteor://ğŸ’»app/lib/collections/schemas/cart.js","meteor://ğŸ’»app/lib/collections/schemas/catalog.js","meteor://ğŸ’»app/lib/collections/schemas/emails.js","meteor://ğŸ’»app/lib/collections/schemas/event.js","meteor://ğŸ’»app/lib/collections/schemas/groups.js","meteor://ğŸ’»app/lib/collections/schemas/helpers.js","meteor://ğŸ’»app/lib/collections/schemas/index.js","meteor://ğŸ’»app/lib/collections/schemas/inventory.js","meteor://ğŸ’»app/lib/collections/schemas/layouts.js","meteor://ğŸ’»app/lib/collections/schemas/logs.js","meteor://ğŸ’»app/lib/collections/schemas/metafield.js","meteor://ğŸ’»app/lib/collections/schemas/notifications.js","meteor://ğŸ’»app/lib/collections/schemas/orders.js","meteor://ğŸ’»app/lib/collections/schemas/payments.js","meteor://ğŸ’»app/lib/collections/schemas/products.js","meteor://ğŸ’»app/lib/collections/schemas/registry.js","meteor://ğŸ’»app/lib/collections/schemas/revisions.js","meteor://ğŸ’»app/lib/collections/schemas/shipping.js","meteor://ğŸ’»app/lib/collections/schemas/shops.js","meteor://ğŸ’»app/lib/collections/schemas/sms.js","meteor://ğŸ’»app/lib/collections/schemas/social.js","meteor://ğŸ’»app/lib/collections/schemas/tags.js","meteor://ğŸ’»app/lib/collections/schemas/templates.js","meteor://ğŸ’»app/lib/collections/schemas/translations.js","meteor://ğŸ’»app/lib/collections/schemas/workflow.js","meteor://ğŸ’»app/lib/collections/transform/cartOrder.js","meteor://ğŸ’»app/lib/collections/collections.js","meteor://ğŸ’»app/lib/collections/index.js","meteor://ğŸ’»app/lib/collections/jobs.js","meteor://ğŸ’»app/lib/collections/search.js","meteor://ğŸ’»app/lib/core/templates.js","meteor://ğŸ’»app/lib/selectors/tags.js","meteor://ğŸ’»app/lib/selectors/variants.js","meteor://ğŸ’»app/server/api/core/accounts/index.js","meteor://ğŸ’»app/server/api/core/accounts/password.js","meteor://ğŸ’»app/server/api/core/email/config.js","meteor://ğŸ’»app/server/api/core/email/email.js","meteor://ğŸ’»app/server/api/core/email/index.js","meteor://ğŸ’»app/server/api/core/addDefaultRoles.js","meteor://ğŸ’»app/server/api/core/assignRoles.js","meteor://ğŸ’»app/server/api/core/connectionDataStore.js","meteor://ğŸ’»app/server/api/core/core.js","meteor://ğŸ’»app/server/api/core/endpoints.js","meteor://ğŸ’»app/server/api/core/groups.js","meteor://ğŸ’»app/server/api/core/importer.js","meteor://ğŸ’»app/server/api/core/index.js","meteor://ğŸ’»app/server/api/core/loadSettings.js","meteor://ğŸ’»app/server/api/core/rightJoin.js","meteor://ğŸ’»app/server/api/core/setDomain.js","meteor://ğŸ’»app/server/api/core/shopName.js","meteor://ğŸ’»app/server/api/core/templates.js","meteor://ğŸ’»app/server/api/core/utils.js","meteor://ğŸ’»app/server/api/geocoder.js","meteor://ğŸ’»app/server/api/index.js","meteor://ğŸ’»app/server/api/method-hooks.js","meteor://ğŸ’»app/server/api/router.js","meteor://ğŸ’»app/server/methods/core/hooks/cart.js","meteor://ğŸ’»app/server/methods/core/hooks/shop.js","meteor://ğŸ’»app/server/methods/core/workflows/orders.js","meteor://ğŸ’»app/server/methods/core/cart.js","meteor://ğŸ’»app/server/methods/core/cartToOrder.js","meteor://ğŸ’»app/server/methods/core/groups.js","meteor://ğŸ’»app/server/methods/core/orders.js","meteor://ğŸ’»app/server/methods/core/packages.js","meteor://ğŸ’»app/server/methods/core/payments.js","meteor://ğŸ’»app/server/methods/core/registry.js","meteor://ğŸ’»app/server/methods/core/shipping.js","meteor://ğŸ’»app/server/methods/core/shop.js","meteor://ğŸ’»app/server/methods/accounts/accounts-password.js","meteor://ğŸ’»app/server/methods/accounts/accounts.js","meteor://ğŸ’»app/server/methods/accounts/serviceConfiguration.js","meteor://ğŸ’»app/server/methods/catalog.js","meteor://ğŸ’»app/server/methods/email.js","meteor://ğŸ’»app/server/methods/helpers.js","meteor://ğŸ’»app/server/methods/i18n.js","meteor://ğŸ’»app/server/publications/accounts/serviceConfiguration.js","meteor://ğŸ’»app/server/publications/collections/accounts.js","meteor://ğŸ’»app/server/publications/collections/cart.js","meteor://ğŸ’»app/server/publications/collections/groups.js","meteor://ğŸ’»app/server/publications/collections/media.js","meteor://ğŸ’»app/server/publications/collections/members.js","meteor://ğŸ’»app/server/publications/collections/orders.js","meteor://ğŸ’»app/server/publications/collections/packages.js","meteor://ğŸ’»app/server/publications/collections/product.js","meteor://ğŸ’»app/server/publications/collections/products.js","meteor://ğŸ’»app/server/publications/collections/reactiveAggregate.js","meteor://ğŸ’»app/server/publications/collections/revisions.js","meteor://ğŸ’»app/server/publications/collections/sessions.js","meteor://ğŸ’»app/server/publications/collections/shipping.js","meteor://ğŸ’»app/server/publications/collections/shops.js","meteor://ğŸ’»app/server/publications/collections/tags.js","meteor://ğŸ’»app/server/publications/collections/themes.js","meteor://ğŸ’»app/server/publications/collections/translations.js","meteor://ğŸ’»app/server/publications/counts.js","meteor://ğŸ’»app/server/publications/email.js","meteor://ğŸ’»app/server/jobs/email.js","meteor://ğŸ’»app/server/jobs/index.js","meteor://ğŸ’»app/server/startup/accounts.js","meteor://ğŸ’»app/server/startup/browser-policy.js","meteor://ğŸ’»app/server/startup/collection-security.js","meteor://ğŸ’»app/server/startup/i18n.js","meteor://ğŸ’»app/server/startup/index.js","meteor://ğŸ’»app/server/startup/load-data.js","meteor://ğŸ’»app/server/startup/prerender.js","meteor://ğŸ’»app/server/startup/rate-limits.js","meteor://ğŸ’»app/server/startup/register-core.js","meteor://ğŸ’»app/server/startup/register-router.js","meteor://ğŸ’»app/server/plugins.js","meteor://ğŸ’»app/server/main.js"],"names":["module","export","DiscountsPackageConfig","registerSchema","watch","require","v","PackageConfig","Discounts","clone","extend","type","Object","optional","blackbox","defaultValue","Boolean","Array","Transactions","SimpleSchema","default","check","Tracker","shopIdAutoValue","cartId","String","index","userId","appliedAt","Date","tracker","autoValue","label","allowedValues","Number","makeNsSetter","Mongo","Schemas","Collection","attachSchema","Reaction","Importer","Collections","DiscountImport","discountRate","key","object","indication","assign","exportDefault","Meteor","Cart","Hooks","Events","add","cart","findOne","_id","discount","call","update","$set","run","loadTranslations","ar","bg","de","el","en","es","fr","he","hr","it","my","nb","nl","pl","pt","ro","ru","sl","sv","tr","vi","zh","methods","Match","discountId","hasPermission","Error","remove","discounts","Optional","transaction","$addToSet","transactions","selector","discountMethod","validate","currentDiscount","billing","paymentMethod","id","calculation","processor","method","invoice","Counts","publish","query","options","shopId","getShopId","ready","select","find","Security","permit","collections","ifHasRole","role","group","registerPackage","name","icon","autoEnable","TaxPackageConfig","Taxes","TaxCodes","unique","TaxRates","country","county","postal","rate","TaxImport","taxCode","Packages","Logger","taxId","doc","docId","modifier","insert","details","taxRate","taxes","tax","taxRatesByShop","itemsWithTax","cartTaxRate","cartTaxData","OneOf","undefined","items","cartToCalc","cartShopId","pkg","enabled","settings","rates","debug","shipping","shippingAddress","address","totalTax","taxDataByShop","reduce","uniqueShopTaxRates","item","$and","$or","$exists","region","sort","keys","ratesByShop","map","taxData","shopTaxData","variants","taxable","shopTaxRate","subtotal","price","quantity","getSubTotal","params","custom","registry","provides","description","priority","container","workflow","template","EmailTemplates","Templates","Integer","templateId","title","language","subject","meta","actionView","dashboardSize","connectorsRoles","packageId","connection","route","getPackageSettings","isRevisionControlEnabled","RevisionApi","getPrimaryShopId","packageInfo","general","insertRevision","updateRevision","markRevisionAsDeleted","_isEmpty","Products","Revisions","Tags","ProductRevision","getSlug","product","isArray","indexOf","productRevision","$nin","productHasAncestors","ancestors","archivedCount","$in","count","documentId","documentData","revisionHasAncestors","modifierContainsIsDeleted","isDeleted","revisionSelector","revisionModifier","prototype","hasOwnProperty","status","hasAncestors","length","operation","property","metafields","$push","updateId","priceRange","getProductPriceRange","isVisible","newValue","newTitle","newHandle","handle","slugDocId","revisionTitle","revisionHandle","hasNewHandle","hasExistingTitle","hasNewTitle","hasHandle","handleMatchesId","$unset","updatedRevision","$pull","hashtags","tagId","productCount","relatedTagsCount","relatedTagIds","$inc","newSet","newInc","hasIgnoredFields","ignoredFields","field","_max","_min","diff","Media","productId","range","min","max","getTopVariants","variantPrices","forEach","variant","getVariantPriceRange","firstPrice","parseFloat","substr","lastPrice","lastIndexOf","push","priceMin","priceMax","toString","priceObject","variantId","children","getVariants","visibleChildren","filter","child","topVariant","getProduct","POSITIVE_INFINITY","NEGATIVE_INFINITY","findRevision","revision","getVariantQuantity","sum","option","inventoryQuantity","differences","documentType","image","Promise","await","raw","metadata","d","fetchPrevious","updateSettings","discardDrafts","MediaRecords","handleImageRevision","result","changeType","JSON","stringify","publishCatalogProduct","validation","documentIds","documentIdArray","parentDocument","revisions","fetch","updatedDocuments","res","Roles","productIds","shop","userIsInRole","shippingRoles","Shipping","orderId","provider","current","multi","Components","ComponentsTable","registerComponent","registerHOC","getComponent","replaceComponent","getRawComponent","getHOCs","copyHOCs","loadRegisteredComponents","_setDisplayName","_compose","rawComponent","hocs","newHOCs","existingComponent","existingHOCs","component","hoc","newComponent","previousComponent","newHocs","sourceComponentName","targetComponent","sourceComponent","Job","JobCollection","createJobCollection","later","isServer","classes","_hooks","onEnter","onExit","_addHook","routeName","callback","enter","cb","leave","arguments","get","callbacks","context","Link","exports","NavLink","Prompt","withRouter","Router","history","ReactionLayout","_uniqBy","React","Route","createBrowserHistory","createMemoryHistory","pathToRegexp","queryParse","Immutable","Blaze","Template","Session","Shops","isClient","currentRoute","Map","routerReadyDependency","Dependency","routerChangeDependency","_routes","value","routes","depend","_initialized","triggerRouterReady","changed","triggers","toJS","setCurrentRoute","routeData","getRouteName","getParam","getQueryParam","setQueryParams","newParams","queryParams","go","watchPathChange","activeClassName","pathFor","path","foundPath","pathObject","hash","shopSlug","includes","toPath","compile","compiledPath","queryString","actualPath","routerGo","startsWith","window","autorun","routerReadyWaitFor","stop","replace","reload","fullPath","isActiveClassName","prefix","hasRoutePermission","permissions","getRegistryRouteName","packageName","registryItem","split","selectLayout","layout","setLayout","setWorkflow","currentLayout","currentWorkflow","marketplaceSettings","marketplace","getMarketplaceSettings","public","merchantTemplates","layoutName","workflowName","layoutStructure","layoutHeader","layoutFooter","notFound","dashboardHeader","dashboardControls","dashboardHeaderControls","adminControlsFooter","layoutTheme","sortedLayout","prev","next","foundLayout","x","structure","theme","optionsHasTemplate","hasReactComponent","e","props","user","createElement","console","warn","initPackageRoutes","reactionContext","shopPrefix","pkgs","routeDefinitions","shopSub","subscribe","shopSubWaitFor","indexLayout","indexRoute","notFoundLayout","newRoutes","from","reactionLayout","newRouteConfig","triggersEnter","triggersExit","substring","uniqRoutes","reverse","reactRouterRoutes","reactComponents","addressBook","_get","xformArrayToConnection","account","connectionArgs","addressList","encodeAccountOpaqueId","getXformedCurrencyByCode","resolveShopFromShopId","currency","_","profile","emailRecords","emails","preferences","createdBy","createdByAccountId","queries","userAccount","encodeGroupOpaqueId","node","addAccountAddressBookEntry","decodeAccountOpaqueId","input","accountId","clientMutationId","dbAccountId","updatedAddress","addAccountToGroup","decodeGroupOpaqueId","groupId","dbGroupId","inviteShopMember","removeAccountAddressBookEntry","removeAccountFromGroup","setAccountProfileCurrency","updateAccountAddressBookEntry","decodeShopOpaqueId","email","decodeAddressOpaqueId","addressId","dbAddressId","removedAddress","currencyCode","updatedAccount","xformAddressInput","updates","administrators","getPaginatedResponse","dbShopId","shopAdministrators","groups","roles","viewer","optimizeIdOnly","__","info","edges","nodes","cursor","addressEdge","Account","AccountConnection","AccountEdge","AddAccountAddressBookEntryPayload","Group","GroupConnection","GroupEdge","Mutation","Query","RoleConnection","RoleEdge","encodeCatalogItemOpaqueId","positions","encodeShopOpaqueId","encodeTagOpaqueId","productPositions","positionTags","tagDocs","toArray","tag","tagDoc","$regex","RegExp","displayWeight","weight","isPinned","pinned","position","updatedAt","xformProductMedia","media","primaryImage","a","b","toGrid","isTaxable","tagIds","slug","socialMetadata","service","message","twitterMsg","facebookMsg","googleplusMsg","pinterestMsg","createdAt","encodeCatalogProductOpaqueId","encodeProductOpaqueId","tags","tagsIds","tagsByIds","productVariants","isBackorder","isLowQuantity","isSoldOut","encodeCatalogProductVariantOpaqueId","ancestorIds","catalogItems","decodeTagOpaqueId","args","shopIds","opaqueShopIds","opaqueTagIds","CatalogItemConnection","CatalogItemEdge","CatalogItemProduct","CatalogProduct","CatalogProductVariant","CatalogItem","__resolveType","CatalogItemContent","primaryShopId","shopById","getXformedCurrenciesByShop","currencies","code","Shop","subTags","subTagIds","Tag","TagConnection","TagEdge","encodeAddressOpaqueId","encodeCurrencyOpaqueId","Address","Currency","GraphQLScalarType","Kind","toCursor","Buffer","fromCursor","serialize","parseLiteral","ast","kind","STRING","parseValue","MAX_LIMIT","Math","INT","parseInt","GraphQLDate","GraphQLTime","GraphQLDateTime","ConnectionCursor","ConnectionLimitInt","DateTime","Time","applyBeforeAfterToFilter","decodeOpaqueId","after","baseFilter","before","collection","sortBy","sortByField","sortOrder","limits","ors","encodedId","op","internalId","endsWith","fields","applyPaginationToMongoCursor","first","last","totalCount","resultCount","limit","skip","pageInfo","hasNextPage","hasPreviousPage","getCollectionFromCursor","db","collectionName","ns","slice","databaseName","getMongoSort","sortOrderEnumToMongo","asc","desc","mongoSort","sortList","unshift","cmd","updatedFilter","startCursor","endCursor","namespaces","Product","Role","graphqlFields","queryFunc","topLevelFields","resolve","parent","assocAccountInternalId","assocAccountOpaqueId","mergeAddressBookToProfile","mergeCurrencyToProfile","mergePreferencesToProfile","xformAccountInput","assocPath","dissoc","pipe","assocInternalId","assocOpaqueId","decodeOpaqueIdForNamespace","encodeOpaqueId","renameKeys","assocAddressInternalId","assocAddressOpaqueId","assocCatalogItemInternalId","assocCatalogItemOpaqueId","decodeCatalogItemOpaqueId","assocCatalogProductInternalId","assocCatalogProductOpaqueId","decodeCatalogProductOpaqueId","mediaItem","large","medium","small","thumbnail","URLs","original","assocCatalogProductVariantInternalId","assocCatalogProductVariantOpaqueId","decodeCatalogProductVariantOpaqueId","connectionFromArray","connectionFromPromisedArray","assocCurrencyInternalId","assocCurrencyOpaqueId","decodeCurrencyOpaqueId","xformCurrencyEntry","xformLegacyCurrencies","assoc","compose","toPairs","k","getXformedCurrenciesByShopId","allCurrencies","assocGroupInternalId","assocGroupOpaqueId","curry","namespace","unencoded","opaqueId","error","decodedId","actualNamespace","assocProductInternalId","assocProductOpaqueId","decodeProductOpaqueId","keysMap","obj","acc","assocShopInternalId","assocShopOpaqueId","xformShopInput","assocTagInternalId","assocTagOpaqueId","_merge","catalog","core","ping","scalar","echo","str","base","metafield","ReactionError","ExtendableError","constructor","eventData","buildContext","curryN","getShopIdForContext","userHasPermission","createApolloServer","cors","bodyParser","express","graphqlExpress","graphiqlExpress","getErrorFormatter","meteorTokenMiddleware","schema","defaultServerConfig","graphiqlPath","graphiqlOptions","passHeader","expressServer","contextFromOptions","graphQLPath","use","json","req","formatError","formatResponse","errors","graphiql","endpointURL","defineCollections","Accounts","Assets","Catalog","Emails","Groups","Inventory","Logs","Notifications","Orders","SellerShops","Sms","Themes","Translations","users","cuid","err","originalError","errorId","eventObj","crypto","tokenExpiration","hashLoginToken","loginToken","createHash","digest","getUserFromToken","hashedToken","currentUser","tokenInformation","services","resume","loginTokens","tokenInfo","expiresAt","when","isExpired","MongoInternals","WebApp","defaultRemoteCollectionDriver","mongo","server","isDevelopment","connectHandlers","headerName","token","headers","sendStatus","runMeteorMethodWithContext","methodName","shopAdministratorsQuery","userAccountQuery","groupQuery","groupsQuery","rolesQuery","getShopIdByDomain","DDP","DDPCommon","invocation","MethodInvocation","isSimulation","setUserId","unblock","randomSeed","_CurrentInvocation","withValue","apply","makeExecutableSchema","resolvers","typeDefs","LOGIN_UNEXPIRING_TOKEN_DAYS","tokenLifetimeMs","getTime","cs","hu","projection","contextShopId","Users","userIds","url","ROOT_URL","process","env","domain","parse","hostname","domains","GLOBAL_GROUP","roleGroup","checkRoles","globalRoles","some","groupRoles","addRolesToGroups","allShops","showForShopTypes","publishProductToCatalog","publishProductsToCatalog","publishProductInventoryAdjustments","CatalogCollection","every","inventoryManagement","inventoryPolicy","lowInventoryWarningThreshold","mediaArray","productMedia","store","upsert","numberAffected","ids","catalogProduct","productsToPublish","canUpdatePrimaryShopProducts","publisableProductIds","success","$ne","shouldIncludeDeleted","isTopLevel","_uniq","_includes","_each","_filter","updateOrderWorkflow","order","newWorkflowStatus","currentCart","defaultPackageWorkflows","nextWorkflowStep","currentWorkflowStatus","packages","reactionPackage","layouts","audience","defaultRoles","statusExistsInWorkflow","maxSteps","nextWorkflowStepIndex","templateProcessedinWorkflow","gotoNextWorkflowStep","currentStatusIndex","resetToIndex","resetedWorkflow","ObjectIncluding","workflowStatus","itemIds","dbOrder","workflows","permission","registerMethods","getTemplateByName","countSelector","findSelector","workflowMethod","method_handlers","payments","BrowserPolicy","content","allowOriginForAll","Migrations","version","up","getDomain","shopType","bypassCollection2","down","OrderSearch","buildOrderSearch","loadSearchRecordBuilderIfItExists","searchPackage","then","currentShipping","packed","shipped","delivered","paymentNameDict","Example","Braintree","AuthNet","PaypalExpress","PayflowPro","Stripe","newBilling","packageData","settingsKey","splice","cartItems","paymentPackageId","paymentSettingsKey","baseUOL","unitsOfLength","uol","$type","updateHandler","shops","downgradeHandler","shopManager","shopManagerRoles","newShopManagerRoles","concat","AccountSearch","buildAccountSearch","unset","shippingItem","shipmentMethod","dropCollection","visiblePublishedProducts","loadPackages","flush","reactionPkgs","oldValue","defaultGroupAccounts","createDefaultGroupsForShop","customPermissions","permissionsArray","sortUniqueArray","updateAccountsInGroup","defaultVisitorRole","ownerRoles","getAllRoles","defaultCustomerRoles","defaultVisitorRoles","groupKeys","updatedAccounts","$size","$all","matchingUserIds","removeGroupsForShop","shopGroups","customer","guest","shopkey","multiArray","sorted","uniqueArray","i","primaryShop","merchantShops","updatedRegistry","app","entry","baseUOM","toLowerCase","unitsOfMeasure","uom","toUpperCase","reactionLogger","opts","level","config","logger","log","logIfLatest","migrateTo","module1","FileDownloadManager","FileRecord","MeteorFileCollection","RemoteUrlWorker","TempFileStore","TempFileStoreWorker","GridFSStore","sharp","lazyLoadSharp","downloadEndpointPrefix","absoluteUrlPrefix","absoluteUrl","gridFSStoresChunkSize","mongodb","NpmModules","imgTransforms","transform","size","mod","format","buildGFS","chunkSize","collectionPrefix","transformWrite","fileRecord","extension","resize","toFormat","stores","tempStore","shouldAllowRequest","uploadMetadata","baseUrl","connectHandler","allowInsert","can","for","allowUpdate","allowRemove","allowGet","files","downloadManager","remoteUrlWorker","fileCollections","start","fileWorker","updateMediaMetadata","insertMedia","removeMedia","updateMediaPriorities","fileRecordId","existingRevision","updatedMetadata","mediaRecordId","revisionMetadata","sortedMediaIDs","sortedMediaRecords","mediaRecord","writeToLog","logType","logLevel","logData","source","logEntry","data","logError","logWarning","date","DiscountCodes","DiscountCodesPackageConfig","MethodHooks","Random","DiscountSchema","preDiscount","preDiscountItemTotal","salePriceItemTotal","codeId","hasInvoice","amount","userCount","orderCount","objectToApplyDiscount","uniqueShopObj","shopObj","participatingShops","conditions","accountLimitExceeded","discountLimitExceeded","t","transactionCount","Set","y","orders","accountLimit","redemptionLimit","i18nKeyLabel","i18nKey","transactionId","_publishCursor","DiscountRatesPackageConfig","DiscountRates","rateId","SearchPackageConfig","_intersection","ProductSearch","getSearchParameters","buildAccountSearchRecord","buildOrderSearchRecord","buildProductSearchRecord","isAppTest","updateData","updatedFields","productDocument","allProps","topLevelFieldNames","getOwnPropertyNames","fieldSet","modifiedFields","Jobs","buildEmptyProductSearch","buildProductSearch","rebuildProductSearchIndex","addBuildProductSearchCollection","productSearchCount","retry","retries","wait","backoff","save","cancelRepeats","addBuildOrderSearchCollection","orderSearchCount","addBuildAccountSearchCollection","accountSearchCount","processJobs","pollInterval","workTimeout","job","done","repeatId","utils","_keys","fieldsChanged","changedFields","fieldType","weightsChanged","currentSettings","newSettingsArray","changedSettings","setting","currentSetting","rebuildJob","ensureProductSearchIndex","transformations","moment","lazyLoadMoment","requiredFields","products","accounts","supportedLanguages","filterFields","customFields","fieldNames","fieldKeys","fieldKey","getScores","weightObject","weights","getSearchLanguage","shopLanguage","default_language","handleIndexUpdateFailures","productRecord","productSearchRecord","Function","indexObject","rawProductSearchCollection","rawCollection","dropIndexes","catch","createIndex","anonymousUserEmail","userEmails","orderSearch","shopBilling","shopShipping","billingName","fullName","billingPhone","phone","shippingName","shippingPhone","billingAddress","address1","city","orderTotal","total","orderDate","billingStatus","billingCard","storedCard","shippingStatus","optionTitle","rawOrderSearchCollection","accountSearch","searchableFields","shouldRunIndex","rawAccountSearchCollection","_replace","_split","fieldData","values","profileObject","firstName","lastName","getResults","escapeStringRegex","supportedCollections","getProductFindTerm","searchTerm","searchTags","findTerm","$text","$search","facets","maxResults","productResults","score","$meta","orderResults","regexSafeSearchTerm","$options","accountResults","searchPhone","Where","coll","buildSearchCollectionJob","pageTitle","vendor","ShippoPackageConfig","addressSchema","purchaseAddressSchema","parcelSchema","object_purpose","company","street1","street_no","street2","state","zip","regEx","RegEx","Email","is_residential","width","height","distance_unit","mass_unit","extra","getShippingRates","previousQueryResults","merchantShippingRates","fatal","pkgData","retrialTargets","shippo","shippoDocs","shippoProvider","carrierAccountId","targets","shippingRatesInfo","shippoRates","singleRetrialTarget","fetchTrackingStatusForOrdersJob","setupShippoTrackingStatusHook","getJobConfig","getOwnerUserId","owner","refreshPeriod","repeat","schedule","text","ownerId","runAsUser","flatten","_difference","ShippoApi","createShippoAddress","reactionAddress","purpose","shippoAddress","address2","isCommercial","createShippoParcel","reactionParcel","cartWeight","reactionMassUnit","reactionDistanceUnit","shippoParcel","getTotalCartweight","totalWeight","cartItem","itemWeight","parcel","ratesParser","rateAmount","reactionRate","carrier","handling","servicelevel_name","object_id","serviceLevelToken","servicelevel_token","carrier_account","filterActiveCarriers","carrierList","activeCarriers","results","active","formatCarrierLabel","carrierName","getApiKey","apiKey","addShippoProviders","carriers","carrierLabel","currentResult","removeShippoProviders","carriersIds","updateShippoProviders","currentShippoProviders","currentCarriersIds","newActiveCarriers","unchangedActiveCarriersIds","carrierId","deactivatedCarriersIds","customModifier","getAddressList","getCarrierAccountsList","shippoOrders","updatingResult","orderShipment","getTransaction","trackingStatus","tracking_status","status_date","trackingStatusDate","orderUpdating","currentMethodInfo","fileName","errorDetails","requestStatus","shippingProvider","isRetry","isNotAmongFailedRequests","target","shippoAddressTo","$elemMatch","shippoAddressFrom","unitOfMeasure","unitOfLength","buyer","carrierAccounts","shippoShipment","createShipment","errorData","rates_list","noShippingMethods","reactionRates","createTransaction","label_url","tracking_number","Shippo","ValidatedMethod","validator","shippoObj","set","getAddressListFiber","wrapAsync","list","allCarriers","fetchCarriers","response","carrieraccount","createFullPath","createShipmentFiber","shipment","create","address_from","address_to","carrier_accounts","async","createTransactionFiber","label_file_type","object_status","messages","retrieveTransactionFiber","retrieve","getApiInfo","shopifyPkg","getPackageSettingsWithOptions","password","shopName","Shopify","apiCreds","shopify","Maybe","published_status","exportToShopify","accounting","convertWeight","convertOrderToShopifyOrder","existingCustomer","paymentType","itemsForShop","getItemsByShop","shopifyOrder","billing_address","convertAddress","shipping_address","convertCustomer","mode","financial_status","line_items","convertLineItems","shipping_lines","convertShipping","source_name","subtotal_price","getSubtotalByShop","total_discounts","getDiscountsByShop","total_line_item_price","total_price","getTotalByShop","total_tax","getTaxesByShop","total_weight","grams","normalizeWeight","lineItems","lineItem","fulfillable_quantity","fulfillment_service","fullfillment_status","product_id","requires_shipping","requiresShipping","sku","variant_id","variant_title","tax_lines","taxItem","lineNumber","detail","taxLine","taxName","toFixed","taxCalculated","convertedAddress","country_code","first_name","last_name","join","province_code","isExistingCustomer","customerByEmailPromise","search","normalizePhone","phoneToNormalize","countryCode","formattedPhone","accepts_marketing","shippingLines","shippingMethod","numShopOrders","shopifyOrders","existingCustomerQuery","newShopifyOrder","markExported","exportedOrder","exportHistory","dateAttempted","exportMethod","destinationIdentifier","createReactionCustomerFromShopifyCustomer","shopifyCustomer","reactionProfile","getPrimaryShopCurrency","fakePhone","fakeZip","reactionCustomer","created_at","acceptsMarketing","note","shopifyId","orders_count","skipRevision","addresses","default_address","shopifyCustomerAddress","province","isBillingDefault","isShippingDefault","customerCount","numPages","ceil","pages","page","shopifyCustomers","reactionCustomerId","importImages","createReactionProductFromShopifyProduct","shopifyProduct","reactionProduct","body_html","productType","product_type","scope","createReactionVariantFromShopifyVariant","shopifyVariant","reactionVariant","barcode","compareAtPrice","compare_at_price","inventory_policy","inventory_quantity","weightInGrams","inventory_management","findVariantImages","shopifyVariantId","images","imageObj","variant_ids","findProductImages","shopifyProductId","createTagCache","cache","getShopifyVariantsAndOptions","shopifyVariants","shopifyOptions","shopifyTernaryOptions","saveImage","tagCache","shopifyProducts","shopifyTags","normalizedTag","reactionProductId","src","productImages","productImage","option1","reactionVariantId","j","shopifyOption","o","option2","reactionOption","reactionOptionId","optionImages","optionImage","entries","ternaryOption","shopifyTernaryOption","option3","reactionTernaryOption","reactionTernaryOptionId","ternaryOptionImages","ternaryOptionImage","variantImages","variantImage","hook","checked","topic","event","syncType","hookSetting","$not","findBottomVariant","bottomVariant","adjustInventory","variantsWithShopifyId","eventLog","integrations","webhooksDomain","integrationsByTopic","topics","integration","splitIntegration","host","webhookAddress","webhooks","webhook","webhookResponse","shopifyWebhookId","delete","statusCode","registeredShopifyWebhooks","responses","all","ShopifyCustomer","ShopifyProduct","verifyWebhook","shopUrl","hmac","createHmac","sharedSecret","rawBody","Endpoints","sendResponse","body","addExportJob","shopIdsInCart","uniqueShopIds","synchooks","addMediaFromUrl","fromUrl","fail","exportOrders","markExportFailed","exportedOrders","observe","added","trigger","Express","getSettings","ref","valueName","expressCheckoutAccountOptions","express_mode","paypal","username","signature","merchantId","return_url","getAbsoluteUrl","cancel_url","accountOptions","PayPal","PayFlow","payflowAccountOptions","payflow_mode","client_id","client_secret","authorize","cardInfo","paymentInfo","capture","captureDetails","is_final_capture","paymentObj","intent","payer","payment_method","funding_instruments","parseCardData","credit_card","number","cvv2","expire_month","expire_year","parsePaymentData","_last","HTTP","PaymentMethodArgument","nvpVersion","getTotal","shippingAmt","getShippingTotal","taxAmt","getTaxTotal","itemAmt","getDiscounts","post","USER","PWD","SIGNATURE","SOLUTIONTYPE","VERSION","PAYMENTACTION","AMT","ITEMAMT","SHIPPINGAMT","TAXAMT","RETURNURL","CANCELURL","DESC","NOSHIPPING","ALLOWNOTE","CURRENCYCODE","METHOD","INVNUM","CUSTOM","parsedResponse","parseResponse","ACK","L_LONGMESSAGE0","TOKEN","payerId","captureAtAuth","getSetting","paymentAction","PAYERID","L_ERRORCODE0","expressCheckoutSettings","clean","authorizationId","TRANSACTIONID","currencycode","AUTHORIZATIONID","NOTE","COMPLETETYPE","saved","rawTransaction","previousTransaction","REFUNDTYPE","amountFormatted","created","refundTransactionId","REFUNDTRANSACTIONID","grossRefundAmount","GROSSREFUNDAMT","netRefundAmount","NETREFUNDAMT","correlationId","CORRELATIONID","STARTDATE","TRANSACTIONCLASS","parseRefundReponse","pieces","piece","subpieces","decodeURIComponent","decodedResult","paypalArray","timeStampKey","timestamp","typeKey","transactionType","amountKey","currencyCodeKey","responseObject","valueOf","abs","parameter","PayflowproMethods","paymentSubmit","paymentCapture","createRefund","listRefunds","PayflowproApi","_isObject","apiCall","paymentSubmitDetails","configure","cardData","paymentData","wrappedFunc","payment","captureCharge","paymentCaptureDetails","authorization","wrappedFuncVoid","void","captureTotal","round","capturedAmount","parentPaymentId","parent_payment","captureId","refundDetails","refund","create_time","refundListDetails","listPayments","authId","resource","related_resources","unix","refundResult","payflowSettings","allowEval","expressAuthAndCapture","support","payflow","blocks","columns","element","className","fieldName","fieldTitle","textFieldProps","i18nKeyPlaceholder","placeholder","style","minWidth","maxWidth","axis","align","padding","justify","multiline","placement","paddingTop","twoColumn","display","SimpleLayout","TwoColumnLayout","registerTemplate","templateFor","CartSchema","shippingErrorDetails","shippingRecord","flatRates","shippingCollection","initialNumOfRates","_results","ShippingMethod","cost","providerId","defaultProvider","methodId","shippingMethods","updatedMethods","deleted","coreDefaultTemplate","inviteNewShopMemberTemplate","inviteShopMemberTemplate","inviteShopOwnerTemplate","resetPaswordTemplate","welcomeEmailTemplate","verifyUpdatedEmailTemplate","verifyEmailTemplate","coreOrderNewTemplate","orderShipped","orderRefunded","orderItemRefund","TemplatePaths","getTemplateFile","SHOP_WORKFLOW_STATUS_ACTIVE","SHOP_WORKFLOW_STATUS_DISABLED","SHOP_WORKFLOW_STATUS_ARCHIVED","marketplaceUpdateShopWorkflow","_without","sellerShopId","getSellerShopId","sellerShopsSubPub","pubShopIds","sellerShopsObserver","paymentMethods","document","removed","onStop","ownedSellerShopSubPub","ownedSellerShopObserver","enabledShopTypes","enabledPackagesByShopTypes","enabledPackages","allowMerchantSignup","marketplaceNakedRoutes","merchantCart","merchantFulfillment","merchantLocale","merchantTheme","hideForShopTypes","registerInventory","newItemId","variantItem","markInventoryShipped","orderItems","orderItem","cartItemId","markInventorySold","simpleSchema","totalNewInventory","inventory","inventoryVariantCount","newQty","batch","_collection","initializeUnorderedBulkOp","_makeNewID","execute","inventoryItem","inserted","nInserted","calledByServer","qty","itemCount","removeQty","removeInventory","currentStatus","notFoundStatus","CartItem","reservationStatus","defaultStatus","backorderStatus","reservationCount","existingReservations","orderItemId","availableInventory","totalRequiredQty","availableInventoryQty","existingReservationQty","backOrderQty","reservation","newReservedQty","newStatus","oldStatus","reservationsCount","clearCount","newReservation","inventoryBackorder","setupStaleCartHook","cartCleanupJob","ServerSessions","getstaleCarts","olderThan","$lte","getShopSettings","removeStaleCart","cleanupDurationDays","match","subtract","_d","carts","removeCart","removeAccount","destroySession","sessionId","addCleanupJobControlHook","cleanupJob","removeStaleJobs","updated","$lt","removeJobs","setupFetchFlushCurrencyHooks","fetchRateJobs","exchangeConfig","openexchangerates","appId","fetchCurrencyRates","flushCurrencyRates","getAdminUserId","admin","sendNotificationToAdmin","adminId","getShopPrefix","sms","OptionalOrNull","types","orderCanceled","newOrder","forAdmin","orderDelivered","orderProcessing","to","hasDetails","AuthNetAPI","ValidCardNumber","ValidExpireMonth","ValidExpireYear","ValidCVV","getAccountOptions","isPayment","queryConditions","authnet","login","tran_key","authnetSubmit","cardNumber","expirationYear","expirationMonth","creditCard","creditCardNumber","authnetService","getAuthnetService","authnetTransactionFunc","authResult","roundedAmount","captureResult","voidTransaction","responseCode","priorAuthCaptureTransaction","Any","API_LOGIN_ID","TRANSACTION_KEY","testMode","transId","refTransId","transactionRequest","sendTransactionRequest","trans","BraintreeMethods","BraintreeApi","Future","getPaymentObj","submitForSettlement","cardholderName","cvv","environment","braintree","publicKey","privateKey","getGateway","isNewPayment","Environment","Production","Sandbox","gateway","connect","getRefundDetails","refundId","braintreeFind","findResults","fut","sale","bindEnvironment","return","errorCollections","validationErrors","refundIds","currencyIsoCode","paymentSubmitResult","paymentCaptureResult","refundListResult","authCode","stripePkg","api_key","merchantStripePkg","connectAuth","stripe_user_id","stripeAuthUrl","grant_type","error_description","stripeNpm","cvc","exp_month","exp_year","formatForStripe","unformatFromStripe","getStripeApi","stripePackage","stripeKey","access_token","stripeCaptureCharge","stripe","capturePromise","charges","normalizeStatus","failure_code","captured","normalizeMode","normalizeRiskLevel","outcome","risk_level","buildPaymentMethods","cartItemsByShop","transactionsByShopId","charAt","riskLevel","card","customerAccount","customerEmail","defaultEmail","stripeApiKey","customers","cust","customerCard","createSource","cartTotals","cartSubtotals","isPrimaryShop","stripeOptions","stripeCharge","stripeUserId","stripe_account","tokens","dashboardAppFee","applicationFee","percentAppFee","coreApplicationFee","application_fee","idempotency_key","charge","rawType","unformat","voidedAmount","reason","refundPromise","refunds","refundListResults","refundListPromise","taxCodes","populateTaxCodes","providerName","taxCodeProvider","ssuta","isSSTCertified","parentTaxCode","formatPhoneNumber","Twilio","lazyLoadTwilio","Nexmo","lazyLoadNexmo","smsDetails","smsSettings","apiToken","smsPhone","smsProvider","client","apiSecret","sendSms","updateSocialSetting","updateSocialSettings","_extend","DefaultSocialApp","profilePage","autoInit","apps","facebook","twitter","googleplus","pinterest","appsOrder","iconOnly","faSize","faClass","targetWindow","taxCalc","linesToTaxes","lines","line","discountAmount","isItemTaxable","taxableAmount","markCartTax","bypassAddressValidation","getPackageData","avalara","performTaxCalculation","estimateCart","taxAmount","totalTaxes","calcTaxable","errorCode","recordOrder","refundAmount","reportRefund","setupAvalaraCleanupHook","cleanupAvalogs","cleanupAvalaraJobs","saveDuration","logRetentionDuration","bunyan","BunyanMongo","levelToName","write","avalog","streams","stream","Avalogger","createLogger","os","ErrorObject","countriesWithRegions","getUrl","checkConfiguration","isValid","msg","getAuthData","auth","getTaxSettings","parseError","errorDetail","errorObjectContext","newContext","avaGet","requestUrl","testCredentials","logObject","appVersion","getAppVersion","meteorVersion","release","machineName","avaClient","timeout","requestTimeout","allOptions","enableLogging","request","parsedError","duration","avaPost","getEntityCodes","subTotal","validateAddress","countryList","addressValidation","validatedAddress","addressToValidate","line1","postalCode","line2","summary","validatedAddresses","resultAddress","credentials","companyCode","getTaxCodes","cartToSalesOrder","shippingTaxCode","companyShipping","cartShipping","cartDate","itemObj","itemCode","taxDescription","salesOrder","customerCode","ShipFrom","ShipTo","discounted","orderToSalesInvoice","commitDocuments","orderShipping","salesInvoice","commit","returnAmount","refundDate","refundReference","returnInvoice","taxOverride","taxDate","apiLoginId","addressValidationMethod","getTaxCodeMethod","origin","taxcloud","shopAddress","Address1","City","State","Zip5","destination","Index","ItemID","TIC","Price","Qty","customerID","cartID","deliveredBySeller","ResponseType","CartItemsResponse","TaxAmount","errMsg","Messages","Message","taxCodeArray","TAXCODE_SRC","tic_list","tic","taxCodeUrl","taxjar","ExampleApi","luhnValid","c","test","expireMonth","expireYear","PaymentMethod","emptyResult","riskStatus","RISKY_TEST_CARD","cardSchema","paymentDataSchema","ThirdPartyAPI","decimal","MetaData","ReactionProduct","init","selectedProduct","keywords","titleCase","param","currentShop","DOM","removeDocHeadAddedTags","setMetaTag","LoginFormValidation","validationMethods","i18nKeyReason","processedEmail","trim","passwordOptions","validationLevel","applyProductRevision","setProduct","currentProductId","currentVariantId","setCurrentVariant","visibileVariant","getPublishedOrRevision","getVariantParent","getSiblings","_isEqual","Core","isPackageEnabled","getSeller","getGroupsForUser","noFallback","seller","getSellerShop","getShopsForUser","filteredShopIds","shopIdsWithRoles","shopsWithPermission","rolesUserHas","hasRole","roleUserHas","hasPermissionForAll","shopsOfUser","latinLangs","getShopName","getShopLang","getPrimaryShopLang","getCurrentTag","toCamelCase","translateRegistry","isObject","mergeDeep","getPrimaryMediaForItem","getPrimaryMediaForOrderItem","ValidEmail","isValidNumber","getPhoneCode","slugify","lazyLoadSlugify","lang","leading","absUrl","slugString","phoneNumber","countryExtension","needscamels","s","registryLabel","i18nKeyDescription","i18nKeyTooltip","i18nKeyTitle","convertedWeight","findOneLocal","PropTypes","pattern","OrderHookOptions","variantIsSelected","resubscribeAfterCloning","_isArray","i18next","orderBy","ReactiveDict","ReactiveVar","__revisions","cleanProduct","revisedProduct","__published","__draft","selectedVariant","sortProducts","selectedVariantId","currentId","changedHandleWas","newUrl","isVariantValidChild","topVariants","selectedProductId","selectedTopVariant","checkChildVariants","parentVariantId","childVariants","checkInventoryVariants","inventoryVariants","getTag","getProductsByTag","newRelatedTags","relatedTag","relatedTags","publishProduct","productOrArray","Alerts","alertSettings","autoHide","dismissable","toggleVisibility","cloneProduct","archiveProduct","confirmTitle","alert","showCancelButton","confirmButtonText","isConfirm","toast","isAncestorDeleted","includeSelf","_every","TagSchema","propName","arrayOfTags","valid","Profile","createdAtAutoValue","updatedAtAutoValue","Metafield","TaxSettings","exemptionNo","customerUsageType","verified","Id","withoutCodeCountries","CartItems","shopIdAutoValueForCart","Payment","ProductVariant","Shipment","ShippingParcel","Workflow","isInsert","isUpdate","isFromTrustedCode","contentType","html","jobId","Event","schemaIdAutoValue","shopDefaultCountry","closestSubschemaFieldName","isUpsert","$setOnInsert","isSet","operator","defaultShippingAddress","Document","Notes","LayoutStructure","Layout","handled","valueType","Notification","timeSent","History","ExportHistory","OrderItem","OrderTransaction","Order","OrderDocument","docType","itemId","paymentId","shipmentId","inventoryId","PaymentItem","Invoice","CurrencyExchangeRate","Refund","userCurrency","exchangeRate","VariantMedia","ProductPosition","PriceRange","siblingField","ErrorTypes","REQUIRED","Permissions","Registry","CorePackageConfig","ShippoShippingMethod","ShipmentQuote","ShipmentItem","ShippoShipment","ShipmentQuotesQueryStatus","ShippoShippingProvider","ShippingProvider","ShippingPackageConfig","containers","trackingStatusStatus","numOfShippingMethodsFound","serviceAuth","serviceSecret","serviceUrl","CustomEmailSettings","Locale","Languages","ShopTheme","BrandAsset","port","symbol","scale","thousand","continents","countries","i18n","themeId","styles","mediaId","MerchantShop","SocialProvider","SocialPackageConfig","Url","ReactLayout","sharedFields","block","defaultData","parser","Translation","translation","cartOrderTransform","_sortBy","_values","getSummary","prop","prop2","getCount","getShippingTotalByShop","uniqueShopShippingTotals","shippingRec","uniqueShopSubTotals","taxTotal","subtotals","taxRates","shopTaxTotals","shopSubtotal","shopTaxTotal","orderDiscounts","cartDiscount","discountsByShop","billingRecord","discountTotal","shippingTotalByShop","shopsInCart","shopTotals","shopTaxes","shopTotal","itemsByShop","getPaymentMethods","billingMethods","methodObjects","paymentMethodObject","getUniquePaymentMethods","uniqueMethods","billingMethod","uniqueValueArray","getShopSummary","taxesByShop","subTotalsByShop","shippingByShop","shopItems","shopObjects","quantityTotal","sortedShopObjects","shopObject","mediaRecordsIndex","rawMedia","background","newInstance","sellerShops","noCollectionSuffix","strings","getTagIds","getVariantIds","sendResetPasswordEmail","sendVerificationEmail","sendUpdatedVerificationEmail","_find","SSR","optionalEmail","mailInfo","secret","tokenObj","_ensure","reset","emailLogo","getShopLogo","copyrightDate","getFullYear","dataForEmail","contactEmail","homepage","legalName","physicalAddress","socialLinks","link","googlePlus","passwordResetUrl","urls","resetPassword","tpl","compileTemplate","getTemplate","getSubject","send","getShopEmail","render","unverifiedEmail","verifyEmail","github","instagram","confirmationUrl","userEmailAddress","getMailUrl","getMailConfig","verifyConfig","nodemailer","getServiceConfig","shopSettings","shopMail","mail","processUrl","MAIL_URL","settingsUrl","mailString","conf","encodeURIComponent","mailUrl","parsedUrl","creds","secure","EMAIL_DEBUG","pass","ignoreTLS","direct","transporter","createTransport","verify","getShopLanguage","tmpl","file","getText","brandAssets","brandAsset","asset","absolute","addRolesToUsersInGroups","groupsToUpdate","groupAndShopIds","$each","assignOwnerRoles","pkgName","roleName","defaultOwnerRoles","owners","shopOwners","getUsersInRole","addUsersToRoles","inMemoryCache","connectionKey","connectionData","_CurrentMethodInvocation","_CurrentPublicationInvocation","hasDataKey","val","clear","_has","_uniqWith","packageJson","EJSON","ProcessJobs","createGroups","ConnectionDataStore","AccountsCollection","_sleepForMs","startJobServer","VERBOSE_JOBS","setLogStream","stdout","createDefaultAdminUser","setAppVersion","registeredPackage","canInviteToGroup","userPermissions","groupPermissions","checkPermissions","checkGroup","hasOwnerAccess","hasAdminAccess","hasDashboardAccess","getShopsWithRoles","shopIdsUserHasRoleFor","configureMailUrl","getPrimaryShop","getPrimaryShopName","getPrimaryShopPrefix","getPrimaryShopSettings","getCurrentShopCursor","getCurrentShop","currentShopCursor","getUserShopId","resetShopId","getUserPreferences","preference","lowerCaseShopName","getShopCurrency","getShopCurrencies","setUserPreferences","setPreferenceResult","insertPackagesForShop","matchingShopType","EnabledPackagesByShopType","uniqLayouts","isSecureSetup","REACTION_SECURE_DEFAULT_ADMIN","defaultPassword","defaultUsername","defaultName","configureEnv","REACTION_EMAIL","REACTION_AUTH","REACTION_USER_NAME","REACTION_USER","reaction","createUser","defaultAdminRoles","setUserRoles","registryFixtureData","REACTION_REGISTRY","validatedJson","settingsFromPackage","settingsFromFixture","packageSetting","settingsFromDB","ps","combinedSettings","package","collectionSchema","selectorErrMsg","col","_isFunction","Fiber","connectRoute","buf","extended","middleWare","Middleware","connectRouter","router","writeJsonToBody","shouldPrettyPrint","NODE_ENV","spacer","setHeader","errorMiddlewares","ErrorMiddleware","startup","errorMiddleware","errorMiddlewareFn","maybeFn","responseHeaders","handler","slashedPath","headerKeys","setResponseHeaders","end","allGroups","getDefaultGroupRoles","createGroupsForShop","groupKey","groupExists","grp","primaryShopGroup","Fixture","_buffers","_contexts","_count","_indications","_limit","_name","_upsert","load","identify","probability","probabilities","buffer","nImported","nModified","nUpserted","nTouched","nMatched","nRemoved","writeErrors","getWriteErrors","errmsg","writeConcernError","getWriteConcernError","namedContext","NpmModule","templateInfo","modifiedKey","importKey","importObject","cleanedModifier","isModifier","extendAutoValueContext","array","Log","AddDefaultRoles","AssignRoles","LoadSettings","SetDomain","ShopName","Utils","loadSettings","ServiceConfiguration","exists","configurations","doRightJoinNoIntersection","leftSet","rightSet","rightJoin","findRightOnlyProperties","rightSubJoin","getRegistryDomain","setDomain","currentDomain","_error","setShopName","REACTION_SHOP_NAME","existingShopWithName","TEMPLATE_PARSER_REACT","TEMPLATE_PARSER_HANDLEBARS","registerTemplateForMemoryCache","registerTemplateForDatabase","processTemplateInfoForMemoryCache","processTemplateInfoForDatabase","registerTemplateParser","renderTemplate","compileHandlebarsTemplate","renderHandlebarsTemplate","renderTemplateToStaticMarkup","resetRegisteredTemplates","initTemplates","ReactDOMServer","Handlebars","registeredTemplates","OrderedMap","templateCache","templateParsers","insertImmediately","literal","reference","templateLiteral","templateReference","templateInfoForMemoryCache","shopTemplates","templateInfoForDatabase","templateName","registeredTemplate","isOriginalTemplate","toObject","templateData","renderFunction","compiledTemplate","renderToStaticMarkup","GeoCoder","self","google","clientId","geocoderProvider","httpAdapter","gc","g","geocode","geoCoderGeocode","geoCallback","geoAddress","rv","lat","lng","lon","geoCoderReverse","latitude","longitude","stateCode","zipcode","streetName","streetNumber","gi","lookupAddress","NODE_TLS_REJECT_UNAUTHORIZED","geoip","_isUndefined","_toArray","_afterHooks","_beforeHooks","_handlers","_methodHandlers","_originalMethodHandlers","_wrappers","_initializeHook","mapping","hookFunction","inputArgs","beforeResult","beforeHooks","beforeHook","hooksProcessed","methodResult","methodError","afterHooks","afterHook","hookResult","_debug","beforeFunction","afterFunction","beforeMethods","dict","afterMethods","quantityProcessing","itemQty","MIN","minOrderQuantity","MAX","Infinity","getSessionCarts","$eq","allowedCarts","removeShippingAddresses","sRecord","currentSessionId","sessionCarts","sessionCart","cartSum","mergedItems","newItems","existingItem","$slice","anonymousUser","sessionCartCount","currentCartId","additionalOptions","overwriteExistingMetafields","cartVariantExists","updateResult","immediateAncestors","ancestor","immediateAncestor","cartResult","getAutoValues","removeQuantity","shipRecord","userCurrencyString","needToUpdate","isShippingDeleting","cartShippingByShop","cartSubTotal","cartSubtotalByShop","cartTaxes","cartTaxesByShop","cartDiscounts","cartTotal","cartTotalByShop","paymentAddress","discountRecords","billingInfo","currentUserCart","newEmail","copyCartToOrder","shippingRecords","userExchangeRate","shipmentItem","newCartExists","groupData","defaultCustomerGroupForShop","defaultAdminPermissions","newGroupData","setUserPermissions","loggedInUserId","canInvite","allGroupsInShop","currentUserGroups","newGroups","currentUserGrpInShop","changeMarketplaceOwner","affectedUsers","orderCreditMethod","orderDebitMethod","ordersInventoryAdjust","ordersInventoryAdjustByShop","orderQuantityAdjust","_omit","formatDateForEmail","emailDate","year","month","getMonth","day","getDate","paddedMonth","paddedDay","creditBillingRecords","debitBillingRecords","refundedItem","newQuantity","refundedQuantity","returnToStock","orderIsApproved","invoiceTotal","paymentMethodId","paymentMethodName","getPaymentMethod","isRefundable","processPayment","completedItemsResult","completedOrderResult","workflowResult","completedItems","completedOrder","isCompleted","action","shippingCost","tracking","refundTotal","userCurrencyFormatting","userCurrencyExchangeRate","combinedItems","foundItem","combinedItem","displayPrice","formatMoney","placeholderImage","adjustedTotal","orderUrl","bilingRecord","bRecord","shopRefunds","sendEmail","checkSupportedMethods","orderMode","refundItemsInfo","refundItems","originalQuantity","refundItem","refundedStatus","updatePackage","billingId","dataToSave","currentPackage","createShipmentQuotes","shipmentQuotes","shipmentQuotesQueryStatus","pruneShippingRecordsByShop","normalizeAddresses","updateShipmentQuotes","updateShippingRecordByShop","cartForShipping","getDefaultAddress","addressEntry","addAddresses","newRates","updateShopBrandAssets","cloneShop","partialShopData","cleanShop","shopWithBrandAsset","shopAdminUserId","hasPrimaryShopOwnerPermission","allowMerchantShopCreation","currentAccount","shopUser","shopAccount","newShopId","newShop","ownerGroup","clientAddress","geo","defaultCountryCode","localeCurrency","locales","geoCountryCode","locale","shopCurrency","profileCurrency","baseCurrency","shopCurrencies","openexchangeratesAppId","rateUrl","rateResults","exchangeRates","currencyConfig","currencyKey","rateUpdate","collectionKey","setHours","getHours","now","fetchCurrencyRatesJob","tagName","currentTagId","newTagId","newTag","existingTag","shopWorkflows","defaultWorkflows","defaultLanguage","updateObject","languages","languageData","defaultCurrency","currencyName","newLayout","_map","findUserByEmail","caseInsensitiveEmail","verifyAccount","updateEmailAddress","removeEmailAddress","syncUsersAndAccounts","addressBookAdd","addressBookUpdate","addressBookRemove","inviteShopOwner","sendWelcomeEmail","addUserPermissions","removeUserPermissions","createFallbackLoginToken","setProfileCurrency","_startCase","_upperCase","_trim","MeteorAccounts","addEmail","removeEmail","getValidator","geoCoders","geoCoder","coder","registryName","packageKey","compareAddress","validationAddress","totalErrors","validated","suggestedAddress","formErrors","validationResult","failedValidation","validationResults","fieldErrors","enteredAddress","currentUserHasPassword","accountUserId","userUpdateQuery","accountsUpdateQuery","oldAddress","addr","updatedAccountResult","shopData","invited","currentUserName","getCurrentUserName","getDataForEmail","tokenUpdate","groupName","verificationUrl","userEmail","shopEmail","removeUsersFromRoles","invitedUserName","getEmailUrl","userToken","enrollAccount","stampedLoginToken","_generateStampedLoginToken","_insertLoginToken","currentUserId","markAddressValidationBypassed","markTaxCalculationFailed","taxCalculationFailed","updateVariantProductField","toDenormalize","createTitle","titleCount","titleNumberSuffix","titleString","copySuffix","createHandle","productHandle","handleCount","handleNumberSuffix","handleString","newHandleCount","copyMedia","newId","variantOldId","variantNewId","fileRecords","fullClone","denormalize","flushQuantity","productUpdate","createProduct","newProduct","updateCatalogProduct","shouldUpdateProduct","sortedVariants","sortedVariant","oldId","parentIndex","ancestorsClone","parentId","newVariant","newVariantId","assembledVariant","currentVariant","variantUpdateResult","toDelete","prod","pool","getIds","pair","setId","buildAncestors","newAncestors","productNewId","publishedAt","newSimpleProduct","extractedProductId","productsWithVariants","toArchiveProduct","numFlaggedAsDeleted","booleanValue","stringValue","getSet","existingHandles","currentProduct","currentProductHandle","positionData","sortedVariantIds","updatedMeta","variantValidator","updatedPriceRange","emailJobId","getJob","_doc","restart","rerun","reloadAllTranslations","reloadTranslationsForShop","tran","setTran","checkUserId","nonAdminGroups","profileUserId","variantIds","productGridMediaPublish","productMediaPublish","readPermissions","ReactiveAggregate","createAggregate","aggregate","$match","$project","$filter","as","cond","$sort","$skip","$limit","aggregateOptions","observeSelector","noReady","currentShopId","registrySettings","packageSettings","hasAdmin","myShopId","observer","newDoc","origDoc","productIdOrHandle","shopIdOrSlug","_documents","filters","extendSelectorWithVariants","productFilters","newSelector","filterProducts","shopIdsOrSlugs","visibility","$gte","pmin","pmax","$gt","wmin","wmax","productScrollLimit","editMode","userAdminShopIds","activeShopsIds","activeShop","productSelectorWithVariants","revisionSelectorWithVariants","productCursor","pipelines","_getCollection","bind","_getDb","mongoConn","wrapWithDb","pub","pipeline","allowDiskUse","MONGO_ALLOW_DISK_USE","defaultOptions","observeOptions","clientCollection","pubOptions","initializing","_ids","_iteration","observeChanges","newSessionId","serverSession","marketplaceCurrency","marketplaceLanguages","marketplaceLocales","sessionLanguages","langTranQuery","sessionLanguage","payload","jobs","transport","sendMail","_set","validateLoginAttempt","attempt","allowed","loginEmail","methodArguments","adminEmail","registerLoginHandler","anonymous","stampedToken","insertUserDoc","loginHandler","onCreateUser","groupToAddUser","additionals","defaultGuestRoles","userServices","serviceObj","picture","profile_image_url_https","dprofile_image_url_https","profile_picture","full_name","bio","userDetails","userDoc","onLogin","$pullAll","rawConnectHandlers","_parsedUrl","pathname","allowConnectOrigin","framing","allowAll","allowImageOrigin","allowFontDataUrl","defineMethod","allow","arg","deny","ifHasRoleForActiveShop","ifShopIdMatches","exceptProps","allowInClientCode","ifFileBelongsToShop","ifShopIdMatchesThisId","ifUserIdMatches","ifSessionIdMatches","loadTranslation","flushTranslationLoad","loadCoreTranslations","importAllTranslations","fsModule","util","fs","readdir","promisify","readFile","realpath","stat","translationSources","rawAssetsCollection","bulkAssetOp","directoryExists","dirPath","isDirectory","sources","meteorPath","cwd","i18nFolder","promises","fileContents","i18nAssetCount","CollectionSecurity","LoadFixtureData","Prerender","RateLimiters","RegisterCore","RegisterRouter","defineValidationErrorTransform","ddpError","startTime","endTime","loadData","SKIP_FIXTURES","preRender","prerender","PRERENDER_TOKEN","PRERENDER_HOST","setRateLimits","DDPRateLimiter","authMethods","addRule","connectionId","allowGuestCheckout","defaultPaymentMethod","on"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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EAA7F,CAAjB,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","file":"/app.js","sourcesContent":["import { registerSchema } from \"@reactioncommerce/schemas\";\nimport { PackageConfig } from \"/lib/collections/schemas/registry\";\nimport { Discounts } from \"./discounts\";\n\n/**\n* DiscountsPackageConfig Schema\n*/\n\nexport const DiscountsPackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.rates\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.rates.enabled\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"settings.rates.discounts\": {\n    type: Array,\n    optional: true\n  },\n  \"settings.rates.discounts.$\": {\n    type: Discounts\n  }\n});\n\nregisterSchema(\"DiscountsPackageConfig\", DiscountsPackageConfig);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { shopIdAutoValue } from \"/lib/collections/schemas/helpers\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n// The Discounts Schema validates using multiple schemas\n// be sure to use `{ selector: { discountMethod: \"code\" } }`\n// to indicate which schema to apply in all updates\n\n/*\n* Discounts Tranaction History Schema\n*/\nexport const Transactions = new SimpleSchema({\n  cartId: {\n    type: String,\n    index: 1\n  },\n  userId: {\n    type: String,\n    index: 1\n  },\n  appliedAt: {\n    type: Date,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Transactions\", Transactions);\n\n/*\n* Discounts Schema\n*/\n\nexport const Discounts = new SimpleSchema({\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValue,\n    index: 1,\n    label: \"Discounts shopId\"\n  },\n  \"label\": {\n    type: String,\n    optional: true\n  },\n  \"description\": {\n    type: String,\n    optional: true\n  },\n  \"discountMethod\": {\n    label: \"Discount Method Type\",\n    type: String,\n    index: 1,\n    allowedValues: [\"code\", \"rate\"]\n  },\n  // discount is allowed to be string or number.\n  // it's a formula value (could be shipping code)\n  \"discount\": {\n    type: String,\n    optional: true\n  },\n  \"transactions\": {\n    type: Array,\n    optional: true\n  },\n  \"transactions.$\": {\n    type: Transactions\n  },\n  \"calculation\": {\n    type: Object,\n    optional: true,\n    label: \"Calculation\",\n    defaultValue: {}\n  },\n  \"calculation.method\": {\n    type: String,\n    index: 1,\n    defaultValue: \"discount\",\n    allowedValues: [\"credit\", \"discount\", \"sale\", \"shipping\"]\n  },\n  \"conditions\": {\n    type: Object,\n    optional: true,\n    label: \"Conditions\",\n    defaultValue: {}\n  },\n  \"conditions.order\": {\n    type: Object,\n    defaultValue: {}\n  },\n  \"conditions.order.min\": {\n    type: Number,\n    label: \"Mininum\",\n    defaultValue: 0.00\n  },\n  \"conditions.order.max\": {\n    type: Number,\n    label: \"Maximum\",\n    optional: true\n  },\n  \"conditions.order.startDate\": {\n    type: Date,\n    label: \"Start\",\n    optional: true\n  },\n  \"conditions.order.endDate\": {\n    type: Date,\n    label: \"End\",\n    optional: true\n  },\n  \"conditions.enabled\": {\n    type: Boolean,\n    label: \"Enabled\",\n    defaultValue: true,\n    optional: true\n  },\n  \"conditions.audience\": {\n    type: Array,\n    optional: true,\n    label: \"Audience\"\n  },\n  \"conditions.audience.$\": {\n    type: String,\n    optional: true,\n    label: \"Audience\"\n  },\n  \"conditions.permissions\": {\n    type: Array,\n    optional: true,\n    label: \"Permissions\"\n  },\n  \"conditions.permissions.$\": {\n    type: String,\n    optional: true,\n    label: \"Permission\"\n  },\n  \"conditions.products\": {\n    type: Array,\n    optional: true,\n    label: \"Products\"\n  },\n  \"conditions.products.$\": {\n    type: String,\n    optional: true,\n    label: \"Product\"\n  },\n  \"conditions.tags\": {\n    type: Array,\n    optional: true,\n    label: \"Tags\"\n  },\n  \"conditions.tags.$\": {\n    type: String,\n    optional: true,\n    label: \"Tag\"\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Discounts\", Discounts);\n","export * from \"./discounts\";\nexport * from \"./config\";\n","import { Mongo } from \"meteor/mongo\";\nimport * as Schemas from \"./schemas\";\n\n/**\n* Discounts Collection\n* @type {Object}\n* @desc Collection for custom discount rates\n* for dollar, percentage, and shipping\n* discount rates.\n*/\nexport const Discounts = new Mongo.Collection(\"Discounts\");\n\nDiscounts.attachSchema(Schemas.Discounts);\n","export * from \"./collections\";\n","import { Reaction } from \"/server/api\";\nimport { Importer } from \"/server/api/core/importer\";\nimport * as Collections from \"../../lib/collections\";\n\n// plugin Import helpers\nconst DiscountImport = Importer;\n\n// Import helper to store a discountRate in the import buffer.\nDiscountImport.discountRate = function (key, discountRate) {\n  return this.object(Collections.Discounts, key, discountRate);\n};\n\n// configure Import key detection\nDiscountImport.indication(\"discount\", Collections.Discounts, 0.5);\n\n// should assign to global\nObject.assign(Reaction.Importer, DiscountImport);\n\n// exports Reaction.Importer with new discount helper\nexport default Reaction;\n","import Reaction from \"./import\";\n\nexport default Reaction;\n","import { Meteor } from \"meteor/meteor\";\nimport { Cart } from \"/lib/collections\";\nimport { Hooks } from \"/server/api\";\n\n/**\n* Cart Hooks for Discounts\n* @type {Object}\n* @desc After cart update apply discounts.\n* if items are changed, recalculating discounts\n* we could have done this in the core/cart transform\n* but this way this file controls the events from\n* the core/discounts plugin.\n*/\nHooks.Events.add(\"afterCartUpdateCalculateDiscount\", (cartId) => {\n  if (cartId) {\n    const cart = Cart.findOne({ _id: cartId });\n    const discount = Meteor.call(\"discounts/calculate\", cart);\n\n    Cart.update({ _id: cart._id }, { $set: { discount } });\n\n    // Calculate taxes\n    Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cartId);\n  }\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./methods\";\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Cart } from \"/lib/collections\";\nimport { Discounts } from \"../../lib/collections\";\nimport Reaction from \"../api\";\n\n/**\n *\n * @namespace Methods/Discounts\n */\n\nexport const methods = {\n  /**\n   * @name discounts/deleteRate\n   * @method\n   * @memberof Methods/Discounts\n   * @param  {String} discountId discount id to delete\n   * @return {String} returns update/insert result\n   */\n  \"discounts/deleteRate\"(discountId) {\n    check(discountId, String);\n\n    // check permissions to delete\n    if (!Reaction.hasPermission(\"discounts\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return Discounts.remove({ _id: discountId });\n  },\n\n  /**\n   * @name discounts/setRate\n   * @method\n   * @memberof Methods/Discounts\n   * @summary Update the cart discounts without hooks\n   * @param  {String} cartId cartId\n   * @param  {Number} discountRate discountRate\n   * @param  {Object} discounts discounts\n   * @return {Number} returns update result\n   */\n  \"discounts/setRate\"(cartId, discountRate, discounts) {\n    check(cartId, String);\n    check(discountRate, Number);\n    check(discounts, Match.Optional(Array));\n\n    return Cart.update(cartId, {\n      $set: {\n        discounts,\n        discount: discountRate\n      }\n    });\n  },\n\n  /**\n   * @name discounts/transaction\n   * @method\n   * @memberof Methods/Discounts\n   * @summary Applies a transaction to discounts for history\n   * @param  {String} cartId cartId\n   * @param  {String} discountId discountId\n   * @return {String} returns update result\n   */\n  \"discounts/transaction\"(cartId, discountId) {\n    check(cartId, String);\n    check(discountId, String);\n\n    const transaction = {\n      cartId,\n      userId: Meteor.userId(),\n      appliedAt: new Date()\n    };\n    // double duty validation, plus we need the method\n    const discount = Discounts.findOne(discountId);\n    return Discounts.update(\n      { _id: discountId },\n      { $addToSet: { transactions: transaction } },\n      { selector: { discountMethod: discount.discountMethod } }\n    );\n  },\n\n  /**\n   * @name discounts/calculate\n   * @method\n   * @memberof Methods/Discounts\n   * @param  {String} cart cartId\n   * @return {Object}  returns discount object\n   */\n  \"discounts/calculate\"(cart) {\n    Reaction.Schemas.Cart.validate(cart);\n\n    let currentDiscount = 0;\n    // what's going on here?\n    // well, we're getting the real details of the discounts from\n    // the collection, because the publicly stored cart\n    // paymentMethod doesn't quite have all of the pieces (intentionally)\n    if (cart && cart.billing) {\n      for (const billing of cart.billing) {\n        if (billing.paymentMethod) {\n          const discount = Discounts.findOne(billing.paymentMethod.id);\n          if (discount && discount.calculation) {\n            const { processor } = billing.paymentMethod;\n            const calculation = discount.calculation.method;\n            // we're using processor/calculation\n            // as a convention that can be easily\n            // added in external discount methods\n            // example: discounts/codes/discount\n            // will also not reprocess invoiced orders\n            if ((!billing.invoice && processor === \"code\") || processor === \"rate\") {\n              // discounts are additive, if we allow more than one.\n              currentDiscount += Meteor.call(`discounts/${processor}s/${calculation}`, cart._id, discount._id);// note the added s.\n            }\n          }\n        }\n      }\n    }\n    return currentDiscount;\n  }\n};\n\nMeteor.methods(methods);\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Discounts } from \"../../lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * Discounts\n * @type {Publication}\n * @param {Object} query\n * @param {Object} options\n */\nMeteor.publish(\"Discounts\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  // check shopId\n  const shopId = Reaction.getShopId();\n  if (!shopId && query) {\n    return this.ready();\n  }\n\n  const select = query || {};\n  // append shopId to query\n  // applicable discounts are published\n  // for this users cartId;\n  select.shopId = shopId;\n  // select.cartId = cartId;\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"discounts-count\", Discounts.find(\n    select,\n    options\n  ));\n\n  return Discounts.find(\n    select,\n    options\n  );\n});\n","import { Security } from \"meteor/ongoworks:security\";\nimport { Discounts } from \"../../lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n//\n// Security definitions\n//\nSecurity.permit([\"read\", \"insert\", \"update\", \"remove\"]).collections([\n  Discounts\n]).ifHasRole({\n  role: \"discounts\",\n  group: Reaction.getShopId()\n});\n","// assemble server api\nimport \"./i18n\";\nimport \"./hooks/cart\";\nimport \"./security/discounts\";\nimport \"./publications/discounts\";\nimport \"./methods\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Discounts\",\n  name: \"reaction-discounts\",\n  icon: \"fa fa-gift\",\n  autoEnable: true\n});\n","import { registerSchema } from \"@reactioncommerce/schemas\";\nimport { PackageConfig } from \"/lib/collections/schemas/registry\";\nimport { Taxes } from \"./taxes\";\n\n/**\n* TaxPackageConfig Schema\n*/\n\nexport const TaxPackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.defaultTaxCode\": {\n    type: String,\n    optional: true\n  },\n  \"settings.taxIncluded\": {\n    type: Boolean,\n    defaultValue: false\n  },\n  \"settings.taxShipping\": {\n    type: Boolean,\n    defaultValue: false\n  },\n  \"settings.rates\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.rates.enabled\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"settings.rates.taxes\": {\n    type: Array,\n    optional: true\n  },\n  \"settings.rates.taxes.$\": {\n    type: Taxes\n  }\n});\n\nregisterSchema(\"TaxPackageConfig\", TaxPackageConfig);\n","export * from \"./taxrates\";\nexport * from \"./taxes\";\nexport * from \"./taxcodes\";\nexport * from \"./config\";\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* TaxCodes Schema\n*/\n\nexport const TaxCodes = new SimpleSchema({\n  \"id\": {\n    type: String,\n    label: \"Tax Id\",\n    unique: true\n  },\n  \"shopId\": {\n    type: String\n  },\n  \"taxCode\": {\n    type: String,\n    label: \"Tax Code\"\n  },\n  \"taxCodeProvider\": {\n    type: String,\n    label: \"Tax Code Provider\"\n  },\n  \"ssuta\": {\n    type: Boolean,\n    label: \"Streamlined Sales Tax\",\n    optional: true,\n    defaultValue: false\n  },\n  \"title\": {\n    type: String,\n    optional: true\n  },\n  \"label\": {\n    type: String,\n    optional: true\n  },\n  \"parent\": {\n    type: String,\n    optional: true\n  },\n  \"children\": {\n    type: Array,\n    optional: true\n  },\n  \"children.$\": {\n    type: Object,\n    blackbox: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"TaxCodes\", TaxCodes);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { shopIdAutoValue } from \"/lib/collections/schemas/helpers\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* Taxes Schema\n*/\n\nexport const Taxes = new SimpleSchema({\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValue,\n    index: 1,\n    label: \"Taxes shopId\"\n  },\n  \"taxCode\": {\n    type: String,\n    label: \"Tax Identifier\",\n    defaultValue: \"RC_TAX\",\n    index: 1\n  },\n  \"cartMethod\": {\n    label: \"Calculation Method\",\n    type: String,\n    allowedValues: [\"unit\", \"row\", \"total\"],\n    defaultValue: \"total\"\n  },\n  \"taxLocale\": {\n    label: \"Taxation Location\",\n    type: String,\n    allowedValues: [\"shipping\", \"billing\", \"origination\", \"destination\"],\n    defaultValue: \"destination\"\n  },\n  \"taxShipping\": {\n    label: \"Tax Shipping\",\n    type: Boolean,\n    defaultValue: false\n  },\n  \"taxIncluded\": {\n    label: \"Taxes included in product prices\",\n    type: Boolean,\n    defaultValue: false,\n    optional: true\n  },\n  \"discountsIncluded\": {\n    label: \"Tax before discounts\",\n    type: Boolean,\n    defaultValue: false,\n    optional: true\n  },\n  \"region\": {\n    label: \"State/Province/Region\",\n    type: String,\n    optional: true,\n    index: 1\n  },\n  \"postal\": {\n    label: \"ZIP/Postal Code\",\n    type: String,\n    optional: true,\n    index: 1\n  },\n  \"country\": {\n    type: String,\n    label: \"Country\",\n    optional: true,\n    index: 1\n  },\n  \"isCommercial\": {\n    label: \"Commercial address.\",\n    type: Boolean,\n    optional: true\n  },\n  \"rate\": Number,\n  \"method\": {\n    type: Array,\n    optional: true,\n    label: \"Tax Methods\"\n  },\n  \"method.$\": {\n    type: Object\n  },\n  \"method.$.plugin\": {\n    type: String,\n    label: \"Plugin\",\n    defaultValue: \"Custom\",\n    optional: true\n  },\n  \"method.$.enabled\": {\n    type: Boolean,\n    label: \"Enabled\",\n    defaultValue: true,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Taxes\", Taxes);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* TaxRates Schema\n*/\n\nexport const TaxRates = new SimpleSchema({\n  country: {\n    type: String\n  },\n  county: {\n    type: String,\n    optional: true\n  },\n  postal: {\n    type: String,\n    optional: true\n  },\n  rate: Number\n}, { check, tracker: Tracker });\n\nregisterSchema(\"TaxRates\", TaxRates);\n","import { Mongo } from \"meteor/mongo\";\nimport * as Schemas from \"./schemas\";\n\n/**\n* ReactionCore Collections TaxCodes\n*/\n\n/**\n* Taxes Collection\n*/\nexport const Taxes = new Mongo.Collection(\"Taxes\");\n\nTaxes.attachSchema(Schemas.Taxes);\n\n\n/**\n* TaxCodes Collection\n*/\nexport const TaxCodes = new Mongo.Collection(\"TaxCodes\");\n\nTaxCodes.attachSchema(Schemas.TaxCodes);\n","export * from \"./collections\";\n","import { Reaction } from \"/server/api\";\nimport { Importer } from \"/server/api/core/importer\";\nimport * as Collections from \"../../lib/collections\";\n\n// plugin Import helpers\nconst TaxImport = Importer;\n\n// Import helper to store a taxCode in the import buffer.\nTaxImport.taxCode = function (key, taxCode) {\n  return this.object(Collections.TaxCodes, key, taxCode);\n};\n\n// configure Import key detection\nTaxImport.indication(\"ssuta\", Collections.TaxCodes, 0.5);\n\n// should assign to global\nObject.assign(Reaction.Importer, TaxImport);\n\n// exports Reaction.Importer with new taxcode helper\nexport default Reaction;\n","import Reaction from \"./import\";\n\nexport default Reaction;\n","import { Meteor } from \"meteor/meteor\";\nimport { Hooks } from \"/server/api\";\n\n/**\n * Cart Hooks for Taxes\n*/\n\n/**\n * After cart update apply taxes.\n * if items are changed, recalculating taxes\n * we could have done this in the core/cart transform\n * but this way this file controls the events from\n * the core/taxes plugin.\n */\n\nHooks.Events.add(\"afterCartUpdateCalculateTaxes\", (cartId) => {\n  Meteor.call(\"taxes/calculate\", cartId);\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Cart, Packages } from \"/lib/collections\";\nimport { Taxes } from \"../../lib/collections\";\nimport Reaction from \"../api\";\nimport { Logger } from \"/server/api\";\n\n/**\n * @file Methods for Taxes. Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/Taxes\n*/\n\nexport const methods = {\n  /**\n   * @name taxes/deleteRate\n   * @method\n   * @memberof Methods/Taxes\n   * @param  {String} taxId tax taxId to delete\n   * @return {String} returns update/insert result\n   */\n  \"taxes/deleteRate\"(taxId) {\n    check(taxId, String);\n\n    // check permissions to delete\n    if (!Reaction.hasPermission(\"taxes\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return Taxes.remove(taxId);\n  },\n\n  /**\n   * @name taxes/addRate\n   * @method\n   * @memberof Methods/Taxes\n   * @param  {Object} doc A Taxes document to be inserted\n   * @param  {String} [docId] DEPRECATED. Existing ID to trigger an update. Use taxes/editRate method instead.\n   * @return {String} Insert result\n   */\n  \"taxes/addRate\"(doc, docId) {\n    check(doc, Object); // actual schema validation happens during insert below\n\n    // Backward compatibility\n    check(docId, Match.Optional(String));\n    if (docId) return Meteor.call(\"taxes/editRate\", { _id: docId, modifier: doc });\n\n    if (!Reaction.hasPermission(\"taxes\")) throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    return Taxes.insert(doc);\n  },\n\n  /**\n   * @name taxes/editRate\n   * @method\n   * @memberof Methods/Taxes\n   * @param  {Object} details An object with _id and modifier props\n   * @return {String} Update result\n   */\n  \"taxes/editRate\"(details) {\n    check(details, {\n      _id: String,\n      modifier: Object // actual schema validation happens during update below\n    });\n    if (!Reaction.hasPermission(\"taxes\")) throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    const { _id, modifier } = details;\n    return Taxes.update(_id, modifier);\n  },\n\n  /**\n   * @name taxes/setRate\n   * @summary Update the cart without hooks\n   * @method\n   * @memberof Methods/Taxes\n   * @param  {String} cartId cartId\n   * @param  {Number} taxRate taxRate\n   * @param  {Object} taxes taxes\n   * @return {Number} returns update result\n   */\n  \"taxes/setRate\"(cartId, taxRate, taxes) {\n    check(cartId, String);\n    check(taxRate, Number);\n    check(taxes, Match.Optional(Array));\n\n    return Cart.update(cartId, {\n      $set: {\n        taxes,\n        tax: taxRate\n      }\n    });\n  },\n\n  /**\n   * @name taxes/setRateByShopAndItem\n   * @method\n   * @memberof Methods/Taxes\n   * @summary Update the cart without hooks\n   * @param  {String} cartId cartId\n   * @param  {Object} options - Options object\n   * @param  {Object} options.taxRatesByShop - Object shopIds: taxRates\n   * @param  {Array}  options.itemsWithTax - Items array with computed tax details\n   * @param  {Object} options.cartTaxRate - Tax rate for shop associated with cart.shopId\n   * @param  {Object} options.cartTaxData - Tax data for shop associated with cart.shopId\n   * @return {Number} returns update result\n   */\n  \"taxes/setRateByShopAndItem\"(cartId, options) {\n    check(cartId, String);\n    check(options, {\n      taxRatesByShop: Object,\n      itemsWithTax: [Object],\n      cartTaxRate: Number,\n      cartTaxData: Match.OneOf([Object], undefined, null)\n    });\n\n    const { cartTaxData, cartTaxRate, itemsWithTax, taxRatesByShop } = options;\n\n    return Cart.update(cartId, {\n      $set: {\n        taxes: cartTaxData,\n        tax: cartTaxRate,\n        items: itemsWithTax,\n        taxRatesByShop\n      }\n    });\n  },\n\n  /**\n   * @name taxes/calculate\n   * @method\n   * @memberof Methods/Taxes\n   * @param  {String} cartId cartId\n   * @return {Object}  returns tax object\n   */\n  \"taxes/calculate\"(cartId) {\n    check(cartId, String);\n    const cartToCalc = Cart.findOne(cartId);\n    const cartShopId = cartToCalc.shopId;\n    let cartTaxRate = 0;\n\n    // TODO: Calculate shipping taxes for regions that require it\n    const pkg = Packages.findOne({\n      shopId: cartShopId,\n      name: \"reaction-taxes\"\n    });\n    //\n    // custom rates\n    // TODO Determine calculation method (row, total, shipping)\n    // TODO method for order tax updates\n    // additional logic will be needed for refunds\n    // or tax adjustments\n    //\n    // check if plugin is enabled and this calculation method is enabled\n    if (pkg && pkg.enabled === true && pkg.settings.rates.enabled === true) {\n      Logger.debug(\"Calculating custom tax rates\");\n\n      if (typeof cartToCalc.shipping !== \"undefined\" && typeof cartToCalc.items !== \"undefined\") {\n        const shippingAddress = cartToCalc.shipping[0].address;\n        let totalTax = 0;\n\n        // custom rates that match shipping info\n        // high chance this needs more review as\n        // it's unlikely this matches all potential\n        // here we just sort by postal, so if it's an exact\n        // match we're taking the first record, where the most\n        // likely tax scenario is a postal code falling\n        // back to a regional tax.\n        if (shippingAddress) {\n          // Get tax rates by shop\n          const taxDataByShop = cartToCalc.items.reduce((uniqueShopTaxRates, item) => {\n            // lookup custom tax rate for each shop once\n            if (!uniqueShopTaxRates[item.shopId]) {\n              uniqueShopTaxRates[item.shopId] = Taxes.findOne({\n                $and: [{\n                  $or: [{\n                    postal: shippingAddress.postal\n                  }, {\n                    postal: { $exists: false },\n                    region: shippingAddress.region,\n                    country: shippingAddress.country\n                  }, {\n                    postal: { $exists: false },\n                    region: { $exists: false },\n                    country: shippingAddress.country\n                  }]\n                }, {\n                  shopId: item.shopId\n                }]\n              }, { sort: { postal: -1 } });\n            }\n\n            return uniqueShopTaxRates;\n          }, {});\n\n          const taxRatesByShop = Object.keys(taxDataByShop).reduce((ratesByShop, shopId) => {\n            if (taxDataByShop[shopId]) {\n              ratesByShop[shopId] = taxDataByShop[shopId].rate / 100;\n            }\n            return ratesByShop;\n          }, {});\n\n          // calculate line item taxes\n          const itemsWithTax = cartToCalc.items.map((item) => {\n            // init rate to 0\n            item.taxRate = 0;\n            item.taxData = undefined;\n            const shopTaxData = taxDataByShop[item.shopId];\n\n            // only process taxble products and skip if there is no shopTaxData\n            if (shopTaxData && item.variants.taxable === true) {\n              const shopTaxRate = shopTaxData.rate / 100;\n\n              // If we have tax rates for this shop\n              if (shopTaxData && shopTaxRate) {\n                item.taxData = shopTaxData;\n                item.taxRate = shopTaxRate;\n                item.subtotal = item.variants.price * item.quantity;\n                item.tax = item.subtotal * item.taxRate;\n              }\n              totalTax += item.tax;\n            }\n\n            // add the item to our new array\n            return item;\n          });\n\n          if (totalTax > 0) {\n            cartTaxRate = totalTax / cartToCalc.getSubTotal();\n          }\n\n          // Marketplace Compatible\n          Meteor.call(\"taxes/setRateByShopAndItem\", cartToCalc._id, {\n            taxRatesByShop,\n            itemsWithTax,\n            cartTaxRate,\n            cartTaxData: undefined\n            // not setting cartTaxData here to disguise actual tax rate from client\n          });\n        } // end custom rates\n      } // end shippingAddress calculation\n    } else {\n      // we are here because the custom rate package is disabled.\n      // we're going to set an inital rate of 0\n      // all methods that trigger when taxes/calculate will\n      // recalculate this rate as needed.\n      Meteor.call(\"taxes/setRate\", cartToCalc._id, cartTaxRate);\n    }\n  } // end taxes/calculate\n};\n\nMeteor.methods(methods);\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Security } from \"meteor/ongoworks:security\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Taxes, TaxCodes } from \"../../lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n//\n// Security\n// import \"/server/security/collections\";\n// Security definitions\n//\nSecurity.permit([\"insert\", \"update\", \"remove\"]).collections([\n  Taxes,\n  TaxCodes\n]).ifHasRole({\n  role: \"admin\",\n  group: Reaction.getShopId()\n});\n/**\n * taxes\n */\nMeteor.publish(\"Taxes\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  // check shopId\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  const select = query || {};\n  // append shopId to query\n  // taxes could be shared\n  // if you disregarded shopId\n  select.shopId = shopId;\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"taxes-count\", Taxes.find(\n    select,\n    options\n  ));\n\n  return Taxes.find(\n    select,\n    options\n  );\n});\n\n/**\n * tax codes\n */\nMeteor.publish(\"TaxCodes\", function (query, params) {\n  check(query, Match.Optional(Object));\n  check(params, Match.Optional(Object));\n\n  // check shopId\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  const select = query || {};\n\n  // for now, not adding shopId to query\n  // taxCodes are reasonable shared??\n  //  select.shopId = shopId;\n\n  const options = params || {};\n  // const options = params || {\n  //   fields: {\n  //     id: 1,\n  //     label: 1\n  //   },\n  //   sort: {\n  //     label: 1\n  //   }\n  // };\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"taxcode-count\", TaxCodes.find(\n    select,\n    options\n  ));\n\n  return TaxCodes.find(\n    select,\n    options\n  );\n});\n","import \"./i18n\";\n// assemble server api\nimport \"./methods/methods\";\nimport \"./publications/taxes\";\nimport \"./hooks/taxes\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Taxes\",\n  name: \"reaction-taxes\",\n  icon: \"fa fa-university\",\n  autoEnable: true,\n  settings: {\n    custom: {\n      enabled: true\n    },\n    rates: {\n      enabled: false\n    }\n  },\n  registry: [\n    {\n      provides: [\"dashboard\"],\n      name: \"taxes\",\n      label: \"Taxes\",\n      description: \"Provide tax rates\",\n      icon: \"fa fa-university\",\n      priority: 1,\n      container: \"core\",\n      workflow: \"coreDashboardWorkflow\"\n    },\n    {\n      label: \"Tax Settings\",\n      icon: \"fa fa-university\",\n      name: \"taxes/settings\",\n      provides: [\"settings\"],\n      template: \"taxSettings\"\n    },\n    {\n      label: \"Custom Rates\",\n      name: \"taxes/settings/rates\",\n      provides: [\"taxSettings\"],\n      template: \"customTaxRates\"\n    },\n    {\n      template: \"flatRateCheckoutTaxes\",\n      provides: [\"taxMethod\"]\n    }\n  ]\n});\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { Templates } from \"/lib/collections\";\nimport { shopIdAutoValue } from \"/lib/collections/schemas/helpers\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * EmailTemplates Schema\n*/\n\nexport const EmailTemplates = new SimpleSchema({\n  \"shopId\": {\n    type: String,\n    index: 1,\n    autoValue: shopIdAutoValue,\n    label: \"Template ShopId\"\n  },\n  \"name\": {\n    type: String,\n    optional: true\n  },\n  \"priority\": {\n    type: SimpleSchema.Integer,\n    optional: true,\n    defaultValue: 1\n  },\n  \"enabled\": {\n    type: Boolean,\n    defaultValue: true\n  },\n  \"route\": {\n    type: String,\n    optional: true\n  },\n  \"audience\": {\n    type: Array,\n    optional: true\n  },\n  \"audience.$\": {\n    type: String\n  },\n  \"type\": {\n    type: String,\n    defaultValue: \"email\",\n    optional: true\n  },\n  \"provides\": {\n    type: String,\n    defaultValue: \"template\"\n  },\n  \"block\": {\n    type: String,\n    optional: true\n  },\n  \"defaultData\": {\n    type: Object,\n    blackbox: true,\n    optional: true\n  },\n  \"template\": {\n    type: String,\n    optional: true\n  },\n  \"parser\": {\n    type: String,\n    optional: true\n  },\n  \"language\": {\n    type: String,\n    optional: true,\n    defaultValue: \"en\"\n  },\n  \"source\": {\n    type: String,\n    optional: true\n  },\n  \"title\": {\n    type: String,\n    optional: true\n  },\n  \"subject\": {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"EmailTemplates\", EmailTemplates);\n\nTemplates.attachSchema(EmailTemplates, { selector: { type: \"email\" } });\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\nimport \"./methods\";\nimport \"../lib/collections/schemas/emailtemplates\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\nimport { Templates } from \"/lib/collections\";\n\n/**\n * @file Methods for Templates. Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/Templates\n*/\n\nexport const methods = {\n  /**\n   * @name templates/email/update\n   * @method\n   * @memberof Methods/Templates\n   * @todo Add permissions\n   * @summary Updates email template in Templates collection\n   * @param {String} templateId - id of template to remove\n   * @param {Object} doc - data to update\n   * @return {Number} remove template\n   */\n  \"templates/email/update\"(templateId, doc) {\n    check(templateId, String);\n    check(doc, Object);\n\n    const shopId = Reaction.getShopId();\n    const userId = Meteor.userId();\n\n    // Check that this user has permission to update templates for the active shop\n    if (!Reaction.hasPermission(\"reaction-templates\", userId, shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return Templates.update({\n      _id: templateId,\n      type: \"email\",\n      shopId // Ensure that the template we're attempting to update is owned by the active shop.\n    }, {\n      $set: {\n        title: doc.title,\n        name: doc.name,\n        language: doc.language,\n        template: doc.template,\n        subject: doc.subject,\n        enabled: doc.enabled\n      }\n    });\n  }\n};\n\nMeteor.methods(methods);\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Templates\",\n  name: \"reaction-templates\",\n  icon: \"fa fa-columns\",\n  autoEnable: true,\n  settings: {\n    name: \"Templates\",\n    custom: {\n      enabled: true\n    }\n  },\n  registry: [\n    {\n      provides: [\"dashboard\"],\n      workflow: \"coreDashboardWorkflow\",\n      name: \"Templates\",\n      label: \"Templates\",\n      description: \"App Templates\",\n      icon: \"fa fa-columns\",\n      priority: 1,\n      container: \"appearance\"\n    },\n    {\n      label: \"Template Settings\",\n      icon: \"fa fa-columns\",\n      name: \"templates/settings\",\n      provides: [\"settings\"],\n      template: \"templateSettings\",\n      meta: {\n        actionView: {\n          dashboardSize: \"md\"\n        }\n      }\n    },\n    {\n      label: \"Email Templates\",\n      name: \"templates/settings/email\",\n      provides: [\"templateSettings\"],\n      template: \"emailTemplates\"\n    }\n  ]\n});\n","export const connectorsRoles = [\"admin\", \"owner\", \"connectors\"];\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport en from \"./en.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\nimport { connectorsRoles } from \"../lib/roles\";\n\n/**\n *\n * @namespace Methods/Connectors\n */\n\nexport const methods = {\n  /**\n   * @name connectors/connection/toggle\n   * @method\n   * @memberof Methods/Connectors\n   * @example Meteor.call(\"connectors/connection/toggle\", packageId, settingsKey)\n   * @summary Toggle enabled connection\n   * @param { String } packageId - packageId\n   * @param { String } connection - connection name\n   * @return { Number } update - result\n   */\n  \"connectors/connection/toggle\"(packageId, connection) {\n    check(packageId, String);\n    check(connection, String);\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const pkg = Packages.findOne(packageId);\n    if (pkg && pkg.settings[connection]) {\n      // const enabled = pkg.settings[connection].enabled;\n    }\n  }\n};\n\nMeteor.methods(methods);\n","import \"./i18n\";\nimport \"./methods/methods\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Connectors\",\n  name: \"reaction-connectors\",\n  icon: \"fa fa-exchange\",\n  autoEnable: true,\n  settings: {\n    name: \"Connectors\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    route: \"/dashboard/connectors\",\n    name: \"connectors\",\n    label: \"Connectors\",\n    description: \"Connectors dashboard\",\n    icon: \"fa fa-exchange\",\n    priority: 1,\n    container: \"core\",\n    workflow: \"coreDashboardWorkflow\"\n  }, {\n    provides: [\"settings\"],\n    name: \"settings/connectors\",\n    label: \"Connectors\",\n    description: \"Configure connectors\",\n    icon: \"fa fa-exchange\",\n    template: \"connectorSettings\"\n  }]\n});\n","export * from \"./revisions\";\n","import { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/lib/api\";\n\nexport function getPackageSettings() {\n  const shopId = Reaction.getPrimaryShopId();\n\n  const packageInfo = Packages.findOne({\n    name: \"reaction-revisions\",\n    shopId\n  });\n\n  if (packageInfo && packageInfo.enabled && packageInfo.settings) {\n    return packageInfo.settings;\n  }\n\n  return null;\n}\n\nexport function isRevisionControlEnabled() {\n  const settings = getPackageSettings();\n\n  if (settings && settings.general && typeof settings.general.enabled === \"boolean\") {\n    return settings.general.enabled;\n  }\n\n  return false;\n}\n\nexport const RevisionApi = {\n  isRevisionControlEnabled,\n  getPackageSettings\n};\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","\nimport _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Products, Revisions, Tags } from \"/lib/collections\";\nimport { Hooks, Logger } from \"/server/api\";\nimport { RevisionApi } from \"../lib/api\";\nimport { ProductRevision } from \"./hooks\";\nimport { getSlug } from \"/lib/api\";\n\n\n/**\n * @method insertRevision\n * @summary Inserts a new revision for a given product\n *\n * @param {Object} product\n * @returns {undefined}\n */\nexport function insertRevision(product) {\n  if (RevisionApi.isRevisionControlEnabled() === false) {\n    return true;\n  }\n\n  if (product.workflow && Array.isArray(product.workflow.workflow) && product.workflow.workflow.indexOf(\"imported\") !== -1) {\n    // Mark imported products as published by default.\n    return true;\n  }\n\n  const productRevision = Revisions.findOne({\n    \"documentId\": product._id,\n    \"workflow.status\": {\n      $nin: [\n        \"revision/published\"\n      ]\n    }\n  });\n\n  // Prevent this product from being created if a parent product / variant ancestor is deleted.\n  //\n  // This will prevent cases where a parent variant has been deleted and a user tries to create a\n  // child variant. You cannot create the child variant because the parent will no longer exist when\n  // changes have been published; resulting in a broken inheritance and UI\n  const productHasAncestors = Array.isArray(product.ancestors);\n\n  if (productHasAncestors) {\n    // Verify there are no deleted ancestors,\n    // Variants cannot be restored if their parent product / variant is deleted\n    const archivedCount = Revisions.find({\n      \"documentId\": { $in: product.ancestors },\n      \"documentData.isDeleted\": true,\n      \"workflow.status\": {\n        $nin: [\n          \"revision/published\"\n        ]\n      }\n    }).count();\n\n    if (archivedCount > 0) {\n      Logger.debug(`Cannot create product ${product._id} as a product/variant higher in it's ancestors tree is marked as 'isDeleted'.`);\n      throw new Meteor.Error(\"unable-to-create-variant\", \"Unable to create product variant\");\n    }\n  }\n\n\n  if (!productRevision) {\n    Logger.debug(`No revision found for product ${product._id}. Creating new revision`);\n\n    Revisions.insert({\n      documentId: product._id,\n      documentData: product\n    });\n  }\n}\n\n/**\n * @method updateRevision\n * @summary Update a product's revision\n *\n * @param {String} userId\n * @param {Object} product - Product to update\n * @param {Object} options - Options include userId, modifier and validation properties\n * @returns {Boolean} true if underlying product should be updated, otherwise false.\n */\nexport function updateRevision(product, options = {}) {\n  if (RevisionApi.isRevisionControlEnabled() === false) {\n    return true;\n  }\n\n  const { userId, modifier } = options;\n\n  let productRevision = Revisions.findOne({\n    \"documentId\": product._id,\n    \"workflow.status\": {\n      $nin: [\"revision/published\"]\n    }\n  });\n\n  // Prevent this product revision from being restored from isDeleted state if a product / variant\n  // ancestor is also deleted.\n  //\n  // This will prevent cases where a parent variant has been deleted and a user tries to restore a\n  // child variant. You cannot restore the child variant, because the parent will no longer exist when\n  // changes have been published; resulting in a broken inheritance and UI\n  const revisionHasAncestors =\n    productRevision && productRevision.documentData && Array.isArray(productRevision.documentData.ancestors);\n  const modifierContainsIsDeleted = modifier.$set && modifier.$set.isDeleted === false;\n\n  if (revisionHasAncestors && modifierContainsIsDeleted) {\n    // Verify there are no deleted ancestors,\n    // Variants cannot be restored if their parent product / variant is deleted\n    const archivedCount = Revisions.find({\n      \"documentId\": { $in: productRevision.documentData.ancestors },\n      \"documentData.isDeleted\": true,\n      \"workflow.status\": {\n        $nin: [\"revision/published\"]\n      }\n    }).count();\n\n    if (archivedCount > 0) {\n      Logger.debug(`Cannot restore product ${\n        product._id\n      } as a product/variant higher in it's ancestors tree is marked as 'isDeleted'.`);\n      throw new Meteor.Error(\"unable-to-delete-variant\", \"Unable to delete product variant\");\n    }\n  }\n\n\n  if (!productRevision) {\n    Logger.debug(`No revision found for product ${product._id}. Creating new revision`);\n\n    // Create a new revision\n    Revisions.insert({\n      documentId: product._id,\n      documentData: product\n    });\n\n    // Fetch newly created revision\n    productRevision = Revisions.findOne({\n      documentId: product._id\n    });\n  }\n\n  // Create a new selector for the revision\n  //\n  // This is especially important since we may need to update some fields\n  // like metadata, and the selector is very important to that.\n  const revisionSelector = {\n    \"documentId\": product._id,\n    \"workflow.status\": {\n      $nin: [\"revision/published\"]\n    }\n  };\n\n  // Create a new modifier for the revision\n  const revisionModifier = {\n    $set: {\n      \"workflow.status\": \"revision/update\"\n    }\n  };\n\n  let publish = false;\n  if (Object.prototype.hasOwnProperty.call(options, \"publish\")) {\n    ({ publish } = options);\n  }\n\n  if (publish === true || (product.workflow && product.workflow.status === \"product/publish\")) {\n    // Maybe mark the revision as published\n\n    Logger.debug(`Publishing revision for product ${product._id}.`);\n    Revisions.update(revisionSelector, {\n      $set: {\n        \"workflow.status\": \"revision/published\"\n      }\n    });\n    Hooks.Events.run(\"afterRevisionsUpdate\", userId, {\n      ...productRevision,\n      workflow: { ...productRevision.workflow, status: \"revisions/published\" }\n    });\n    return true;\n  }\n\n  const hasAncestors = Array.isArray(product.ancestors) && product.ancestors.length > 0;\n\n  for (const operation in modifier) {\n    if (Object.hasOwnProperty.call(modifier, operation)) {\n      if (!revisionModifier[operation]) {\n        revisionModifier[operation] = {};\n      }\n\n      for (const property in modifier[operation]) {\n        if ({}.hasOwnProperty.call(modifier[operation], property)) {\n          if (operation === \"$set\" && property === \"metafields.$\") {\n            // Special handling for meta fields with $ operator\n            // We need to update the selector otherwise the operation would completely fail.\n            //\n            // This does NOT apply to metafield.0, metafield.1, metafield.n operations\n            // where 0, 1, n represent an array index.\n\n            // const originalSelector = options.selector;\n            revisionSelector[\"documentData.metafields\"] = options.metafields;\n            revisionModifier.$set[`documentData.${property}`] = modifier.$set[property];\n          } else if (operation === \"$push\" && property === \"hashtags\") {\n            if (!revisionModifier.$addToSet) {\n              revisionModifier.$addToSet = {};\n            }\n            revisionModifier.$addToSet[`documentData.${property}`] = modifier.$push[property];\n          } else if (operation === \"$set\" && property === \"price\" && hasAncestors) {\n            Revisions.update(revisionSelector, {\n              $set: {\n                \"documentData.price\": modifier.$set.price\n              }\n            });\n            Hooks.Events.run(\"afterRevisionsUpdate\", userId, {\n              ...productRevision,\n              documentData: { ...productRevision.documentData, price: modifier.$set.price }\n            });\n\n            const updateId = product.ancestors[0] || product._id;\n            const priceRange = ProductRevision.getProductPriceRange(updateId);\n\n            Meteor.call(\"products/updateProductField\", updateId, \"price\", priceRange);\n          } else if (operation === \"$set\" && property === \"isVisible\" && hasAncestors) {\n            Revisions.update(revisionSelector, {\n              $set: {\n                \"documentData.isVisible\": modifier.$set.isVisible\n              }\n            });\n            Hooks.Events.run(\"afterRevisionsUpdate\", userId, {\n              ...productRevision,\n              documentData: { ...productRevision.documentData, isVisible: modifier.$set.isVisible }\n            });\n\n            const updateId = product.ancestors[0] || product._id;\n            const priceRange = ProductRevision.getProductPriceRange(updateId);\n\n            Meteor.call(\"products/updateProductField\", updateId, \"price\", priceRange);\n          } else if (\n            operation === \"$set\" &&\n            (property === \"title\" || property === \"handle\") &&\n            hasAncestors === false\n          ) {\n            // Special handling for product title and handle\n            //\n            // Summary:\n            // When a user updates the product title, if the handle matches the product id,\n            // then update the handle to be a slugified version of the title\n            //\n            // This block ensures that the handle is either a custom slug, slug of the title, or\n            // the _id of the product, but is never blank\n\n            // New data\n            const newValue = modifier.$set[property];\n            const newTitle = modifier.$set.title;\n            const newHandle = modifier.$set.handle;\n\n            // Current revision data\n            const { documentId } = productRevision;\n            const slugDocId = getSlug(documentId);\n            const revisionTitle = productRevision.documentData.title;\n            const revisionHandle = productRevision.documentData.handle;\n\n            // Checks\n            const hasNewHandle = _.isEmpty(newHandle) === false;\n            const hasExistingTitle = _.isEmpty(revisionTitle) === false;\n            const hasNewTitle = _.isEmpty(newTitle) === false;\n            const hasHandle = _.isEmpty(revisionHandle) === false;\n            const handleMatchesId =\n              revisionHandle === documentId ||\n              revisionHandle === slugDocId ||\n              newValue === documentId ||\n              newValue === slugDocId;\n\n            // Continue to set the title / handle as originally requested\n            // Handle will get changed if conditions are met in the below if block\n            revisionModifier.$set[`documentData.${property}`] = newValue;\n\n            if (\n              (handleMatchesId || hasHandle === false) &&\n              (hasExistingTitle || hasNewTitle) &&\n              hasNewHandle === false\n            ) {\n              // Set the handle to be the slug of the product.title\n              // when documentId (product._id) matches the handle, then handle is empty, and a title exists\n              revisionModifier.$set[\"documentData.handle\"] = getSlug(newTitle || revisionTitle);\n            } else if (hasHandle === false && hasExistingTitle === false && hasNewHandle === false) {\n              // If the handle & title is empty, the handle becomes the product id\n              revisionModifier.$set[\"documentData.handle\"] = documentId;\n            } else if (hasNewHandle === false && property === \"handle\") {\n              // If the handle is empty, the handle becomes the slugified product title, or document id if title does not exist.\n              // const newTitle = modifier.$set[\"title\"];\n              revisionModifier.$set[\"documentData.handle\"] = hasExistingTitle\n                ? getSlug(newTitle || revisionTitle)\n                : documentId;\n            }\n          } else if (operation === \"$unset\" && property === \"handle\" && hasAncestors === false) {\n            // Special handling for product handle when it is going to be unset\n            //\n            // Summary:\n            // When a user updates the handle to a black string e.g. deletes all text in field in UI and saves,\n            // the handle will be adjusted so it will not be blank\n            const newValue = modifier.$unset[property];\n            const revisionTitle = productRevision.documentData.title;\n            const hasExistingTitle = _.isEmpty(revisionTitle) === false;\n\n            // If the new handle is going to be empty, the handle becomes the slugified product title, or document id if title does not exist.\n            if (_.isEmpty(newValue)) {\n              revisionModifier.$set[\"documentData.handle\"] = hasExistingTitle\n                ? getSlug(revisionTitle)\n                : productRevision.documentId;\n            }\n          } else {\n            // Let everything else through\n            revisionModifier[operation][`documentData.${property}`] = modifier[operation][property];\n          }\n        }\n      }\n    }\n  }\n\n  Revisions.update(revisionSelector, revisionModifier);\n  const updatedRevision = Revisions.findOne({ documentId: product._id });\n  Hooks.Events.run(\"afterRevisionsUpdate\", userId, updatedRevision);\n\n  Logger.debug(`Revision updated for product ${product._id}.`);\n\n  if (modifier.$pull && modifier.$pull.hashtags) {\n    const tagId = modifier.$pull.hashtags;\n\n    const productCount = Products.find({\n      hashtags: tagId\n    }).count();\n\n    const relatedTagsCount = Tags.find({\n      relatedTagIds: tagId\n    }).count();\n\n    if (productCount === 0 && relatedTagsCount === 0) {\n      // Mark tag as deleted\n      Tags.update(\n        {\n          _id: tagId\n        },\n        {\n          $set: {\n            isDeleted: true\n          }\n        }\n      );\n    } else {\n      Tags.update(\n        {\n          _id: tagId\n        },\n        {\n          $set: {\n            isDeleted: false\n          }\n        }\n      );\n    }\n  }\n\n  // If we are using $set or $inc, and the fields are one of the ignoredFields,\n  // allow product to be updated without going through revision control\n  if ((modifier.$set || modifier.$inc) && !modifier.$pull && !modifier.$push) {\n    const newSet = {};\n    const newInc = {};\n    let hasIgnoredFields = false;\n    const ignoredFields = [\"isLowQuantity\", \"isSoldOut\", \"inventoryQuantity\"];\n\n    for (const field of ignoredFields) {\n      if (modifier.$set && (\n        typeof modifier.$set[field] === \"number\" ||\n        typeof modifier.$set[field] === \"boolean\" ||\n        typeof modifier.$set[field] === \"string\"\n      )) {\n        newSet[field] = modifier.$set[field];\n        hasIgnoredFields = true;\n      }\n\n      if (modifier.$inc && (\n        typeof modifier.$inc[field] === \"number\" ||\n        typeof modifier.$inc[field] === \"boolean\" ||\n        typeof modifier.$set[field] === \"string\"\n      )) {\n        newInc[field] = modifier.$inc[field];\n        hasIgnoredFields = true;\n      }\n    }\n    if (_.isEmpty(newSet) === false) {\n      modifier.$set = newSet;\n    }\n\n    if (_.isEmpty(newInc) === false) {\n      modifier.$inc = newInc;\n    }\n\n    return hasIgnoredFields === true;\n  }\n\n  // prevent the underlying document from being modified as it is in draft mode\n  return false;\n}\n/**\n * @method markRevisionAsDeleted\n * @summary Flag a product's revision as deleted\n *\n * @param {Object} product - The product whose revision will be flagged as deleted.\n * @param {Object} options - Contains userId\n * @returns {undefined}\n */\nexport function markRevisionAsDeleted(product, options) {\n  if (RevisionApi.isRevisionControlEnabled() === false) {\n    return true;\n  }\n\n  const { userId } = options;\n\n  let productRevision = Revisions.findOne({\n    documentId: product._id\n  });\n\n  if (!productRevision) {\n    Logger.debug(`No revision found for product ${product._id}. Creating new revision`);\n\n    Revisions.insert({\n      documentId: product._id,\n      documentData: product\n    });\n    productRevision = Revisions.findOne({\n      documentId: product._id\n    });\n  }\n\n  // Set the revision as deleted \"isDeleted: true\"\n  Revisions.update({\n    documentId: product._id\n  }, {\n    $set: {\n      \"documentData.isDeleted\": true,\n      \"workflow.status\": \"revision/remove\"\n    }\n  });\n  Hooks.Events.run(\"afterRevisionsUpdate\", userId, {\n    ...productRevision,\n    documentData: { ...productRevision.documentData, isDeleted: true },\n    workflow: { ...productRevision.workflow, workflow: \"revision/remove\" }\n  });\n\n  Logger.debug(`Revision updated for product ${product._id}.`);\n  Logger.debug(`Product ${product._id} is now marked as deleted.`);\n\n  // If the original product is deleted, and the user is trying to delete it again,\n  // then actually remove it completely.\n  //\n  // This acts like a trash. Where the product is sent to trash before it can actually\n  // be deleted permanently.\n  if (product.isDeleted === true) {\n    Logger.debug(`Allowing write to product ${product._id} for Collection.remove().`);\n\n    return true;\n  }\n\n  Logger.debug(`Preventing write to product ${product._id} for Collection.remove().`);\n  return false;\n}\n","import _ from \"lodash\";\nimport { diff } from \"deep-diff\";\nimport { RevisionApi } from \"../lib/api\";\nimport { insertRevision, updateRevision, markRevisionAsDeleted } from \"./functions\";\nimport { Products, Revisions } from \"/lib/collections\";\nimport { Hooks } from \"/server/api\";\nimport { Media } from \"/imports/plugins/core/files/server\";\n\nexport const ProductRevision = {\n  getProductPriceRange(productId) {\n    const product = Products.findOne(productId);\n    if (!product) {\n      return {\n        range: \"0\",\n        min: 0,\n        max: 0\n      };\n    }\n\n    const variants = this.getTopVariants(product._id);\n    if (variants.length > 0) {\n      const variantPrices = [];\n      variants.forEach((variant) => {\n        if (variant.isVisible === true) {\n          const range = this.getVariantPriceRange(variant._id);\n          if (typeof range === \"string\") {\n            const firstPrice = parseFloat(range.substr(0, range.indexOf(\" \")));\n            const lastPrice = parseFloat(range.substr(range.lastIndexOf(\" \") + 1));\n            variantPrices.push(firstPrice, lastPrice);\n          } else {\n            variantPrices.push(range);\n          }\n        } else {\n          variantPrices.push(0, 0);\n        }\n      });\n      const priceMin = _.min(variantPrices);\n      const priceMax = _.max(variantPrices);\n      let priceRange = `${priceMin} - ${priceMax}`;\n      // if we don't have a range\n      if (priceMin === priceMax) {\n        priceRange = priceMin.toString();\n      }\n      const priceObject = {\n        range: priceRange,\n        min: priceMin,\n        max: priceMax\n      };\n      return priceObject;\n    }\n\n    if (!product.price) {\n      return {\n        range: \"0\",\n        min: 0,\n        max: 0\n      };\n    }\n\n    // if we have no variants subscribed to (client)\n    // we'll get the price object previously from the product\n    return product.price;\n  },\n\n  getVariantPriceRange(variantId) {\n    const children = this.getVariants(variantId);\n    const visibleChildren = children.filter((child) => child.isVisible && !child.isDeleted);\n\n    switch (visibleChildren.length) {\n      case 0: {\n        const topVariant = this.getProduct(variantId);\n        // topVariant could be undefined when we removing last top variant\n        return topVariant && topVariant.price;\n      }\n      case 1: {\n        return visibleChildren[0].price;\n      }\n      default: {\n        let priceMin = Number.POSITIVE_INFINITY;\n        let priceMax = Number.NEGATIVE_INFINITY;\n\n        visibleChildren.forEach((child) => {\n          if (child.price < priceMin) {\n            priceMin = child.price;\n          }\n          if (child.price > priceMax) {\n            priceMax = child.price;\n          }\n        });\n\n        if (priceMin === priceMax) {\n          // TODO check impact on i18n/formatPrice from moving return to string\n          return priceMin.toString();\n        }\n        return `${priceMin} - ${priceMax}`;\n      }\n    }\n  },\n\n  findRevision({ documentId }) {\n    return Revisions.findOne({\n      documentId,\n      \"workflow.status\": {\n        $nin: [\n          \"revision/published\"\n        ]\n      }\n    });\n  },\n\n  getProduct(variantId) {\n    const product = Products.findOne(variantId);\n    const revision = this.findRevision({\n      documentId: variantId\n    });\n\n    return (revision && revision.documentData) || product;\n  },\n\n  getTopVariants(id) {\n    const variants = [];\n\n    Products.find({\n      ancestors: [id],\n      type: \"variant\",\n      isDeleted: false\n    }).forEach((product) => {\n      const revision = this.findRevision({\n        documentId: product._id\n      });\n\n      if (revision && revision.documentData.isVisible) {\n        variants.push(revision.documentData);\n      } else if (!revision && product.isVisible) {\n        variants.push(product);\n      }\n\n      return variants;\n    });\n\n    return variants;\n  },\n\n  getVariants(id, type) {\n    const variants = [];\n\n    Products.find({\n      ancestors: { $in: [id] },\n      type: type || \"variant\",\n      isDeleted: false\n    }).forEach((product) => {\n      const revision = this.findRevision({\n        documentId: product._id\n      });\n\n      if (revision && revision.documentData.isVisible) {\n        variants.push(revision.documentData);\n      } else if (!revision && product.isVisible) {\n        variants.push(product);\n      }\n    });\n\n    return variants;\n  },\n\n  getVariantQuantity(variant) {\n    const options = this.getVariants(variant._id);\n    if (options && options.length) {\n      return options.reduce((sum, option) =>\n        sum + option.inventoryQuantity || 0, 0);\n    }\n    return variant.inventoryQuantity || 0;\n  }\n};\n\n/**\n * @function\n * @name beforeInsertCatalogProductInsertRevision\n *\n * @summary Executes the provided function when beforeInsertCatalogProductInsertRevision\n * hook is ran. The hook is ran before a product is inserted, and it will insert a\n * corresponding revision for the provided product.\n * @param {Function} Callback to execute\n * @return {Object} product - the product in which the callback was called on.\n */\nHooks.Events.add(\"beforeInsertCatalogProductInsertRevision\", (product) => {\n  insertRevision(product);\n\n  return product;\n});\n\n/**\n * @function\n * @name afterInsertCatalogProductInsertRevision\n *\n * @summary Executes the provided function when beforeInsertCatalogProductInsertRevision\n * hook is ran. The hook is ran after a product is inserted, and it will insert a\n * corresponding revision for the provided product.\n * @param {Function} Callback to execute\n * @return {Object} product - the product in which the callback was called on.\n */\nHooks.Events.add(\"afterInsertCatalogProductInsertRevision\", (product) => {\n  insertRevision(product);\n\n  return product;\n});\n\n/**\n * @function\n * @name beforeUpdateCatalogProduct\n *\n * @summary Executes the provided function when beforeUpdateCatalogProduct\n * hook is ran. The hook is ran before a product is updated, and it will updated the\n * corresponding revisions for the provided product.\n * @param {Function} Callback to execute\n * @return {Boolean} true|false - Used to determine whether the underlying product should be updated.\n */\nHooks.Events.add(\"beforeUpdateCatalogProduct\", (product, options) => updateRevision(product, options));\n\n/**\n * @function\n * @name beforeRemoveCatalogProduct\n *\n * @summary Executes the provided function when beforeRemoveCatalogProduct\n * hook is ran. The hook is ran before a product or variant is archived, and it will updated the\n * corresponding revisions for the provided product or variant.\n * @param {Function} Callback to execute\n * @return {Boolean} true|false - Used to determine whether the underlying product should be updated.\n */\nHooks.Events.add(\"beforeRemoveCatalogProduct\", (product, options) => markRevisionAsDeleted(product, options));\n\nHooks.Events.add(\"afterRevisionsUpdate\", (userId, revision) => {\n  if (RevisionApi.isRevisionControlEnabled() === false) {\n    return true;\n  }\n  let differences;\n\n\n  if (!revision.documentType || revision.documentType === \"product\") {\n    // Make diff\n    const product = Products.findOne({\n      _id: revision.documentId\n    });\n    differences = diff(product, revision.documentData);\n  }\n\n  if (revision.documentType && revision.documentType === \"image\") {\n    const image = Promise.await(Media.findOne(revision.documentId, { raw: true }));\n    differences = image && diff(image.metadata, revision.documentData);\n  }\n\n  Revisions.update({\n    _id: revision._id\n  }, {\n    $set: {\n      diff: differences && differences.map((d) => Object.assign({}, d))\n    }\n  });\n}, {\n  fetchPrevious: false\n});\n","import \"./hooks\";\nimport \"./methods\";\nimport \"./i18n\";\nimport \"./publications\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Products, MediaRecords, Revisions, Packages } from \"/lib/collections\";\nimport { Hooks, Logger } from \"/server/api\";\n\nfunction handleImageRevision(revision) {\n  let result = 0;\n  if (revision.changeType === \"insert\") {\n    result = MediaRecords.update({\n      _id: revision.documentId\n    }, {\n      $set: {\n        metadata: { ...revision.documentData, workflow: \"published\" }\n      }\n    });\n  } else if (revision.changeType === \"remove\") {\n    result = MediaRecords.update({\n      _id: revision.documentId\n    }, {\n      $set: {\n        \"metadata.workflow\": \"archived\"\n      }\n    });\n  } else if (revision.changeType === \"update\") {\n    result = MediaRecords.update({\n      _id: revision.documentId\n    }, {\n      $set: {\n        metadata: { ...revision.documentData, workflow: \"published\" }\n      }\n    });\n    Logger.debug(`setting metadata for ${revision.documentId} to ${JSON.stringify(revision.documentData, null, 4)}`);\n  }\n  // mark revision published whether we are publishing the image or not\n  Revisions.update({\n    _id: revision._id\n  }, {\n    $set: {\n      \"workflow.status\": \"revision/published\"\n    }\n  });\n\n  return result;\n}\n\nexport function updateSettings(settings) {\n  check(settings, Object);\n\n  Packages.update({\n    name: \"reaction-revisions\"\n  }, {\n    $set: {\n      settings\n    }\n  });\n}\n\n/**\n * @function\n * @name publishCatalogProduct\n * @description Updates revision and publishes a product.\n *\n * @param {String} userId - currently logged in user\n * @param {Object} selector - selector for product to update\n * @param {Object} modifier - Object describing what parts of the document to update.\n * @param {Object} validation - simple schema validation\n * @return {String} _id of updated document\n */\nfunction publishCatalogProduct(userId, selector, modifier, validation) {\n  const product = Products.findOne(selector);\n  const options = {\n    userId,\n    modifier,\n    validation,\n    publish: true\n  };\n\n  Hooks.Events.run(\"beforeUpdateCatalogProduct\", product, options);\n\n  const result = Products.update(selector, modifier, validation);\n\n  Hooks.Events.run(\"afterUpdateCatalogProduct\", product, options);\n\n  // Records are not remove from the Products collection, they are only flagged as deleted.\n  // Run Hook to remove search record, if a product is being published as deleted\n  // Which is the equivalent to removing a product.\n  if (modifier.$set.isDeleted === true) {\n    Hooks.Events.run(\"afterRemoveProduct\", product);\n  }\n\n  return result;\n}\n\nexport function discardDrafts(documentIds) {\n  check(documentIds, Match.OneOf(String, Array));\n\n  let documentIdArray;\n\n  if (Array.isArray(documentIds)) {\n    documentIdArray = documentIds;\n  } else {\n    documentIdArray = [documentIds];\n  }\n\n  const selector = {\n    \"workflow.status\": {\n      $nin: [\n        \"revision/published\"\n      ]\n    },\n    \"$or\": [\n      {\n        documentId: {\n          $in: documentIdArray\n        }\n      },\n      {\n        \"documentData.ancestors\": {\n          $in: documentIdArray\n        }\n      },\n      {\n        parentDocument: {\n          $in: documentIds\n        }\n      }\n    ]\n  };\n\n  const result = Revisions.remove(selector);\n\n  return result > 0;\n}\n\nMeteor.methods({\n  \"revisions/settings/update\": updateSettings,\n  \"revisions/discard\": discardDrafts,\n  \"revisions/publish\"(documentIds) {\n    check(documentIds, Match.OneOf(String, Array));\n\n    // Also publish variants if they have a draft\n    let revisions;\n\n    if (Array.isArray(documentIds)) {\n      revisions = Revisions.find({\n        \"workflow.status\": {\n          $nin: [\n            \"revision/published\"\n          ]\n        },\n        \"$or\": [\n          {\n            documentId: {\n              $in: documentIds\n            }\n          },\n          {\n            \"documentData.ancestors\": {\n              $in: documentIds\n            }\n          },\n          {\n            parentDocument: {\n              $in: documentIds\n            }\n          }\n        ]\n      }).fetch();\n    } else {\n      revisions = Revisions.find({\n        \"workflow.status\": {\n          $nin: [\n            \"revision/published\"\n          ]\n        },\n        \"$or\": [\n          { documentId: documentIds },\n          {\n            \"documentData.ancestors\": {\n              $in: [documentIds]\n            }\n          }\n        ]\n      }).fetch();\n    }\n\n    let updatedDocuments = 0;\n    if (revisions) {\n      for (const revision of revisions) {\n        if (!revision.documentType || revision.documentType === \"product\") {\n          const res = publishCatalogProduct(\n            this.userId,\n            {\n              _id: revision.documentId\n            },\n            {\n              $set: revision.documentData\n            }\n          );\n          updatedDocuments += res;\n        } else if (revision.documentType === \"image\") {\n          updatedDocuments += handleImageRevision(revision);\n        }\n      }\n    }\n\n    if (updatedDocuments > 0) {\n      return {\n        status: \"success\"\n      };\n    }\n\n    return false;\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Revisions } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * products publication\n * @param {Number} productScrollLimit - optional, defaults to 24\n * @param {Array} shops - array of shopId to retrieve product from.\n * @return {Object} return product cursor\n */\nMeteor.publish(\"ProductRevisions\", function (productIds) {\n  check(productIds, Array);\n\n  const shop = Reaction.getShopId();\n  // Authorized content curators fo the shop get special publication of the product\n  // all all relevant revisions all is one package\n  if (Roles.userIsInRole(this.userId, [\"owner\", \"admin\", \"createProduct\"], shop._id)) {\n    return Revisions.find({\n      \"$or\": [\n        {\n          documentId: {\n            $in: productIds\n          }\n        },\n        {\n          \"documentData.ancestors\": {\n            $in: productIds\n          }\n        },\n        {\n          parentDocument: {\n            $in: productIds\n          }\n        }\n      ],\n      \"workflow.status\": {\n        $nin: [\n          \"revision/published\"\n        ]\n      }\n    });\n  }\n\n  return this.ready();\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Revisions\",\n  name: \"reaction-revisions\",\n  autoEnable: true,\n  settings: {\n    general: {\n      enabled: true\n    }\n  },\n  registry: [\n    // Settings Panel in Catalog\n    {\n      label: \"Product Revisions\",\n      name: \"catalog/settings/revisions/general\",\n      provides: [\"catalogSettings\"],\n      template: \"revisionControlSettings\"\n    }\n  ]\n});\n","export const shippingRoles = [\"admin\", \"owner\", \"shipping\"];\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Shipping, Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\nimport { shippingRoles } from \"../lib/roles\";\n\n/**\n *\n * @namespace Methods/Shipping\n */\n\nexport const methods = {\n  /**\n   * @name shipping/status/refresh\n   * @method\n   * @memberof Methods/Shipping\n   * @todo This is a stub for future core processing\n   * @summary Blank method. Serves as a place for Method Hooks,\n   * in other shipping packages, like Shippo\n   * @param  {String} orderId order ID\n   * @return {String}         order ID\n   */\n  \"shipping/status/refresh\"(orderId) {\n    check(orderId, String);\n    // this is a stub for future core processing\n    // it also serves as a place for Method Hooks\n    // in other shipping packages, like Shippo\n    return orderId;\n  },\n\n  /**\n   * @name shipping/provider/toggle\n   * @method\n   * @memberof Methods/Shipping\n   * @example Meteor.call(\"shipping/provider/toggle\", packageId, settingsKey)\n   * @summary Toggle enabled provider\n   * @param { String } packageId packageId\n   * @param { String } provider provider name\n   * @return { Number } update result\n   */\n  \"shipping/provider/toggle\"(packageId, provider) {\n    check(packageId, String);\n    check(provider, String);\n    if (!Reaction.hasPermission(shippingRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const pkg = Packages.findOne(packageId);\n    if (pkg && pkg.settings[provider]) {\n      const current = Shipping.findOne({ \"provider.name\": provider });\n      const { enabled } = pkg.settings[provider];\n      // const enabled = !current.provider.enabled;\n      if (current && current.provider) {\n        return Shipping.update({\n          \"_id\": current._id,\n          \"provider.name\": provider\n        }, {\n          $set: {\n            \"provider.enabled\": enabled\n          }\n        }, {\n          multi: true\n        });\n      }\n    }\n  }\n};\n\nMeteor.methods(methods);\n","import \"./i18n\";\nimport \"./methods/methods\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Shipping\",\n  name: \"reaction-shipping\",\n  icon: \"fa fa-truck\",\n  autoEnable: true,\n  settings: {\n    name: \"Shipping\",\n    shipping: {\n      enabled: true\n    }\n  },\n  registry: [\n    {\n      provides: [\"dashboard\"],\n      route: \"/dashboard/shipping\",\n      name: \"shipping\",\n      label: \"Shipping\",\n      description: \"Shipping dashboard\",\n      icon: \"fa fa-truck\",\n      priority: 1,\n      container: \"core\",\n      workflow: \"coreDashboardWorkflow\"\n    },\n    {\n      provides: [\"settings\"],\n      name: \"settings/shipping\",\n      label: \"Shipping\",\n      description: \"Configure shipping\",\n      icon: \"fa fa-truck\",\n      template: \"shippingSettings\"\n    }\n  ]\n});\n","import { compose, setDisplayName } from \"recompose\";\n\nexport const Components = {}; // populated with final wrapped components\nexport const ComponentsTable = {}; // storage for separate elements of each component\n\n/**\n * @example // Register a component and container(s) with a name.\n * // The raw component can then be extended or replaced.\n *\n * // Structure of a component in the list:\n *\n * ComponentsTable.MyComponent = {\n *    name: 'MyComponent',\n *    hocs: [fn1, fn2],\n *    rawComponent: React.Component\n * }\n * @name registerComponent\n * @method\n * @memberof Components\n * @param {String} name The name of the component to register.\n * @param {React.Component} rawComponent Interchangeable/extendable component.\n * @param {Function|Array} hocs The HOCs to wrap around the raw component.\n *\n * @returns {React.Component} returns the final wrapped component\n */\nexport function registerComponent(name, rawComponent, hocs = []) {\n  if (!name || !rawComponent) {\n    throw new Error(\"A name and component are required for registerComponent\");\n  }\n\n  // store the component in the table\n  ComponentsTable[name] = {\n    name,\n    rawComponent,\n    hocs: Array.isArray(hocs) ? hocs : [hocs]\n  };\n}\n\n\n/**\n * @name registerHOC\n * @method\n * @summary Register containers (HOC) with a name.\n * If some containers already exist for the component, they will be extended.\n * @param {String} name The name of the component to register.\n * @param {Function|Array} hocs The HOCs to wrap around the raw component.\n * @memberof Components\n * @returns {undefined}\n */\nexport function registerHOC(name, hocs = []) {\n  if (!name || !hocs) {\n    throw new Error(\"A name and HOC(s) are required for registerHOC\");\n  }\n\n  const newHOCs = Array.isArray(hocs) ? hocs : [hocs];\n\n  const existingComponent = ComponentsTable[name];\n\n  // Check to see if this component has already been registered and whether it has\n  // HOC's to merge with our new ones. If not, just register it like a new component.\n  // This allows us to register HOCs _before_ registering the UI component.\n  // Just keep in mind that the resulting component will definitely throw an error\n  // if a UI component doesn't eventually get registered.\n  if (!!existingComponent && !!existingComponent.hocs) {\n    const existingHOCs = existingComponent.hocs;\n\n    ComponentsTable[name] = {\n      name,\n      hocs: [...newHOCs, ...existingHOCs]\n    };\n  } else {\n    ComponentsTable[name] = {\n      name,\n      hocs: newHOCs\n    };\n  }\n}\n\n\n/**\n * @name getComponent\n * @method\n * @summary Get a component registered with registerComponent(name, component, ...hocs).\n * @param {String} name The name of the component to get.\n * @return {Function|React.Component} A (wrapped) React component\n * @memberof Components\n */\nexport function getComponent(name) {\n  const component = ComponentsTable[name];\n\n  if (!component) {\n    throw new Error(`Component ${name} not registered.`);\n  }\n\n  const hocs = component.hocs.map((hoc) => (Array.isArray(hoc) ? hoc[0](hoc[1]) : hoc));\n\n  return compose(...hocs, setDisplayName(`Reaction(${name})`))(component.rawComponent);\n}\n\n\n/**\n * @name replaceComponent\n * @method\n * @summary Replace a Reaction component with a new component and optionally add one or more higher order components.\n * This function keeps track of the previous HOCs and wraps the new HOCs around previous ones\n * @param {String} name The name of the component to register.\n * @param {React.Component} newComponent Interchangeable/extendable component.\n * @param {Function|Array} hocs The HOCs to compose with the raw component.\n * @returns {Function|React.Component} A component callable with Components[name]\n * @memberof Components\n */\nexport function replaceComponent(name, newComponent, hocs = []) {\n  const previousComponent = ComponentsTable[name];\n\n  if (!previousComponent) {\n    throw new Error(`Component '${name}' not found. Use registerComponent to create it.`);\n  }\n\n  const newHocs = Array.isArray(hocs) ? hocs : [hocs];\n\n  return registerComponent(name, newComponent, [...newHocs, ...previousComponent.hocs]);\n}\n\n\n/**\n * @name getRawComponent\n * @method\n * @summary Get the raw UI component without any possible HOCs wrapping it.\n * @param {String} name The name of the component to get.\n * @returns {Function|React.Component} A React component\n * @memberof Components\n */\nexport const getRawComponent = (name) => ComponentsTable[name].rawComponent;\n\n\n/**\n * @name getHOCs\n * @method\n * @summary Get the raw UI component without any possible HOCs wrapping it.\n * @param {String} name The name of the component to get.\n * @returns {Function|React.Component} Array of HOCs\n * @memberof Components\n */\nexport const getHOCs = (name) => ComponentsTable[name].hocs;\n\n\n/**\n * @name copyHOCs\n * @method\n * @summary Wrap a new component with the HOCs from a different component\n * @param {String} sourceComponentName The name of the component to get the HOCs from\n * @param {Function|React.Component} targetComponent Component to wrap\n * @returns {Function|React.Component} A new component wrapped with the HOCs of the source component\n * @memberof Components\n */\nexport function copyHOCs(sourceComponentName, targetComponent) {\n  const sourceComponent = ComponentsTable[sourceComponentName];\n  return compose(...sourceComponent.hocs)(targetComponent);\n}\n\n\n/**\n * @name loadRegisteredComponents\n * @method\n * @summary Populate the final Components object with the contents of the lookup table.\n * This should only be called once on app startup.\n * @returns {Object} An object containing all of the registered components\n * @memberof Components\n **/\nexport function loadRegisteredComponents() {\n  Object.keys(ComponentsTable).forEach((name) => {\n    Components[name] = getComponent(name);\n  });\n\n  return Components;\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { Mongo } from \"meteor/mongo\";\nimport { check, Match } from \"meteor/check\";\nimport createJobCollection from \"@reactioncommerce/job-queue\";\n\nconst later = Meteor.isServer && require(\"later\");\n\nconst classes = createJobCollection({ Mongo, Meteor, check, Match, later });\n\nexport const { Job, JobCollection } = classes;\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Job Collection\",\n  name: \"reaction-job-collection\",\n  icon: \"fa fa-cogs\"\n});\n","/**\n * @file Route Hook Methods - The Router.Hooks namespace provides a router-agnostic API for registering functions to be called either on specific routes or on every route. Read more about [Routing in Reaction](https://docs.reactioncommerce.com/reaction-docs/master/routing).\n *\n * @namespace Router.Hooks\n */\n\nconst Hooks = {\n  _hooks: {\n    onEnter: {},\n    onExit: {}\n  },\n\n  _addHook(type, routeName, callback) {\n    if (typeof this._hooks[type][routeName] === \"undefined\") {\n      this._hooks[type][routeName] = [];\n    }\n    this._hooks[type][routeName].push(callback);\n  },\n\n  enter(callback) {\n    if (Array.isArray(callback)) {\n      callback.forEach((cb) => {\n        this.onEnter(cb);\n      });\n    } else {\n      this.onEnter(callback);\n    }\n  },\n\n  leave(callback) {\n    if (Array.isArray(callback)) {\n      callback.forEach((cb) => {\n        this.onExit(cb);\n      });\n    } else {\n      return this.onExit(callback);\n    }\n  },\n\n  /**\n   * @method onEnter\n   * @memberof Router.Hooks\n   * @summary Register a hook on a specific route\n   * Can be called as many times as needed to add more than one callback\n   * @example // create a function to do something on the product detail page\nfunction logSomeStuff() {\n  console.log(\"We're arriving at the product page!\");\n}\n// add that to the product detail page onEnter hook\nRouter.Hooks.onEnter(\"product\", logSomeStuff);\n   * @param  {String}   routeName Name of route\n   * @param  {Function} callback  Callback method\n   * @return {undefined}\n   */\n  onEnter(routeName, callback) {\n    // if first argument is a function it's a global callback\n    if (arguments.length === 1 && typeof routeName === \"function\") {\n      const cb = routeName;\n      return this._addHook(\"onEnter\", \"GLOBAL\", cb);\n    }\n    // route-specific onEnter callback\n    return this._addHook(\"onEnter\", routeName, callback);\n  },\n\n  /**\n   * @method onExit\n   * @memberof Router.Hooks\n   * @summary Register a hook on a specific route\n   * Can be called as many times as needed to add more than one callback\n   * @param  {String}   routeName Name of route\n   * @param  {Function} callback  Callback method\n   * @return {undefined}\n   */\n  onExit(routeName, callback) {\n    // if first argument is a function it's a global callback\n    if (arguments.length === 1 && typeof routeName === \"function\") {\n      const cb = routeName;\n      return this._addHook(\"onExit\", \"GLOBAL\", cb);\n    }\n    // route-specific onExit callback\n    return this._addHook(\"onExit\", routeName, callback);\n  },\n\n  /**\n   * @method get\n   * @memberof Router.Hooks\n   * @summary Get all registered hooks for a specific route\n   * @param  {String} type Type of hook - `\"onEnter\"` or `\"onExit\"`\n   * @param  {String} name Name of Route\n   * @return {Array}  Array of hooks\n   */\n  get(type, name) {\n    const group = this._hooks[type] || {};\n    const callbacks = group[name];\n    return (typeof callbacks !== \"undefined\" && !!callbacks.length) ? callbacks : [];\n  },\n\n  /**\n   * @method run\n   * @memberof Router.Hooks\n   * @summary Run all registered hooks\n   * @param  {String} type Type of hook - `\"onEnter\"` or `\"onExit\"`\n   * @param  {String} name \"GLOBAL\" for all registered global hooks\n   * @param  {Object} [context] Context object, optional, or `routeName`\n   * @return {Array}  Array of hooks\n   */\n  run(type, name, context) {\n    const callbacks = this.get(type, name);\n    if (typeof callbacks !== \"undefined\" && !!callbacks.length) {\n      return callbacks.forEach((callback) => callback(context));\n    }\n    return null;\n  }\n};\n\nexport default Hooks;\n","export { Link, NavLink, Prompt, withRouter } from \"react-router-dom\";\nexport { default as Router } from \"./router\";\n","import React from \"react\";\nimport { Route } from \"react-router\";\nimport createBrowserHistory from \"history/createBrowserHistory\";\nimport createMemoryHistory from \"history/createMemoryHistory\";\nimport pathToRegexp from \"path-to-regexp\";\nimport queryParse from \"query-parse\";\nimport Immutable from \"immutable\";\nimport { uniqBy } from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport Blaze from \"meteor/gadicc:blaze-react-component\";\nimport { Template } from \"meteor/templating\";\nimport { Session } from \"meteor/session\";\nimport { Tracker } from \"meteor/tracker\";\nimport { Packages, Shops } from \"/lib/collections\";\nimport { getComponent } from \"@reactioncommerce/reaction-components/components\";\nimport Hooks from \"./hooks\";\n\n// Using a ternary operator here to avoid a mutable export - open to suggestions for a better way to do this\nexport const history = Meteor.isClient ? createBrowserHistory() : createMemoryHistory();\n\n// Private vars\nlet currentRoute = Immutable.Map();\nconst routerReadyDependency = new Tracker.Dependency();\nconst routerChangeDependency = new Tracker.Dependency();\n\n/** Class representing a static base router */\nclass Router {\n  /**\n   * history\n   * @type {history}\n   */\n  static history = history\n\n  /**\n   * Hooks\n   * @type {Hooks}\n   */\n  static Hooks = Hooks\n\n  /**\n   * Registered route definitions\n   * @type {Array}\n   */\n  static routes = []\n\n  /**\n   * Router initialization state\n   * @type {Boolean}\n   */\n  static _initialized = false;\n\n  /**\n   * Active classname for active routes\n   * @type {String}\n   */\n  static activeClassName = \"active\";\n\n  /**\n   * Routes array\n   * @type {Array}\n   * @param {Array} value An array of objects\n   */\n  static set _routes(value) {\n    Router.routes = value;\n  }\n\n  static get _routes() {\n    return Router.routes;\n  }\n\n  /**\n   * Triggers reactively on router ready state changed\n   * @return {Boolean} Router initalization state\n   */\n  static ready() {\n    routerReadyDependency.depend();\n    return Router._initialized;\n  }\n\n  /**\n   * Re-triggers router ready dependency\n   * @return {undefined}\n   */\n  static triggerRouterReady() {\n    routerReadyDependency.changed();\n  }\n\n  /**\n   * Hooks\n   * @type {Hooks}\n   */\n  static get triggers() {\n    return Hooks;\n  }\n\n  /**\n   * Get the current route date. Not reactive.\n   * @return {Object} Object containing route data\n   */\n  static current() {\n    return currentRoute.toJS();\n  }\n\n  /**\n   * Set current route data. Is reactive.\n   * @param {Object} routeData Object containing route data\n   * @return {undefined}\n   */\n  static setCurrentRoute(routeData) {\n    currentRoute = Immutable.Map(routeData);\n    routerChangeDependency.changed();\n  }\n\n  /**\n   * Get the name of the current route. Is reactive.\n   * @return {String} Name of current route\n   */\n  static getRouteName() {\n    const current = Router.current();\n\n    return (current.route && current.route.name) || \"\";\n  }\n\n  /**\n   * Get param by name. Is reactive.\n   * @param  {String} name Param name\n   * @return {String|undefined} String value or undefined\n   */\n  static getParam(name) {\n    routerChangeDependency.depend();\n    const current = Router.current();\n\n    return (current.params && current.params[name]) || undefined;\n  }\n\n  /**\n   * Get query param by name\n   * @param  {String} name Query param name. Is reactive.\n   * @return {String|undefined} String value or undefined\n   */\n  static getQueryParam(name) {\n    routerChangeDependency.depend();\n    const current = Router.current();\n\n    return (current.query && current.query[name]) || undefined;\n  }\n\n  /**\n   * Merge new query params with current params\n   * @param {Object} newParams Object containing params\n   * @return {undefined}\n   */\n  static setQueryParams(newParams) {\n    const current = Router.current();\n\n    // Merge current and new params\n    const queryParams = Object.assign({}, current.query, newParams);\n\n    // Any param marked as null or undefined will be removed\n    for (const key in queryParams) {\n      if (queryParams[key] === null || queryParams[key] === undefined) {\n        delete queryParams[key];\n      }\n    }\n\n    // Update route\n    Router.go(current.route.name, current.params, queryParams);\n  }\n\n  /**\n   * Watch path change. Is Reactive.\n   * @return {undefined}\n   */\n  static watchPathChange() {\n    routerChangeDependency.depend();\n  }\n}\n\n/**\n * pathFor\n * @summary get current router path\n * @param {String} path - path to fetch\n * @param {Object} options - url params\n * @return {String} returns current router path\n */\nRouter.pathFor = (path, options = {}) => {\n  const foundPath = Router.routes.find((pathObject) => {\n    if (pathObject.route) {\n      if (options.hash && options.hash.shopSlug) {\n        if (pathObject.options.name === path && pathObject.route.includes(\"shopSlug\")) {\n          return true;\n        }\n      } else if (pathObject.options.name === path && !pathObject.route.includes(\"shopSlug\")) {\n        return true;\n      }\n    }\n\n    // No path found\n    return false;\n  });\n\n  if (foundPath) {\n    // Pull the hash out of options\n    //\n    // This is becuase of Spacebars that we have hash.\n    // Spacebars takes all params passed into a template tag and places\n    // them into the options.hash object. This will also include any `query` params\n    const hash = (options && options.hash) || {};\n\n    // Create an executable function based on the route regex\n    const toPath = pathToRegexp.compile(foundPath.route);\n\n    // Compile the regex path with the params from the hash\n    const compiledPath = toPath(hash);\n\n    // Convert the query object to a string\n    // e.g. { a: \"one\", b: \"two\"} => \"a=one&b=two\"\n    const queryString = queryParse.toString(hash.query);\n\n    // Return the compiled path + query string if we have one\n    if (typeof queryString === \"string\" && queryString.length) {\n      return `${compiledPath}?${queryString}`;\n    }\n\n    // Return only the compiled path\n    return compiledPath;\n  }\n\n  return \"/\";\n};\n\n/**\n * Navigate to path with params and query\n * @param  {String} path Path string\n * @param  {Object} params Route params object\n * @param  {Object} query Query params object\n * @return {undefined} undefined\n */\nRouter.go = (path, params, query) => {\n  let actualPath;\n\n  const routerGo = () => {\n    if (typeof path === \"string\" && path.startsWith(\"/\")) {\n      actualPath = path;\n    } else {\n      actualPath = Router.pathFor(path, {\n        hash: {\n          ...params,\n          query\n        }\n      });\n    }\n\n    if (window) {\n      history.push(actualPath);\n    }\n  };\n\n  // if Router is in a non ready/initialized state yet, wait until it is\n  if (!Router.ready()) {\n    Tracker.autorun((routerReadyWaitFor) => {\n      if (Router.ready()) {\n        routerReadyWaitFor.stop();\n        routerGo();\n      }\n    });\n\n    return;\n  }\n\n  routerGo();\n};\n\n/**\n * Replace location\n * @param  {String} path Path string\n * @param  {Object} params Route params object\n * @param  {Object} query Query params object\n * @return {undefined} undefined\n */\nRouter.replace = (path, params, query) => {\n  const actualPath = Router.pathFor(path, {\n    hash: {\n      ...params,\n      query\n    }\n  });\n\n  if (window) {\n    history.replace(actualPath);\n  }\n};\n\n/**\n * Reload router\n * @return {undefined} undefined\n */\nRouter.reload = () => {\n  const current = Router.current();\n\n  if (window) {\n    history.replace(current.route.fullPath || \"/\");\n  }\n};\n\n/**\n * isActive\n * @summary general helper to return \"active\" when on current path\n * @example {{active \"name\"}}\n * @param {String} routeName - route name as defined in registry\n * @return {String} return \"active\" or null\n */\nRouter.isActiveClassName = (routeName) => {\n  const current = Router.current();\n  const { group } = current.route;\n  let prefix = \"\";\n\n  if (current.route) {\n    const { path } = current.route;\n\n    if (group && group.prefix) {\n      ({ prefix } = current.route.group);\n    }\n\n    // Match route\n    if (prefix.length && routeName.startsWith(prefix) && path === routeName) {\n      // Route name is a path and starts with the prefix. (default '/reaction')\n      return Router.activeClassName;\n    } else if (routeName.startsWith(\"/\") && path === routeName) {\n      // Route name isa  path and starts with slash, but was not prefixed\n      return Router.activeClassName;\n    } else if (current.route.name === routeName) {\n      // Route name is the actual name of the route\n      return Router.activeClassName;\n    }\n  }\n\n  return \"\";\n};\n\n/**\n * hasRoutePermission\n * check if user has route permissions\n * @access private\n * @param  {Object} route - route context\n * @return {Boolean} returns `true` if user is allowed to see route, `false` otherwise\n */\nfunction hasRoutePermission(route) {\n  const routeName = route.name;\n\n  return routeName === \"index\" ||\n    routeName === \"not-found\" ||\n    Router.Reaction.hasPermission(route.permissions, Meteor.userId());\n}\n\n\n/**\n * getRegistryRouteName\n * assemble route name to be standard\n * prefix/package name + registry name or route\n * @param  {String} packageName  [package name]\n * @param  {Object} registryItem [registry object]\n * @return {String}              [route name]\n */\nfunction getRegistryRouteName(packageName, registryItem) {\n  let routeName;\n  if (packageName && registryItem) {\n    if (registryItem.name) {\n      routeName = registryItem.name;\n    } else if (registryItem.template) {\n      routeName = `${packageName}/${registryItem.template}`;\n    } else {\n      routeName = packageName;\n    }\n    // dont include params in the name\n    [routeName] = routeName.split(\":\");\n    return routeName;\n  }\n  return null;\n}\n\n/**\n * selectLayout\n * @access private\n * @param {Object} layout - element of shops.layout array\n * @param {Object} setLayout - layout\n * @param {Object} setWorkflow - workflow\n * @returns {Object} layout - return object of template definitions for Blaze Layout\n */\nfunction selectLayout(layout, setLayout, setWorkflow) {\n  const currentLayout = setLayout || Session.get(\"DEFAULT_LAYOUT\") || \"coreLayout\";\n  const currentWorkflow = setWorkflow || Session.get(\"DEFAULT_WORKFLOW\") || \"coreWorkflow\";\n  if (layout.layout === currentLayout && layout.workflow === currentWorkflow && layout.enabled === true) {\n    return layout;\n  }\n  return null;\n}\n\n/**\n * ReactionLayout\n * sets and returns reaction layout structure\n * @access public\n * @param {Object} options - this router context\n * @param {String} options.layout - string of shop.layout.layout (defaults to coreLayout)\n * @param {String} options.workflow - string of shop.layout.workflow (defaults to coreLayout)\n * @returns {Object} layout - return object of template definitions for Blaze Layout\n */\nexport function ReactionLayout(options = {}) {\n  // Find a workflow layout to render\n\n  // By default we'll use the primary shop for layouts\n  let shopId = Router.Reaction.getPrimaryShopId();\n\n  // We'll check the marketplace settings too so that we can use the active shopId\n  // if merchantTemplates is enabled\n  // XXX: using merchantTemplates is not ready for production and has not been tested! Use at your own risk.\n  let marketplaceSettings;\n\n  if (Meteor.isClient) { // If we're on the client, use the cached marketplace settings\n    marketplaceSettings = Router.Reaction.marketplace;\n  } else { // if we're on the server, go get the settings from the db with this method\n    marketplaceSettings = Router.Reaction.getMarketplaceSettings();\n    if (marketplaceSettings && marketplaceSettings.public) {\n      // We're only interested in the public settings here\n      marketplaceSettings = marketplaceSettings.public;\n    }\n  }\n\n  // If merchantTemplates is enabled, use the active shopId\n  if (marketplaceSettings && marketplaceSettings.merchantTemplates === true) {\n    shopId = Router.Reaction.getShopId();\n  }\n\n  // Get the shop data\n  const shop = Shops.findOne(shopId);\n\n  // get the layout & workflow from options if they exist\n  // Otherwise get them from the Session. this is set in `/client/config/defaults`\n  // Otherwise, default to hard-coded values\n  const layoutName = options.layout || Session.get(\"DEFAULT_LAYOUT\") || \"coreLayout\";\n  const workflowName = options.workflow || Session.get(\"DEFAULT_WORKFLOW\") || \"coreWorkflow\";\n\n  // Layout object used to render\n  // Defaults provided for reference\n  let layoutStructure = {\n    template: \"\",\n    layoutHeader: \"\",\n    layoutFooter: \"\",\n    notFound: \"notFound\",\n    dashboardHeader: \"\",\n    dashboardControls: \"\",\n    dashboardHeaderControls: \"\",\n    adminControlsFooter: \"\"\n  };\n\n  let layoutTheme = \"default\";\n\n  // Find a registered layout using the layoutName and workflowName\n  if (shop) {\n    const sortedLayout = shop.layout.sort((prev, next) => prev.priority - next.priority);\n    const foundLayout = sortedLayout.find((x) => selectLayout(x, layoutName, workflowName));\n\n    if (foundLayout) {\n      if (foundLayout.structure) {\n        layoutStructure = {\n          ...foundLayout.structure\n        };\n      }\n      if (foundLayout.theme) {\n        layoutTheme = foundLayout.theme;\n      }\n    }\n  }\n\n  // If the original options did not include a workflow, but did have a template,\n  // then we override the template from the layout with the one provided by the options.\n  //\n  // Why is this? We always need a workflow to render the entire layout of the app.\n  // The default layout has a default template that may not be the one we want to render.\n  // Some routes, such as `/account/profile` do no have a workflow, but define a template.\n  // Without the logic below, it would end up rendering the homepage instead of the profile\n  // page.\n  // const optionsHasWorkflow = typeof options.workflow === \"string\";\n  const optionsHasTemplate = typeof options.template === \"string\";\n\n  if (optionsHasTemplate) {\n    layoutStructure.template = options.template;\n  }\n\n  // If there is no Blaze Template (Template[]) or React Component (getComponent)\n  // Then use the notFound template instead\n  let hasReactComponent = true;\n\n  try {\n    getComponent(layoutStructure.template);\n  } catch (e) {\n    hasReactComponent = false;\n  }\n\n  if (!Template[layoutStructure.template] && !hasReactComponent) {\n    return (\n      <Blaze template={layoutStructure.notFound} />\n    );\n  }\n\n  // Render the layout\n  return {\n    theme: layoutTheme,\n    structure: layoutStructure,\n    component: (props) => { // eslint-disable-line react/no-multi-comp, react/display-name\n      const { route } = Router.current();\n      const { permissions } = options;\n      const structure = {\n        ...layoutStructure\n      };\n\n      // If the current route is unauthorized, and is not the \"not-found\" route,\n      // then override the template to use the default unauthorized template\n      if (hasRoutePermission({ ...route, permissions }) === false && route.name !== \"not-found\" && !Meteor.user()) {\n        if (!Router.Reaction.hasPermission(route.permissions, Meteor.userId())) {\n          structure.template = \"unauthorized\";\n        }\n        return false;\n      }\n      try {\n        // Try to create a React component if defined\n        return React.createElement(getComponent(layoutName), {\n          ...props,\n          structure\n        });\n      } catch (e) {\n        // eslint-disable-next-line\n        console.warn(e, \"Failed to create a React layout element\");\n      }\n      // If all else fails, render a not found page\n      return <Blaze template={structure.notFound} />;\n    }\n  };\n}\n\n/**\n * initPackageRoutes\n * registers route and template when registry item has\n * registryItem.route && registryItem.template\n * @param {Object} options - options and context for route creation\n * @returns {undefined} returns undefined\n */\nRouter.initPackageRoutes = (options) => {\n  // make _initialized = false in case router is reinitialized\n  Router._initialized = false;\n  routerReadyDependency.changed();\n\n  Router.Reaction = options.reactionContext;\n  Router.routes = [];\n\n  let marketplaceSettings = {\n    shopPrefix: \"/shop\" // default value\n  };\n\n  const marketplace = Packages.findOne({\n    name: \"reaction-marketplace\",\n    shopId: Router.Reaction.getPrimaryShopId()\n  });\n\n  if (marketplace && marketplace.settings && marketplace.settings.public) {\n    marketplaceSettings = marketplace.settings.public;\n  }\n\n  const pkgs = Packages.find().fetch();\n\n  const routeDefinitions = [];\n\n  // prefixing isnt necessary if we only have one shop\n  // but we need to bypass the current\n  // subscription to determine this.\n  const shopSub = Meteor.subscribe(\"shopsCount\");\n\n  Tracker.autorun((shopSubWaitFor) => {\n    if (shopSub.ready()) {\n      shopSubWaitFor.stop();\n      // using tmeasday:publish-counts\n\n      // Default layouts\n      const indexLayout = ReactionLayout(options.indexRoute);\n      const notFoundLayout = ReactionLayout({ template: \"notFound\" });\n\n      // Index route\n      routeDefinitions.push({\n        route: \"/\",\n        name: \"index\",\n        options: {\n          name: \"index\",\n          ...options.indexRoute,\n          theme: indexLayout.theme,\n          component: indexLayout.component,\n          structure: indexLayout.structure\n        }\n      });\n\n      routeDefinitions.push({\n        route: `${marketplaceSettings.shopPrefix}/:shopSlug`,\n        name: \"index\",\n        options: {\n          name: \"index\",\n          type: \"shop-prefix\",\n          ...options.indexRoute,\n          theme: indexLayout.theme,\n          component: indexLayout.component,\n          structure: indexLayout.structure\n        }\n      });\n\n      // Not-found route\n      routeDefinitions.push({\n        route: \"/not-found\",\n        name: \"not-found\",\n        options: {\n          name: \"not-found\",\n          ...notFoundLayout.indexRoute,\n          theme: notFoundLayout.theme,\n          component: notFoundLayout.component,\n          structure: notFoundLayout.structure\n        }\n      });\n\n      // get package registry route configurations\n      for (const pkg of pkgs) {\n        const newRoutes = [];\n        // pkg registry\n        if (pkg.registry && pkg.enabled) {\n          const registry = Array.from(pkg.registry);\n          for (const registryItem of registry) {\n            // registryItems\n            if (registryItem.route) {\n              const {\n                meta,\n                route,\n                permissions,\n                template,\n                layout,\n                workflow\n                // provides\n              } = registryItem;\n\n              const name = getRegistryRouteName(pkg.name, registryItem);\n\n              // define new route\n              // we could allow the options to be passed in the registry if we need to be more flexible\n              const reactionLayout = ReactionLayout({ template, workflow, layout, permissions });\n              const newRouteConfig = {\n                route,\n                name,\n                options: {\n                  meta,\n                  name,\n                  template,\n                  layout,\n                  triggersEnter: Router.Hooks.get(\"onEnter\", name),\n                  triggersExit: Router.Hooks.get(\"onExit\", name),\n                  component: reactionLayout.component,\n                  theme: reactionLayout.theme,\n                  structure: reactionLayout.structure\n                }\n              };\n              newRoutes.push({\n                ...newRouteConfig,\n                route: `/shop/:shopSlug${route}`,\n                options: {\n                  ...newRouteConfig.options,\n                  type: \"shop-prefix\"\n                }\n              });\n              // push new routes\n              newRoutes.push(newRouteConfig);\n            } // end registryItems\n          } // end package.registry\n\n          //\n          // add group and routes to routing table\n          //\n          for (const route of newRoutes) {\n            // allow overriding of prefix in route definitions\n            // define an \"absolute\" url by excluding \"/\"\n            route.group = {};\n\n            if (route.route.substring(0, 1) !== \"/\") {\n              route.route = `/${route.route}`;\n              route.group.prefix = \"\";\n            }\n\n            routeDefinitions.push(route);\n          }\n        }\n      } // end package loop\n\n      // Uniq-ify routes\n      // Take all route definitions in the order that were received, and reverse it.\n      // Routes defined later, like in the case of custom routes will then have a\n      // higher precedence. Any duplicates after the first instance will be removed.\n      //\n      // TODO: In the future, sort by priority\n      // TODO: Allow duplicated routes with a prefix / suffix / flag\n      const uniqRoutes = uniqBy(routeDefinitions.reverse(), \"route\");\n      const reactRouterRoutes = uniqRoutes.map((route, index) => (\n        <Route\n          key={`${route.name}-${index}`}\n          path={route.route}\n          exact={true}\n          render={route.options.component}\n        />\n      ));\n\n      // Last route, if no other route is matched, this one will be the not-found view\n      // Note: This is last becuase all other routes must at-least attempt a match\n      // before falling back to this not-found route.\n      reactRouterRoutes.push((\n        <Route\n          key=\"not-found\"\n          render={notFoundLayout.component}\n        />\n      ));\n\n      // Finish initialization\n      Router._initialized = true;\n      Router.reactComponents = reactRouterRoutes;\n      Router._routes = uniqRoutes;\n\n      // Trigger a reactive refresh to re-render routes\n      routerReadyDependency.changed();\n    }\n  });\n};\n\n\nexport default Router;\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Router\",\n  name: \"reaction-router\",\n  icon: \"fa fa-share\",\n  autoEnable: true,\n  settings: {},\n  registry: []\n});\n","import { get } from \"lodash\";\nimport { xformArrayToConnection } from \"@reactioncommerce/reaction-graphql-xforms/connection\";\n\n/**\n * @name addressBook\n * @method\n * @summary converts the `addressBook` prop on the provided account to a connection\n * @param {Object} account - result of the parent resolver, which is an Account object in GraphQL schema format\n * @return {Promise<Object>} A connection object\n */\nexport default async function addressBook(account, connectionArgs) {\n  const addressList = get(account, \"profile.addressBook\");\n  if (!Array.isArray(addressList)) return null;\n\n  return xformArrayToConnection(connectionArgs, addressList);\n}\n","import { get } from \"lodash\";\nimport { encodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\nimport { getXformedCurrencyByCode } from \"@reactioncommerce/reaction-graphql-xforms/currency\";\nimport { resolveShopFromShopId } from \"@reactioncommerce/reaction-graphql-utils\";\nimport addressBook from \"./addressBook\";\n\nexport default {\n  _id: (account) => encodeAccountOpaqueId(account._id),\n  addressBook,\n  currency: (account, _, context) => getXformedCurrencyByCode(context, account.shopId, account.profile && account.profile.currency),\n  emailRecords: (account) => account.emails,\n  preferences: (account) => get(account, \"profile.preferences\"),\n  shop: resolveShopFromShopId\n};\n","/**\n * @name createdBy\n * @method\n * @summary query the Accounts collection and return user account data\n * @param {Object} args - an object of all arguments that were sent by the previous resolver\n * @param {Object} args.createdBy - a string account id\n * @param {Object} _ - unused\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object>} user account object\n */\nexport default function createdBy({ createdBy: createdByAccountId }, _, context) {\n  return context.queries.userAccount(context, createdByAccountId);\n}\n","import { encodeGroupOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/group\";\nimport { resolveShopFromShopId } from \"@reactioncommerce/reaction-graphql-utils\";\nimport createdBy from \"./createdBy\";\n\nexport default {\n  _id: (node) => encodeGroupOpaqueId(node._id),\n  createdBy,\n  shop: resolveShopFromShopId\n};\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\n\n/**\n * @name addAccountAddressBookEntry\n * @method\n * @summary resolver for the addAccountAddressBookEntry GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} args.input.accoundId - The account ID\n * @param {AddressInput} args.input.address - The address to add\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} AddAccountAddressBookEntryPayload\n */\nexport default function addAccountAddressBookEntry(_, { input }, context) {\n  const { accountId, address, clientMutationId = null } = input;\n  const dbAccountId = decodeAccountOpaqueId(accountId);\n  const updatedAddress = context.methods[\"accounts/addressBookAdd\"](context, [address, dbAccountId]);\n  return {\n    address: updatedAddress,\n    clientMutationId\n  };\n}\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\nimport { decodeGroupOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/group\";\n\n/**\n * @name addAccountToGroup\n * @method\n * @summary resolver for the addAccountToGroup GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} args.input.accoundId - The account ID\n * @param {String} args.input.groupId - The group ID\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} AddAccountToGroupPayload\n */\nexport default function addAccountToGroup(_, { input }, context) {\n  const { accountId, groupId, clientMutationId = null } = input;\n  const dbAccountId = decodeAccountOpaqueId(accountId);\n  const dbGroupId = decodeGroupOpaqueId(groupId);\n  const group = context.methods[\"group/addUser\"](context, [dbAccountId, dbGroupId]);\n  return {\n    group,\n    clientMutationId\n  };\n}\n","import addAccountAddressBookEntry from \"./addAccountAddressBookEntry\";\nimport addAccountToGroup from \"./addAccountToGroup\";\nimport inviteShopMember from \"./inviteShopMember\";\nimport removeAccountAddressBookEntry from \"./removeAccountAddressBookEntry\";\nimport removeAccountFromGroup from \"./removeAccountFromGroup\";\nimport setAccountProfileCurrency from \"./setAccountProfileCurrency\";\nimport updateAccountAddressBookEntry from \"./updateAccountAddressBookEntry\";\n\nexport default {\n  addAccountAddressBookEntry,\n  addAccountToGroup,\n  inviteShopMember,\n  removeAccountAddressBookEntry,\n  removeAccountFromGroup,\n  setAccountProfileCurrency,\n  updateAccountAddressBookEntry\n};\n","import { decodeGroupOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/group\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name inviteShopMember\n * @method\n * @summary resolver for the inviteShopMember GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} args.input.email - The email address of the person to invite\n * @param {String} args.input.groupId - The permission group for this person's new account\n * @param {String} args.input.name - The permission group for this person's new account\n * @param {String} args.input.shopId - The ID of the shop to which you want to invite this person\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} InviteShopMemberPayload\n */\nexport default function inviteShopMember(_, { input }, context) {\n  const { email, groupId, name, shopId, clientMutationId = null } = input;\n  const options = {\n    email,\n    groupId: decodeGroupOpaqueId(groupId),\n    name,\n    shopId: decodeShopOpaqueId(shopId)\n  };\n  const account = context.methods[\"accounts/inviteShopMember\"](context, [options]);\n  return {\n    account,\n    clientMutationId\n  };\n}\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\nimport { decodeAddressOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/address\";\n\n/**\n * @name removeAccountAddressBookEntry\n * @method\n * @summary resolver for the removeAccountAddressBookEntry GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} args.input.accoundId - The account ID\n * @param {String} args.input.addressId - The ID of the address to remove\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} removeAccountAddressBookEntryPayload\n */\nexport default function removeAccountAddressBookEntry(_, { input }, context) {\n  const { accountId, addressId, clientMutationId = null } = input;\n  const dbAccountId = decodeAccountOpaqueId(accountId);\n  const dbAddressId = decodeAddressOpaqueId(addressId);\n  const removedAddress = context.methods[\"accounts/addressBookRemove\"](context, [dbAddressId, dbAccountId]);\n  return {\n    address: removedAddress,\n    clientMutationId\n  };\n}\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\nimport { decodeGroupOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/group\";\n\n/**\n * @name removeAccountFromGroup\n * @method\n * @summary resolver for the removeAccountFromGroup GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} args.input.accoundId - The account ID\n * @param {String} args.input.groupId - The group ID\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} RemoveAccountFromGroupPayload\n */\nexport default function removeAccountFromGroup(_, { input }, context) {\n  const { accountId, groupId, clientMutationId = null } = input;\n  const dbAccountId = decodeAccountOpaqueId(accountId);\n  const dbGroupId = decodeGroupOpaqueId(groupId);\n  const group = context.methods[\"group/removeUser\"](context, [dbAccountId, dbGroupId]);\n  return {\n    group,\n    clientMutationId\n  };\n}\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\n\n/**\n * @name setAccountProfileCurrency\n * @method\n * @summary resolver for the setAccountProfileCurrency GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} [args.input.accoundId] - The account ID, which defaults to the viewer account\n * @param {String} args.input.currencyCode - The currencyCode to add to user profile\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} setAccountProfileCurrency\n */\nexport default function setAccountProfileCurrency(_, { input }, context) {\n  const { accountId, currencyCode, clientMutationId = null } = input;\n  const dbAccountId = decodeAccountOpaqueId(accountId);\n  const updatedAccount = context.methods[\"accounts/setProfileCurrency\"](context, [currencyCode, dbAccountId]);\n\n  return {\n    account: updatedAccount,\n    clientMutationId\n  };\n}\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\nimport { xformAddressInput } from \"@reactioncommerce/reaction-graphql-xforms/address\";\n\n/**\n * @name updateAccountAddressBookEntry\n * @method\n * @summary resolver for the updateAccountAddressBookEntry GraphQL mutation\n * @param {Object} _ - unused\n * @param {Object} args.input - an object of all mutation arguments that were sent by the client\n * @param {String} args.input.accountId - optional opaque ID of account on which entry should be updated, for admins\n * @param {String} args.input.addressId - opaque ID of the address to edit\n * @param {Object} args.input.updatedAddress - updated address object, in GraphQL schema format\n * @param {String} [args.input.clientMutationId] - An optional string identifying the mutation call\n * @param {Object} context - an object containing the per-request state\n * @return {Object} UpdateAccountAddressBookEntryPayload\n */\nexport default function updateAccountAddressBookEntry(_, { input }, context) {\n  const { accountId, addressId, clientMutationId, type, updates } = input;\n  const dbAccountId = decodeAccountOpaqueId(accountId);\n  const address = xformAddressInput({ ...updates, _id: addressId });\n  const updatedAddress = context.methods[\"accounts/addressBookUpdate\"](context, [address, dbAccountId, type]);\n  return {\n    address: updatedAddress,\n    clientMutationId\n  };\n}\n","import { decodeAccountOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/account\";\n\n/**\n * @name account\n * @method\n * @summary query the Accounts collection and return user account data\n * @param {Object} _ - unused\n * @param {Object} args - an object of all arguments that were sent by the client\n * @param {String} args.id - id of user to query\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object>} user account object\n */\nexport default function account(_, { id }, context) {\n  const dbAccountId = decodeAccountOpaqueId(id);\n  return context.queries.userAccount(context, dbAccountId);\n}\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name administrators\n * @method\n * @summary find and return the administrators (users with \"admin\" or \"owner\" role) for a shop\n * @param {Object} _ - unused\n * @param {ConnectionArgs} args - an object of all arguments that were sent by the client\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of user account objects\n */\nexport default async function administrators(_, { shopId, ...connectionArgs }, context) {\n  // Transform ID from base64\n  const dbShopId = decodeShopOpaqueId(shopId);\n\n  const query = await context.queries.shopAdministrators(context, dbShopId);\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import { decodeGroupOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/group\";\n\n/**\n * @name group\n * @method\n * @summary query the Groups collection and return a group by id\n * @param {Object} _ - unused\n * @param {Object} args - an object of all arguments that were sent by the client\n * @param {String} args.id - id of group to query\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object>} group object\n */\nexport default async function group(_, { id }, context) {\n  const dbGroupId = decodeGroupOpaqueId(id);\n  return context.queries.group(context, dbGroupId);\n}\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * Arguments passed by the client a groups query\n * @typedef {ConnectionArgs} GroupConnectionArgs - An object of all arguments that were sent by the client\n * @property {ConnectionArgs} args - An object of all arguments that were sent by the client. {@link ConnectionArgs|See default connection arguments}\n * @property {String} args.shopId - The id of shop to filter groups by\n * @property {Number} args.sortBy - Sort results by a GroupSortByField enum value of `_id`, `name`, `createdAt`, or `updatedAt`\n */\n\n/**\n * @name groups\n * @method\n * @summary find and return the administrators (users with \"admin\" or \"owner\" role) for a shop\n * @param {Object} _ - unused\n * @param {GroupConnectionArgs} args - an object of all arguments that were sent by the client. {@link ConnectionArgs|See default connection arguments}\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} an array of user Group objects\n */\nexport default async function groups(_, { shopId, ...connectionArgs }, context) {\n  // Transform ID from base64\n  const dbShopId = decodeShopOpaqueId(shopId);\n\n  const query = await context.queries.groups(context, dbShopId);\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import account from \"./account\";\nimport administrators from \"./administrators\";\nimport group from \"./group\";\nimport groups from \"./groups\";\nimport roles from \"./roles\";\nimport viewer from \"./viewer\";\n\nexport default {\n  account,\n  administrators,\n  group,\n  groups,\n  roles,\n  viewer\n};\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name roles\n * @method\n * @summary find and return the roles for a shop\n * @param {Object} _ - unused\n * @param {ConnectionArgs} args - an object of all arguments that were sent by the client\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of user Roles objects\n */\nexport default async function roles(_, { shopId, ...connectionArgs }, context) {\n  // Transform ID from base64\n  const dbShopId = decodeShopOpaqueId(shopId);\n\n  const query = await context.queries.roles(context, dbShopId);\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import { optimizeIdOnly } from \"@reactioncommerce/reaction-graphql-utils\";\n\n/**\n * @name viewer\n * @method\n * @summary query the Accounts collection and return user account data for the current user\n * @param {Object} _ - unused\n * @param {Object} args - an object of all arguments that were sent by the client\n * @param {Object} context - an object containing the per-request state\n * @return {Object} user account object\n */\nexport default function viewer(_, __, context, info) {\n  if (!context.userId) return null;\n\n  return optimizeIdOnly(context.userId, info, context.queries.userAccount)(context, context.userId);\n}\n","export default {\n  edges: ({ nodes }) => nodes\n};\n","export default {\n  cursor: (account) => account._id,\n  node: (account) => account\n};\n","export default {\n  addressEdge: ({ address }) => address\n};\n","export default {\n  edges: ({ nodes }) => nodes\n};\n","export default {\n  cursor: (group) => group._id,\n  node: (group) => group\n};\n","export default {\n  edges: ({ nodes }) => nodes\n};\n","export default {\n  cursor: (role) => role._id,\n  node: (role) => role\n};\n","import Account from \"./Account\";\nimport AccountConnection from \"./AccountConnection\";\nimport AccountEdge from \"./AccountEdge\";\nimport AddAccountAddressBookEntryPayload from \"./AddAccountAddressBookEntryPayload\";\nimport Group from \"./Group\";\nimport GroupConnection from \"./GroupConnection\";\nimport GroupEdge from \"./GroupEdge\";\nimport Mutation from \"./Mutation\";\nimport Query from \"./Query\";\nimport RoleConnection from \"./RoleConnection\";\nimport RoleEdge from \"./RoleEdge\";\n\nexport default {\n  Account,\n  AccountConnection,\n  AccountEdge,\n  AddAccountAddressBookEntryPayload,\n  Group,\n  GroupConnection,\n  GroupEdge,\n  Mutation,\n  Query,\n  RoleConnection,\n  RoleEdge\n};\n","import { encodeCatalogItemOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/catalogItem\";\nimport { resolveShopFromShopId } from \"@reactioncommerce/reaction-graphql-utils\";\nimport positions from \"./positions\";\nimport product from \"./product\";\n\nexport default {\n  _id: (item) => encodeCatalogItemOpaqueId(item._id),\n  positions,\n  product,\n  shop: resolveShopFromShopId\n};\n","import { encodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\nimport { encodeTagOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/tag\";\n\n/**\n * @name positions\n * @method\n * @summary Adjusts the positions prop of a product\n * @param {Object} product - CatalogProduct response from parent resolver\n * @return {Promise<Object[]>} Promise that resolves with an array of positions\n */\nexport default async function positions(product, _, context) {\n  const { positions: productPositions } = product;\n  if (!productPositions) return [];\n\n  const { Shops, Tags } = context.collections;\n  const positionTags = Object.keys(productPositions);\n  const tagDocs = await Tags.find({ name: { $in: positionTags } }).toArray();\n\n  return positionTags.map(async (tag) => {\n    const tagDoc = tagDocs.find((doc) => doc.name === tag);\n    let shop;\n    if (!tagDoc) {\n      // Tag name can also be the shop name lowercase\n      shop = await Shops.findOne({ name: { $regex: new RegExp(`^${tag}$`, \"i\") } });\n      if (!shop) throw new Error(`No tag or shop found with name \"${tag}\"`);\n    }\n\n    let tagId;\n    if (tagDoc) {\n      tagId = encodeTagOpaqueId(tagDoc._id);\n    } else {\n      tagId = encodeShopOpaqueId(shop._id);\n    }\n\n    const info = productPositions[tag];\n    return {\n      displayWeight: info.weight,\n      isPinned: !!info.pinned,\n      position: info.position || 1,\n      tagId,\n      updatedAt: info.updatedAt\n    };\n  });\n}\n","import { xformProductMedia } from \"@reactioncommerce/reaction-graphql-xforms/catalogProduct\";\n\n/**\n * @name product\n * @method\n * @summary Returns the product for a catalog item\n * @param {Object} item - CatalogItem response from parent resolver\n * @return {Object} Adjusted product object\n */\nexport default function product(item) {\n  const { media } = item;\n  const primaryImage = (media || [])\n    .sort((a, b) => a.metadata.priority - b.metadata.priority)\n    .find(({ metadata = {} }) => metadata.toGrid === 1);\n\n  return {\n    ...item,\n    isTaxable: !!item.taxable,\n    media: media.map(xformProductMedia),\n    primaryImage: xformProductMedia(primaryImage),\n    tagIds: item.hashtags,\n    slug: item.handle,\n    socialMetadata: [\n      { service: \"twitter\", message: item.twitterMsg },\n      { service: \"facebook\", message: item.facebookMsg },\n      { service: \"googleplus\", message: item.googleplusMsg },\n      { service: \"pinterest\", message: item.pinterestMsg }\n    ],\n    updatedAt: item.updatedAt || item.createdAt\n  };\n}\n","import { encodeCatalogProductOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/catalogProduct\";\nimport { encodeProductOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/product\";\nimport { resolveShopFromShopId } from \"@reactioncommerce/reaction-graphql-utils\";\nimport tagIds from \"./tagIds\";\nimport tags from \"./tags\";\nimport variants from \"./variants\";\n\nexport default {\n  _id: (node) => encodeCatalogProductOpaqueId(node._id),\n  productId: (node) => encodeProductOpaqueId(node._id),\n  shop: resolveShopFromShopId,\n  tagIds,\n  tags,\n  variants\n};\n","import { encodeTagOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/tag\";\n\n/**\n * @name tagIds\n * @method\n * @summary Returns the product tagIds prop to opaque IDs\n * @param {Object} product - CatalogProduct response from parent resolver\n * @return {String[]} Array of tag IDs\n */\nexport default function tagsIds(product) {\n  const { tagIds } = product;\n  if (!tagIds || tagIds.length === 0) return [];\n\n  return tagIds.map(encodeTagOpaqueId);\n}\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { xformArrayToConnection } from \"@reactioncommerce/reaction-graphql-xforms/connection\";\n\n/**\n * @name tags\n * @method\n * @summary Returns the tags for a product\n * @param {Object} product - CatalogProduct response from parent resolver\n * @param {TagConnectionArgs} args - arguments sent by the client {@link ConnectionArgs|See default connection arguments}\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of Tag objects\n */\nexport default async function tags(product, connectionArgs, context) {\n  const { tagIds } = product;\n  if (!tagIds || tagIds.length === 0) return xformArrayToConnection(connectionArgs, []);\n\n  const query = await context.queries.tagsByIds(context, tagIds, connectionArgs);\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","/**\n * @name variants\n * @method\n * @summary Adjusts the variants prop of a product\n * @param {Object} product - CatalogProduct response from parent resolver\n * @return {Promise<Object[]>} Promise that resolves with an array of variants\n */\nexport default async function variants(product) {\n  const { variants: productVariants } = product;\n  if (!productVariants || productVariants.length === 0) return null;\n\n  return productVariants.filter((variant) => !variant.isDeleted && variant.isVisible).map((variant) => ({\n    ...variant,\n    index: variant.index || 0,\n    isBackorder: !!variant.isBackorder,\n    isLowQuantity: !!variant.isLowQuantity,\n    isSoldOut: !!variant.isSoldOut,\n    isTaxable: !!variant.taxable,\n    updatedAt: variant.updatedAt || variant.createdAt\n  }));\n}\n","import { encodeCatalogProductOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/catalogProduct\";\nimport { encodeCatalogProductVariantOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/catalogProductVariant\";\nimport { encodeProductOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/product\";\nimport { resolveShopFromShopId } from \"@reactioncommerce/reaction-graphql-utils\";\n\nexport default {\n  _id: (node) => encodeCatalogProductVariantOpaqueId(node._id),\n  ancestorIds: (node) => {\n    const { ancestors } = node;\n\n    if (ancestors.length === 1) {\n      return [encodeCatalogProductOpaqueId(ancestors[0])];\n    }\n\n    if (ancestors.length === 2) {\n      return [\n        encodeCatalogProductOpaqueId(ancestors[0]),\n        encodeCatalogProductVariantOpaqueId(ancestors[1])\n      ];\n    }\n\n    return [];\n  },\n  variantId: (node) => encodeProductOpaqueId(node._id),\n  shop: resolveShopFromShopId\n};\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\nimport { decodeTagOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/tag\";\n\n/**\n * @name catalogItems\n * @method\n * @summary Get a list of catalogItems\n * @param {Object} _ - unused\n * @param {ConnectionArgs} args - an object of all arguments that were sent by the client\n * @param {Object} args.shopIds - limit to catalog items for these shops\n * @param {Object} args.tagIds - limit to catalog items with these tags\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object>} A CatalogItemConnection object\n */\nexport default async function catalogItems(_, args, context) {\n  const { shopIds: opaqueShopIds, tagIds: opaqueTagIds, ...connectionArgs } = args;\n\n  const shopIds = opaqueShopIds && opaqueShopIds.map(decodeShopOpaqueId);\n  const tagIds = opaqueTagIds && opaqueTagIds.map(decodeTagOpaqueId);\n\n  const query = await context.queries.catalogItems(context, {\n    shopIds,\n    tagIds\n  });\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import catalogItems from \"./catalogItems\";\n\nexport default {\n  catalogItems\n};\n","export default {\n  edges: ({ nodes }) => nodes\n};\n","export default {\n  cursor: (item) => item._id,\n  node: (item) => item\n};\n","import { encodeCatalogItemOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/catalogItem\";\nimport CatalogItemConnection from \"./CatalogItemConnection\";\nimport CatalogItemEdge from \"./CatalogItemEdge\";\nimport CatalogItemProduct from \"./CatalogItemProduct\";\nimport CatalogProduct from \"./CatalogProduct\";\nimport CatalogProductVariant from \"./CatalogProductVariant\";\nimport Query from \"./Query\";\n\nexport default {\n  CatalogItem: {\n    __resolveType() {\n      // For now they are all assumed to be products\n      return \"CatalogItemProduct\";\n    }\n  },\n  CatalogItemContent: {\n    _id: (item) => encodeCatalogItemOpaqueId(item._id)\n  },\n  CatalogItemConnection,\n  CatalogItemEdge,\n  CatalogItemProduct,\n  CatalogProduct,\n  CatalogProductVariant,\n  Query\n};\n","import primaryShopId from \"./primaryShopId\";\nimport shop from \"./shop\";\n\nexport default {\n  primaryShopId,\n  shop\n};\n","import { encodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name primaryShopId\n * @method\n * @summary Gets the primary shop ID\n * @param {Object} parentObject - unused\n * @param {Object} args - unused\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<String>} The shop ID based on the domain in ROOT_URL\n */\nexport default async function primaryShopId(_, __, context) {\n  const shopId = await context.queries.primaryShopId(context.collections);\n  return encodeShopOpaqueId(shopId);\n}\n","import { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name shop\n * @method\n * @summary query the Shops collection and return shop data\n * @param {Object} _ - unused\n * @param {Object} args - an object of all arguments that were sent by the client\n * @param {String} args.id - ID of shop to query\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object>} user account object\n */\nexport default async function shop(_, { id }, context) {\n  const dbShopId = decodeShopOpaqueId(id);\n\n  return context.queries.shopById(context, dbShopId);\n}\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name administrators\n * @method\n * @summary find and return the administrators (users with \"admin\" or \"owner\" role) for a shop\n * @param {Object} shop - The shop object returned by the parent resolver\n * @param {ConnectionArgs} args - an object of all arguments that were sent by the client\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of user account objects\n */\nexport default async function administrators(shop, connectionArgs, context) {\n  // Transform ID from base64\n  const dbShopId = decodeShopOpaqueId(shop._id);\n\n  const query = await context.queries.shopAdministrators(context, dbShopId);\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name groups\n * @method\n * @summary find and return the groups for a shop\n * @param {Object} resolverArgs - an object containing the result returned from the resolver\n * @param {String} resolverArgs._id - id of group to query\n * @param {GroupConnectionArgs} args - an object of all arguments that were sent by the client. {@link ConnectionArgs|See default connection arguments}\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of user Group objects\n */\nexport default async function groups({ _id }, connectionArgs, context) {\n  // Transform ID from base64\n  const dbShopId = decodeShopOpaqueId(_id);\n  const query = await context.queries.groups(context, dbShopId);\n\n  return await getPaginatedResponse(query, connectionArgs);\n}\n","import { getXformedCurrenciesByShop } from \"@reactioncommerce/reaction-graphql-xforms/currency\";\nimport { encodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\nimport administrators from \"./administrators\";\nimport groups from \"./groups\";\nimport roles from \"./roles\";\nimport tags from \"./tags\";\n\nexport default {\n  _id: (node) => encodeShopOpaqueId(node._id),\n  administrators,\n  currencies: (shop) => getXformedCurrenciesByShop(shop),\n  currency: (shop) => getXformedCurrenciesByShop(shop).find((currency) => currency.code === (shop.currency || \"USD\")),\n  groups,\n  roles,\n  tags\n};\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * @name roles\n * @method\n * @summary find and return the roles for a shop\n * @param {Object} _ - unused\n * @param {Object} args - an object of all arguments that were sent by the client\n * @param {String} args.shopId - id of shop to query\n * @param {String} args.after - Connection argument\n * @param {String} args.before - Connection argument\n * @param {Number} args.first - Connection argument\n * @param {Number} args.last - Connection argument\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of user Roles objects\n */\nexport default async function roles({ _id }, connectionArgs, context) {\n  // Transform ID from base64\n  const dbShopId = decodeShopOpaqueId(_id);\n\n  const query = await context.queries.roles(context, dbShopId);\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * Arguments passed by the client for a tags query\n * @typedef {ConnectionArgs} TagConnectionArgs - An object of all arguments that were sent by the client\n * @property {ConnectionArgs} args - An object of all arguments that were sent by the client. {@link ConnectionArgs|See default connection arguments}\n * @property {Boolean} args.includeDeleted - If set to true, include deleted. Default false.\n * @property {Boolean} args.isTopLevel - If set to a boolean, filter by this.\n * @property {Number} args.sortBy - Sort results by a TagSortByField enum value of `_id`, `name`, `position`, `createdAt`, `updatedAt`\n */\n\n/**\n * @name tags\n * @method\n * @summary Returns the tags for the parent resolver shop\n * @param {Object} _ - unused\n * @param {TagConnectionArgs} args - arguments sent by the client {@link ConnectionArgs|See default connection arguments}\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of Tag objects\n */\nexport default async function tags({ _id }, connectionArgs, context) {\n  const dbShopId = decodeShopOpaqueId(_id);\n\n  const query = await context.queries.tags(context, dbShopId, connectionArgs);\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import Query from \"./Query\";\nimport Shop from \"./Shop\";\n\nexport default {\n  Query,\n  Shop\n};\n","import tags from \"./tags\";\n\nexport default {\n  tags\n};\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { decodeShopOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/shop\";\n\n/**\n * Arguments passed by the client for a tags query\n * @typedef {ConnectionArgs} TagConnectionArgs - An object of all arguments that were sent by the client\n * @property {ConnectionArgs} args - An object of all arguments that were sent by the client. {@link ConnectionArgs|See default connection arguments}\n * @property {Boolean} args.shouldIncludeDeleted - If set to true, include deleted. Default false.\n * @property {Boolean} args.isTopLevel - If set to a boolean, filter by this.\n * @property {String} args.shopId - The ID of shop to filter tags by\n * @property {Number} args.sortBy - Sort results by a TagSortByField enum value of `_id`, `name`, `position`, `createdAt`, `updatedAt`\n */\n\n/**\n * @name tags\n * @method\n * @summary Returns the tags for a shop\n * @param {Object} _ - unused\n * @param {TagConnectionArgs} args - arguments sent by the client {@link ConnectionArgs|See default connection arguments}\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of Tag objects\n */\nexport default async function tags(_, connectionArgs, context) {\n  const { shopId } = connectionArgs;\n\n  const dbShopId = decodeShopOpaqueId(shopId);\n\n  const query = await context.queries.tags(context, dbShopId, connectionArgs);\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","import { encodeTagOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/tag\";\nimport subTags from \"./subTags\";\n\nexport default {\n  _id: (tag) => encodeTagOpaqueId(tag._id),\n  subTagIds: (tag) => (tag.relatedTagIds || []).map(encodeTagOpaqueId),\n  subTags\n};\n","import { getPaginatedResponse } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { xformArrayToConnection } from \"@reactioncommerce/reaction-graphql-xforms/connection\";\n\n/**\n * Arguments passed by the client for a tags query\n * @typedef {ConnectionArgs} SubTagConnectionArgs - An object of all arguments that were sent by the client\n * @property {ConnectionArgs} args - An object of all arguments that were sent by the client. {@link ConnectionArgs|See default connection arguments}\n * @property {Boolean} args.shouldIncludeDeleted - If set to true, include deleted. Default false.\n * @property {Number} args.sortBy - Sort results by a TagSortByField enum value of `_id`, `name`, `position`, `createdAt`, `updatedAt`\n */\n\n/**\n * @name subTags\n * @method\n * @summary Returns the child tags for a tag\n * @param {Object} tag - Tag response from parent resolver\n * @param {SubTagConnectionArgs} args - arguments sent by the client {@link ConnectionArgs|See default connection arguments}\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object[]>} Promise that resolves with array of Tag objects\n */\nexport default async function subTags({ relatedTagIds }, connectionArgs, context) {\n  if (!relatedTagIds || relatedTagIds.length === 0) return xformArrayToConnection(connectionArgs, []);\n\n  const query = await context.queries.tagsByIds(context, relatedTagIds, connectionArgs);\n\n  return getPaginatedResponse(query, connectionArgs);\n}\n","export default {\n  edges: ({ nodes }) => nodes\n};\n","export default {\n  cursor: (tag) => tag._id,\n  node: (tag) => tag\n};\n","import Query from \"./Query\";\nimport Tag from \"./Tag\";\nimport TagConnection from \"./TagConnection\";\nimport TagEdge from \"./TagEdge\";\n\nexport default {\n  Query,\n  Tag,\n  TagConnection,\n  TagEdge\n};\n","import { encodeAddressOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/address\";\n\nexport default {\n  _id: (node) => encodeAddressOpaqueId(node._id)\n};\n","import { encodeCurrencyOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/currency\";\n\nexport default {\n  _id: (node) => encodeCurrencyOpaqueId(node._id)\n};\n","import Address from \"./Address\";\nimport Currency from \"./Currency\";\n\nexport default {\n  Address,\n  Currency\n};\n","import { GraphQLScalarType } from \"graphql\";\nimport { Kind } from \"graphql/language\";\n\nconst toCursor = (value) => (value ? Buffer.from(value).toString(\"base64\") : null);\nconst fromCursor = (cursor) => (cursor ? Buffer.from(cursor, \"base64\").toString(\"utf8\") : null);\n\nconst description = `\nAn opaque string that identifies a particular result within a connection,\nallowing you to request a subset of results before or after that result.\n`;\n\nexport default new GraphQLScalarType({\n  description,\n  name: \"ConnectionCursor\",\n  serialize: toCursor,\n  parseLiteral(ast) {\n    if (ast.kind === Kind.STRING) return fromCursor(ast.value);\n    return null;\n  },\n  parseValue: fromCursor\n});\n","import { GraphQLScalarType } from \"graphql\";\nimport { Kind } from \"graphql/language\";\n\nconst MAX_LIMIT = 50;\n\n/**\n * @name parseValue\n * @method\n * @summary Adjusts value to be between 1 and MAX_LIMIT, inclusive\n * @param {Number} value An integer provided by the client for the requested limit\n * @returns The adjusted integer value.\n */\nfunction parseValue(value) {\n  // Note that we do not have to do isNaN(value) check here because GraphQLScalarType will not call this for isNaN.\n  // Instead it automatically changes isNaN to undefined.\n  if (typeof value !== \"number\") return MAX_LIMIT;\n  return Math.min(Math.max(1, value), MAX_LIMIT);\n}\n\nconst description = `\nAn integer between 1 and 50, inclusive. Values less than 1 become 1 and\nvalues greater than 50 become 50.\n`;\n\nexport default new GraphQLScalarType({\n  description,\n  name: \"ConnectionLimitInt\",\n  serialize: (value) => value,\n  parseLiteral(ast) {\n    if (ast.kind !== Kind.INT) return MAX_LIMIT;\n    return parseValue(parseInt(ast.value, 10));\n  },\n  parseValue\n});\n","import { GraphQLDate, GraphQLTime, GraphQLDateTime } from \"graphql-iso-date\";\nimport ConnectionCursor from \"./ConnectionCursor\";\nimport ConnectionLimitInt from \"./ConnectionLimitInt\";\n\nexport default {\n  ConnectionCursor,\n  ConnectionLimitInt,\n  Date: GraphQLDate,\n  DateTime: GraphQLDateTime,\n  Time: GraphQLTime\n};\n","import { decodeOpaqueId } from \"@reactioncommerce/reaction-graphql-xforms/id\";\n\nexport default async function applyBeforeAfterToFilter({\n  after,\n  baseFilter = {},\n  before,\n  collection,\n  sortBy: sortByField = \"_id\",\n  sortOrder = \"asc\"\n}) {\n  let filter = baseFilter;\n  const limits = {};\n  const ors = [];\n\n  if (typeof sortByField !== \"string\") throw new Error(\"sortBy is required\");\n  if (sortOrder !== \"asc\" && sortOrder !== \"desc\") throw new Error(\"sortOrder is required\");\n\n  if (after && before) throw new Error(\"Including both 'after' and 'before' params is not allowed\");\n\n  if (!after && !before) return filter;\n\n  let encodedId;\n  let op;\n  if (before) {\n    encodedId = before;\n    op = (sortOrder === \"desc\" ? \"$gt\" : \"$lt\");\n  } else {\n    encodedId = after;\n    op = (sortOrder === \"desc\" ? \"$lt\" : \"$gt\");\n  }\n\n  // \"encodedId\" is encoded twice. At this point the cursor has already been decoded\n  // but we are still left with an encoded ID, which we'll now decode.\n  let internalId;\n  if (encodedId.endsWith(\"=\")) {\n    internalId = decodeOpaqueId(encodedId).id;\n  } else {\n    internalId = encodedId; // it was only encoded once\n  }\n\n  if (sortByField === \"_id\") {\n    // We already have _id. Skip the lookup\n    filter = {\n      $and: [\n        { ...filter },\n        { _id: { [op]: internalId } }\n      ]\n    };\n  } else {\n    const doc = await collection.findOne({\n      _id: internalId\n    }, {\n      fields: {\n        [sortByField]: 1\n      }\n    });\n\n    if (doc) {\n      limits[op] = doc[sortByField];\n      ors.push({\n        [sortByField]: doc[sortByField],\n        _id: { [op]: internalId }\n      });\n\n      filter = {\n        $and: [\n          { ...filter },\n          {\n            $or: [\n              {\n                [sortByField]: limits\n              },\n              ...ors\n            ]\n          }\n        ]\n      };\n    }\n  }\n\n  return filter;\n}\n","/**\n * Mostly borrowed from https://www.reindex.io/blog/relay-graphql-pagination-with-mongodb/\n */\nexport default async function applyPaginationToMongoCursor(cursor, { first, last } = {}) {\n  const totalCount = await cursor.clone().count();\n  let resultCount = totalCount;\n\n  if (first || last) {\n    let limit;\n    let skip;\n\n    if (first && totalCount > first) {\n      limit = first;\n    }\n\n    if (last) {\n      if (limit && limit > last) {\n        skip = limit - last;\n        limit -= skip;\n      } else if (!limit && totalCount > last) {\n        skip = totalCount - last;\n      }\n    }\n\n    if (skip) {\n      cursor.skip(skip);\n    }\n\n    if (limit) {\n      cursor.limit(limit);\n    }\n\n    resultCount = await cursor.clone().count();\n  }\n\n  return {\n    totalCount,\n    pageInfo: {\n      hasNextPage: !!first && resultCount >= first,\n      hasPreviousPage: !!last && resultCount >= last\n    }\n  };\n}\n","export default function getCollectionFromCursor(cursor) {\n  const { db } = cursor.options;\n  const collectionName = cursor.ns.slice(db.databaseName.length + 1);\n  return db.collection(collectionName);\n}\n","const sortOrderEnumToMongo = {\n  asc: 1,\n  desc: -1\n};\n\nexport default function getMongoSort({ sortBy, sortOrder } = {}) {\n  const mongoSort = sortOrderEnumToMongo[sortOrder || \"asc\"];\n  const sortList = [[\"_id\", mongoSort]];\n  if (sortBy && sortBy !== \"_id\") {\n    sortList.unshift([sortBy, mongoSort]);\n  }\n  return sortList;\n}\n","import applyBeforeAfterToFilter from \"./applyBeforeAfterToFilter\";\nimport applyPaginationToMongoCursor from \"./applyPaginationToMongoCursor\";\nimport getCollectionFromCursor from \"./getCollectionFromCursor\";\nimport getMongoSort from \"./getMongoSort\";\n\nconst getPaginatedResponse = async (query, args) => {\n  const { totalCount, pageInfo } = await applyPaginationToMongoCursor(query, args);\n\n  const collection = getCollectionFromCursor(query);\n  const baseFilter = query.cmd.query;\n\n  const updatedFilter = await applyBeforeAfterToFilter({ collection, baseFilter, ...args });\n  const sort = getMongoSort(args);\n\n  const nodes = await query.filter(updatedFilter).sort(sort).toArray();\n\n  const count = nodes.length;\n  if (count) {\n    pageInfo.startCursor = nodes[0]._id;\n    pageInfo.endCursor = nodes[count - 1]._id;\n  }\n\n  return { nodes, pageInfo, totalCount };\n};\n\nexport default getPaginatedResponse;\n","export { default as applyPaginationToMongoCursor } from \"./applyPaginationToMongoCursor\";\nexport { default as getPaginatedResponse } from \"./getPaginatedResponse\";\nexport { default as namespaces } from \"./namespaces\";\nexport { default as optimizeIdOnly } from \"./optimizeIdOnly\";\nexport { default as resolveShopFromShopId } from \"./resolveShopFromShopId\";\n","export default {\n  Account: \"reaction/account\",\n  Address: \"reaction/address\",\n  CatalogItem: \"reaction/catalogItem\",\n  CatalogProduct: \"reaction/catalogProduct\",\n  CatalogProductVariant: \"reaction/catalogProductVariant\",\n  Currency: \"reaction/currency\",\n  Group: \"reaction/group\",\n  Product: \"reaction/product\",\n  Role: \"reaction/role\",\n  Shop: \"reaction/shop\",\n  Tag: \"reaction/tag\"\n};\n","import graphqlFields from \"graphql-fields\";\n\nexport default function optimizeIdOnly(_id, info, queryFunc) {\n  const topLevelFields = Object.keys(graphqlFields(info));\n\n  // If only the _id was requested, we already have that. Save a DB call.\n  if (topLevelFields.length === 1 && topLevelFields[0] === \"_id\") {\n    return () => Promise.resolve({ _id });\n  }\n\n  return queryFunc;\n}\n","/**\n * @name resolveShopFromShopId\n * @method\n * @summary A generic resolver that gets the shop object for the provided parent result, assuming it has a `shopId` property\n * @param {Object} parent - result of the parent resolver\n * @param {Object} args - an object of all arguments that were sent by the client\n * @param {Object} context - an object containing the per-request state\n * @return {Promise<Object>} The shop having ID parent.shopId, in GraphQL schema format\n */\nexport default async function resolveShopFromShopId(parent, _, context) {\n  const { shopId } = parent;\n  if (!shopId) return null;\n\n  return context.queries.shopById(context, shopId);\n}\n","import { assocPath, dissoc, pipe } from \"ramda\";\nimport { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\nimport { renameKeys } from \"./ramda-ext\";\n\nexport const assocAccountInternalId = assocInternalId(namespaces.Account);\nexport const assocAccountOpaqueId = assocOpaqueId(namespaces.Account);\nexport const decodeAccountOpaqueId = decodeOpaqueIdForNamespace(namespaces.Account);\nexport const encodeAccountOpaqueId = encodeOpaqueId(namespaces.Account);\n\nexport const mergeAddressBookToProfile = (item) =>\n  assocPath([\"profile\", \"addressBook\"], item.addressBook, item);\n\nexport const mergeCurrencyToProfile = (item) =>\n  assocPath([\"profile\", \"currency\"], item.currency, item);\n\nexport const mergePreferencesToProfile = (item) =>\n  assocPath([\"profile\", \"preferences\"], item.preferences, item);\n\nexport const xformAccountInput = pipe(\n  assocAccountInternalId,\n  mergeAddressBookToProfile,\n  mergeCurrencyToProfile,\n  mergePreferencesToProfile,\n  dissoc(\"addressBook\"),\n  dissoc(\"currency\"),\n  dissoc(\"preferences\"),\n  renameKeys({ emailRecords: \"emails\" })\n);\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocAddressInternalId = assocInternalId(namespaces.Address);\nexport const assocAddressOpaqueId = assocOpaqueId(namespaces.Address);\nexport const decodeAddressOpaqueId = decodeOpaqueIdForNamespace(namespaces.Address);\nexport const encodeAddressOpaqueId = encodeOpaqueId(namespaces.Address);\nexport const xformAddressInput = assocAddressInternalId;\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocCatalogItemInternalId = assocInternalId(namespaces.CatalogItem);\nexport const assocCatalogItemOpaqueId = assocOpaqueId(namespaces.CatalogItem);\nexport const decodeCatalogItemOpaqueId = decodeOpaqueIdForNamespace(namespaces.CatalogItem);\nexport const encodeCatalogItemOpaqueId = encodeOpaqueId(namespaces.CatalogItem);\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { encodeProductOpaqueId } from \"./product\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocCatalogProductInternalId = assocInternalId(namespaces.CatalogProduct);\nexport const assocCatalogProductOpaqueId = assocOpaqueId(namespaces.CatalogProduct);\nexport const decodeCatalogProductOpaqueId = decodeOpaqueIdForNamespace(namespaces.CatalogProduct);\nexport const encodeCatalogProductOpaqueId = encodeOpaqueId(namespaces.CatalogProduct);\n\n/**\n * @name xformProductMedia\n * @method\n * @param {Object} mediaItem object from a catalog product\n * @return transformed product media array\n */\nexport function xformProductMedia(mediaItem) {\n  if (!mediaItem) return null;\n\n  const { metadata, large, medium, image, small, thumbnail } = mediaItem;\n\n  return {\n    priority: metadata && metadata.priority,\n    toGrid: metadata && metadata.toGrid,\n    productId: encodeProductOpaqueId(metadata && metadata.productId),\n    variantId: encodeProductOpaqueId(metadata && metadata.variantId),\n    URLs: {\n      large,\n      medium,\n      original: image,\n      small,\n      thumbnail\n    }\n  };\n}\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocCatalogProductVariantInternalId = assocInternalId(namespaces.CatalogProductVariant);\nexport const assocCatalogProductVariantOpaqueId = assocOpaqueId(namespaces.CatalogProductVariant);\nexport const decodeCatalogProductVariantOpaqueId = decodeOpaqueIdForNamespace(namespaces.CatalogProductVariant);\nexport const encodeCatalogProductVariantOpaqueId = encodeOpaqueId(namespaces.CatalogProductVariant);\n","import { connectionFromArray, connectionFromPromisedArray } from \"graphql-relay\";\n\nexport async function xformArrayToConnection(connectionArgs, result) {\n  let connection;\n  if (Array.isArray(result)) {\n    connection = connectionFromArray(result, connectionArgs);\n  } else {\n    connection = await connectionFromPromisedArray(result, connectionArgs);\n  }\n\n  // XXX An optimization would be to do this map only if the client\n  // actually asked for the `nodes` array.\n  connection.nodes = connection.edges.map(({ node }) => node);\n\n  return connection;\n}\n","import { assoc, compose, map, toPairs } from \"ramda\";\nimport { Meteor } from \"meteor/meteor\";\nimport { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocCurrencyInternalId = assocInternalId(namespaces.Currency);\nexport const assocCurrencyOpaqueId = assocOpaqueId(namespaces.Currency);\nexport const decodeCurrencyOpaqueId = decodeOpaqueIdForNamespace(namespaces.Currency);\nexport const encodeCurrencyOpaqueId = encodeOpaqueId(namespaces.Currency);\n\n// add `code` and `_id` keys to each currency object\nexport const xformCurrencyEntry = ([k, v]) => compose(\n  assoc(\"code\", k),\n  assoc(\"_id\", k)\n)(v);\n\n// map over all provided currencies, provided in the format stored in our Shops collection,\n// and convert them to the format that GraphQL needs\nexport const xformLegacyCurrencies = compose(map(xformCurrencyEntry), toPairs);\n\nexport function getXformedCurrenciesByShop(shop) {\n  if (!shop || !shop.currencies) return [];\n  return xformLegacyCurrencies(shop.currencies);\n}\n\n// retrive all currencies from the Shops collection and xform them\nasync function getXformedCurrenciesByShopId(context, shopId) {\n  const shop = await context.collections.Shops.findOne({ _id: shopId });\n  return getXformedCurrenciesByShop(shop);\n}\n\n// Find an individual xformed currency\nexport async function getXformedCurrencyByCode(context, shopId, code) {\n  if (!code) return null;\n  if (!shopId) throw new Meteor.Error(\"invalid\", \"shopId is required to build a Currency object\");\n  const allCurrencies = await getXformedCurrenciesByShopId(context, shopId);\n  return allCurrencies.find((currency) => currency.code === code);\n}\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocGroupInternalId = assocInternalId(namespaces.Group);\nexport const assocGroupOpaqueId = assocOpaqueId(namespaces.Group);\nexport const decodeGroupOpaqueId = decodeOpaqueIdForNamespace(namespaces.Group);\nexport const encodeGroupOpaqueId = encodeOpaqueId(namespaces.Group);\n","import { assoc, curry } from \"ramda\";\n\n/**\n * @summary Transforms an internal ID to an opaque ID\n * @param {String} namespace The namespace of the ID\n * @param {String} id The ID to transform\n * @returns {String} An opaque ID\n */\nexport const encodeOpaqueId = curry((namespace, id) => {\n  if (typeof id !== \"string\" && typeof id !== \"number\") return id;\n  const unencoded = `${namespace}:${id}`;\n  return Buffer.from(unencoded).toString(\"base64\");\n});\n\n/**\n * @summary Transforms an opaque ID to an internal ID\n * @param {String} opaqueId The ID to transform\n * @returns {String} An internal ID\n */\nexport const decodeOpaqueId = (opaqueId) => {\n  if (opaqueId === undefined || opaqueId === null) return null;\n  const unencoded = Buffer.from(opaqueId, \"base64\").toString(\"utf8\");\n  const [namespace, id] = unencoded.split(\":\");\n  return { namespace, id };\n};\n\n/**\n * @summary Transforms an opaque ID to an internal ID, throwing an error if the namespace is wrong\n * @param {String} namespace The namespace that you expect the decoded ID to have\n * @param {String} opaqueId The ID to transform\n * @returns {String} An internal ID\n */\nexport const decodeOpaqueIdForNamespace = curry((namespace, opaqueId, error = new Error(`ID namespace must be ${namespace}`)) => {\n  const decodedId = decodeOpaqueId(opaqueId);\n  if (!decodedId) return null;\n  const { namespace: actualNamespace, id } = decodedId;\n  if (actualNamespace !== namespace) throw error;\n  return id;\n});\n\n/**\n * @summary Assoc an opaque ID onto an object by transforming its existing _id\n *   Assumes key is _id but key could be provided as another curried param.\n * @param {String} namespace The namespace\n * @param {Object} item An object with _id property\n */\nexport const assocOpaqueId = curry((namespace, item) =>\n  assoc(\"_id\", encodeOpaqueId(namespace, item._id), item));\n\n/**\n * @summary Assoc an internal ID onto an object by decoding its existing opaque _id\n *   Assumes key is _id but key could be provided as another curried param.\n * @param {String} namespace The namespace\n * @param {Object} item An object with _id property\n */\nexport const assocInternalId = curry((namespace, item) =>\n  assoc(\"_id\", decodeOpaqueIdForNamespace(namespace, item._id), item));\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocProductInternalId = assocInternalId(namespaces.Product);\nexport const assocProductOpaqueId = assocOpaqueId(namespaces.Product);\nexport const decodeProductOpaqueId = decodeOpaqueIdForNamespace(namespaces.Product);\nexport const encodeProductOpaqueId = encodeOpaqueId(namespaces.Product);\n","import { assoc, curry, keys, reduce } from \"ramda\";\n\nexport const renameKeys = curry((keysMap, obj) =>\n  reduce((acc, key) => assoc(keysMap[key] || key, obj[key], acc), {}, keys(obj)));\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocShopInternalId = assocInternalId(namespaces.Shop);\nexport const assocShopOpaqueId = assocOpaqueId(namespaces.Shop);\nexport const decodeShopOpaqueId = decodeOpaqueIdForNamespace(namespaces.Shop);\nexport const encodeShopOpaqueId = encodeOpaqueId(namespaces.Shop);\nexport const xformShopInput = assocShopInternalId;\n","import { namespaces } from \"@reactioncommerce/reaction-graphql-utils\";\nimport { assocInternalId, assocOpaqueId, decodeOpaqueIdForNamespace, encodeOpaqueId } from \"./id\";\n\nexport const assocTagInternalId = assocInternalId(namespaces.Tag);\nexport const assocTagOpaqueId = assocOpaqueId(namespaces.Tag);\nexport const decodeTagOpaqueId = decodeOpaqueIdForNamespace(namespaces.Tag);\nexport const encodeTagOpaqueId = encodeOpaqueId(namespaces.Tag);\n","import { merge } from \"lodash\";\nimport account from \"./account\";\nimport catalog from \"./catalog\";\nimport core from \"./core\";\nimport ping from \"./ping\";\nimport scalar from \"./scalar\";\nimport shop from \"./shop\";\nimport tag from \"./tag\";\n\nexport default merge({}, account, catalog, core, scalar, ping, shop, tag);\n\n/**\n * Arguments passed by the client for a query\n * @typedef {Object} ConnectionArgs - an object of all arguments that were sent by the client\n * @property {String} args.after - Connection argument\n * @property {String} args.before - Connection argument\n * @property {Number} args.first - Connection argument\n * @property {Number} args.last - Connection argument\n * @property {Number} args.sortBy - Connection argument. Check schema for allowed values.\n * @property {Number} args.sortOrder - Connection argument\n */\n\n/**\n * Arguments passed by the client a groups query\n * @typedef {Object} AddressInput - Address\n * @property {String} address1 - Address line 1\n * @property {String} [address2] - Address line 2\n * @property {String} city - City\n * @property {String} [company] - Company name\n * @property {String} country - Country\n * @property {Boolean} [failedValidation] - Mark address as failed validation by address validation service\n * @property {String} fullName - Full name\n * @property {Boolean} isBillingDefault - Mark address as default for billing\n * @property {Boolean} isCommercial - Mask address as commercial\n * @property {Boolean} isShippingDefault -  Mark address as default for shipping\n * @property {Array<MetafieldInput>} metafields - Array of metafields\n * @property {String} phone - Phone number\n * @property {String} postal - Postal code\n * @property {String} region - Region of country\n */\n\n/**\n * Metafield input\n * @typedef {Object} MetafieldInput - Metafield\n * @property {String} key - Key\n * @property {String} [value] - Value\n * @property {String} [namespace] - Namespace\n * @property {String} [scope] - Scope\n * @property {String} [description] - Description\n * @property {String} [valueType] - Value type\n */\n","export default {\n  Query: {\n    ping: () => \"pong\"\n  },\n  Mutation: {\n    echo: (_, { str }) => `${str}`\n  }\n};\n","import account from \"./account.graphql\";\nimport address from \"./address.graphql\";\nimport base from \"./base.graphql\";\nimport catalog from \"./catalog.graphql\";\nimport currency from \"./currency.graphql\";\nimport email from \"./email.graphql\";\nimport group from \"./group.graphql\";\nimport metafield from \"./metafield.graphql\";\nimport node from \"./node.graphql\";\nimport role from \"./role.graphql\";\nimport shipping from \"./shipping.graphql\";\nimport shop from \"./shop.graphql\";\nimport tag from \"./tag.graphql\";\n\nexport default [\n  base,\n  account,\n  address,\n  catalog,\n  currency,\n  email,\n  group,\n  metafield,\n  node,\n  role,\n  shipping,\n  shop,\n  tag\n];\n","import ExtendableError from \"es6-error\";\n\nexport default class ReactionError extends ExtendableError {\n  constructor(error, message, eventData = {}) {\n    super(message);\n    this.eventData = eventData;\n    this.error = error;\n  }\n}\n","import { curryN } from \"ramda\";\nimport hasPermission from \"/imports/plugins/core/accounts/server/no-meteor/hasPermission\";\nimport getShopIdForContext from \"/imports/plugins/core/accounts/server/no-meteor/getShopIdForContext\";\n\n// mutates the context object\nexport default async function buildContext(context, user) {\n  context.user = user || null;\n  context.userId = (user && user._id) || null;\n\n  // Add the shopId for this request, either from the authenticated user's preferences or based on the ROOT_URL domain name\n  context.shopId = await getShopIdForContext(context);\n\n  // Add a curried hasPermission tied to the current user (or to no user)\n  context.userHasPermission = curryN(2, hasPermission)(context.user);\n}\n","import cors from \"cors\";\nimport bodyParser from \"body-parser\";\nimport express from \"express\";\nimport { graphqlExpress, graphiqlExpress } from \"apollo-server-express\";\nimport buildContext from \"./buildContext\";\nimport getErrorFormatter from \"./getErrorFormatter\";\nimport meteorTokenMiddleware from \"./meteorTokenMiddleware\";\nimport schema from \"./schema\";\n\nconst defaultServerConfig = {\n  // graphql endpoint\n  path: \"/graphql-alpha\",\n  // GraphiQL endpoint\n  graphiqlPath: \"/graphiql\",\n  // GraphiQL options (default: log the current user in your request)\n  graphiqlOptions: {\n    passHeader: \"'meteor-login-token': localStorage['Meteor.loginToken']\"\n  }\n};\n\nexport default function createApolloServer(options = {}) {\n  // the Meteor GraphQL server is an Express server\n  const expressServer = express();\n\n  const { context: contextFromOptions } = options;\n  const graphQLPath = options.path || defaultServerConfig.path;\n\n  // GraphQL endpoint, enhanced with JSON body parser\n  expressServer.use(\n    graphQLPath,\n    cors(),\n    bodyParser.json(),\n    meteorTokenMiddleware(\"meteor-login-token\", contextFromOptions),\n    graphqlExpress(async (req) => {\n      const context = { ...contextFromOptions };\n\n      // meteorTokenMiddleware will have set req.user if there is one\n      await buildContext(context, req.user);\n\n      return {\n        context,\n        debug: options.debug,\n        formatError: getErrorFormatter(context),\n        formatResponse(res) {\n          // Apollo includes `errors` in the response when empty, but the spec forbids this.\n          // http://facebook.github.io/graphql/draft/#sec-Errors\n          if (Object.prototype.hasOwnProperty.call(res, \"errors\") && (!res.errors || res.errors.filter((v) => !!v).length === 0)) {\n            delete res.errors;\n          }\n\n          return res;\n        },\n        schema\n      };\n    })\n  );\n\n  // Start GraphiQL if enabled\n  if (options.graphiql) {\n    // GraphiQL endpoint\n    expressServer.use(\n      options.graphiqlPath || defaultServerConfig.graphiqlPath,\n      graphiqlExpress({\n        // GraphiQL options\n        ...defaultServerConfig.graphiqlOptions,\n        // endpoint of the graphql server where to send requests\n        endpointURL: graphQLPath\n      })\n    );\n  }\n\n  return expressServer;\n}\n","/**\n * @param {MongoDatabase} db A database instance from Node Mongo client\n * @param {Object} collections An object to mutate with all of the Reaction collections\n */\nexport default function defineCollections(db, collections) {\n  Object.assign(collections, {\n    Accounts: db.collection(\"Accounts\"),\n    Assets: db.collection(\"Assets\"),\n    Cart: db.collection(\"Cart\"),\n    Catalog: db.collection(\"Catalog\"),\n    Emails: db.collection(\"Emails\"),\n    Groups: db.collection(\"Groups\"),\n    Inventory: db.collection(\"Inventory\"),\n    Logs: db.collection(\"Logs\"),\n    MediaRecords: db.collection(\"MediaRecords\"),\n    Notifications: db.collection(\"Notifications\"),\n    Orders: db.collection(\"Orders\"),\n    Packages: db.collection(\"Packages\"),\n    Products: db.collection(\"Products\"),\n    Revisions: db.collection(\"Revisions\"),\n    roles: db.collection(\"roles\"),\n    SellerShops: db.collection(\"SellerShops\"),\n    Shipping: db.collection(\"Shipping\"),\n    Shops: db.collection(\"Shops\"),\n    Sms: db.collection(\"Sms\"),\n    Tags: db.collection(\"Tags\"),\n    Templates: db.collection(\"Templates\"),\n    Themes: db.collection(\"Themes\"),\n    Translations: db.collection(\"Translations\"),\n    users: db.collection(\"users\")\n  });\n}\n","import cuid from \"cuid\";\nimport { Logger } from \"./logger\";\n\nfunction getErrorFormatter(context = {}) {\n  return (err) => {\n    const { originalError } = err;\n\n    // Generate an ID that can be used to correlate client errors with this server error\n    err.errorId = cuid();\n\n    let type = \"unknown\";\n    if (originalError) {\n      const eventObj = {\n        errorId: err.errorId,\n        path: err.path,\n        userId: (context.user && context.user._id) || null,\n        ...(originalError.eventData || {})\n      };\n\n      Logger.error(eventObj);\n\n      if (typeof originalError.error === \"string\") type = originalError.error;\n    }\n\n    // Add a `type` prop to our `errors` response object for client parsing\n    err.type = type;\n\n    return err;\n  };\n}\n\nexport default getErrorFormatter;\n","import crypto from \"crypto\";\nimport ReactionError from \"./ReactionError\";\nimport tokenExpiration from \"./tokenExpiration\";\n\n// This is Meteor's Accounts._hashLoginToken\nfunction hashLoginToken(loginToken) {\n  const hash = crypto.createHash(\"sha256\");\n  hash.update(loginToken);\n  return hash.digest(\"base64\");\n}\n\nasync function getUserFromToken(loginToken, context) {\n  const { collections } = context;\n  const { users } = collections;\n\n  const hashedToken = hashLoginToken(loginToken);\n\n  // search for user from the database with hashedToken\n  // note: no need for a fiber aware findOne\n  const currentUser = await users.findOne({\n    \"services.resume.loginTokens.hashedToken\": hashedToken\n  });\n\n  if (!currentUser) throw new ReactionError(\"access-denied\", \"Token invalid\");\n\n  // find the right login token because the user may have\n  // several sessions logged in on different browsers/computers\n  const tokenInformation = currentUser.services.resume.loginTokens.find((tokenInfo) => tokenInfo.hashedToken === hashedToken);\n\n  // get token expiration date\n  const expiresAt = tokenExpiration(tokenInformation.when);\n\n  const isExpired = expiresAt < new Date();\n  if (isExpired) throw new ReactionError(\"access-denied\", \"Token expired\");\n\n  return currentUser;\n}\n\nexport default getUserFromToken;\n","import { Meteor } from \"meteor/meteor\";\nimport { MongoInternals } from \"meteor/mongo\";\nimport { WebApp } from \"meteor/webapp\";\nimport createApolloServer from \"./createApolloServer\";\nimport defineCollections from \"./defineCollections\";\nimport methods from \"./methods\";\nimport queries from \"./queries\";\n\nconst collections = {};\n\nconst { db } = MongoInternals.defaultRemoteCollectionDriver().mongo;\ndefineCollections(db, collections);\n\nconst server = createApolloServer({\n  context: {\n    collections,\n    methods,\n    queries\n  },\n  // XXX Eventually these should be from individual env variables instead\n  debug: Meteor.isDevelopment,\n  graphiql: Meteor.isDevelopment\n});\n\n// bind the specified paths to the Express server running Apollo + GraphiQL\nWebApp.connectHandlers.use(server);\n","import Logger from \"@reactioncommerce/logger\";\n\nexport { Logger };\n","import getUserFromToken from \"./getUserFromToken\";\n\nexport default function meteorTokenMiddleware(headerName, contextFromOptions) {\n  return async (req, res, next) => {\n    // get the login token from the headers request, given by the Meteor's\n    // network interface middleware if enabled\n    const token = req.headers[headerName];\n\n    if (!token) {\n      next();\n      return;\n    }\n\n    try {\n      // get the current user\n      req.user = await getUserFromToken(token, contextFromOptions);\n      next();\n    } catch (error) {\n      res.sendStatus(401);\n    }\n  };\n}\n","import runMeteorMethodWithContext from \"./runMeteorMethodWithContext\";\n\nconst methods = {};\n\n[\n  \"accounts/addressBookAdd\",\n  \"accounts/addressBookRemove\",\n  \"accounts/addressBookUpdate\",\n  \"accounts/inviteShopMember\",\n  \"accounts/setProfileCurrency\",\n  \"group/addUser\",\n  \"group/removeUser\"\n].forEach((methodName) => {\n  methods[methodName] = (context, args) => (\n    runMeteorMethodWithContext(context, methodName, args)\n  );\n});\n\nexport default methods;\n","import { shopAdministratorsQuery } from \"/imports/plugins/core/accounts/server/methods/shopAdministratorsQuery\";\nimport { userAccountQuery } from \"/imports/plugins/core/accounts/server/methods/userAccountQuery\";\nimport { groupQuery, groupsQuery } from \"/imports/plugins/core/accounts/server/methods/groupQuery\";\nimport { rolesQuery } from \"/imports/plugins/core/accounts/server/methods/rolesQuery\";\nimport catalogItems from \"/imports/plugins/core/catalog/server/queries/catalogItems\";\nimport tags from \"/imports/plugins/core/catalog/server/queries/tags\";\nimport tagsByIds from \"/imports/plugins/core/catalog/server/queries/tagsByIds\";\nimport getShopIdByDomain from \"/imports/plugins/core/accounts/server/no-meteor/getShopIdByDomain\";\n\nexport default {\n  catalogItems,\n  group: groupQuery,\n  groups: groupsQuery,\n  primaryShopId: getShopIdByDomain,\n  roles: rolesQuery,\n  shopAdministrators: shopAdministratorsQuery,\n  shopById: (context, _id) => context.collections.Shops.findOne({ _id }),\n  tags,\n  tagsByIds,\n  userAccount: userAccountQuery\n};\n","import { DDP } from \"meteor/ddp\";\nimport { DDPCommon } from \"meteor/ddp-common\";\nimport { Meteor } from \"meteor/meteor\";\n\n/**\n * Applies args to a Meteor method with a GraphQL context.\n * @param {Object} context - A GraphQL context.\n * @param {String} name - The Meteor method name.\n * @param {Array} args - an array of Meteor method args.\n * @return {any} The result of the Meteor method call.\n */\nexport default function runMeteorMethodWithContext(context, name, args) {\n  const userId = context && context.user && context.user._id;\n\n  const invocation = new DDPCommon.MethodInvocation({\n    isSimulation: false,\n    userId,\n    setUserId: () => {},\n    unblock: () => {},\n    connection: null,\n    randomSeed: null\n  });\n\n  return DDP._CurrentInvocation.withValue(invocation, () => Meteor.apply(name, args));\n}\n","import { makeExecutableSchema } from \"graphql-tools\";\nimport resolvers from \"./resolvers\";\nimport typeDefs from \"./schemas\";\n\nexport default makeExecutableSchema({ typeDefs, resolvers });\n","// A large number of expiration days (approximately 100 years worth) that is\n// used when creating unexpiring tokens.\nconst LOGIN_UNEXPIRING_TOKEN_DAYS = 365 * 100;\n\n// This is what Meteor's Accounts._getTokenLifetimeMs returns for Reaction's current settings\nconst tokenLifetimeMs = LOGIN_UNEXPIRING_TOKEN_DAYS * 24 * 60 * 60 * 1000;\n\n// This is Meteor's Accounts._tokenExpiration\nexport default function tokenExpiration(when) {\n  // We pass when through the Date constructor for backwards compatibility;\n  // `when` used to be a number.\n  return new Date((new Date(when)).getTime() + tokenLifetimeMs);\n}\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\n\n/**\n * @name groupQuery\n * @method\n * @summary query the Groups collection and return group data\n * @param {Object} context - an object containing the per-request state\n * @param {String} id - id of group to query\n * @return {Object} group object\n */\nexport async function groupQuery(context, id) {\n  const { collections, userHasPermission, userId } = context;\n  const { Accounts, Groups } = collections;\n\n  const group = await Groups.findOne({ _id: id });\n  if (!group) throw new Meteor.Error(\"not-found\", \"There is no group with this ID\");\n\n  // If the user has sufficient permissions, then allow them to find any group by ID\n  if (userHasPermission([\"owner\", \"admin\", \"reaction-accounts\"], group.shopId)) return group;\n\n  // Otherwise, only let users see groups that they are members of\n  const userAccount = await Accounts.findOne({\n    _id: userId,\n    groups: id\n  }, {\n    projection: {\n      _id: 1\n    }\n  });\n\n  // If user is not found, throw an error\n  if (!userAccount) throw new Meteor.Error(\"access-denied\", \"User does not have permissions to view groups\");\n\n  return group;\n}\n\n/**\n * @name groupsQuery\n * @method\n * @summary query the Groups collection and return a MongoDB cursor\n * @param {Object} context - an object containing the per-request state\n * @param {String} shopId - shop ID to get groups for\n * @return {Object} Groups collection cursor\n */\nexport async function groupsQuery(context, shopId) {\n  const { collections, userHasPermission, userId } = context;\n  const { Accounts, Groups } = collections;\n\n  if (userHasPermission([\"owner\", \"admin\", \"reaction-accounts\"], shopId)) {\n    // find groups by shop ID\n    return Groups.find({ shopId });\n  }\n\n  const userAccount = Accounts.findOne({\n    _id: userId\n  }, {\n    projection: {\n      groups: 1\n    }\n  });\n\n  // If user is not found, throw an error\n  if (!userAccount) throw new Meteor.Error(\"access-denied\", \"User does not have permissions to view groups\");\n\n  // find groups by shop ID limited to those the current user is in\n  return Groups.find({\n    _id: {\n      $in: userAccount.groups || []\n    },\n    shopId\n  });\n}\n","import { Meteor } from \"meteor/meteor\";\n\n/**\n * @name rolesQuery\n * @method\n * @summary query the Shops collection, filter over packages, and return available roles data\n * @param {Object} context - an object containing the per-request state\n * @param {String} shopId - ID of Shop to query\n * @return {Object} roles object Promise\n */\nexport async function rolesQuery(context) {\n  const { collections, shopId: contextShopId, userHasPermission } = context;\n  const { roles } = collections;\n\n  if (!userHasPermission([\"owner\", \"admin\"], contextShopId)) {\n    throw new Meteor.Error(\"access-denied\", \"User does not have permissions to view roles\");\n  }\n\n  return roles.find({});\n}\n","import { Meteor } from \"meteor/meteor\";\n\n/**\n * @name shopAdministratorsQuery\n * @method\n * @summary return Account object for all users who are \"owner\" or \"admin\" role for the shop\n * @param {Object} context - an object containing the per-request state\n * @param {String} id - ID of shop\n * @return {Object[]} Array of user account objects\n */\nexport async function shopAdministratorsQuery(context, id) {\n  const { collections, userHasPermission } = context;\n  const { Accounts, users: Users } = collections;\n\n  if (!userHasPermission([\"owner\", \"admin\"], id)) throw new Meteor.Error(\"access-denied\", \"User does not have permission\");\n\n  const users = await Users.find({\n    [`roles.${id}`]: \"admin\"\n  }, {\n    fields: { _id: 1 }\n  }).toArray();\n  const userIds = users.map(({ _id }) => _id);\n\n  return Accounts.find({ _id: { $in: userIds } });\n}\n","import { Meteor } from \"meteor/meteor\";\n\n/**\n * @name userAccountQuery\n * @method\n * @summary query the Accounts collection and return user account data\n * @param {Object} context - an object containing the per-request state\n * @param {String} id - id of user to query\n * @return {Object} user account object\n */\nexport async function userAccountQuery(context, id) {\n  const { collections, userHasPermission, userId } = context;\n  const { Accounts } = collections;\n\n  const userAccount = await Accounts.findOne({ _id: id });\n  if (!userAccount) throw new Meteor.Error(\"not-found\", \"No account found\");\n\n  // Check to make sure current user has permissions to view queried user\n  if (userId !== id && !userHasPermission([\"reaction-accounts\"], userAccount.shopId)) {\n    throw new Meteor.Error(\"access-denied\", \"User does not have permission\");\n  }\n\n  return userAccount;\n}\n","import url from \"url\";\n\nexport default async function getShopIdByDomain(collections) {\n  const { Shops } = collections;\n\n  const { ROOT_URL } = process.env;\n  if (typeof ROOT_URL !== \"string\") return null;\n\n  const domain = url.parse(ROOT_URL).hostname;\n\n  const shop = await Shops.findOne({\n    domains: domain\n  }, {\n    fields: {\n      _id: 1\n    }\n  });\n\n  return (shop && shop._id) || null;\n}\n","import { get } from \"lodash\";\nimport getShopIdByDomain from \"./getShopIdByDomain\";\n\nexport default async function getShopIdForContext(context) {\n  const { collections, user } = context;\n\n  let shopId;\n\n  if (user) {\n    shopId = get(user, \"profile.preferences.reaction.activeShopId\");\n  }\n\n  // if still not found, look up the shop by domain\n  if (!shopId) {\n    shopId = await getShopIdByDomain(collections);\n  }\n\n  return shopId || null;\n}\n","const GLOBAL_GROUP = \"__global_roles__\";\n\n/**\n * @name hasPermission\n * @method\n * @memberof Core\n * @param {Object} user - The user object, with `roles` property, to check.\n * @param {String[]} permissions - Array of permission strings. The account must have at least one of them either globally or for the roleGroup.\n * @param {String} [roleGroup] - The shop ID for which the permissions are needed, or a more specific roles group. If not set,\n *   only global roles will be checked.\n * @return {Promise<Boolean>} True if the account with ID accountId has at least one of the requested permissions in the roleGroup group\n */\nexport default function hasPermission(user, permissions, roleGroup) {\n  if (!user || !user.roles) return false;\n\n  if (!Array.isArray(permissions)) throw new Error(\"permissions must be an array of strings\");\n  if (roleGroup !== undefined && roleGroup !== null && (typeof roleGroup !== \"string\" || roleGroup.length === 0)) {\n    throw new Error(\"roleGroup must be a non-empty string\");\n  }\n\n  const checkRoles = permissions.slice(0);\n\n  // This should always return true for owners\n  if (checkRoles.indexOf(\"owner\") === -1) checkRoles.push(\"owner\");\n\n  const { roles } = user;\n\n  // always check GLOBAL_GROUP\n  const globalRoles = roles[GLOBAL_GROUP];\n  if (Array.isArray(globalRoles) && checkRoles.some((role) => globalRoles.indexOf(role) !== -1)) return true;\n\n  if (roleGroup) {\n    // convert any periods to underscores for MongoDB compatibility\n    const group = roleGroup.replace(/\\./g, \"_\");\n\n    const groupRoles = roles[group];\n    if (Array.isArray(groupRoles) && checkRoles.some((role) => groupRoles.indexOf(role) !== -1)) return true;\n  }\n\n  return false;\n}\n","import \"./i18n\";\nimport \"./init.js\";\n","import { Reaction, Hooks } from \"/server/api\";\n\nHooks.Events.add(\"afterCoreInit\", () => {\n  Reaction.addRolesToGroups({\n    allShops: true,\n    groups: [\"guest\", \"customer\"],\n    roles: [\"account/verify\"]\n  });\n});\n","import { Reaction } from \"/server/api\";\n\n/**\n * @file Accounts core plugin: Manage how members sign into your shop\n *\n * @namespace Accounts\n */\n\nReaction.registerPackage({\n  label: \"Accounts\",\n  name: \"reaction-accounts\",\n  icon: \"fa fa-users\",\n  autoEnable: true,\n  settings: {},\n  registry: [{\n    route: \"/dashboard/accounts\",\n    name: \"accounts\",\n    provides: [\"dashboard\"],\n    label: \"Accounts\",\n    description: \"Manage how members sign into your shop.\",\n    icon: \"fa fa-users\",\n    container: \"core\",\n    template: \"accountsDashboard\",\n    workflow: \"coreAccountsWorkflow\",\n    priority: 1\n  }, {\n    route: \"/account/profile/verify\",\n    label: \"Account Verify\",\n    name: \"account/verify\",\n    workflow: \"coreAccountsWorkflow\",\n    template: \"VerifyAccount\"\n  }, {\n    label: \"Account Settings\",\n    icon: \"fa fa-sign-in\",\n    provides: [\"settings\"],\n    route: \"/dashboard/account/settings\",\n    container: \"accounts\",\n    workflow: \"coreAccountsWorkflow\",\n    template: \"accountsSettings\",\n    showForShopTypes: [\"primary\"]\n  }, {\n    route: \"/dashboard/accounts\",\n    name: \"dashboard/accounts\",\n    workflow: \"coreAccountsWorkflow\",\n    provides: [\"shortcut\"],\n    label: \"Accounts\",\n    icon: \"fa fa-users\",\n    priority: 1,\n    container: \"dashboard\",\n    template: \"accountsDashboard\"\n  }, {\n    route: \"/account/profile\",\n    template: \"accountProfile\",\n    name: \"account/profile\",\n    label: \"Profile\",\n    icon: \"fa fa-user\",\n    provides: [\"userAccountDropdown\"]\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreAccountsWorkflow\",\n    collection: \"Accounts\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"accountsDashboard\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"\",\n      notFound: \"notFound\",\n      dashboardHeader: \"dashboardHeader\",\n      dashboardControls: \"\",\n      dashboardHeaderControls: \"\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Products, Catalog as CatalogCollection } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\nimport { Media } from \"/imports/plugins/core/files/server\";\nimport { ProductRevision as Catalog } from \"/imports/plugins/core/revisions/server/hooks\";\n\n/**\n * @method isSoldOut\n * @summary We are to stop accepting new orders if product is marked as `isSoldOut`.\n * @memberof Catalog\n * @param {Array} variants - Array with top-level variants\n * @return {Boolean} true if summary product quantity is zero.\n */\nexport function isSoldOut(variants) {\n  return variants.every((variant) => {\n    if (variant.inventoryManagement) {\n      return Catalog.getVariantQuantity(variant) <= 0;\n    }\n    return false;\n  });\n}\n\n/**\n * @method isLowQuantity\n * @summary If at least one of the variants is less than the threshold, then function returns `true`\n * @memberof Catalog\n * @param {Array} variants - array of child variants\n * @return {boolean} low quantity or not\n */\nexport function isLowQuantity(variants) {\n  return variants.some((variant) => {\n    const quantity = Catalog.getVariantQuantity(variant);\n    // we need to keep an eye on `inventoryPolicy` too and qty > 0\n    if (variant.inventoryManagement && variant.inventoryPolicy && quantity) {\n      return quantity <= variant.lowInventoryWarningThreshold;\n    }\n    return false;\n  });\n}\n\n/**\n * @method isBackorder\n * @summary Is products variants is still available to be ordered after summary variants quantity is zero\n * @memberof Catalog\n * @param {Array} variants - array with variant objects\n * @return {boolean} is backorder allowed or not for a product\n */\nexport function isBackorder(variants) {\n  return variants.every((variant) => !variant.inventoryPolicy && variant.inventoryManagement &&\n    variant.inventoryQuantity === 0);\n}\n\n/**\n * @method publishProductToCatalog\n * @summary Publish a product to the Catalog\n * @memberof Catalog\n * @param {string} productId - A string product id\n * @return {boolean} true on successful publish, false if publish was unsuccessful\n */\nexport async function publishProductToCatalog(productId) {\n  check(productId, String);\n\n  // Find the product by id\n  let product = Products.findOne({\n    $or: [\n      { _id: productId },\n      { ancestors: productId }\n    ]\n  });\n\n  // Stop if a product could not be found\n  if (!product) {\n    Logger.info(\"Cannot publish product to catalog\");\n    return false;\n  }\n\n  // If the product has ancestors, then find the top product document\n  if (Array.isArray(product.ancestors) && product.ancestors.length) {\n    product = Products.findOne({\n      _id: product.ancestors[0]\n    });\n  }\n\n  // Get variants of the product\n  const variants = Products.find({\n    ancestors: productId\n  }).fetch();\n\n  // Get Media for the product\n  const mediaArray = await Media.find({\n    \"metadata.productId\": productId,\n    \"metadata.toGrid\": 1,\n    \"metadata.workflow\": { $nin: [\"archived\", \"unpublished\"] }\n  }, {\n    sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 }\n  });\n\n  // Denormalize media\n  const productMedia = mediaArray.map((media) => ({\n    metadata: media.metadata,\n    thumbnail: `${media.url({ store: \"thumbnail\" })}`,\n    small: `${media.url({ store: \"small\" })}`,\n    medium: `${media.url({ store: \"medium\" })}`,\n    large: `${media.url({ store: \"large\" })}`,\n    image: `${media.url({ store: \"image\" })}`\n  }));\n\n  // Denormalize product fields\n  product.media = productMedia;\n  product.type = \"product-simple\";\n  product.isSoldOut = isSoldOut(variants);\n  product.isBackorder = isBackorder(variants);\n  product.isLowQuantity = isLowQuantity(variants);\n  product.variants = variants.map((variant) => {\n    const { inventoryQuantity, ...v } = variant;\n    return v;\n  });\n\n  // Insert/update catalog document\n  const result = CatalogCollection.upsert({\n    _id: productId\n  }, {\n    $set: product\n  });\n\n  return result && result.numberAffected === 1;\n}\n\n/**\n * @method publishProductsToCatalog\n * @summary Publish one or more products to the Catalog\n * @memberof Catalog\n * @param {string|array} productIds - A string product id or an array of product ids\n * @return {boolean} true on successful publish for all documents, false if one ore more fail to publish\n */\nexport function publishProductsToCatalog(productIds) {\n  check(productIds, Match.OneOf(String, Array));\n\n  let ids = productIds;\n  if (typeof ids === \"string\") {\n    ids = [productIds];\n  }\n\n  return ids.every(async (productId) => await publishProductToCatalog(productId));\n}\n\n/**\n * @method publishProductInventoryAdjustments\n * @summary Publish inventory updates for a single product to the Catalog\n * @memberof Catalog\n * @param {string} productId - A string product id\n * @return {boolean} true on success, false on failure\n */\nexport function publishProductInventoryAdjustments(productId) {\n  check(productId, Match.OneOf(String, Array));\n\n  const catalogProduct = CatalogCollection.findOne({\n    _id: productId\n  });\n\n  if (!catalogProduct) {\n    Logger.info(\"Cannot publish inventory changes to catalog product\");\n    return false;\n  }\n\n  const variants = Products.find({\n    ancestors: {\n      $in: [productId]\n    }\n  }).fetch();\n\n  const update = {\n    isSoldOut: isSoldOut(variants),\n    isBackorder: isBackorder(variants),\n    isLowQuantity: isLowQuantity(variants)\n  };\n\n  // Only apply changes of one these fields have changed\n  if (\n    update.isSoldOut !== catalogProduct.isSoldOut ||\n    update.isBackorder !== catalogProduct.isBackorder ||\n    update.isLowQuantity !== catalogProduct.isLowQuantity\n  ) {\n    const result = CatalogCollection.update({\n      _id: productId\n    }, {\n      $set: update\n    });\n\n    return result;\n  }\n\n  return false;\n}\n\nMeteor.methods({\n  \"catalog/publish/products\": (productIds) => {\n    check(productIds, Match.OneOf(String, Array));\n\n    // Ensure user has createProduct permission for active shop\n    if (!Reaction.hasPermission(\"createProduct\")) {\n      Logger.error(\"Access Denied\");\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Convert productIds if it's a string\n    let ids = productIds;\n    if (typeof ids === \"string\") {\n      ids = [productIds];\n    }\n\n    // Find all products\n    const productsToPublish = Products.find({\n      _id: { $in: ids }\n    }).fetch();\n\n    const canUpdatePrimaryShopProducts = Reaction.hasPermission(\"createProduct\", this.userId, Reaction.getPrimaryShopId());\n\n    const publisableProductIds = productsToPublish\n      // Only allow users to publish products for shops they permissions to createProductsFor\n      // If the user can createProducts on the main shop, they can publish products for all shops to the catalog.\n      .filter((product) => Reaction.hasPermission(\"createProduct\", this.userId, product.shopId) || canUpdatePrimaryShopProducts)\n      .map((product) => product._id);\n\n    const success = publishProductsToCatalog(publisableProductIds);\n\n    if (!success) {\n      Logger.error(\"Some Products could not be published to the Catalog.\");\n      throw new Meteor.Error(\"server-error\", \"Some Products could not be published to the Catalog.\");\n    }\n\n    return true;\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\n\n/**\n * @name catalogItems\n * @method\n * @summary query the Catalog by shop ID and/or tag ID\n * @param {Object} context - an object containing the per-request state\n * @param {Object} params - request parameters\n * @param {String[]} [params.shopIds] - Shop IDs to include (OR)\n * @param {String[]} [params.tags] - Tag IDs to include (OR)\n * @return {Promise<MongoCursor>} - A MongoDB cursor for the proper query\n */\nexport default async function catalogItems(context, { shopIds, tagIds } = {}) {\n  const { collections } = context;\n  const { Catalog } = collections;\n\n  if ((!shopIds || shopIds.length === 0) && (!tagIds || tagIds.length === 0)) {\n    throw new Meteor.Error(\"invalid-param\", \"You must provide tagIds or shopIds or both\");\n  }\n\n  const query = {\n    isDeleted: { $ne: true },\n    isVisible: { $ne: false }\n  };\n\n  if (shopIds) query.shopId = { $in: shopIds };\n  if (tagIds) query.hashtags = { $in: tagIds };\n\n  return Catalog.find(query);\n}\n","/**\n * @name tags\n * @method\n * @summary query the Tags collection by shop ID and optionally by isTopLevel\n * @param {Object} context - an object containing the per-request state\n * @param {String} shopId - ID of shop to query\n * @param {Object} [params] - Additional options for the query\n * @param {Boolean} [params.isTopLevel] - If set, look for `isTopLevel` matching this value\n * @param {Boolean} [params.shouldIncludeDeleted] - Whether or not to include `isDeleted=true` tags. Default is `false`\n * @return {Promise<MongoCursor>} - A MongoDB cursor for the proper query\n */\nexport default async function tags(context, shopId, { shouldIncludeDeleted = false, isTopLevel } = {}) {\n  const { collections } = context;\n\n  const { Tags } = collections;\n  const query = { shopId };\n\n  if (isTopLevel === false || isTopLevel === true) query.isTopLevel = isTopLevel;\n  if (shouldIncludeDeleted !== true) query.isDeleted = { $ne: true };\n\n  return Tags.find(query);\n}\n","/**\n * @name tagsByIds\n * @method\n * @summary query the Tags collection by a list of IDs\n * @param {Object} context - an object containing the per-request state\n * @param {String[]} tagIds - tag IDs to get\n * @param {Object} [params] - Additional options for the query\n * @param {Boolean} [params.shouldIncludeDeleted] - Whether or not to include `isDeleted=true` tags. Default is `false`\n * @return {Promise<MongoCursor>} - A MongoDB cursor for the proper query\n */\nexport default async function tagsByIds(context, tagIds, { shouldIncludeDeleted = false } = {}) {\n  const { collections } = context;\n\n  const { Tags } = collections;\n  const query = { _id: { $in: tagIds } };\n\n  if (shouldIncludeDeleted !== true) query.isDeleted = { $ne: true };\n\n  return Tags.find(query);\n}\n","import \"./i18n\";\nimport \"./methods/catalog\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Catalog\",\n  name: \"reaction-catalog\",\n  icon: \"fa fa-book\",\n  autoEnable: true,\n  settings: {\n    name: \"Catalog\"\n  },\n  registry: [\n    {\n      provides: [\"dashboard\"],\n      label: \"Catalog\",\n      description: \"Product catalog\",\n      icon: \"fa fa-book\",\n      container: \"core\"\n    },\n    {\n      label: \"Catalog Settings\",\n      icon: \"fa fa-book\",\n      name: \"catalog/settings\",\n      provides: [\"settings\"],\n      template: \"catalogSettings\"\n    }\n  ]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { check, Match } from \"meteor/check\";\nimport { Cart, Orders, Packages, Groups } from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\n\n/* eslint no-shadow: 0 */\n\n/**\n * @method updateOrderWorkflow\n * @summary Updates a hook to update orders status before updating an order.\n *\n * @param {String} userId - currently logged in user\n * @param {Object} selector - selector for product to update\n * @param {Object} modifier - Object describing what parts of the document to update.\n * @param {Object} validation\n * @return {String} _id of updated document\n */\nfunction updateOrderWorkflow(userId, selector, modifier, validation) {\n  const order = Orders.findOne(selector);\n\n  Hooks.Events.run(\"beforeUpdateOrderWorkflow\", order, {\n    userId,\n    modifier,\n    validation\n  });\n\n  Logger.debug(\"beforeUpdateOrderWorkflow hook executed before Order is updated\");\n\n  const result = Orders.update(selector, modifier, validation);\n\n  // Update mongo search record\n  Hooks.Events.run(\"afterUpdateOrderUpdateSearchRecord\", order);\n\n  return result;\n}\n\n/**\n * @file Methods for Workflow. Run these methods using `Meteor.call()`.\n * @example Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"checkoutLogin\");\n *\n * @namespace Methods/Workflow\n*/\nMeteor.methods({\n  /**\n   * @name workflow/pushCartWorkflow\n   * @memberof Methods/Workflow\n   * @method\n   * @example Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"checkoutLogin\");\n   * @summary updates cart workflow status\n   * @description status in the workflow is stored as the current active workflow step.\n   * first sets, second call moves status to next workflow\n   * additional calls do nothing\n   * user permissions to template are verified\n   * @param {String} workflow - name of workflow\n   * @param {String} newWorkflowStatus - name of the next workflow stage\n   * @param {String} [cartId] - cart._id\n   * @return {Array|Boolean|Number} return\n   */\n  \"workflow/pushCartWorkflow\"(workflow, newWorkflowStatus, cartId) {\n    check(workflow, String);\n    check(newWorkflowStatus, String);\n    check(cartId, Match.Optional(String));\n    this.unblock();\n\n    let currentCart;\n    const defaultPackageWorkflows = [];\n    let nextWorkflowStep = {\n      template: \"\"\n    };\n\n    // This method could be called indirectly from publication method in a time\n    // when `this.userId` will be null, that's why we have a third argument in\n    // this method - `cartId`. So, we can't completely rely on `Meteor.userId()`\n    // here.\n    if (typeof cartId === \"string\") {\n      currentCart = Cart.findOne(cartId);\n    } else {\n      currentCart = Cart.findOne({\n        userId: this.userId\n      });\n    }\n    // exit if a cart doesn't exist.\n    if (!currentCart) return [];\n    // TODO doc this\n    const currentWorkflowStatus = currentCart.workflow.status;\n    const packages = Packages.find({\n      \"shopId\": Reaction.getShopId(),\n      \"layout.workflow\": workflow\n    });\n\n    // loop through packages and set the defaultPackageWorkflows\n    packages.forEach((reactionPackage) => {\n      // todo fix this hack for not filtering nicely\n      if (!reactionPackage.layout.layout) {\n        const layouts = _.filter(reactionPackage.layout, {\n          workflow\n        });\n        // for every layout, process the associated workflows\n        _.each(layouts, (layout) => {\n          // audience is the layout permissions\n          if (typeof layout.audience !== \"object\") {\n            const defaultRoles = Groups.findOne({\n              slug: \"customer\",\n              shopId: Reaction.getShopId()\n            }).permissions;\n            layout.audience = defaultRoles;\n          }\n          // check permissions so you don't have to on template. For a case, when\n          // this method calls indirectly from publication method, we do this\n          // check which is looks not pretty secure\n          let hasPermission;\n          if (typeof Meteor.userId() !== \"string\") {\n            hasPermission = Roles.userIsInRole(currentCart.userId, layout.audience, Reaction.getShopId());\n          } else {\n            hasPermission = Roles.userIsInRole(Meteor.userId(), layout.audience, Reaction.getShopId());\n          }\n\n          if (hasPermission && !layout.layout) {\n            defaultPackageWorkflows.push(layout);\n          }\n        });\n      }\n    });\n\n    // statusExistsInWorkflow boolean\n    const statusExistsInWorkflow = _.includes(currentCart.workflow.workflow, newWorkflowStatus);\n    const maxSteps = defaultPackageWorkflows.length;\n    let nextWorkflowStepIndex;\n    let templateProcessedinWorkflow = false;\n    let gotoNextWorkflowStep = false;\n\n    // if we haven't populated workflows lets exit\n    if (!defaultPackageWorkflows.length > 0) {\n      return [];\n    }\n\n    // loop through all shop configured layouts, and their default workflows\n    // to determine what the next workflow step should be\n    // the cart workflow status while processing is neither true nor false (set to template)\n    _.each(defaultPackageWorkflows, (workflow, currentStatusIndex) => {\n      if (workflow.template === currentWorkflowStatus) {\n        // don't go past the end of the workflow\n        if (currentStatusIndex < maxSteps - 1) {\n          Logger.debug(\"currentStatusIndex, maxSteps\", currentStatusIndex, maxSteps);\n          Logger.debug(\"currentStatusIndex, maxSteps\", currentStatusIndex, maxSteps);\n          nextWorkflowStepIndex = currentStatusIndex + 1;\n        } else {\n          nextWorkflowStepIndex = currentStatusIndex;\n        }\n\n        Logger.debug(\"nextWorkflowStepIndex\", nextWorkflowStepIndex);\n        // set the nextWorkflowStep as the next workflow object from registry\n        nextWorkflowStep = defaultPackageWorkflows[nextWorkflowStepIndex];\n\n        Logger.debug(\"setting nextWorkflowStep\", nextWorkflowStep.template);\n      }\n    });\n\n    // check to see if the next step has already been processed.\n    // templateProcessedinWorkflow boolean\n    gotoNextWorkflowStep = nextWorkflowStep.template;\n    templateProcessedinWorkflow = _.includes(currentCart.workflow.workflow, nextWorkflowStep.template);\n\n    // debug info\n    Logger.debug(\"currentWorkflowStatus: \", currentWorkflowStatus);\n    Logger.debug(\"workflow/pushCartWorkflow workflow: \", workflow);\n    Logger.debug(\"newWorkflowStatus: \", newWorkflowStatus);\n    Logger.debug(\"current cartId: \", currentCart._id);\n    Logger.debug(\"currentWorkflow: \", currentCart.workflow.workflow);\n    Logger.debug(\"nextWorkflowStep: \", nextWorkflowStep.template || defaultPackageWorkflows[0].template);\n    Logger.debug(\"statusExistsInWorkflow: \", statusExistsInWorkflow);\n    Logger.debug(\"templateProcessedinWorkflow: \", templateProcessedinWorkflow);\n    Logger.debug(\"gotoNextWorkflowStep: \", gotoNextWorkflowStep);\n\n    // Condition One\n    // if you're going to join the workflow you need a status that is a template name.\n    // this status/template is how we know\n    // where you are in the flow and configures `gotoNextWorkflowStep`\n\n    if (!gotoNextWorkflowStep && currentWorkflowStatus !== newWorkflowStatus) {\n      Logger.debug(`######## Condition One #########:\n        initialise the ${currentCart._id} ${workflow}:\n        ${defaultPackageWorkflows[0].template}`);\n      const result = Cart.update(currentCart._id, {\n        $set: {\n          \"workflow.status\": defaultPackageWorkflows[0].template\n        }\n      });\n      Logger.debug(result);\n      return result;\n    }\n\n    // Condition Two\n    // your're now accepted into the workflow,\n    // but to begin the workflow you need to have a next step\n    // and you should have already be in the current workflow template\n    if (gotoNextWorkflowStep && statusExistsInWorkflow === false &&\n      templateProcessedinWorkflow === false) {\n      Logger.debug(\"######## Condition Two #########: set status to: \", nextWorkflowStep.template);\n\n      return Cart.update(currentCart._id, {\n        $set: {\n          \"workflow.status\": nextWorkflowStep.template\n        },\n        $addToSet: {\n          \"workflow.workflow\": currentWorkflowStatus\n        }\n      });\n    }\n\n    // Condition Three\n    // If you got here by skipping around willy nilly\n    // we're going to do our best to ignore you.\n    if (gotoNextWorkflowStep && statusExistsInWorkflow === true &&\n      templateProcessedinWorkflow === false) {\n      Logger.debug(\n        `######## Condition Three #########: complete workflow ${currentWorkflowStatus} updates and move to: `,\n        nextWorkflowStep.template\n      );\n      return Cart.update(currentCart._id, {\n        $set: {\n          \"workflow.status\": nextWorkflowStep.template\n        },\n        $addToSet: {\n          \"workflow.workflow\": currentWorkflowStatus\n        }\n      });\n    }\n\n    // Condition Four\n    // you got here through hard work, and processed the previous template\n    // nice job. now start over with the next step.\n    if (gotoNextWorkflowStep && statusExistsInWorkflow === true &&\n      templateProcessedinWorkflow === true) {\n      Logger.debug(\n        \"######## Condition Four #########: previously ran, doing nothing. : \",\n        newWorkflowStatus\n      );\n      return true;\n    }\n  },\n\n  /**\n   * @name workflow/revertCartWorkflow\n   * @memberof Methods/Workflow\n   * @method\n   * @summary if something was changed on the previous `cartWorkflow` steps,\n   * we need to revert to this step to renew the order\n   * @param {String} newWorkflowStatus - name of `cartWorkflow` step, which we need to revert\n   * @todo need tests\n   * @return {Number|Boolean} cart update results\n   */\n  \"workflow/revertCartWorkflow\"(newWorkflowStatus) {\n    check(newWorkflowStatus, String);\n    this.unblock();\n\n    const cart = Cart.findOne({\n      userId: this.userId\n    });\n\n    if (!cart || typeof cart.workflow !== \"object\") return false;\n    if (typeof cart.workflow.workflow !== \"object\") return false;\n\n    const { workflow } = cart.workflow;\n    // get index of `newWorkflowStatus`\n    const resetToIndex = workflow.indexOf(newWorkflowStatus);\n    // exit if no such step in workflow\n    if (resetToIndex < 0) return false;\n    // remove all steps that further `newWorkflowStatus` and itself\n    const resetedWorkflow = workflow.slice(0, resetToIndex);\n\n    return Cart.update(cart._id, {\n      $set: {\n        \"workflow.status\": newWorkflowStatus,\n        \"workflow.workflow\": resetedWorkflow\n      }\n    });\n  },\n\n  /**\n   * @name workflow/pushOrderWorkflow\n   * @summary Update the order workflow: Push the status as the current workflow step,\n   * move the current status to completed worflow steps\n   *\n   * @description Step 1 meteor call to push a new workflow\n   * Meteor.call(\"workflow/pushOrderWorkflow\", \"coreOrderWorkflow\", \"processing\", this);\n   * NOTE: \"coreOrderWorkflow\", \"processing\" will be combined into \"coreOrderWorkflow/processing\" and set as the status\n   * Step 2 (this method) of the \"workflow/pushOrderWorkflow\" flow; Try to update the current status\n   *\n   * @method\n   * @memberof Methods/Workflow\n   * @param  {String} workflow workflow to push to\n   * @param  {String} status - Workflow status\n   * @param  {Order} order - Schemas.Order, an order object\n   * @return {Boolean} true if update was successful\n   */\n  \"workflow/pushOrderWorkflow\"(workflow, status, order) {\n    check(workflow, String);\n    check(status, String);\n    check(order, Match.ObjectIncluding({\n      _id: String\n    }));\n    this.unblock();\n\n    const workflowStatus = `${workflow}/${status}`;\n\n    const result = updateOrderWorkflow(\n      this.userId,\n      {\n        _id: order._id\n      },\n      {\n        $set: {\n          // Combine (workflow) \"coreOrderWorkflow\", (status) \"processing\" into \"coreOrderWorkflow/processing\".\n          // This comoniation will be used to call the method \"workflow/coreOrderWorkflow/processing\", if it exists.\n          \"workflow.status\": `${workflow}/${status}`\n        },\n        $addToSet: {\n          \"workflow.workflow\": workflowStatus\n        }\n      }\n    );\n\n    return result;\n  },\n\n  /**\n   * @name workflow/pullOrderWorkflow\n   * @description Push the status as the current workflow step, move the current status to completed worflow steps\n   * @summary Pull a previous order status\n   * @method\n   * @memberof Methods/Workflow\n   * @param  {String} workflow workflow to push to\n   * @param  {String} status - Workflow status\n   * @param  {Order} order - Schemas.Order, an order object\n   * @return {Boolean} true if update was successful\n   */\n  \"workflow/pullOrderWorkflow\"(workflow, status, order) {\n    check(workflow, String);\n    check(status, String);\n    check(order, Match.ObjectIncluding({\n      _id: String,\n      workflow: Match.ObjectIncluding({\n        status: String\n      })\n    }));\n    this.unblock();\n\n    const result = Orders.update({\n      _id: order._id\n    }, {\n      $set: {\n        \"workflow.status\": status\n      },\n      $pull: {\n        \"workflow.workflow\": order.workflow.status\n      }\n    });\n\n    return result;\n  },\n\n  /**\n   * @name workflow/pushItemWorkflow\n   * @method\n   * @memberof Methods/Workflow\n   * @param  {String} status  Workflow status\n   * @param  {Object} order   Schemas.Order, an order object\n   * @param  {String[]} itemIds Array of item IDs\n   * @return {Boolean}         true if update was successful\n   */\n  \"workflow/pushItemWorkflow\"(status, order, itemIds) {\n    check(status, String);\n    check(order, Match.ObjectIncluding({\n      _id: String,\n      items: [Object]\n    }));\n    check(itemIds, Array);\n\n    // We can't trust the order from the client (for several reasons)\n    // Initially because in a multi-merchant scenario, the order from the client\n    // will contain only the items associated with their shop\n    // We'll get the order from the db that has all the items\n\n    // TODO: Resolve potential concurrency issue where any writes to the order items\n    // between this read and the Orders.update write below would be lost.\n    const dbOrder = Orders.findOne({ _id: order._id });\n    const items = dbOrder.items.map((item) => {\n      // Don't modify items unless they in our itemIds array\n      if (!itemIds.includes(item._id)) {\n        return item;\n      }\n\n      // Add the current status to completed workflows\n      if (item.workflow.status !== \"new\") {\n        const workflows = item.workflow.workflow || [];\n\n        workflows.push(status);\n        item.workflow.workflow = _.uniq(workflows);\n      }\n\n      // Set the new item status\n      item.workflow.status = status;\n      return item;\n    });\n\n    const result = Orders.update({\n      _id: dbOrder._id\n    }, {\n      $set: {\n        items\n      }\n    });\n\n    // Update search record\n    Hooks.Events.run(\"afterUpdateOrderUpdateSearchRecord\", order);\n\n    return result;\n  }\n});\n","import \"./methods/workflow\";\nimport \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Checkout\",\n  name: \"reaction-checkout\",\n  icon: \"fa fa-shopping-cart\",\n  autoEnable: true,\n  settings: {\n    name: \"Checkout\"\n  },\n  registry: [{\n    route: \"/cart/checkout\",\n    name: \"cart/checkout\",\n    workflow: \"coreCartWorkflow\",\n    label: \"Checkout\",\n    template: \"cartCheckout\"\n  }, {\n    route: \"/cart/completed/:_id?\",\n    name: \"cart/completed\",\n    template: \"cartCompleted\",\n    workflow: \"coreCartWorkflow\"\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreCartWorkflow\",\n    collection: \"Cart\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"cartCheckout\",\n      layoutHeader: \"NavBarCheckout\",\n      layoutFooter: \"\",\n      notFound: \"notFound\",\n      dashboardHeader: \"\",\n      dashboardControls: \"dashboardControls\",\n      dashboardHeaderControls: \"\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }, {\n    template: \"checkoutLogin\",\n    label: \"Login\",\n    workflow: \"coreCartWorkflow\",\n    container: \"checkout-steps-main\",\n    audience: [\"guest\", \"anonymous\"],\n    position: \"1\"\n  }, {\n    template: \"checkoutAddressBook\",\n    label: \"Shipping Billing\",\n    workflow: \"coreCartWorkflow\",\n    container: \"checkout-steps-main\",\n    audience: [\"guest\", \"anonymous\"],\n    position: \"2\"\n  }, {\n    template: \"coreCheckoutShipping\",\n    label: \"Shipping Options\",\n    workflow: \"coreCartWorkflow\",\n    container: \"checkout-steps-main\",\n    audience: [\"guest\", \"anonymous\"],\n    position: \"3\"\n  }, {\n    template: \"checkoutReview\",\n    label: \"Review Payment\",\n    workflow: \"coreCartWorkflow\",\n    container: \"checkout-steps-side\",\n    audience: [\"guest\", \"anonymous\"],\n    position: \"4\"\n  }, {\n    template: \"checkoutPayment\",\n    label: \"Complete\",\n    workflow: \"coreCartWorkflow\",\n    container: \"checkout-steps-side\",\n    audience: [\"guest\", \"anonymous\"],\n    position: \"5\"\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Dashboard\",\n  name: \"reaction-dashboard\",\n  icon: \"fa fa-th\",\n  autoEnable: true,\n  settings: {\n    name: \"Dashboard\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    workflow: \"coreDashboardWorkflow\",\n    name: \"dashboardPackages\",\n    label: \"Core\",\n    description: \"Reaction core shop configuration\",\n    icon: \"fa fa-th\",\n    priority: 0,\n    container: \"core\",\n    permissions: [{\n      label: \"Dashboard\",\n      permission: \"dashboard\"\n    }]\n  }, {\n    route: \"/dashboard\",\n    name: \"dashboard\",\n    workflow: \"coreDashboardWorkflow\",\n    provides: [\"shortcut\"],\n    label: \"Dashboard\",\n    template: \"dashboardPackages\",\n    icon: \"icon-reaction-logo\",\n    priority: 0,\n    permissions: [{\n      label: \"Dashboard\",\n      permission: \"dashboard\"\n    }]\n  }, {\n    route: \"/dashboard/shop/settings\",\n    template: \"shopSettings\",\n    name: \"shopSettings\",\n    label: \"Shop Settings\",\n    icon: \"fa fa-th\",\n    provides: [\"settings\"],\n    container: \"dashboard\"\n  }, {\n    label: \"Options\",\n    provides: [\"shopSettings\"],\n    container: \"dashboard\",\n    template: \"optionsShopSettings\",\n    showForShopTypes: [\"primary\"]\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreDashboardWorkflow\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"dashboardPackages\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"\",\n      notFound: \"notFound\",\n      dashboardHeader: \"dashboardHeader\",\n      dashboardControls: \"dashboardControls\",\n      dashboardHeaderControls: \"dashboardHeaderControls\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Email\",\n  name: \"reaction-email\",\n  icon: \"fa fa-envelope-o\",\n  autoEnable: true,\n  settings: {\n    name: \"Email\"\n  },\n  registry: [{\n    label: \"Email Settings\",\n    description: \"Email settings\",\n    icon: \"fa fa-envelope-o\",\n    name: \"email/settings\",\n    provides: [\"settings\"],\n    workflow: \"coreEmailWorkflow\",\n    template: \"emailSettings\",\n    meta: {\n      actionView: {\n        dashboardSize: \"md\"\n      }\n    }\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreEmailWorkflow\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"email\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"\",\n      notFound: \"notFound\",\n      dashboardHeader: \"dashboardHeader\",\n      dashboardControls: \"dashboardControls\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\n// loadTranslations([en]);\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"i18n\",\n  name: \"reaction-i18n\",\n  icon: \"fa fa-language\",\n  autoEnable: true,\n  settings: {\n    name: \"i18n\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    label: \"i18n\",\n    description: \"Internationalization utilities\",\n    icon: \"fa fa-language\",\n    priority: 1,\n    container: \"utilities\"\n  }, {\n    provides: [\"settings\"],\n    template: \"i18nSettings\",\n    label: \"Localization and i18n\",\n    icon: \"fa fa-language\",\n    container: \"reaction-i18n\"\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { getTemplateByName } from \"./templates\";\n\nexport function registerMethods() {\n  Meteor.methods({\n    getTemplateByName\n  });\n}\n\nexport { getTemplateByName };\n","import { check } from \"meteor/check\";\nimport { Templates } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\nexport function getTemplateByName(name, shopId) {\n  check(name, String);\n\n  const template = Templates.findOne({\n    name,\n    shopId: shopId || Reaction.getShopId()\n  });\n\n  return template;\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Reaction } from \"/server/api\";\nimport { Templates } from \"/lib/collections\";\n\nMeteor.publish(\"Templates\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  const marketplaceSettings = Reaction.getMarketplaceSettings();\n  const shopId = Reaction.getShopId();\n\n  const countSelector = query || {}; // The query selector we use for the Counts publication\n  const findSelector = {}; // The query selector we'll use for the Templates publication\n\n  // If we're using marketplace merchantTemplates we need to ensure we have a shopId and use the shopId in the selector\n  if (marketplaceSettings && marketplaceSettings.public && marketplaceSettings.public.merchantTemplates) {\n    if (!shopId) {\n      return this.ready();\n    }\n\n    // append shopId to query\n    countSelector.shopId = shopId;\n    findSelector.shopId = shopId;\n  }\n\n  // If we aren't using merchantTemplates, we'll share templates with the primary shop\n\n  // Original comments\n  // templates could be shared\n  // if you disregarded shopId\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"templates-count\", Templates.find(\n    countSelector,\n    options\n  ));\n\n  return Templates.find(findSelector);\n});\n","import { registerMethods } from \"./methods\";\nimport \"./publications/templates\";\nimport \"./i18n\";\n\nregisterMethods();\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Layout\",\n  name: \"reaction-layout\",\n  icon: \"fa fa-object-group\",\n  autoEnable: true,\n  settings: {\n    name: \"Layout\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    label: \"Layout\",\n    description: \"Layout utilities\",\n    icon: \"fa fa-object-group\",\n    priority: 1,\n    container: \"appearance\"\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./startup\";\nimport \"./i18n\";\n","import { Meteor } from \"meteor/meteor\";\nimport { Hooks } from \"/server/api\";\n\n\n/**\n*  Step 3 of the \"workflow/pushOrderWorkflow\" flow\n*\n*  The following methods are called from Orders.before.update hook.\n*  @see packages/reaction-schema/common/hooks/orders.js\n*  @see packages/reaction-core/common/methods/workflow.js\n*/\n\n/**\n * @method beforeUpdateOrderWorkflow hook\n *\n * @summary Updates an order's workflow before persisting order.\n *\n * @param {Order} order - Order object, before any modifications\n * @param {Object} options - Includes userId, modifier and validation\n * @return {Boolean} true if document should be updated, false otherwise\n*/\nHooks.Events.add(\"beforeUpdateOrderWorkflow\", (order, options) => {\n  const { userId, modifier } = options;\n  // if we're adding a new product or variant to the cart\n  if (modifier.$set) {\n    // Updating status of order e.g. \"coreOrderWorkflow/processing\"\n    if (modifier.$set[\"workflow.status\"]) {\n      const status = modifier.$set[\"workflow.status\"];\n      const workflowMethod = `workflow/${status}`;\n\n      if (Meteor.server.method_handlers[workflowMethod]) {\n        const result = Meteor.call(workflowMethod, {\n          userId,\n          order,\n          modifier\n        });\n        // Result should be true / false to all or disallow updating the status\n        return result;\n      }\n    }\n  }\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Orders\",\n  name: \"reaction-orders\",\n  icon: \"fa fa-sun-o\",\n  autoEnable: true,\n  settings: {\n    name: \"Orders\"\n  },\n  registry: [{\n    route: \"/dashboard/orders\",\n    provides: [\"dashboard\"],\n    workflow: \"coreOrderWorkflow\",\n    name: \"orders\",\n    label: \"Orders\",\n    description: \"Fulfill your orders\",\n    icon: \"fa fa-sun-o\",\n    priority: 0,\n    container: \"core\",\n    template: \"orders\"\n  }, {\n    route: \"/dashboard/orders\",\n    name: \"dashboard/orders\",\n    provides: [\"shortcut\"],\n    label: \"Orders\",\n    description: \"Fulfill your orders\",\n    icon: \"fa fa-sun-o\",\n    priority: 1,\n    container: \"dashboard\",\n    template: \"orders\",\n    audience: [\"seller\"]\n  }, {\n    route: \"/dashboard/pdf/orders/:id\",\n    workflow: \"coreOrderPrintWorkflow\",\n    layout: \"printLayout\",\n    name: \"dashboard/pdf/orders\",\n    template: \"completedPDFLayout\"\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreOrderWorkflow\",\n    collection: \"Orders\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"orders\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"Footer\",\n      notFound: \"notFound\",\n      dashboardHeader: \"dashboardHeader\",\n      dashboardHeaderControls: \"orderListFilters\",\n      dashboardControls: \"dashboardControls\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }, {\n    layout: \"printLayout\",\n    workflow: \"coreOrderPrintWorkflow\",\n    collection: \"Orders\",\n    enabled: true,\n    structure: {\n      template: \"completedPDFLayout\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"Footer\"\n    }\n  }, {\n    layout: \"coreLayout\",\n    workflow: \"coreOrderShipmentWorkflow\",\n    collection: \"Orders\",\n    theme: \"default\",\n    enabled: true\n  }, {\n    label: \"Order Processing\",\n    status: \"created\",\n    workflow: \"coreOrderWorkflow\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    template: \"coreOrderProcessing\",\n    label: \"Order Processing\",\n    status: \"processing\",\n    workflow: \"coreOrderWorkflow\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    template: \"coreOrderCompleted\",\n    label: \"Order Completed\",\n    status: \"completed\",\n    workflow: \"coreOrderWorkflow\",\n    audience: [\"dashboard/orders\"]\n  }, { // Standard Order Fulfillment with shipping\n    template: \"coreOrderShippingSummary\",\n    label: \"Summary\",\n    workflow: \"coreOrderShipmentWorkflow\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    template: \"coreOrderShippingInvoice\",\n    label: \"Invoice\",\n    workflow: \"coreOrderShipmentWorkflow\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    template: \"coreOrderShippingTracking\",\n    label: \"Shipment Tracking\",\n    workflow: \"coreOrderShipmentWorkflow\",\n    audience: [\"dashboard/orders\"]\n  }, { // Standard Order Item workflow\n    label: \"Inventory Adjust\",\n    workflow: \"coreOrderItemWorkflow\",\n    status: \"inventoryAdjusted\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    label: \"Item Payment Captured\",\n    workflow: \"coreOrderItemWorkflow\",\n    status: \"captured\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    label: \"Item Ship\",\n    workflow: \"coreOrderItemWorkflow\",\n    status: \"shipped\",\n    audience: [\"dashboard/orders\"]\n  }, {\n    label: \"Item Delivered\",\n    workflow: \"coreOrderItemWorkflow\",\n    status: \"completed\",\n    audience: [\"dashboard/orders\"]\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Payments\",\n  name: \"reaction-payments\",\n  icon: \"fa fa-credit-card\",\n  autoEnable: true,\n  settings: {\n    payments: {\n      enabled: true\n    }\n  },\n  registry: [\n    {\n      provides: [\"dashboard\"],\n      name: \"payments\",\n      label: \"Payments\",\n      description: \"Payment Methods\",\n      icon: \"fa fa-credit-card\",\n      priority: 1,\n      container: \"core\",\n      workflow: \"coreDashboardWorkflow\"\n    },\n    {\n      label: \"Payment Settings\",\n      icon: \"fa fa-credit-card\",\n      name: \"payment/settings\",\n      provides: [\"settings\"],\n      template: \"paymentSettings\"\n    }\n  ]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\nimport \"./policy\";\n","import { BrowserPolicy } from \"meteor/browser-policy-common\";\n\nBrowserPolicy.content.allowOriginForAll(\"*.facebook.com\");\nBrowserPolicy.content.allowOriginForAll(\"connect.facebook.net\");\nBrowserPolicy.content.allowOriginForAll(\"fonts.googleapis.com\");\nBrowserPolicy.content.allowOriginForAll(\"fonts.gstatic.com\");\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"UI\",\n  name: \"reaction-ui\",\n  icon: \"fa fa-html5\",\n  autoEnable: true,\n  registry: [],\n  layout: []\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"UI Navbar\",\n  name: \"reaction-ui-navbar\",\n  autoEnable: true\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"UI TagNav\",\n  name: \"reaction-ui-tagnav\",\n  autoEnable: true\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\nimport en from \"./en.json\";\n\nloadTranslations([en]);\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Reaction } from \"/server/api/\";\nimport { Shops } from \"/lib/collections\";\n\nMigrations.add({\n  // moving to multi-shop setup requries a primary shop to be set.\n  // Updates a shop marked active, that has associated email for domain as the primary shop\n  version: 10,\n  up() {\n    Shops.update({\n      \"status\": \"active\",\n      \"domains\": Reaction.getDomain(),\n      \"emails.0.address\": { $exists: true }\n    }, {\n      $set: { shopType: \"primary\" }\n    }, { bypassCollection2: true });\n  },\n  down() {\n    Shops.update({ shopType: \"primary\" }, {\n      $unset: { shopType: \"\" }\n    }, { bypassCollection2: true });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Cart, Orders, Products } from \"/lib/collections\";\n\nMigrations.add({\n  version: 11,\n  up() {\n    // Add whole product object to all cart items in all Cart documents if the cart has an item added\n    Cart.find().forEach((cart) => {\n      if (Array.isArray(cart.items) && cart.items.length) {\n        cart.items.forEach((item) => {\n          item.product = Products.findOne({ _id: item.productId });\n        });\n        Cart.update({ _id: cart._id }, {\n          $set: { items: cart.items }\n        }, { bypassCollection2: true });\n      }\n    });\n\n    // Add whole product object to all order items in all order documents\n    Orders.find().forEach((order) => {\n      order.items.forEach((item) => {\n        item.product = Products.findOne({ _id: item.productId });\n      });\n      Orders.update({ _id: order._id }, {\n        $set: { items: order.items }\n      }, { bypassCollection2: true });\n    });\n  },\n  // Going down, we remove the product object on each item in cart and order\n  down() {\n    Cart.find().forEach((cart) => {\n      if (Array.isArray(cart.items) && cart.items.length) {\n        cart.items.forEach((item) => {\n          delete item.product;\n        });\n        Cart.update({ _id: cart._id }, {\n          $set: { items: cart.items }\n        }, { bypassCollection2: true });\n      }\n    });\n\n    Orders.find().forEach((order) => {\n      order.items.forEach((item) => {\n        delete item.product;\n      });\n      Orders.update({ _id: order._id }, {\n        $set: { items: order.items }\n      }, { bypassCollection2: true });\n    });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Cart, Orders } from \"/lib/collections\";\nimport { Reaction } from \"/server/api/\";\n\nMigrations.add({\n  version: 12,\n  up() {\n    // moving to multi-shop setup requires each billing objects to be marked by shopId\n    // This adds shopId field to each billing object in orders and carts.\n    const shopId = Reaction.getShopId();\n\n    Orders.update({}, {\n      $set: { \"billing.0.shopId\": shopId }\n    }, { bypassCollection2: true, multi: true });\n\n    Cart.update({}, {\n      $set: { \"billing.0.shopId\": shopId }\n    }, { bypassCollection2: true, multi: true });\n  },\n  down() {\n    Orders.update({}, {\n      $unset: { \"billing.0.shopId\": \"\" }\n    }, { bypassCollection2: true, multi: true });\n\n    Cart.update({}, {\n      $set: { \"billing.0.shopId\": \"\" }\n    }, { bypassCollection2: true, multi: true });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Cart, Orders } from \"/lib/collections\";\nimport { Reaction } from \"/server/api/\";\n\nMigrations.add({\n  version: 13,\n  up() {\n    // moving to multi-shop setup requires each shipping objects to be marked by shopId\n    // This adds shopId field to each shipping object in orders and carts.\n    const shopId = Reaction.getShopId();\n\n    Orders.update({}, {\n      $set: { \"shipping.0.shopId\": shopId }\n    }, { bypassCollection2: true, multi: true });\n\n    Cart.update({}, {\n      $set: { \"shipping.0.shopId\": shopId }\n    }, { bypassCollection2: true, multi: true });\n  },\n  down() {\n    Orders.update({}, {\n      $unset: { \"shipping.0.shopId\": \"\" }\n    }, { bypassCollection2: true, multi: true });\n\n    Cart.update({}, {\n      $set: { \"shipping.0.shopId\": \"\" }\n    }, { bypassCollection2: true, multi: true });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { OrderSearch } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\n\nlet buildOrderSearch;\n\nasync function loadSearchRecordBuilderIfItExists() {\n  const searchPackage = Reaction.getPackageSettings(\"reaction-search\");\n\n  if (typeof searchPackage === \"object\") {\n    Logger.debug(\"Found stock search-mongo (reaction-search) plugin.\");\n\n    ({ buildOrderSearch } = await import(\"/imports/plugins/included/search-mongo/server/methods/searchcollections\"));\n  } else {\n    Logger.warn(\"Failed to load reaction-search plugin. Skipping building order search records on version migration \" +\n                \"step 14.\");\n  }\n}\n\nloadSearchRecordBuilderIfItExists().then(() => Migrations.add({\n  // Migrations 12 and 13 introduced changes on Orders, so we need to rebuild the search collection\n  version: 14,\n  up() {\n    OrderSearch.remove({});\n\n    if (buildOrderSearch) {\n      buildOrderSearch();\n    }\n  },\n  down() {\n    // whether we are going up or down we just want to update the search collections\n    // to match whatever the current code in the build methods are.\n    OrderSearch.remove({});\n\n    if (buildOrderSearch) {\n      buildOrderSearch();\n    }\n  }\n}), (err) => Logger.warn(`Failed to run version migration step 14. Received error: ${err}.`));\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Orders } from \"/lib/collections\";\n\nMigrations.add({\n  version: 15,\n  // Reaction v1.0 had 3 shipping boolean states (packed, shipped, delivered). Shipping workflow is not managed with a\n  // workflow object that keeps track of previous state.\n  up() {\n    Orders.find().forEach((order) => {\n      const currentShipping = order.shipping[0];\n      currentShipping.workflow = {};\n\n      if (currentShipping.packed) {\n        currentShipping.workflow.status = \"coreOrderWorkflow/packed\";\n        currentShipping.workflow.workflow = [\n          \"coreOrderWorkflow/notStarted\",\n          \"coreOrderWorkflow/picked\",\n          \"coreOrderWorkflow/packed\"\n        ];\n      }\n\n      if (currentShipping.shipped) {\n        currentShipping.workflow.status = \"coreOrderWorkflow/shipped\";\n        currentShipping.workflow.workflow = [\n          \"coreOrderWorkflow/notStarted\",\n          \"coreOrderWorkflow/picked\",\n          \"coreOrderWorkflow/packed\",\n          \"coreOrderWorkflow/labeled\",\n          \"coreOrderWorkflow/shipped\"\n        ];\n      }\n\n      if (currentShipping.delivered) {\n        currentShipping.workflow.status = \"coreOrderWorkflow/delivered\";\n        currentShipping.workflow.workflow = [\n          \"coreOrderWorkflow/notStarted\",\n          \"coreOrderWorkflow/picked\",\n          \"coreOrderWorkflow/packed\",\n          \"coreOrderWorkflow/labeled\",\n          \"coreOrderWorkflow/shipped\",\n          \"coreOrderWorkflow/delivered\"\n        ];\n      }\n\n      // If none of the 3 v1.0 states is true, set as unstarted.\n      // Note: In case of customized workflow status, modify here to capture the added status(es) before running the migration\n      currentShipping.workflow.status = \"new\";\n      currentShipping.workflow.workflow = [\"coreOrderWorkflow/notStarted\"];\n\n      delete currentShipping.packed;\n      delete currentShipping.shipped;\n      delete currentShipping.delivered;\n\n      Orders.update({ _id: order._id }, {\n        $set: { \"shipping.0\": currentShipping }\n      }, { bypassCollection2: true });\n    });\n  },\n  down() {\n    Orders.find().forEach((order) => {\n      const currentShipping = order.shipping[0];\n      const { workflow } = currentShipping;\n\n      currentShipping.packed = false;\n      currentShipping.shipped = false;\n      currentShipping.delivered = false;\n\n      if (workflow && workflow.status === \"coreOrderWorkflow/packed\") {\n        currentShipping.packed = true;\n      }\n\n      if (workflow && workflow.status === \"coreOrderWorkflow/shipped\") {\n        currentShipping.shipped = true;\n      }\n\n      if (workflow && workflow.status === \"coreOrderWorkflow/delivered\") {\n        currentShipping.delivered = true;\n      }\n\n      delete currentShipping.workflow.workflow;\n\n      Orders.update({ _id: order._id }, {\n        $set: { \"shipping.0\": currentShipping }\n      }, { bypassCollection2: true });\n    });\n  }\n});\n\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Orders, Packages } from \"/lib/collections\";\n\nconst paymentNameDict = {\n  Example: \"example-paymentmethod\",\n  Braintree: \"reaction-braintree\",\n  AuthNet: \"reaction-auth-net\",\n  PaypalExpress: \"reaction-paypal\",\n  PayflowPro: \"reaction-paypal\",\n  Stripe: \"reaction-stripe\"\n};\n\nMigrations.add({\n  version: 16,\n  up() {\n    Orders.find().forEach((order) => {\n      const newBilling = order.billing.map((billing) => {\n        const packageData = Packages.findOne({\n          name: paymentNameDict[billing.paymentMethod.processor],\n          shopId: billing.shopId\n        });\n        const registry = packageData && Array.isArray(packageData.registry)\n          && packageData.registry[0] && packageData.registry[0];\n        // create key in similar pattern created in Packages pub transform\n        const settingsKey = (registry.name || packageData.name).split(\"/\").splice(-1)[0];\n        const cartItems = order.items.map((item) => ({\n          _id: item._id,\n          productId: item.productId,\n          variantId: item.variants._id,\n          shopId: item.shopId,\n          quantity: item.quantity\n        }));\n\n        billing.paymentMethod.paymentPackageId = packageData && packageData._id;\n        billing.paymentMethod.paymentSettingsKey = settingsKey;\n        billing.paymentMethod.shopId = billing.shopId;\n        billing.paymentMethod.items = cartItems;\n        return billing;\n      });\n\n      Orders.update({ _id: order._id }, {\n        $set: { billing: newBilling }\n      }, { bypassCollection2: true });\n    });\n  },\n  down() {\n    Orders.find().forEach((order) => {\n      order.billing.forEach((billing) => {\n        delete billing.paymentMethod.paymentPackageId;\n        delete billing.paymentMethod.paymentSettingsKey;\n        delete billing.paymentMethod.shopId;\n        delete billing.paymentMethod.items;\n      });\n      Orders.update({ _id: order._id }, {\n        $set: { items: order.billing }\n      }, { bypassCollection2: true });\n    });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Shops } from \"/lib/collections\";\n\nMigrations.add({\n  // Initializes shops without a baseUOL and without unitsOfLength to our default\n  version: 17,\n  up() {\n    Shops.update({\n      baseUOL: { $exists: false },\n      unitsOfLength: { $exists: false }\n    }, {\n      $set: {\n        baseUOL: \"in\",\n        unitsOfLength: [{\n          uol: \"in\",\n          label: \"Inches\",\n          default: true\n        }, {\n          uol: \"cm\",\n          label: \"Centimeters\"\n        }, {\n          uol: \"ft\",\n          label: \"Feet\"\n        }]\n      }\n    }, { bypassCollection2: true, multi: true });\n  },\n  down() {\n    Shops.update({\n      baseUOL: { $exists: true },\n      unitsOfLength: { $exists: true }\n    }, {\n      $unset: {\n        baseUOL: \"\",\n        unitsOfLength: \"\"\n      }\n    }, { bypassCollection2: true, multi: true });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Shops, Packages } from \"/lib/collections\";\n\nconst pkgs = [\n  \"reaction-accounts\",\n  \"reaction-checkout\",\n  \"reaction-dashboard\",\n  \"reaction-email\",\n  \"reaction-orders\",\n  \"reaction-ui\",\n  \"reaction-product-variant\",\n  \"product-detail-simple\",\n  \"core\"\n];\n\nconst query = {\n  name: { $in: pkgs },\n  layout: { $type: 3 } // docs with layouts set\n};\n\nMigrations.add({\n  version: 18,\n  up() {\n    const packages = Packages.find(query).fetch();\n    packages.forEach(updateHandler(Packages));\n\n    const shops = Shops.find().fetch();\n    shops.forEach(updateHandler(Shops));\n  },\n  down() {\n    const packages = Packages.find(query).fetch();\n    packages.forEach(downgradeHandler(Packages));\n\n    const shops = Shops.find().fetch();\n    shops.forEach(downgradeHandler(Shops));\n  }\n});\n\nfunction updateHandler(collection) {\n  return function (doc) {\n    let changed = false;\n    for (const layout of doc.layout) {\n      if (layout.structure && layout.structure.template === \"cartCheckout\") {\n        layout.structure.layoutHeader = \"NavBarCheckout\";\n        changed = true;\n      } else if (layout.structure && layout.structure.layoutHeader === \"layoutHeader\") {\n        layout.structure.layoutHeader = \"NavBar\";\n        changed = true;\n      }\n      if (layout.structure && layout.structure.layoutFooter === \"layoutFooter\") {\n        layout.structure.layoutFooter = \"Footer\";\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      collection.update({ _id: doc._id }, {\n        $set: { layout: doc.layout }\n      });\n    }\n  };\n}\n\nfunction downgradeHandler(collection) {\n  return function (doc) {\n    let changed = false;\n    for (const layout of doc.layout) {\n      if (layout.structure && layout.structure.layoutHeader === \"NavBar\") {\n        layout.structure.layoutHeader = \"layoutHeader\";\n        changed = true;\n      }\n      if (layout.structure && layout.structure.layoutFooter === \"Footer\") {\n        layout.structure.layoutFooter = \"layoutFooter\";\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      collection.update({ _id: doc._id }, {\n        $set: { layout: doc.layout }\n      });\n    }\n  };\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { Migrations } from \"meteor/percolate:migrations\";\nimport { Logger } from \"/server/api\";\nimport { Accounts, Groups, Shops } from \"/lib/collections\";\n\n// Migration file created for removing the admin role from shop manager group, and users in the group\nMigrations.add({\n  version: 19,\n  up() {\n    const shops = Shops.find({}).fetch();\n    if (shops && shops.length) {\n      shops.forEach((shop) => {\n        const shopManager = Groups.findOne({ slug: \"shop manager\", shopId: shop._id });\n        if (shopManager) {\n          const shopManagerRoles = shopManager.permissions;\n          const newShopManagerRoles = shopManagerRoles.filter((permission) => permission !== \"admin\");\n          Groups.update({\n            slug: \"shop manager\",\n            shopId: shop._id\n          }, {\n            $set: { permissions: newShopManagerRoles }\n          });\n          Logger.debug(`group \"shop manager\" with id \"${shopManager._id}\" updated(admin role removed)`);\n\n          // update users in group to new roles\n          const userIds = Accounts.find({ groups: shopManager._id }).fetch().map((acc) => acc._id);\n          Meteor.users.update({\n            _id: { $in: userIds }\n          }, {\n            $set: { [`roles.${shop._id}`]: newShopManagerRoles }\n          }, {\n            multi: true\n          });\n          Logger.debug(`users with \"shop manager\" in shop \"${shop._id}\" updated(admin role removed)`);\n        }\n      });\n    }\n  },\n\n  down() {\n    const shops = Shops.find({}).fetch();\n\n    if (shops && shops.length) {\n      shops.forEach((shop) => {\n        const shopManager = Groups.findOne({ slug: \"shop manager\", shopId: shop._id });\n        if (shopManager) {\n          const shopManagerRoles = shopManager.permissions;\n          // add back admin role\n          const newShopManagerRoles = shopManagerRoles.concat([\"admin\"]);\n          Groups.update({\n            slug: \"shop manager\",\n            shopId: shop._id\n          }, {\n            $set: { permissions: newShopManagerRoles }\n          });\n          Logger.debug(`group \"shop manager\" with id \"${shopManager._id}\" updated(admin role added)`);\n\n          // update users in group to new roles\n          const userIds = Accounts.find({ groups: shopManager._id }).fetch().map((acc) => acc._id);\n          Meteor.users.update({\n            _id: { $in: userIds }\n          }, {\n            $set: { [`roles.${shop._id}`]: newShopManagerRoles }\n          }, {\n            multi: true\n          });\n          Logger.debug(`users with \"shop manager\" in shop \"${shop._id}\" updated(admin role added)`);\n        }\n      });\n    }\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { OrderSearch, AccountSearch } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\n\nlet buildOrderSearch;\nlet buildAccountSearch;\n\nasync function loadSearchRecordBuilderIfItExists() {\n  const searchPackage = Reaction.getPackageSettings(\"reaction-search\");\n\n  if (typeof searchPackage === \"object\") {\n    Logger.debug(\"Found stock search-mongo (reaction-search) plugin.\");\n\n    ({\n      buildOrderSearch,\n      buildAccountSearch\n    } = await import(\"/imports/plugins/included/search-mongo/server/methods/searchcollections\"));\n  } else {\n    Logger.warn(\"Failed to load reaction-search plugin. Skipping building order and account search records \" +\n                \"on version migration step 1.\");\n  }\n}\n\nloadSearchRecordBuilderIfItExists().then(() => Migrations.add({\n  version: 1,\n  up() {\n    OrderSearch.remove({});\n    AccountSearch.remove({});\n\n    if (buildOrderSearch) {\n      buildOrderSearch();\n    }\n\n    if (buildAccountSearch) {\n      buildAccountSearch();\n    }\n  },\n  down() {\n    // whether we are going up or down we just want to update the search collections\n    // to match whatever the current code in the build methods are.\n    OrderSearch.remove({});\n    AccountSearch.remove({});\n\n    if (buildOrderSearch) {\n      buildOrderSearch();\n    }\n\n    if (buildAccountSearch) {\n      buildAccountSearch();\n    }\n  }\n}), (err) => Logger.warn(`Failed to run version migration step 1. Received error: ${err}.`));\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Reaction } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\n\n// Migration file created for removing the admin role from shop manager group, and users in the group\nMigrations.add({\n  version: 20,\n  up() {\n    Packages.update({\n      name: \"reaction-marketplace\",\n      shopId: Reaction.getPrimaryShopId()\n    }, {\n      $set: {\n        \"settings.public.shopPrefix\": \"/shop\"\n      }\n    });\n  },\n\n  down() {\n    Packages.update({\n      name: \"reaction-marketplace\",\n      shopId: Reaction.getPrimaryShopId()\n    }, {\n      $unset: {\n        \"settings.public.shopPrefix\": 1\n      }\n    });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Cart } from \"/lib/collections\";\n\n// aldeed:simple-schema behavior would lead to a dangling incomplete shipmentMethod\n// on new carts, but NPM simpl-schema now complains about that when validating.\nMigrations.add({\n  version: 21,\n  up() {\n    Cart.find().forEach((cart) => {\n      const unset = {};\n\n      (cart.shipping || []).forEach((shippingItem, index) => {\n        const { shipmentMethod } = shippingItem;\n        if (!shipmentMethod) return;\n        if (Object.keys(shipmentMethod).length === 1) {\n          unset[`shipping.${index}.shipmentMethod`] = 1;\n        }\n      });\n\n      if (Object.keys(unset).length > 0) {\n        Cart.update({ _id: cart._id }, { $unset: unset });\n      }\n    });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Packages } from \"/lib/collections\";\n\n\nMigrations.add({\n  version: 22,\n  up() {\n    const pkg = Packages.findOne({ name: \"reaction-accounts\" });\n    for (const route of pkg.registry) {\n      if (route.route === \"/account/profile/verify:email?\") {\n        route.route = \"/account/profile/verify\";\n        route.template = \"VerifyAccount\";\n        Packages.update(\n          { _id: pkg._id },\n          { $set: { registry: pkg.registry } }\n        );\n        break;\n      }\n    }\n  },\n  down() {\n    const pkg = Packages.findOne({ name: \"reaction-accounts\" });\n    for (const route of pkg.registry) {\n      if (route.route === \"/account/profile/verify\") {\n        route.route = \"/account/profile/verify:email?\";\n        route.template = \"verifyAccount\";\n        Packages.update(\n          { _id: pkg._id },\n          { $set: { registry: pkg.registry } }\n        );\n        break;\n      }\n    }\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { MongoInternals } from \"meteor/mongo\";\n\nconst { db } = MongoInternals.defaultRemoteCollectionDriver().mongo;\n\nMigrations.add({\n  version: 23,\n  up() {\n    try {\n      Promise.await(db.dropCollection(\"cfs._tempstore.chunks\"));\n      Promise.await(db.dropCollection(\"cfs_gridfs._tempstore.chunks\"));\n      Promise.await(db.dropCollection(\"cfs_gridfs._tempstore.files\"));\n    } catch (error) {\n      // These seem to throw an error from mongo NPM pkg, but only after\n      // they succeed in dropping the collections, so we'll just ignore\n    }\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Products } from \"/lib/collections\";\nimport { publishProductsToCatalog } from \"/imports/plugins/core/catalog/server/methods/catalog\";\n\nMigrations.add({\n  version: 24,\n  up() {\n    const visiblePublishedProducts = Products.find(\n      { isVisible: true, isDeleted: false, type: \"simple\" },\n      { _id: 1 }\n    ).map((product) => product._id);\n    publishProductsToCatalog(visiblePublishedProducts);\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Packages } from \"/lib/collections\";\n\n// Add keys to search so that stock search is enabled by default\nMigrations.add({\n  version: 2,\n  up() {\n    if (Packages) {\n      Packages.update(\n        { name: \"reaction-ui-search\" },\n        {\n          $set: {\n            registry: [\n              {\n                name: \"Search Modal\",\n                provides: [\"ui-search\"],\n                template: \"searchModal\"\n              }\n            ]\n          }\n        },\n        { bypassCollection2: true, multi: true }\n      );\n    }\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api/\";\n// Add keys to search so that stock search is enabled by default\nMigrations.add({\n  version: 3,\n  up() {\n    Packages.update(\n      {}, {\n        $set: {\n          registry: []\n        }\n      },\n      { bypassCollection2: true, multi: true }\n    );\n    Reaction.loadPackages();\n    Reaction.Importer.flush();\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Packages } from \"/lib/collections\";\n\nconst reactionPkgs = [ // reaction packages with layouts\n  \"reaction-accounts\",\n  \"reaction-checkout\",\n  \"reaction-dashboard\",\n  \"reaction-email\",\n  \"reaction-orders\",\n  \"reaction-ui\",\n  \"reaction-inventory\",\n  \"reaction-product-variant\"];\n\nconst query = {\n  name: { $in: reactionPkgs },\n  layout: { $type: 3 } // docs with layouts set\n};\n\nMigrations.add({\n  version: 4,\n  up() {\n    const packages = Packages.find(query).fetch();\n    packages.forEach(updateHandler(1, 999));\n  },\n  down() {\n    const packages = Packages.find(query).fetch();\n    packages.forEach(updateHandler(999, 1));\n  }\n});\n\nfunction updateHandler(oldValue, newValue) {\n  return function (pkg) {\n    let changed = false; // to track if updating is needed\n    pkg.layout.forEach((layout) => {\n      if (!layout.priority || layout.priority === oldValue) {\n        layout.priority = newValue;\n        changed = true;\n      }\n    });\n\n    if (changed) {\n      Packages.update(pkg._id, {\n        $set: { layout: pkg.layout }\n      }, { bypassCollection2: true });\n    }\n  };\n}\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Migrations } from \"meteor/percolate:migrations\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Accounts, Groups, Shops } from \"/lib/collections\";\n\n/**\n * Migration file created for moving from previous admin permission management to permission groups\n * On up, it creates the default groups for all shops in the app, then update accounts belonging to the\n * default groups. It also creates custom groups for every unique set of permission and assigns accounts\n * with such permissions to the custom group they belong.\n */\nMigrations.add({\n  version: 5,\n  up() {\n    const shops = Shops.find({}).fetch();\n\n    // needed to ensure restart in case of a migration that failed before finishing\n    Groups.remove({});\n    Accounts.update({}, { $set: { groups: [] } }, { bypassCollection2: true, multi: true });\n\n    if (shops && shops.length) {\n      shops.forEach((shop) => {\n        const defaultGroupAccounts = createDefaultGroupsForShop(shop);\n        // retrieves remaining permission sets that doesn't fit the default sets\n        const customPermissions = Meteor.users\n          .find({ _id: { $nin: defaultGroupAccounts } })\n          .fetch()\n          .map((user) => user.roles && user.roles[shop._id]);\n        // sorts the array of permission sets to contain only unique sets to avoid creating groups with same permissions\n        const permissionsArray = sortUniqueArray(customPermissions);\n        permissionsArray.forEach((permissions, index) => {\n          if (!permissions) { return null; }\n          Logger.debug(`creating custom group for shop ${shop.name}`);\n          const groupId = Groups.insert({\n            name: `custom ${index + 1}`,\n            slug: `custom${index + 1}`,\n            permissions,\n            shopId: shop._id\n          }, { bypassCollection2: true });\n          updateAccountsInGroup({\n            shopId: shop._id,\n            permissions,\n            groupId\n          });\n        });\n      });\n    }\n\n    function createDefaultGroupsForShop(shop) {\n      let defaultGroupAccounts = [];\n      const { defaultRoles, defaultVisitorRole } = shop;\n      let ownerRoles = Roles.getAllRoles().fetch().map((role) => role.name);\n\n      // See detailed comment in `/server/api/core/groups.js`. The code here follows similar pattern.\n      ownerRoles = ownerRoles.concat(Reaction.defaultCustomerRoles);\n      ownerRoles = _.uniq(ownerRoles);\n\n      const shopManagerRoles = ownerRoles.filter((role) => role !== \"owner\");\n      const roles = {\n        \"shop manager\": shopManagerRoles,\n        \"customer\": defaultRoles || Reaction.defaultCustomerRoles,\n        \"guest\": defaultVisitorRole || Reaction.defaultVisitorRoles,\n        \"owner\": ownerRoles\n      };\n\n      Object.keys(roles).forEach((groupKeys) => {\n        Logger.debug(`creating group ${groupKeys} for shop ${shop.name}`);\n        const groupId = Groups.insert({\n          name: groupKeys,\n          slug: groupKeys,\n          permissions: roles[groupKeys],\n          shopId: shop._id\n        });\n        Logger.debug(`new group \"${groupKeys}\" created with id \"${groupId}\"`);\n        const updatedAccounts = updateAccountsInGroup({\n          shopId: shop._id,\n          permissions: roles[groupKeys],\n          groupId\n        });\n        defaultGroupAccounts = defaultGroupAccounts.concat(updatedAccounts);\n      });\n      return defaultGroupAccounts;\n    }\n\n    // finds all accounts with a permission set and assigns them to matching group\n    function updateAccountsInGroup({ shopId, permissions = [], groupId }) {\n      const query = { [`roles.${shopId}`]: { $size: permissions.length, $all: permissions } };\n      const matchingUserIds = Meteor.users.find(query).fetch().map((user) => user._id);\n\n      if (matchingUserIds.length) {\n        Logger.debug(`updating following matching Accounts to new group: ${matchingUserIds}`);\n      }\n      Accounts.update(\n        { _id: { $in: matchingUserIds }, shopId },\n        { $addToSet: { groups: groupId } },\n        { bypassCollection2: true, multi: true }\n      );\n      return matchingUserIds;\n    }\n  },\n  down() {\n    const shops = Shops.find({}).fetch();\n\n    if (shops && shops.length) {\n      shops.forEach((shop) => removeGroupsForShop(shop));\n    }\n    function removeGroupsForShop(shop) {\n      const shopGroups = Groups.find({ shopId: shop._id }).fetch();\n\n      const keys = {\n        customer: \"defaultRoles\",\n        guest: \"defaultVisitorRole\"\n      };\n\n      shopGroups.forEach((group) => {\n        const shopkey = keys[group.slug];\n        Shops.update({ _id: shop._id }, { $set: { [shopkey]: group.permissions } });\n        Accounts.update({ shopId: shop._id }, { $unset: { groups: \"\" } }, { bypassCollection2: true, multi: true });\n      });\n    }\n  }\n});\n\n/*\n * helper func created to limit the permission sets available to unique values without duplicates.\n * It takes a two dimentional array like this:\n * [\n *   [\"tag\", \"product\"],\n *   [\"product\", \"tag\"],\n *   [\"tag\", \"product\", \"shop\"],\n *   [\"tag\", \"shop\"],\n *   [\"shop\", \"tag\"]\n * ]\n * and returns this: [[\"product\", \"tag\"], [\"product\", \"shop\", \"tag\"], [\"shop\", \"tag\"]]\n */\nfunction sortUniqueArray(multiArray) {\n  const sorted = multiArray.map((x) => {\n    if (!x) { return []; }\n    return x.sort();\n  }).sort();\n  const uniqueArray = [];\n  uniqueArray.push(sorted[0]);\n\n  for (let i = 1; i < sorted.length; i += 1) {\n    if (JSON.stringify(sorted[i]) !== JSON.stringify(sorted[i - 1])) {\n      uniqueArray.push(sorted[i]);\n    }\n  }\n  return uniqueArray;\n}\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Tags } from \"/lib/collections\";\n\nMigrations.add({\n  version: 6,\n  up() {\n    Tags.update({}, {\n      $set: {\n        isVisible: true\n      }\n    }, { bypassCollection2: true, multi: true });\n  },\n  down() {\n    Tags.update({}, {\n      $unset: {\n        isVisible: null\n      }\n    }, { bypassCollection2: true, multi: true });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Shops } from \"/lib/collections\";\nimport { getSlug } from \"/lib/api\";\n\nMigrations.add({\n  version: 7,\n  up() {\n    // Get all shops\n    const shops = Shops.find();\n    // Get primary shop\n    const primaryShop = Shops.findOne({ shopType: \"primary\" });\n    // Init list of merchant shops\n    const merchantShops = [];\n\n    // Loop through all shops creating slugs and creating merchant shop objects\n    shops.forEach((shop) => {\n      // create slug from shop name\n      const shopSlug = getSlug(shop.name);\n\n      // If a shop doesn't have a slug, add one\n      if (typeof shop.slug === \"undefined\") {\n        Shops.update({ _id: shop._id }, {\n          $set: {\n            slug: shopSlug\n          }\n        }, { bypassCollection2: true });\n      }\n\n      // if the shop is a merchant shop, create an obeject for it to - these will be used to create shop routes\n      if (shop.shopType === \"merchant\") {\n        merchantShops.push({\n          _id: shop._id,\n          name: shop.name,\n          slug: shopSlug\n        });\n      }\n    });\n\n    // if we added any merchant shops, add those to the primary shop\n    if (merchantShops.length > 0) {\n      Shops.update({ _id: primaryShop._id }, {\n        $set: {\n          merchantShops\n        }\n      }, { bypassCollection2: true });\n    }\n  },\n\n  down() {\n    // Remove slugs and merchant shops\n    Shops.update({}, {\n      $unset: {\n        slug: null,\n        merchantShops: null\n      }\n    }, { bypassCollection2: true, multi: true });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Packages } from \"/lib/collections\";\n\nMigrations.add({\n  version: 8,\n  up() {\n    const packages = Packages.find();\n    // Loop through all packages and update provides to use an array\n    packages.forEach((pkg) => {\n      if (pkg.registry) {\n        // Map the existing registry into an updated registry with the existing \"provides\" string wrapped in an array\n        // We use the term \"app\" to refer to individual registry entries\n        const updatedRegistry = pkg.registry.map((app) => {\n          if (typeof app.provides === \"string\") {\n            app.provides = [app.provides];\n          }\n          return app;\n        });\n\n        // Update the package document with the new registry\n        Packages.update({ _id: pkg._id }, {\n          $set: {\n            registry: updatedRegistry\n          }\n        }, { bypassCollection2: true });\n      }\n    });\n  },\n\n  down() {\n    const packages = Packages.find();\n\n    // Loop through all packages and update provides to use an array\n    packages.forEach((pkg) => {\n      if (pkg.registry) {\n        // Map the existing registry into an updated registry with any provides arrays changed to use the first element\n        // of the array. We discussed reducing the array and creating an entry for each provides here, but felt that\n        // since versions of the app before this would have only had one entry, it's safer to just take the first element\n        // of the array\n        const updatedRegistry = pkg.registry.map((entry) => {\n          if (Array.isArray(entry.provides)) {\n            entry.provides = entry.provides[0]; // eslint-disable-line prefer-destructuring\n          }\n          return entry;\n        });\n\n        // Update the package document with the new registry\n        Packages.update({ _id: pkg._id }, {\n          $set: {\n            registry: updatedRegistry\n          }\n        }, { bypassCollection2: true });\n      }\n    });\n  }\n});\n","import { Migrations } from \"meteor/percolate:migrations\";\nimport { Shops } from \"/lib/collections\";\n\nMigrations.add({\n  version: 9,\n  up() {\n    Shops.find().forEach((shop) => {\n      // Default baseUOM to oz\n      if (!shop.baseUOM) {\n        shop.baseUOM = \"oz\";\n      } else {\n        shop.baseUOM = shop.baseUOM.toLowerCase();\n      }\n\n      // normalize grams to \"g\"\n      if (shop.baseUOM === \"gr\") {\n        shop.baseUOM = \"g\";\n      }\n\n      shop.unitsOfMeasure = [{\n        uom: \"oz\",\n        label: \"Ounces\",\n        default: true\n      }, {\n        uom: \"lb\",\n        label: \"Pounds\"\n      }, {\n        uom: \"g\",\n        label: \"Grams\"\n      }, {\n        uom: \"kg\",\n        label: \"Kilograms\"\n      }];\n\n      Shops.update({ _id: shop._id }, {\n        $set: {\n          baseUOM: shop.baseUOM,\n          unitsOfMeasure: shop.unitsOfMeasure\n        }\n      }, { bypassCollection2: true });\n    });\n  },\n  down() {\n    Shops.find().forEach((shop) => {\n      shop.baseUOM = shop.baseUOM && shop.baseUOM.toUpperCase();\n      Shops.update({ _id: shop._id }, {\n        $set: {\n          baseUOM: shop.baseUOM\n        }\n      }, { bypassCollection2: true });\n    });\n  }\n});\n","import \"./1_rebuild_account_and_order_search_collections\";\nimport \"./2_add_key_to_search_ui\";\nimport \"./3_reset_package_registry\";\nimport \"./4_update_templates_priority\";\nimport \"./5_update_defaultRoles_to_groups\";\nimport \"./6_update_tags_is_visible\";\nimport \"./7_add_shop_slugs_to_schema\";\nimport \"./8_update_registry_provides_to_array\";\nimport \"./9_update_metrics\";\nimport \"./10_set_primary_shop\";\nimport \"./11_add_product_to_cart_items\";\nimport \"./12_add_shopId_on_billing\";\nimport \"./13_add_shopId_on_shipping\";\nimport \"./14_rebuild_order_search_collection\";\nimport \"./15_update_shipping_status_to_workflow\";\nimport \"./16_update_billing_paymentMethod\";\nimport \"./17_set_shop_uols\";\nimport \"./18_use_react_for_header_and_footer_layout\";\nimport \"./19_remove_admin_from_shop_manager\";\nimport \"./20_add_shop_to_marketplace\";\nimport \"./21_clean_cart_shipment_method\";\nimport \"./22_register_verify_account\";\nimport \"./23_drop_tempstore_collections\";\nimport \"./24_publish_all_existing_visible_products\";\n","import \"./startup\";\nimport \"./migrations/\";\nimport \"./i18n\";\n","import { Hooks, Logger } from \"/server/api\";\nimport { Migrations } from \"meteor/percolate:migrations\";\n\nfunction reactionLogger(opts) {\n  if ([\"warn\", \"info\", \"error\"].includes(opts.level)) {\n    Logger[opts.level](opts.message);\n  }\n}\n\nMigrations.config({\n  logger: reactionLogger,\n  log: true,\n  logIfLatest: false,\n  collectionName: \"Migrations\"\n});\n\nHooks.Events.add(\"afterCoreInit\", () => {\n  Migrations.migrateTo(\"latest\");\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Migrations\",\n  name: \"reaction-migrations\",\n  icon: \"fa fa-database\",\n  autoEnable: true,\n  settings: {},\n  registry: []\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { MongoInternals } from \"meteor/mongo\";\nimport { WebApp } from \"meteor/webapp\";\nimport { check } from \"meteor/check\";\nimport { Security } from \"meteor/ongoworks:security\";\nimport fetch from \"node-fetch\";\nimport {\n  FileDownloadManager,\n  FileRecord,\n  MeteorFileCollection,\n  RemoteUrlWorker,\n  TempFileStore,\n  TempFileStoreWorker\n} from \"@reactioncommerce/file-collections\";\nimport GridFSStore from \"@reactioncommerce/file-collections-sa-gridfs\";\nimport { Logger } from \"/server/api\";\nimport { MediaRecords } from \"/lib/collections\";\n\n// lazy loading sharp package\nlet sharp;\nasync function lazyLoadSharp() {\n  if (sharp) return;\n  sharp = await import(\"sharp\");\n}\n\nFileRecord.downloadEndpointPrefix = \"/assets/files\";\nFileRecord.absoluteUrlPrefix = Meteor.absoluteUrl();\n\n// 1024*1024*2 is the GridFSStore default chunk size, and 256k is default GridFS chunk size, but performs terribly\nconst gridFSStoresChunkSize = 1 * 1024 * 1024;\nconst mongodb = MongoInternals.NpmModules.mongodb.module;\nconst { db } = MongoInternals.defaultRemoteCollectionDriver().mongo;\n\n/**\n * @name imgTransforms\n * @constant {Array}\n * @property {string} name - transform name that will be used as GridFS name\n * @property {object|undefined} transform - object with image transform settings\n * @property {number} size - transform size, only one number needed for both width & height\n * @property {string} mod - transform modifier function call,\n * for example the `large` & `medium` image transforms want to preserve\n * the image's aspect ratio and resize based on the larger width or height\n * so we use the `max` Sharp modifier function.\n * Check out the {@link http://sharp.pixelplumbing.com/en/stable/|Sharp Docs} for more helper functions.\n * {@link http://sharp.pixelplumbing.com/en/stable/api-resize/#max|Sharp max()}\n * {@link http://sharp.pixelplumbing.com/en/stable/api-resize/#crop|Sharp crop()}\n * @property {string} format - output image format\n * @summary Defines all image transforms\n * Image files are resized to 4 different sizes:\n * 1. `large` - 1000px by 1000px - preserves aspect ratio\n * 2. `medium` - 600px by 600px - preserves aspect ratio\n * 3. `small` - 235px by 235px - crops to square - creates png version\n * 4. `thumbnail` - 100px by 100px - crops to square - creates png version\n */\nconst imgTransforms = [\n  { name: \"image\", transform: { size: 1600, mod: \"max\", format: \"jpg\", type: \"image/jpeg\" } },\n  { name: \"large\", transform: { size: 1000, mod: \"max\", format: \"jpg\", type: \"image/jpeg\" } },\n  { name: \"medium\", transform: { size: 600, mod: \"max\", format: \"jpg\", type: \"image/jpeg\" } },\n  { name: \"small\", transform: { size: 235, mod: \"crop\", format: \"png\", type: \"image/png\" } },\n  { name: \"thumbnail\", transform: { size: 100, mod: \"crop\", format: \"png\", type: \"image/png\" } }\n];\n\n/**\n * @function buildGFS\n * @param {object} imgTransform\n * @summary buildGFS returns a fresh GridFSStore instance from provided image transform settings.\n */\nconst buildGFS = ({ name, transform }) => (\n  new GridFSStore({\n    chunkSize: gridFSStoresChunkSize,\n    collectionPrefix: \"cfs_gridfs.\",\n    db,\n    mongodb,\n    name,\n    async transformWrite(fileRecord) {\n      if (!transform) return;\n\n      try {\n        await lazyLoadSharp();\n      } catch (error) {\n        Logger.warn(\"Problem lazy loading Sharp lib in image transformWrite\", error.message);\n      }\n\n      if (!sharp) {\n        Logger.warn(\"In transformWrite, sharp does not seem to be available\");\n        return;\n      }\n\n      const { size, mod, format, type } = transform;\n      // Need to update the content type and extension of the file info, too.\n      // The new size gets set correctly automatically by FileCollections package.\n      fileRecord.type(type, { store: name });\n      fileRecord.extension(format, { store: name });\n\n      // resizing image, adding mod, setting output format\n      return sharp().resize(size, size)[mod]().toFormat(format);\n    }\n  })\n);\n\n/**\n * @name stores\n * @constant {Array}\n * @summary Defines an array of GridFSStore by mapping the imgTransform settings over the buildGFS function\n */\nconst stores = imgTransforms.map(buildGFS);\n\n/**\n * @name tempStore\n * @type TempFileStore\n * @summary Defines the temporary store where chunked uploads from browsers go\n * initially, until the chunks are eventually combined into one complete file\n * which the worker will then store to the permanant stores.\n * @see https://github.com/reactioncommerce/reaction-file-collections\n */\nconst tempStore = new TempFileStore({\n  shouldAllowRequest(req) {\n    const { type } = req.uploadMetadata;\n    if (typeof type !== \"string\" || !type.startsWith(\"image/\")) {\n      Logger.info(`shouldAllowRequest received request to upload file of type \"${type}\" and denied it`);\n      return false;\n    }\n    return true;\n  }\n});\nWebApp.connectHandlers.use(\"/assets/uploads\", (req, res) => {\n  req.baseUrl = \"/assets/uploads\"; // tus relies on this being set, which is an Express thing\n  tempStore.connectHandler(req, res);\n});\n\n/**\n * @name Media\n * @type MeteorFileCollection\n * @summary Defines the Media FileCollection\n * To learn how to further manipulate images with Sharp, refer to\n * {@link http://sharp.pixelplumbing.com/en/stable/|Sharp Docs}\n * @see https://github.com/reactioncommerce/reaction-file-collections\n */\nexport const Media = new MeteorFileCollection(\"Media\", {\n  allowInsert: (userId, doc) => Security.can(userId).insert(doc).for(MediaRecords).check(),\n  allowUpdate: (userId, id, modifier) => Security.can(userId).update(id, modifier).for(MediaRecords).check(),\n  allowRemove: (userId, id) => Security.can(userId).remove(id).for(MediaRecords).check(),\n  check,\n  collection: MediaRecords,\n  DDP: Meteor,\n  allowGet: () => true, // add more security here if the files should not be public\n  stores,\n  tempStore\n});\n\n// For backward-compatibility with code relying on how CFS did it, we'll put a\n// reference to the backing MongoDB collection on Media.files property as well.\nMedia.files = MediaRecords;\n\n/**\n * @name downloadManager\n * @type FileDownloadManager\n * @summary Set up a URL for downloading the files\n * @see https://github.com/reactioncommerce/reaction-file-collections\n */\nconst downloadManager = new FileDownloadManager({\n  collections: [Media],\n  headers: {\n    get: {\n      \"Cache-Control\": \"public, max-age=31536000\"\n    }\n  }\n});\nWebApp.connectHandlers.use(\"/assets/files\", downloadManager.connectHandler);\n\n/**\n * @name remoteUrlWorker\n * @type RemoteUrlWorker\n * @summary Start a worker to watch for inserted remote URLs and stream them to all stores\n * @see https://github.com/reactioncommerce/reaction-file-collections\n */\nconst remoteUrlWorker = new RemoteUrlWorker({ fetch, fileCollections: [Media] });\nremoteUrlWorker.start();\n\n/**\n * @name fileWorker\n * @type TempFileStoreWorker\n * @summary Start a worker to watch for finished uploads, store them permanantly,\n * and then remove the temporary file\n * @see https://github.com/reactioncommerce/reaction-file-collections\n */\nconst fileWorker = new TempFileStoreWorker({ fileCollections: [Media] });\nfileWorker.start();\n","import { Media } from \"./fileCollections\";\nimport \"./methods\";\n\nexport { Media };\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Hooks, Reaction } from \"/server/api\";\nimport { MediaRecords, Revisions } from \"/lib/collections\";\nimport { Media } from \"/imports/plugins/core/files/server\";\nimport { RevisionApi } from \"/imports/plugins/core/revisions/lib/api\";\n\n/**\n * @method updateMediaMetadata\n * @memberof media\n * @summary updates media record in revision control.\n * @param {String} fileRecordId - _id of updated file record.\n * @param {Object} metadata - metadata from updated media file.\n * @return {Boolean}\n */\nexport async function updateMediaMetadata(fileRecordId, metadata) {\n  check(fileRecordId, String);\n  check(metadata, Object);\n  if (RevisionApi.isRevisionControlEnabled()) {\n    if (metadata.productId) {\n      const existingRevision = Revisions.findOne({\n        \"documentId\": fileRecordId,\n        \"workflow.status\": {\n          $nin: [\n            \"revision/published\"\n          ]\n        }\n      });\n      if (existingRevision) {\n        const updatedMetadata = Object.assign({}, existingRevision.documentData, metadata);\n        // Special case where if we have both added and reordered images before publishing we don't want to overwrite\n        // the workflow status since it would be \"unpublished\"\n        if (existingRevision.documentData.workflow === \"published\" || existingRevision.changeType === \"insert\") {\n          updatedMetadata.workflow = \"published\";\n        }\n        Revisions.update({ _id: existingRevision._id }, {\n          $set: {\n            documentData: updatedMetadata\n          }\n        });\n        Hooks.Events.run(\"afterRevisionsUpdate\", Meteor.userId(), {\n          ...existingRevision,\n          documentData: updatedMetadata\n        });\n      } else {\n        Revisions.insert({\n          documentId: fileRecordId,\n          documentData: metadata,\n          documentType: \"image\",\n          parentDocument: metadata.productId,\n          changeType: \"update\",\n          workflow: {\n            status: \"revision/update\"\n          }\n        });\n      }\n\n      return false;\n    }\n  }\n  // for non-product images, just ignore and keep on moving\n  return true;\n}\n\n/**\n * @method insertMedia\n * @memberof media\n * @summary insert a new media record and add it to revision control.\n * @param {Object} fileRecord - document from file collection upload.\n * @return {String} - _id of the new inserted media record.\n */\nexport async function insertMedia(fileRecord) {\n  check(fileRecord, Object);\n  const mediaRecordId = await MediaRecords.insert(fileRecord);\n\n  if (RevisionApi.isRevisionControlEnabled() && fileRecord.metadata.workflow !== \"published\") {\n    if (fileRecord.metadata.productId) {\n      const revisionMetadata = Object.assign({}, fileRecord.metadata);\n      revisionMetadata.workflow = \"published\";\n      Revisions.insert({\n        documentId: mediaRecordId,\n        documentData: revisionMetadata,\n        documentType: \"image\",\n        parentDocument: fileRecord.metadata.productId,\n        changeType: \"insert\",\n        workflow: {\n          status: \"revision/update\"\n        }\n      });\n      MediaRecords.update({\n        _id: mediaRecordId\n      }, {\n        $set: {\n          \"metadata.workflow\": \"unpublished\"\n        }\n      });\n    } else {\n      MediaRecords.update({\n        _id: mediaRecordId\n      }, {\n        $set: {\n          \"metadata.workflow\": \"published\"\n        }\n      });\n    }\n  }\n\n  return mediaRecordId;\n}\n\n/**\n * @method removeMedia\n * @memberof media\n * @summary removes media file and updates record in revision control.\n * @param {String} fileRecordId - _id of file record to be deleted.\n * @return {Boolean}\n */\nexport async function removeMedia(fileRecordId) {\n  check(fileRecordId, String);\n  const { metadata } = MediaRecords.findOne({ _id: fileRecordId });\n  if (RevisionApi.isRevisionControlEnabled() && metadata.workflow && metadata.workflow === \"unpublished\") {\n    Revisions.remove({\n      documentId: fileRecordId\n    });\n    Media.remove(fileRecordId);\n    return true;\n  } else if (metadata.productId) {\n    Revisions.insert({\n      documentId: fileRecordId,\n      documentData: metadata,\n      documentType: \"image\",\n      parentDocument: metadata.productId,\n      changeType: \"remove\",\n      workflow: {\n        status: \"revision/update\"\n      }\n    });\n    return true;\n  }\n  return false;\n}\n\n/**\n * updateMediaPriorities\n * @summary sorting media by array indexes\n * @type {Method}\n * @param {String[]} sortedMediaIDs\n * @return {Boolean} true\n */\nexport function updateMediaPriorities(sortedMediaIDs) {\n  check(sortedMediaIDs, [String]);\n\n  if (!Reaction.hasPermission(\"createProduct\")) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  // Check to be sure product linked with each media belongs to the current user's current shop\n  const shopId = Reaction.getShopId();\n\n  const sortedMediaRecords = MediaRecords.find({\n    _id: { $in: sortedMediaIDs }\n  }).fetch();\n\n  sortedMediaRecords.forEach((mediaRecord) => {\n    if (!mediaRecord.metadata || mediaRecord.metadata.shopId !== shopId) {\n      throw new Meteor.Error(\"access-denied\", `Access Denied. No access to shop ${mediaRecord.metadata.shopId}`);\n    }\n  });\n\n  if (sortedMediaRecords.length !== sortedMediaIDs.length) {\n    throw new Meteor.Error(\"not-found\", \"At least one ID in sortedMediaIDs does not exist\");\n  }\n\n  sortedMediaIDs.forEach((_id, index) => {\n    MediaRecords.update({\n      _id\n    }, {\n      $set: {\n        \"metadata.priority\": index\n      }\n    });\n    const { metadata } = MediaRecords.findOne({ _id });\n    updateMediaMetadata(_id, metadata);\n  });\n\n  return true;\n}\n\nMeteor.methods({\n  \"media/insert\": insertMedia,\n  \"media/updatePriorities\": updateMediaPriorities,\n  \"media/remove\": removeMedia\n});\n","import \"./publications\";\nimport \"./methods\";\n","import { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { check } from \"meteor/check\";\nimport { Logs } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n *\n * @namespace Methods/Logging\n */\n\n/**\n * @name writeToLog\n * @method\n * @memberof Methods/Logging\n * @summary Writes a log entry into log\n * @param  {String} logType Type\n * @param  {String} logLevel Level\n * @param  {Object} logData Data\n * @param  {String} [source=\"client\"]\n * @return {null}\n */\nexport function writeToLog(logType, logLevel, logData, source = \"client\") {\n  check(logType, String);\n  check(logLevel, String);\n  check(logData, Object);\n\n  const logEntry = {\n    logType,\n    shopId: Reaction.getShopId(),\n    data: logData,\n    level: logLevel,\n    source\n  };\n  Logs.insert(logEntry);\n}\n\n/**\n * @name logging/logError\n * @method\n * @memberof Methods/Logging\n * @param  {String} logType Type\n * @param  {Object} logData Data\n * @return {null}\n */\nfunction logError(logType, logData) {\n  check(logType, String);\n  check(logData, Object);\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\"])) {\n    writeToLog(logType, \"error\", logData);\n  }\n}\n\n/**\n * @name logging/logWarning\n * @method\n * @memberof Methods/Logging\n * @param  {String} logType Type\n * @param  {Object} logData Data\n * @return {null}\n */\nfunction logWarning(logType, logData) {\n  check(logType, String);\n  check(logData, Object);\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\"])) {\n    writeToLog(logType, \"warn\", logData);\n  }\n}\n\nMeteor.methods({\n  \"logging/logError\": logError,\n  \"logging/logWarning\": logWarning\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Logs } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n\n/**\n * Publish logs\n * Poor admins get swamped with a ton of data so let's just only subscribe to one\n * logType at a time\n */\nMeteor.publish(\"Logs\", function (query, options) {\n  check(query, Match.OneOf(undefined, Object));\n  check(options, Match.OneOf(undefined, Object));\n\n  const shopId = Reaction.getShopId();\n  if (!query || !query.logType || !shopId) {\n    return this.ready();\n  }\n\n  const { logType } = query;\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\"])) {\n    Counts.publish(this, \"logs-count\", Logs.find({ shopId, logType }));\n    return Logs.find({ shopId, logType }, { sort: { date: 1 } });\n  }\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Logging\",\n  name: \"reaction-logging\",\n  autoEnable: true\n});\n","import SimpleSchema from \"simpl-schema\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections/schemas\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* Discount Codes Schema\n* @type {Object}\n* @desc schema that extends discount schema\n* with properties for discount codes.\n*/\nexport const DiscountCodes = Discounts.clone().extend({\n  \"discountMethod\": {\n    label: \"Method\",\n    type: String,\n    defaultValue: \"code\"\n  },\n  \"calculation.method\": {\n    type: String,\n    index: 1,\n    defaultValue: \"discount\"\n  },\n  \"code\": {\n    label: \"Discount Code\",\n    type: String\n  },\n  \"conditions.redemptionLimit\": {\n    type: SimpleSchema.Integer,\n    label: \"Total Limit\",\n    optional: true\n  },\n  \"conditions.accountLimit\": {\n    type: SimpleSchema.Integer,\n    label: \"Account Limit\",\n    defaultValue: 1,\n    optional: true\n  }\n});\n\nregisterSchema(\"DiscountCodes\", DiscountCodes);\n","import { DiscountsPackageConfig } from \"/imports/plugins/core/discounts/lib/collections/schemas\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* Discount Codes Package Config Schema\n* @type {Object}\n* @desc schema that extends discount schema\n* with properties for discount rates.\n*/\nexport const DiscountCodesPackageConfig = DiscountsPackageConfig.clone().extend({\n  \"settings.codes\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.codes.enabled\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  }\n});\n\nregisterSchema(\"DiscountCodesPackageConfig\", DiscountCodesPackageConfig);\n","export * from \"./config\";\nexport * from \"./codes\";\n","import { Meteor } from \"meteor/meteor\";\nimport { Cart } from \"/lib/collections\";\nimport { MethodHooks } from \"/server/api\";\n\n// this hook runs before a cart is converted to an order\n// it looks at any discounts that have been applied to the cart\n// and updates the discount document with a transaction history\nMethodHooks.before(\"cart/copyCartToOrder\", (options) => {\n  const cartId = options.arguments[0];\n  const cart = Cart.findOne(cartId);\n  // record that discounts have been applied to order\n  if (cart && cart.billing) {\n    for (const billing of cart.billing) {\n      // TODO should we enable transactions for rates as well?\n      if (billing.paymentMethod && billing.paymentMethod.processor === \"code\") {\n        Meteor.call(\"discounts/transaction\", cartId, billing.paymentMethod.id);\n      }\n    }\n  }\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./methods\";\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport { Reaction, Hooks } from \"/server/api\";\nimport { Cart } from \"/lib/collections\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections\";\nimport { DiscountCodes as DiscountSchema } from \"../../lib/collections/schemas\";\n\n// attach discount code specific schema\nDiscounts.attachSchema(DiscountSchema, { selector: { discountMethod: \"code\" } });\n\n//\n// make all discount methods available\n//\nexport const methods = {\n  /**\n   * discounts/codes/discount\n   * calculates percentage off discount rates\n   * we intentionally passed ids, instead\n   * of the cart,discount Object\n   * for a smaller request providing an\n   * additional level of validation.\n   * @param  {String} cartId cartId\n   * @param  {String} discountId discountId\n   * @return {Number} returns discount total\n   */\n  \"discounts/codes/discount\"(cartId, discountId) {\n    check(cartId, String);\n    check(discountId, String);\n    let discount = 0;\n    const discountMethod = Discounts.findOne(discountId);\n    const cart = Cart.findOne(cartId);\n\n    for (const item of cart.items) {\n      const preDiscount = item.quantity * item.variants.price;\n      discount += preDiscount * discountMethod.discount / 100;\n    }\n\n    return discount;\n  },\n  /**\n   * TODO discounts/codes/credit\n   * calculates a credit off cart\n   * for discount codes\n   * @param  {String} cartId cartId\n   * @param  {String} discountId discountId\n   * @return {Number} returns discount total\n   */\n  \"discounts/codes/credit\"(cartId, discountId) {\n    check(cartId, String);\n    check(discountId, String);\n    let discount = 0;\n    const discountMethod = Discounts.findOne(discountId);\n    ({ discount } = discountMethod);\n    return discount;\n  },\n  /**\n   * TODO discounts/codes/sale\n   * calculates a new price for an item\n   * @param  {String} cartId cartId\n   * @param  {String} discountId discountId\n   * @return {Number} returns discount total\n   */\n  \"discounts/codes/sale\"(cartId, discountId) {\n    check(cartId, String);\n    check(discountId, String);\n    let discount = 0;\n    const discountMethod = Discounts.findOne(discountId);\n    const cart = Cart.findOne(cartId);\n\n    // TODO add item specific conditions to sale calculations.\n    for (const item of cart.items) {\n      const preDiscountItemTotal = item.quantity * item.variants.price;\n      const salePriceItemTotal = item.quantity * discountMethod.discount;\n      // we if the sale is below 0, we won't discount at all. that's invalid.\n      discount += Math.max(0, preDiscountItemTotal - salePriceItemTotal);\n    }\n\n    return discount;\n  },\n  /**\n   * TODO discounts/codes/shipping\n   * calculates a discount based on the value\n   * of a calculated shipping rate in the cart.\n   * @param  {String} cartId cartId\n   * @param  {String} discountId discountId\n   * @return {Number} returns discount total\n   */\n  \"discounts/codes/shipping\"(cartId, discountId) {\n    check(cartId, String);\n    check(discountId, String);\n    let discount = 0;\n    const discountMethod = Discounts.findOne(discountId);\n    const cart = Cart.findOne(cartId);\n    if (cart.shipping && cart.shipping.length) {\n      for (const shipping of cart.shipping) {\n        if (shipping.shipmentMethod && shipping.shipmentMethod.name.toUpperCase() === discountMethod.discount.toUpperCase()) {\n          discount += Math.max(0, shipping.shipmentMethod.rate);\n        }\n      }\n    }\n    return discount;\n  },\n\n  /**\n   * @name discounts/addCode\n   * @method\n   * @param  {Object} doc A Discounts document to be inserted\n   * @param  {String} [docId] DEPRECATED. Existing ID to trigger an update. Use discounts/editCode method instead.\n   * @return {String} Insert result\n   */\n  \"discounts/addCode\"(doc, docId) {\n    check(doc, Object); // actual schema validation happens during insert below\n\n    // Backward compatibility\n    check(docId, Match.Optional(String));\n    if (docId) return Meteor.call(\"discounts/editCode\", { _id: docId, modifier: doc });\n\n    if (!Reaction.hasPermission(\"discount-codes\")) throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    return Discounts.insert(doc);\n  },\n\n  /**\n   * @name discounts/editCode\n   * @method\n   * @param  {Object} details An object with _id and modifier props\n   * @return {String} Update result\n   */\n  \"discounts/editCode\"(details) {\n    check(details, {\n      _id: String,\n      modifier: Object // actual schema validation happens during update below\n    });\n    if (!Reaction.hasPermission(\"discount-codes\")) throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    const { _id, modifier } = details;\n    return Discounts.update(_id, modifier);\n  },\n\n  /**\n   * discounts/codes/remove\n   * removes discounts that have been previously applied\n   * to a cart.\n   * @param  {String} id cart id of which to remove a code\n   * @param  {String} codeId discount Id from cart.billing\n   * @param  {String} collection collection (either Orders or Cart)\n   * @return {String} returns update/insert result\n   */\n  \"discounts/codes/remove\"(id, codeId, collection = \"Cart\") {\n    check(id, String);\n    check(codeId, String);\n    check(collection, String);\n    const Collection = Reaction.Collections[collection];\n    //\n    // delete code from cart\n    //\n    const cart = Collection.findOne(id);\n    let hasInvoice = false;\n    let currentDiscount = 0;\n    for (const billing of cart.billing) {\n      if (billing.paymentMethod && billing.paymentMethod.processor === \"code\" && billing._id !== codeId) {\n        currentDiscount += parseFloat(billing.paymentMethod.amount);\n      }\n      if (billing.paymentMethod && billing.invoice) {\n        hasInvoice = true;\n      }\n    }\n    // only if this is an order\n    if (hasInvoice) {\n      const selector = {\n        \"_id\": id,\n        \"billing._id\": cart.billing[0]._id\n      };\n      const update = {\n        $set: {\n          \"billing.$.invoice.discounts\": currentDiscount\n        }\n      };\n      Collection.update(selector, update);\n    }\n    // TODO: update a history record of transaction\n    const result = Collection.update(\n      { _id: id },\n      { $set: { discount: currentDiscount }, $pull: { billing: { _id: codeId } } },\n      { multi: true }\n    );\n\n    // calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", id);\n\n    return result;\n  },\n  /**\n   * discounts/codes/apply\n   * checks validity of code conditions and then\n   * applies a discount as a paymentMethod to cart\n   * @param  {String} id cart/order id of which to remove a code\n   * @param  {String} code valid discount code\n   * @param  {String} collection collection (either Orders or Cart)\n   * @return {Boolean} returns true if successfully applied\n   */\n  \"discounts/codes/apply\"(id, code, collection = \"Cart\") {\n    check(id, String);\n    check(code, String);\n    check(collection, String);\n    let userCount = 0;\n    let orderCount = 0;\n\n    // TODO: further expand to meet all condition rules\n    // const conditions = {\n    //   enabled: true\n    // };\n\n    // check to ensure discounts can only apply to single shop carts\n    // TODO: Remove this check after implementation of shop-by-shop discounts\n    const Collection = Reaction.Collections[collection];\n    const objectToApplyDiscount = Collection.findOne({ _id: id });\n    const items = objectToApplyDiscount && objectToApplyDiscount.items;\n    // loop through all items and filter down to unique shops (in order to get participating shops in the order/cart)\n    const uniqueShopObj = items.reduce((shopObj, item) => {\n      if (!shopObj[item.shopId]) {\n        shopObj[item.shopId] = true;\n      }\n      return shopObj;\n    }, {});\n    const participatingShops = Object.keys(uniqueShopObj);\n\n    if (participatingShops.length > 1) {\n      throw new Meteor.Error(\"not-implemented\", \"discounts.multiShopError\", \"Discounts cannot be applied to a multi-shop cart or order\");\n    }\n\n    // TODO: add  conditions: conditions\n    const discount = Discounts.findOne({ code });\n\n    // TODO: check usage limit\n    // don't apply if cart has exceeded usage limit\n    // will also need to check all time usage.\n    // which means storing the use data with the Discounts\n    // or searching all user's order history\n    // and if a user cancels an order,\n    // is the discount now re-activated\n\n    if (discount) {\n      const { conditions } = discount;\n      let accountLimitExceeded = false;\n      let discountLimitExceeded = false;\n\n      // existing usage count\n      if (discount.transactions) {\n        const users = Array.from(discount.transactions, (t) => t.userId);\n        const transactionCount = new Map([...new Set(users)].map((x) => [x, users.filter((y) => y === x).length]));\n        const orders = Array.from(discount.transactions, (t) => t.cartId);\n        userCount = transactionCount.get(Meteor.userId());\n        orderCount = orders.length;\n      }\n      // check limits\n      if (conditions) {\n        if (conditions.accountLimit) accountLimitExceeded = conditions.accountLimit <= userCount;\n        if (conditions.redemptionLimit) discountLimitExceeded = conditions.redemptionLimit <= orderCount;\n      }\n\n      // validate basic limit handling\n      if (accountLimitExceeded === true || discountLimitExceeded === true) {\n        return { i18nKeyLabel: \"Code is expired\", i18nKey: \"discounts.codeIsExpired\" };\n      }\n\n      // save to payment methods\n      // and update status in Discounts\n      // payment methods can be debit or credit.\n      const paymentMethod = {\n        id: discount._id,\n        processor: discount.discountMethod,\n        method: discount.calculation.method,\n        code: discount.code,\n        transactionId: Random.id(),\n        amount: discount.discount, // pre-process to amount.\n        status: \"created\"\n      };\n      return Meteor.call(\"payments/apply\", id, paymentMethod, collection);\n    }\n  }\n};\n\n// export methods to Meteor\nMeteor.methods(methods);\n","import { Mongo } from \"meteor/mongo\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * Discounts\n * @type {Publication}\n * @param {Object} query\n * @param {Object} options\n */\nMeteor.publish(\"DiscountCodes\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  // check shopId\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  const select = query || {};\n  // append shopId to query\n  select.shopId = shopId;\n  // select.cartId = cartId;\n  if (!select.discountMethod) {\n    select.discountMethod = \"code\";\n  }\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"discount-codes-count\", Discounts.find(\n    select,\n    options\n  ));\n\n  // Publishing our Discounts to a client side collection \"DiscountCodes\"\n  Mongo.Collection._publishCursor(Discounts.find(select, options), this, \"DiscountCodes\");\n\n  return this.ready();\n});\n","import { Security } from \"meteor/ongoworks:security\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n//\n// Security definitions\n//\nSecurity.permit([\"read\", \"insert\", \"update\", \"remove\"]).collections([\n  Discounts\n]).ifHasRole({\n  role: \"discount-codes\",\n  group: Reaction.getShopId()\n});\n","import \"./publications/discounts\";\nimport \"./security/discounts\";\nimport \"./i18n\";\nimport \"./methods\";\nimport \"./hooks/orders\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Codes\",\n  name: \"discount-codes\",\n  icon: \"fa fa-gift\",\n  autoEnable: true,\n  settings: {\n    \"discount-codes\": {\n      enabled: false\n    }\n  },\n  registry: [\n    {\n      label: \"Codes\",\n      provides: [\"paymentSettings\"],\n      template: \"customDiscountCodes\"\n    }, {\n      provides: [\"paymentMethod\"],\n      template: \"discountCodesCheckout\"\n    }\n  ]\n});\n","import { DiscountsPackageConfig } from \"/imports/plugins/core/discounts/lib/collections/schemas\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* Discount Rates Package Config Schema\n* @type {Object}\n* @desc schema that extends discount schema\n* with properties for discount rates.\n*/\nexport const DiscountRatesPackageConfig = DiscountsPackageConfig.clone().extend({\n  \"settings.rates\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.rates.enabled\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  }\n});\n\nregisterSchema(\"DiscountRatesPackageConfig\", DiscountRatesPackageConfig);\n","export * from \"./config\";\nexport * from \"./rates\";\n","import { Discounts } from \"/imports/plugins/core/discounts/lib/collections/schemas/discounts\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n* Discount Codes Schema\n* @type {Object}\n* @desc schema that extends discount schema\n* with properties for discount codes.\n*/\nexport const DiscountRates = Discounts.clone().extend({\n  discountMethod: {\n    label: \"Calculation Method\",\n    type: String,\n    defaultValue: \"rate\"\n  }\n});\n\nregisterSchema(\"DiscountRates\", DiscountRates);\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./methods\";\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections\";\nimport { DiscountRates as DiscountSchema } from \"../../lib/collections/schemas\";\n\n// attach discount code specific schema\nDiscounts.attachSchema(DiscountSchema, { selector: { discountMethod: \"rate\" } });\n\n//\n// make all discount methods available\n//\nexport const methods = {\n  /**\n   * discounts/rates/amount\n   * for discount rates\n   * @param  {String} cartId cartId\n   * @param  {String} rateId rateid\n   * @return {Number} returns discount total\n   */\n  \"discounts/rates/amount\"(cartId, rateId) {\n    check(cartId, String);\n    check(rateId, String);\n    const rate = 0;\n    // TODO: discounts/rates/amount\n    // should be pricing rate lookup.\n    return rate;\n  },\n\n  \"discounts/rates/discount\"(cartId, rateId) {\n    check(cartId, String);\n    check(rateId, String);\n    const rate = 0;\n    // TODO: discounts/rates/discount\n    return rate;\n  },\n\n  /**\n   * @name discounts/addRate\n   * @method\n   * @param  {Object} doc A Discounts document to be inserted\n   * @param  {String} [docId] DEPRECATED. Existing ID to trigger an update. Use discounts/editCode method instead.\n   * @return {String} Insert result\n   */\n  \"discounts/addRate\"(doc, docId) {\n    check(doc, Object); // actual schema validation happens during insert below\n\n    // Backward compatibility\n    check(docId, Match.Optional(String));\n    if (docId) return Meteor.call(\"discounts/editRate\", { _id: docId, modifier: doc });\n\n    if (!Reaction.hasPermission(\"discount-rates\")) throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    return Discounts.insert(doc);\n  },\n\n  /**\n   * @name discounts/editRate\n   * @method\n   * @param  {Object} details An object with _id and modifier props\n   * @return {String} Update result\n   */\n  \"discounts/editRate\"(details) {\n    check(details, {\n      _id: String,\n      modifier: Object // actual schema validation happens during update below\n    });\n    if (!Reaction.hasPermission(\"discount-rates\")) throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    const { _id, modifier } = details;\n    return Discounts.update(_id, modifier);\n  }\n};\n\n// export methods to Meteor\nMeteor.methods(methods);\n","import { Mongo } from \"meteor/mongo\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * Discounts\n * @type {Publication}\n * @param {Object} query\n * @param {Object} options\n */\nMeteor.publish(\"DiscountRates\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  // check shopId\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  const select = query || {};\n  // append shopId to query\n  select.shopId = shopId;\n\n  if (!select.discountMethod) {\n    select.discountMethod = \"rate\";\n  }\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"discount-rates-count\", Discounts.find(\n    select,\n    options\n  ));\n\n  // Publishing our Discounts to a client side collection \"DiscountRates\"\n  Mongo.Collection._publishCursor(Discounts.find(select, options), this, \"DiscountRates\");\n\n  return this.ready();\n});\n","import { Security } from \"meteor/ongoworks:security\";\nimport { Discounts } from \"/imports/plugins/core/discounts/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n//\n// Security definitions\n//\nSecurity.permit([\"read\", \"insert\", \"update\", \"remove\"]).collections([\n  Discounts\n]).ifHasRole({\n  role: \"discount-rates\",\n  group: Reaction.getShopId()\n});\n","import \"./publications/discounts\";\nimport \"./security/discounts\";\nimport \"./i18n\";\nimport \"./methods\";\n","export * from \"./search\";\n","import SimpleSchema from \"simpl-schema\";\nimport { PackageConfig } from \"/lib/collections/schemas/registry\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\nexport const SearchPackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.products\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.products.includes\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.products.weights\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.products.includes.title\": {\n    type: Boolean,\n    defaultValue: true,\n    label: \"Include title\"\n  },\n  \"settings.products.weights.title\": {\n    type: SimpleSchema.Integer,\n    label: \"Title weight\",\n    defaultValue: 10,\n    max: 10,\n    min: 1\n  },\n  \"settings.products.includes.description\": {\n    type: Boolean,\n    label: \"Include description\",\n    defaultValue: true\n  },\n  \"settings.products.weights.description\": {\n    type: SimpleSchema.Integer,\n    label: \"Desc. weight\",\n    defaultValue: 5,\n    max: 10,\n    min: 1\n  },\n  \"settings.products.includes.pageTitle\": {\n    type: Boolean,\n    label: \"Include page title\",\n    defaultValue: false\n  },\n  \"settings.products.weights.pageTitle\": {\n    type: SimpleSchema.Integer,\n    label: \"Page title weight\",\n    defaultValue: 2,\n    max: 10,\n    min: 1\n  },\n  \"settings.products.includes.metafields\": {\n    type: Boolean,\n    label: \"Include details\",\n    defaultValue: true\n  },\n  \"settings.products.weights.metafields\": {\n    type: SimpleSchema.Integer,\n    label: \"Details weight\",\n    defaultValue: 6,\n    max: 10,\n    min: 1\n  },\n  \"settings.products.includes.vendor\": {\n    type: Boolean,\n    label: \"Include vendor\",\n    defaultValue: true\n  },\n  \"settings.products.weights.vendor\": {\n    type: SimpleSchema.Integer,\n    label: \"Vendor weight\",\n    defaultValue: 6,\n    max: 10,\n    min: 1\n  }\n});\n\nregisterSchema(\"SearchPackageConfig\", SearchPackageConfig);\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Products, ProductSearch, OrderSearch, AccountSearch } from \"/lib/collections\";\nimport {\n  getSearchParameters,\n  buildAccountSearchRecord,\n  buildOrderSearchRecord,\n  buildProductSearchRecord\n} from \"../methods/searchcollections\";\nimport { Hooks, Logger } from \"/server/api\";\n\nHooks.Events.add(\"afterAccountsInsert\", (userId, accountId) => {\n  if (AccountSearch && !Meteor.isAppTest) {\n    // Passing forceIndex will run account search index even if\n    // updated fields don't match a searchable field\n    buildAccountSearchRecord(accountId, [\"forceIndex\"]);\n  }\n});\n\nHooks.Events.add(\"afterAccountsRemove\", (userId, accountId) => {\n  if (AccountSearch && !Meteor.isAppTest) {\n    AccountSearch.remove(accountId);\n  }\n});\n\nHooks.Events.add(\"afterAccountsUpdate\", (userId, updateData) => {\n  const { accountId, updatedFields } = updateData;\n\n  if (AccountSearch && !Meteor.isAppTest) {\n    buildAccountSearchRecord(accountId, updatedFields);\n  }\n});\n\n\n// NOTE: this hooks does not seemed to get fired, are there is no way\n// to delete an order, only cancel.\n// TODO: Verify the assumption above.\n// Orders.after.remove((userId, doc) => {\n//   if (OrderSearch && !Meteor.isAppTest) {\n//     OrderSearch.remove(doc._id);\n//   }\n// });\n\nHooks.Events.add(\"afterOrderInsert\", (doc) => {\n  if (OrderSearch && !Meteor.isAppTest) {\n    const orderId = doc._id;\n    buildOrderSearchRecord(orderId);\n  }\n\n  return doc;\n});\n\nHooks.Events.add(\"afterUpdateOrderUpdateSearchRecord\", (order) => {\n  if (OrderSearch && !Meteor.isAppTest) {\n    const orderId = order._id;\n    OrderSearch.remove(orderId);\n    buildOrderSearchRecord(orderId);\n  }\n});\n\n/**\n * if product is removed, remove product search record\n */\nHooks.Events.add(\"afterRemoveProduct\", (doc) => {\n  if (ProductSearch && !Meteor.isAppTest && doc.type === \"simple\") {\n    const productId = doc._id;\n    ProductSearch.remove(productId);\n    Logger.debug(`Removed product ${productId} from ProductSearch collection`);\n  }\n\n  return doc;\n});\n\n/**\n* after product update rebuild product search record\n*/\nHooks.Events.add(\"afterUpdateCatalogProduct\", (doc, options) => {\n  // Find the most recent version of the product document based on\n  // the passed in doc._id\n  const productDocument = Products.findOne({\n    _id: doc._id\n  });\n\n  // If this hook is ran without options, then this callback\n  // should no be executed.\n  if (!options) {\n    return productDocument;\n  }\n\n  const { modifier: { $set: allProps } } = options;\n  const topLevelFieldNames = Object.getOwnPropertyNames(allProps);\n\n  if (ProductSearch && !Meteor.isAppTest && productDocument.type === \"simple\") {\n    const productId = productDocument._id;\n    const { fieldSet } = getSearchParameters();\n    const modifiedFields = _.intersection(fieldSet, topLevelFieldNames);\n    if (modifiedFields.length) {\n      Logger.debug(`Rewriting search record for ${productDocument.title}`);\n      ProductSearch.remove(productId);\n      if (!productDocument.isDeleted) { // do not create record if product was archived\n        buildProductSearchRecord(productId);\n      }\n    } else {\n      Logger.debug(\"No watched fields modified, skipping\");\n    }\n  }\n\n  return productDocument;\n});\n\n/**\n * after insert\n * @summary should fires on create new variants, on clones products/variants\n */\nHooks.Events.add(\"afterInsertProduct\", (doc) => {\n  if (ProductSearch && !Meteor.isAppTest && doc.type === \"simple\") {\n    const productId = doc._id;\n    buildProductSearchRecord(productId);\n    Logger.debug(`Added product ${productId} to ProductSearch`);\n  }\n\n  return doc;\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Jobs, ProductSearch, Orders, OrderSearch, AccountSearch } from \"/lib/collections\";\nimport { Hooks, Logger } from \"/server/api\";\nimport {\n  buildAccountSearch,\n  buildEmptyProductSearch,\n  buildOrderSearch,\n  buildProductSearch,\n  rebuildProductSearchIndex\n} from \"../methods/\";\n\n\nfunction addBuildProductSearchCollection() {\n  const productSearchCount = ProductSearch.find({}).count();\n  if (!productSearchCount) {\n    Logger.debug(\"No ProductSearch records found. Adding build ProductSearch Collection to jobs\");\n    new Job(Jobs, \"product/buildSearchCollection\", {})\n      .priority(\"normal\")\n      .retry({\n        retries: 5,\n        wait: 60000,\n        backoff: \"exponential\"\n      })\n      .save({\n        cancelRepeats: true\n      });\n  } else {\n    Logger.debug(\"ProductSearch collection already exists, not building\");\n  }\n}\n\nfunction addBuildOrderSearchCollection() {\n  const orderSearchCount = OrderSearch.find({}).count();\n  const orderCount = Orders.find({}).count();\n  if (!orderSearchCount && orderCount) {\n    Logger.debug(\"No OrderSearch records found. Adding build OrderSearch Collection to jobs\");\n    new Job(Jobs, \"order/buildSearchCollection\", {})\n      .priority(\"normal\")\n      .retry({\n        retries: 5,\n        wait: 60000,\n        backoff: \"exponential\"\n      })\n      .save({\n        cancelRepeats: true\n      });\n  } else {\n    Logger.debug(\"OrderSearch collection already exists (or no orders), not building\");\n  }\n}\n\nfunction addBuildAccountSearchCollection() {\n  const accountSearchCount = AccountSearch.find({}).count();\n  if (!accountSearchCount) {\n    Logger.debug(\"No AccountSearch records found. Adding build AccountSearch Collection to jobs\");\n    new Job(Jobs, \"account/buildSearchCollection\", {})\n      .priority(\"normal\")\n      .retry({\n        retries: 5,\n        wait: 60000,\n        backoff: \"exponential\"\n      })\n      .save({\n        cancelRepeats: true\n      });\n  } else {\n    Logger.debug(\"AccountSearch collection already exists, not building\");\n  }\n}\n\nHooks.Events.add(\"afterCoreInit\", () => {\n  if (!Meteor.isAppTest) {\n    buildEmptyProductSearch();\n    addBuildProductSearchCollection();\n    addBuildOrderSearchCollection();\n    addBuildAccountSearchCollection();\n  }\n});\n\n\nexport default function () {\n  Jobs.processJobs(\n    \"product/buildSearchCollection\",\n    {\n      pollInterval: 30 * 1000,\n      workTimeout: 180 * 1000\n    },\n    (job, callback) => {\n      Logger.debug(\"(re)build ProductSearch collection running\");\n      buildProductSearch((error) => {\n        if (error) {\n          job.done(error.toString(), { repeatId: true });\n          callback();\n        } else {\n          const success = \"ProductSearch collection (re)built successfully.\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n          callback();\n        }\n      });\n    }\n  );\n\n  Jobs.processJobs(\n    \"product/buildSearchIndex\",\n    {\n      pollInterval: 30 * 1000,\n      workTimeout: 180 * 1000\n    },\n    (job, callback) => {\n      Logger.debug(\"(re)build ProductSearch index running\");\n      rebuildProductSearchIndex((error) => {\n        if (error) {\n          job.done(error.toString(), { repeatId: true });\n          callback();\n        } else {\n          const success = \"ProductSearch Index (re)built successfully.\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n          callback();\n        }\n      });\n    }\n  );\n\n  Jobs.processJobs(\n    \"order/buildSearchCollection\",\n    {\n      pollInterval: 30 * 1000,\n      workTimeout: 180 * 1000\n    },\n    (job, callback) => {\n      Logger.debug(\"(re)build OrderSearch index running\");\n      buildOrderSearch((error) => {\n        if (error) {\n          job.done(error.toString(), { repeatId: true });\n          callback();\n        } else {\n          const success = \"OrderSearch collection (re)built successfully.\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n          callback();\n        }\n      });\n    }\n  );\n\n  Jobs.processJobs(\n    \"account/buildSearchCollection\",\n    {\n      pollInterval: 30 * 1000,\n      workTimeout: 180 * 1000\n    },\n    (job, callback) => {\n      Logger.debug(\"(re)build AccountSearch index running\");\n      buildAccountSearch((error) => {\n        if (error) {\n          job.done(error.toString(), { repeatId: true });\n          callback();\n        } else {\n          const success = \"AccountSearch collection (re)built successfully.\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n          callback();\n        }\n      });\n    }\n  );\n}\n","import \"./buildSearchCollections\";\n","import { Reaction } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\n\nconst utils = {\n  getPackageSettings() {\n    const searchPackage = Packages.findOne({\n      shopId: Reaction.getShopId(),\n      name: \"reaction-search\"\n    });\n    return searchPackage.settings;\n  }\n};\n\nexport default utils;\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Packages, Jobs } from \"/lib/collections\";\nimport { SearchPackageConfig } from \"../../lib/collections/schemas\";\nimport { Logger, Reaction } from \"/server/api\";\n\nfunction fieldsChanged(changedFields, fieldType = \"includes\") {\n  for (const field of changedFields) {\n    if (field.indexOf(fieldType) !== -1) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction weightsChanged(changedFields) {\n  return fieldsChanged(changedFields, \"weights\");\n}\n\nMeteor.methods({\n  /**\n   * @name search/updateSearchSettings\n   * @method\n   * @param  {Object} details An object with _id and modifier props\n   * @param  {String} [docId] DEPRECATED. The _id, if details is the modifier.\n   */\n  \"search/updateSearchSettings\"(details, docId) {\n    check(details, Object);\n\n    // Backward compatibility\n    check(docId, Match.Optional(String));\n    const id = docId || details._id;\n    const modifier = docId ? details : details.modifier;\n\n    check(id, String);\n    SearchPackageConfig.validate(modifier, { modifier: true });\n\n    const currentSettings = Packages.findOne(id);\n    const newSettingsArray = _.keys(modifier.$set);\n    const changedSettings = [];\n    for (const setting of newSettingsArray) {\n      const currentSetting = _.get(currentSettings, setting);\n      if (currentSetting !== modifier.$set[setting]) {\n        changedSettings.push(setting);\n      }\n    }\n    // must have core permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    let rebuildJob;\n    if (fieldsChanged(changedSettings)) {\n      Logger.debug(\"Fields have changed, we need to rebuild the ProductSearch Collection\");\n      // fields have changed, we need to rebuild entire Product Search Collection\n      rebuildJob = new Job(Jobs, \"product/buildSearchCollection\", {})\n        .priority(\"normal\")\n        .retry({\n          retries: 5,\n          wait: 60000,\n          backoff: \"exponential\" // delay by twice as long for each subsequent retry\n        })\n        .save({\n          // Cancel any jobs of the same type,\n          // but only if this job repeats forever.\n          cancelRepeats: true\n        });\n    } else if (weightsChanged(changedSettings)) {\n      // only weights have changed, we only need to build the index\n      Logger.debug(\"Weights have changed, we need to rebuild the ProductSearch index\");\n      rebuildJob = new Job(Jobs, \"product/buildSearchIndex\", {})\n        .priority(\"normal\")\n        .retry({\n          retries: 5,\n          wait: 60000,\n          backoff: \"exponential\"\n        })\n        .save({\n          // Cancel any jobs of the same type,\n          // but only if this job repeats forever.\n          cancelRepeats: true\n        });\n    }\n    Packages.update(id, modifier);\n    return rebuildJob;\n  }\n});\n","import \"./searchcollections\";\nimport \"./formHandler\";\n\nexport * from \"./searchcollections\";\n","/* eslint camelcase: 0 */\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { ProductSearch, OrderSearch, AccountSearch, Orders, Products, Accounts, Shops } from \"/lib/collections\";\nimport utils from \"./common\";\nimport { transformations } from \"./transformations\";\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\nconst requiredFields = {};\nrequiredFields.products = [\"_id\", \"hashtags\", \"shopId\", \"handle\", \"price\", \"isVisible\", \"isSoldOut\", \"isLowQuantity\", \"isBackorder\"];\nrequiredFields.orders = [\"_id\", \"shopId\", \"shippingName\", \"shippingPhone\", \"billingName\", \"userEmails\",\n  \"shippingAddress\", \"billingAddress\", \"shippingStatus\", \"billingStatus\", \"orderTotal\", \"orderDate\"];\nrequiredFields.accounts = [\"_id\", \"shopId\", \"emails\", \"profile\"];\n\n// https://docs.mongodb.com/manual/reference/text-search-languages/#text-search-languages\n// MongoDb supports a subset of languages for analysis of the text data which includes\n// things like stop words and stems. With this language support the quality of the search matches\n// and weighting increases, however without this search will still work and delivery good results.\n// We currently support the languages which are supported by Mongo by default but more languages\n// are available through custom configuration.\nconst supportedLanguages = [\"da\", \"nl\", \"en\", \"fi\", \"fr\", \"de\", \"hu\", \"it\", \"nb\", \"pt\", \"ro\", \"ru\", \"es\", \"sv\", \"tr\"];\n\n\nfunction filterFields(customFields) {\n  const fieldNames = [];\n  const fieldKeys = Object.keys(customFields);\n  for (const fieldKey of fieldKeys) {\n    if (customFields[fieldKey]) {\n      fieldNames.push(fieldKey);\n    }\n  }\n  return fieldNames;\n}\n\n// get the weights for all enabled fields\nfunction getScores(customFields, settings, collection = \"products\") {\n  const weightObject = {};\n  for (const weight of Object.keys(settings[collection].weights)) {\n    if (customFields.includes(weight)) {\n      weightObject[weight] = settings[collection].weights[weight];\n    }\n  }\n  return weightObject;\n}\n\nfunction getSearchLanguage() {\n  const shopId = Reaction.getShopId();\n  const shopLanguage = Shops.findOne(shopId).language;\n  if (supportedLanguages.includes(shopLanguage)) {\n    return { default_language: shopLanguage };\n  }\n  return { default_language: \"en\" };\n}\n\n/**\n * handleIndexUpdateFailures\n * When using Collection.rawCollection() methods that return a Promise,\n * handle the errors in a catch. However, ignore errors with altering indexes\n * before a collection exists.\n * @param  {Error} error an error object returned from a Promise rejection\n * @return {undefined}   doesn't return anything\n */\nfunction handleIndexUpdateFailures(error) {\n  // If we get an error from the Mongo driver because something tried to drop a\n  // collection before it existed, log it out as debug info.\n  // Otherwise, log whatever happened as an error.\n  if (error.name === \"MongoError\" && error.message === \"ns not found\") {\n    Logger.debug(error, \"Attempted to set or remove indexes in a Mongo collection that doesn't exist yet\");\n  } else {\n    Logger.error(error);\n  }\n}\n\nexport function getSearchParameters(collection = \"products\") {\n  const settings = utils.getPackageSettings();\n  const customFields = filterFields(settings[collection].includes);\n  const fieldSet = requiredFields[collection].concat(customFields);\n  const weightObject = getScores(customFields, settings);\n  return { fieldSet, weightObject, customFields };\n}\n\nexport function buildProductSearchRecord(productId) {\n  const product = Products.findOne(productId);\n  if (product.type === \"simple\") {\n    const { fieldSet } = getSearchParameters();\n    const productRecord = {};\n    for (const field of fieldSet) {\n      if (transformations.products[field]) {\n        productRecord[field] = transformations.products[field](product[field]);\n      } else {\n        productRecord[field] = product[field];\n      }\n    }\n    const productSearchRecord = ProductSearch.insert(productRecord);\n    ensureProductSearchIndex();\n    return productSearchRecord;\n  }\n  return undefined;\n}\n\nexport function buildProductSearch(cb) {\n  check(cb, Match.Optional(Function));\n  Logger.debug(\"Start (re)Building ProductSearch Collection\");\n  ProductSearch.remove({});\n  const { fieldSet, weightObject, customFields } = getSearchParameters();\n  const products = Products.find({ type: \"simple\" }).fetch();\n  for (const product of products) {\n    const productRecord = {};\n    for (const field of fieldSet) {\n      if (transformations.products[field]) {\n        productRecord[field] = transformations.products[field](product[field]);\n      } else {\n        productRecord[field] = product[field];\n      }\n    }\n    ProductSearch.insert(productRecord);\n  }\n  const indexObject = {};\n  for (const field of customFields) {\n    indexObject[field] = \"text\";\n  }\n\n  const rawProductSearchCollection = ProductSearch.rawCollection();\n  rawProductSearchCollection.dropIndexes().catch(handleIndexUpdateFailures);\n  rawProductSearchCollection.createIndex(indexObject, weightObject, getSearchLanguage()).catch(handleIndexUpdateFailures);\n  if (cb) {\n    cb();\n  }\n}\n\n// we build this immediately on startup so that search will not throw an error\nexport function buildEmptyProductSearch() {\n  const { weightObject, customFields } = getSearchParameters();\n  const indexObject = {};\n  for (const field of customFields) {\n    indexObject[field] = \"text\";\n  }\n  const rawProductSearchCollection = ProductSearch.rawCollection();\n  rawProductSearchCollection.dropIndexes().catch(handleIndexUpdateFailures);\n  rawProductSearchCollection.createIndex(indexObject, weightObject, getSearchLanguage()).catch(handleIndexUpdateFailures);\n}\n\nexport function rebuildProductSearchIndex(cb) {\n  check(cb, Match.Optional(Function));\n  const { customFields, weightObject } = getSearchParameters();\n  const indexObject = {};\n  for (const field of customFields) {\n    indexObject[field] = \"text\";\n  }\n  const rawProductSearchCollection = ProductSearch.rawCollection();\n  rawProductSearchCollection.dropIndexes().catch(handleIndexUpdateFailures);\n  rawProductSearchCollection.createIndex(indexObject, weightObject, getSearchLanguage()).catch(handleIndexUpdateFailures);\n  if (cb) {\n    cb();\n  }\n}\n\n// this only creates the index if it doesn't already exist, `ensureIndex` is deprecated\nexport function ensureProductSearchIndex() {\n  const { customFields, weightObject } = getSearchParameters();\n  const indexObject = {};\n  for (const field of customFields) {\n    indexObject[field] = \"text\";\n  }\n  const rawProductSearchCollection = ProductSearch.rawCollection();\n  rawProductSearchCollection.createIndex(indexObject, weightObject, getSearchLanguage()).catch(handleIndexUpdateFailures);\n}\n\nexport function buildOrderSearchRecord(orderId) {\n  const order = Orders.findOne(orderId);\n  const user = Meteor.users.findOne(order.userId);\n  const anonymousUserEmail = order.email;\n\n  const userEmails = [];\n  if (user && user.emails.length) {\n    for (const email of user.emails) {\n      userEmails.push(email.address);\n    }\n  } else if (anonymousUserEmail) {\n    userEmails.push(anonymousUserEmail);\n  }\n  const orderSearch = {};\n  for (const field of requiredFields.orders) {\n    if (transformations.orders[field]) {\n      orderSearch[field] = transformations.orders[field](order[field]);\n    } else {\n      orderSearch[field] = order[field];\n    }\n  }\n\n  // get the billing object for the current shop on the order (and not hardcoded [0])\n  const shopBilling = (order.billing && order.billing.find((billing) => billing && billing.shopId === Reaction.getShopId())) || {};\n\n  // get the shipping object for the current shop on the order (and not hardcoded [0])\n  const shopShipping = order.shipping.find((shipping) => shipping.shopId === Reaction.getShopId()) || {};\n\n  Promise.await(lazyLoadMoment());\n\n  orderSearch.billingName = shopBilling.address && shopBilling.address.fullName;\n  orderSearch.billingPhone = shopBilling.address && shopBilling.address.phone.replace(/\\D/g, \"\");\n  orderSearch.shippingName = shopShipping.address && shopShipping.address.fullName;\n  if (shopShipping.address && shopShipping.address.phone) {\n    orderSearch.shippingPhone = shopShipping.address && shopShipping.address.phone.replace(/\\D/g, \"\");\n  }\n\n  orderSearch.billingAddress = {\n    address: shopBilling.address && shopBilling.address.address1,\n    postal: shopBilling.address && shopBilling.address.postal,\n    city: shopBilling.address && shopBilling.address.city,\n    region: shopBilling.address && shopBilling.address.region,\n    country: shopBilling.address && shopBilling.address.country\n  };\n  orderSearch.shippingAddress = {\n    address: shopShipping.address && shopShipping.address.address1,\n    postal: shopShipping.address && shopShipping.address.postal,\n    city: shopShipping.address && shopShipping.address.city,\n    region: shopShipping.address && shopShipping.address.region,\n    country: shopShipping.address && shopShipping.address.country\n  };\n  orderSearch.userEmails = userEmails;\n  orderSearch.orderTotal = shopBilling.invoice && shopBilling.invoice.total;\n  orderSearch.orderDate = moment && moment(order.createdAt).format(\"YYYY/MM/DD\");\n  orderSearch.billingStatus = shopBilling.paymentMethod && shopBilling.paymentMethod.status;\n  orderSearch.billingCard = shopBilling.paymentMethod && shopBilling.paymentMethod.storedCard;\n  orderSearch.currentWorkflowStatus = order.workflow.status;\n  if (shopShipping.shipped) {\n    orderSearch.shippingStatus = \"Shipped\";\n  } else if (shopShipping.packed) {\n    orderSearch.shippingStatus = \"Packed\";\n  } else {\n    orderSearch.shippingStatus = \"New\";\n  }\n  orderSearch.product = {};\n  orderSearch.variants = {};\n  orderSearch.product.title = order.items.map((item) => item.product && item.product.title);\n  orderSearch.variants.title = order.items.map((item) => item.variants && item.variants.title);\n  orderSearch.variants.optionTitle = order.items.map((item) => item.variants && item.variants.optionTitle);\n\n  try {\n    OrderSearch.upsert(orderId, { $set: { ...orderSearch } });\n  } catch (error) {\n    Logger.error(error, \"Failed to add order to the OrderSearch collection\");\n  }\n}\n\nexport function buildOrderSearch(cb) {\n  check(cb, Match.Optional(Function));\n  const orders = Orders.find({}).fetch();\n  for (const order of orders) {\n    buildOrderSearchRecord(order._id);\n  }\n  const rawOrderSearchCollection = OrderSearch.rawCollection();\n  rawOrderSearchCollection.dropIndexes().catch(handleIndexUpdateFailures);\n  rawOrderSearchCollection.createIndex({\n    shopId: 1, shippingName: 1, billingName: 1, userEmails: 1\n  }).catch(handleIndexUpdateFailures);\n  if (cb) {\n    cb();\n  }\n}\n\nexport function buildAccountSearchRecord(accountId, updatedFields) {\n  Logger.debug(\"building account search record\");\n  check(accountId, String);\n  check(updatedFields, Array);\n\n  const account = Accounts.findOne(accountId);\n  // let's ignore anonymous accounts\n  if (account && account.emails && account.emails.length) {\n    const accountSearch = {};\n\n    // Not all required fields are used in search\n    // We need to filter through fields that are used,\n    // and only update the search index if one of those fields were updated\n    // forceIndex is included to forceIndexing on startup, or when manually added\n    const searchableFields = [\"forceIndex\", \"shopId\", \"emails\", \"firstName\", \"lastName\", \"phone\"];\n\n    const shouldRunIndex = updatedFields && updatedFields.some((field) => searchableFields.includes(field));\n\n    // If updatedFields contains one of the searchableFields, run the indexing\n    if (shouldRunIndex) {\n      AccountSearch.remove(accountId);\n      for (const field of requiredFields.accounts) {\n        if (transformations.accounts[field]) {\n          accountSearch[field] = transformations.accounts[field](account[field]);\n        } else {\n          accountSearch[field] = account[field];\n        }\n      }\n      AccountSearch.insert(accountSearch);\n    }\n  }\n}\n\nexport function buildAccountSearch(cb) {\n  check(cb, Match.Optional(Function));\n  AccountSearch.remove({});\n  const accounts = Accounts.find({}).fetch();\n  for (const account of accounts) {\n    // Passing forceIndex will run account search index even if\n    // updated fields don't match a searchable field\n    buildAccountSearchRecord(account._id, [\"forceIndex\"]);\n  }\n  const rawAccountSearchCollection = AccountSearch.rawCollection();\n  rawAccountSearchCollection.dropIndexes().catch(handleIndexUpdateFailures);\n  rawAccountSearchCollection.createIndex({ shopId: 1, emails: 1 }).catch(handleIndexUpdateFailures);\n  if (cb) {\n    cb();\n  }\n}\n","import _ from \"lodash\";\n\nexport const transformations = {};\ntransformations.products = {};\ntransformations.accounts = {};\ntransformations.orders = {};\n\ntransformations.products.metafields = function (fieldData) {\n  const values = [];\n  if (fieldData) {\n    for (const field of fieldData) {\n      values.push(field.value);\n    }\n  }\n  return values;\n};\n\ntransformations.accounts.emails = function (fieldData) {\n  const values = [];\n  if (fieldData) {\n    for (const email of fieldData) {\n      values.push(email.address);\n    }\n  }\n  return values;\n};\n\ntransformations.accounts.profile = function (fieldData) {\n  let profileObject;\n  if (fieldData && fieldData.addressBook && fieldData.addressBook[0] && fieldData.addressBook[0].fullName) {\n    profileObject = {\n      firstName: _.split(fieldData.addressBook[0].fullName, \" \")[0],\n      lastName: _.split(fieldData.addressBook[0].fullName, \" \")[1],\n      phone: _.replace(fieldData.addressBook[0].phone, /\\D/g, \"\")\n    };\n  }\n  return profileObject;\n};\n","import _ from \"lodash\";\nimport escapeStringRegex from \"escape-string-regexp\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { ProductSearch, OrderSearch, AccountSearch } from \"/lib/collections\";\n\nconst supportedCollections = [\"products\", \"orders\", \"accounts\"];\n\nfunction getProductFindTerm(searchTerm, searchTags, userId) {\n  const shopId = Reaction.getShopId();\n  const findTerm = {\n    shopId,\n    $text: { $search: searchTerm }\n  };\n  if (searchTags.length) {\n    findTerm.hashtags = { $all: searchTags };\n  }\n  if (!Roles.userIsInRole(userId, [\"admin\", \"owner\"], shopId)) {\n    findTerm.isVisible = true;\n  }\n  // Deletes the shopId field from \"findTerm\" for primary shop\n  // thereby allowing users on primary shop to search all products\n  if (shopId === Reaction.getPrimaryShopId()) {\n    delete findTerm.shopId;\n  }\n  return findTerm;\n}\n\nexport const getResults = {};\n\ngetResults.products = function (searchTerm, facets, maxResults, userId) {\n  const searchTags = facets || [];\n  const findTerm = getProductFindTerm(searchTerm, searchTags, userId);\n  const productResults = ProductSearch.find(\n    findTerm,\n    {\n      fields: {\n        score: { $meta: \"textScore\" },\n        title: 1,\n        hashtags: 1,\n        description: 1,\n        handle: 1,\n        price: 1,\n        isSoldOut: 1,\n        isLowQuantity: 1,\n        isBackorder: 1\n      },\n      sort: { score: { $meta: \"textScore\" } },\n      limit: maxResults\n    }\n  );\n  return productResults;\n};\n\ngetResults.orders = function (searchTerm, facets, maxResults, userId) {\n  let orderResults;\n  const regexSafeSearchTerm = escapeStringRegex(searchTerm);\n  const shopId = Reaction.getShopId();\n  const findTerm = {\n    $and: [\n      { shopId },\n      {\n        $or: [\n          {\n            _id: {\n              $regex: `^${regexSafeSearchTerm}`,\n              $options: \"i\"\n            }\n          },\n          {\n            userEmails: {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            shippingName: {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            billingName: {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            billingCard: {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            billingPhone: {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            shippingPhone: {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            \"product.title\": {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            \"variants.title\": {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          },\n          {\n            \"variants.optionTitle\": {\n              $regex: regexSafeSearchTerm,\n              $options: \"i\"\n            }\n          }\n        ]\n      }\n    ]\n  };\n  // Deletes the shopId field from \"findTerm\" for primary shop\n  // thereby allowing users on primary shop to search all products\n  if (shopId === Reaction.getPrimaryShopId()) {\n    delete findTerm.$and[0].shopId;\n  }\n  if (Reaction.hasPermission(\"orders\", userId)) {\n    orderResults = OrderSearch.find(findTerm, { limit: maxResults });\n    Logger.debug(`Found ${orderResults.count()} orders searching for ${regexSafeSearchTerm}`);\n  }\n  return orderResults;\n};\n\ngetResults.accounts = function (searchTerm, facets, maxResults, userId) {\n  let accountResults;\n  const shopId = Reaction.getShopId();\n  const searchPhone = _.replace(searchTerm, /\\D/g, \"\");\n  if (Reaction.hasPermission(\"reaction-accounts\", userId)) {\n    const findTerm = {\n      $and: [\n        { shopId },\n        {\n          $or: [\n            {\n              emails: {\n                $regex: searchTerm,\n                $options: \"i\"\n              }\n            },\n            {\n              \"profile.firstName\": {\n                $regex: `^${searchTerm}$`,\n                $options: \"i\"\n              }\n            },\n            {\n              \"profile.lastName\": {\n                $regex: `^${searchTerm}$`,\n                $options: \"i\"\n              }\n            },\n            {\n              \"profile.phone\": {\n                $regex: `^${searchPhone}$`,\n                $options: \"i\"\n              }\n            }\n          ]\n        }\n      ]\n    };\n    // Deletes the shopId field from \"findTerm\" for primary shop\n    // thereby allowing users on primary shop to search all products\n    if (shopId === Reaction.getPrimaryShopId()) {\n      delete findTerm.$and[0].shopId;\n    }\n    accountResults = AccountSearch.find(findTerm, {\n      limit: maxResults\n    });\n    Logger.debug(`Found ${accountResults.count()} accounts searching for ${searchTerm}`);\n  }\n  return accountResults;\n};\n\nMeteor.publish(\"SearchResults\", function (collection, searchTerm, facets, maxResults = 99) {\n  check(collection, String);\n  check(collection, Match.Where((coll) => _.includes(supportedCollections, coll)));\n  check(searchTerm, Match.Optional(String));\n  check(facets, Match.OneOf(Array, undefined));\n  Logger.debug(`Returning search results on ${collection}. SearchTerm: |${searchTerm}|. Facets: |${facets}|.`);\n  if (!searchTerm) {\n    return this.ready();\n  }\n  return getResults[collection](searchTerm, facets, maxResults, this.userId);\n});\n","import \"./publications/searchresults\";\nimport \"./hooks/search\";\nimport \"./jobs\";\nimport buildSearchCollectionJob from \"./jobs/buildSearchCollections\";\nimport \"./i18n\";\n\nexport * from \"./publications/searchresults\";\n\nbuildSearchCollectionJob();\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Search\",\n  name: \"reaction-search\",\n  icon: \"fa fa-search\",\n  autoEnable: true,\n  settings: {\n    products: {\n      includes: {\n        title: true,\n        description: true,\n        pageTitle: false,\n        metafields: true,\n        vendor: true\n      },\n      weights: {\n        title: 10,\n        description: 5,\n        pageTitle: 3,\n        metafields: 1,\n        vendor: 4\n      }\n    }\n  },\n  registry: [\n    // Dashboard card\n    {\n      provides: [\"dashboard\"],\n      label: \"Search\",\n      description: \"Search\",\n      icon: \"fa fa-search\",\n      priority: 2,\n      container: \"core\"\n    },\n    // Settings Panel\n    {\n      label: \"Search Settings\",\n      icon: \"fa fa-search\",\n      route: \"/dashboard/search\",\n      provides: [\"settings\"],\n      container: \"dashboard\",\n      template: \"searchSettings\"\n    }\n  ]\n});\n","export * from \"./shippo\";\n","import { PackageConfig } from \"/lib/collections/schemas/registry\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\nexport const ShippoPackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.apiKey\": {\n    type: String,\n    label: \"API Key\",\n    min: 10,\n    optional: true\n  }\n});\n\nregisterSchema(\"ShippoPackageConfig\", ShippoPackageConfig);\n","export const shippingRoles = [\"admin\", \"owner\", \"shipping\", \"reaction-shipping-rates\"];\n","/* eslint camelcase: 0 */\nimport SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\nexport const addressSchema = new SimpleSchema({\n  object_purpose: { type: String, allowedValues: [\"QUOTE\", \"PURCHASE\"] },\n  name: { type: String, optional: true },\n  company: { type: String, optional: true },\n  street1: { type: String, optional: true },\n  street_no: { type: String, optional: true }, // only needed for DHL , the others get it from street1\n  street2: { type: String, optional: true },\n  city: { type: String, optional: true },\n  state: { type: String, optional: true },\n  zip: { type: String, optional: true },\n  country: { type: String }, // maybe iso 2\n  phone: { type: String, optional: true },\n  email: { type: String, regEx: SimpleSchema.RegEx.Email, optional: true },\n  is_residential: { type: Boolean, optional: true },\n  validate: { type: Boolean, optional: true },\n  metadata: { type: String, optional: true }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"addressSchema\", addressSchema);\n\n// Overrides the properties required for purchasing labels/shipping.\n// we don't override the purpose because for some cases like getRatesForCart we don't want to\n// purchase Labels(purpose=\"QUOTE\" but we want all the fields required for purchasing to be present.\nexport const purchaseAddressSchema = addressSchema.clone().extend({\n  name: String,\n  street1: String,\n  city: String,\n  state: String,\n  zip: String,\n  phone: String,\n  email: {\n    type: String,\n    regEx: SimpleSchema.RegEx.Email,\n    optional: true\n  }\n});\n\nregisterSchema(\"purchaseAddressSchema\", purchaseAddressSchema);\n\nexport const parcelSchema = new SimpleSchema({\n  length: { type: Number, min: 0.0001 },\n  width: { type: Number, min: 0.0001 },\n  height: { type: Number, min: 0.0001 },\n  distance_unit: { type: String, allowedValues: [\"cm\", \"in\", \"ft\", \"mm\", \"m\", \"yd\"] },\n  weight: { type: Number, min: 0.0001 },\n  mass_unit: { type: String, allowedValues: [\"g\", \"oz\", \"lb\", \"kg\"] },\n  template: { type: String, optional: true },\n  extra: { type: Object, optional: true },\n  metadata: { type: String, optional: true }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"parcelSchema\", parcelSchema);\n","import \"./rates\";\nimport \"./tracking\";\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Shipping, Packages } from \"/lib/collections\";\nimport { Logger, Reaction, Hooks } from \"/server/api\";\n\n// callback ran on getShippingRates hook\nfunction getShippingRates(previousQueryResults, cart) {\n  const marketplaceSettings = Reaction.getMarketplaceSettings();\n  const merchantShippingRates = _.get(marketplaceSettings, \"public.merchantShippingRates\", false);\n\n  if (merchantShippingRates) {\n    Logger.fatal(\"Multiple shipping providers is currently not implemented\");\n    throw new Meteor.Error(\"not-implemented\", \"Multiple shipping providers is currently not implemented\");\n  }\n\n  const pkgData = Packages.findOne({\n    name: \"reaction-shippo\",\n    shopId: Reaction.getPrimaryShopId()\n  });\n\n  const [rates, retrialTargets] = previousQueryResults;\n  const products = cart.items;\n\n  // must have cart items and package enabled to calculate shipping\n  if (!pkgData || !products || pkgData.settings.shippo.enabled !== true) {\n    return [rates, retrialTargets];\n  }\n\n  // if we don't have merchant shipping rates enabled, only grab rates from primary shop\n  const shops = [];\n  if (!merchantShippingRates) {\n    shops.push(Reaction.getPrimaryShopId());\n  } else {\n    // create an array of shops, allowing\n    // the cart to have products from multiple shops\n    for (const product of products) {\n      if (product.shopId) {\n        shops.push(product.shopId);\n      }\n    }\n  }\n\n  const shippoDocs = {};\n  Shipping.find({\n    \"shopId\": { $in: shops },\n    \"provider.enabled\": true\n  }).forEach((doc) => {\n    // If provider is from Shippo, put it in an object to get rates dynamically(shippoApi) for all of them after.\n    if (doc.provider.shippoProvider) {\n      shippoDocs[doc.provider.shippoProvider.carrierAccountId] = doc;\n    }\n  });\n\n  // Get shippingRates from Shippo\n  if (Object.keys(shippoDocs).length > 0) {\n    const targets = retrialTargets.slice();\n    const shippingRatesInfo =\n      Meteor.call(\"shippo/getShippingRatesForCart\", cart._id, shippoDocs, targets);\n    const [shippoRates, singleRetrialTarget] = shippingRatesInfo;\n    rates.push(...shippoRates);\n    retrialTargets.push(...singleRetrialTarget);\n  }\n\n  Logger.debug(\"Shippo onGetShippingRates\", [rates, retrialTargets]);\n  return [rates, retrialTargets];\n}\n\n// run getShippingRates when the onGetShippingRates event runs\nHooks.Events.add(\"onGetShippingRates\", getShippingRates);\n","import { Meteor } from \"meteor/meteor\";\nimport { MethodHooks } from \"/server/api\";\n\nMethodHooks.before(\"shipping/status/refresh\", (options) => {\n  const orderId = options.arguments[0];\n  Meteor.call(\"shippo/confirmShippingMethodForOrder\", orderId);\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { fetchTrackingStatusForOrdersJob, setupShippoTrackingStatusHook } from \"./shippo\";\n\nsetupShippoTrackingStatusHook();\n// start \"shippo/fetchTrackingStatusForOrdersJob\"\nfetchTrackingStatusForOrdersJob();\n","import { Meteor } from \"meteor/meteor\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\nimport { Jobs, Packages } from \"/lib/collections\";\n\n// helper to fetch shippo config\nfunction getJobConfig() {\n  return Packages.findOne({\n    name: \"reaction-shippo\",\n    shopId: Reaction.getShopId()\n  }).settings;\n}\n\n// helper to get owner's UserId\nfunction getOwnerUserId() {\n  const owner = Meteor.users.findOne({\n    \"roles.__global_roles__\": \"owner\"\n  });\n  if (owner && typeof owner === \"object\") {\n    return owner._id;\n  }\n  return false;\n}\n\nexport function setupShippoTrackingStatusHook() {\n  Hooks.Events.add(\"afterCoreInit\", () => {\n    const config = getJobConfig();\n    const { refreshPeriod } = config;\n\n    if (!config.shippo.enabled || !refreshPeriod) {\n      return;\n    }\n    // there might be some validity to this being Logger.info.\n    Logger.debug(`Adding shippo/fetchTrackingStatusForOrders to JobControl. Refresh ${refreshPeriod}`);\n    new Job(Jobs, \"shippo/fetchTrackingStatusForOrdersJob\", {})\n      .priority(\"normal\")\n      .retry({\n        retries: 5,\n        wait: 60000,\n        backoff: \"exponential\" // delay by twice as long for each subsequent retry\n      })\n      .repeat({\n        schedule: Jobs.later.parse.text(refreshPeriod)\n      })\n      .save({\n        // Cancel any jobs of the same type,\n        // but only if this job repeats forever.\n        cancelRepeats: true\n      });\n  });\n}\n\nexport function fetchTrackingStatusForOrdersJob() {\n  const ownerId = getOwnerUserId();\n  if (ownerId) {\n    Jobs.processJobs(\n      \"shippo/fetchTrackingStatusForOrdersJob\",\n      {\n        pollInterval: 30 * 1000,\n        workTimeout: 180 * 1000\n      },\n      (job, callback) => {\n        // TODO review meteor runAsUser and add to project documentation\n        // As this is run by the Server and we don't have userId()/this.userId\n        // which \"shippo/fetchTrackingStatusForOrders\" need, we use dispatch:run-as-user\n        // An alternative way is https://forums.meteor.com/t/cant-set-logged-in-user-for-rest-calls/18656/3\n        Meteor.runAsUser(ownerId, () => {\n          Meteor.call(\"shippo/fetchTrackingStatusForOrders\", (error) => {\n            if (error) {\n              job.done(error.toString(), { repeatId: true });\n            } else {\n              const success = \"Shippo tracking status updated.\";\n              Logger.debug(success);\n              job.done(success, { repeatId: true });\n            }\n          });\n        });\n        callback();\n      }\n    );\n  }\n  return false;\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Shipping } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\nimport { shippingRoles } from \"../lib/roles\";\n\nexport const methods = {\n  /**\n   * shippo/carrier/update\n   * @summary update Shipping methods for a provider\n   * @param {String} provider provider object\n   * @return {Number} update result\n   */\n  \"shippo/carrier/update\"(provider) {\n    check(provider, Object); // ShippingProvider\n    if (!Reaction.hasPermission(shippingRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const method = {};\n    method.provider = provider;\n    const flatten = require(\"flatten-obj\")();\n    const update = flatten(method);\n    return Shipping.update({\n      \"provider._id\": provider._id\n    }, {\n      $set: update\n    });\n  }\n};\n\nMeteor.methods(methods);\n","import \"./shippo\";\nimport \"./carriers\";\n","/* eslint camelcase: 0 */\nimport _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Reaction, Hooks } from \"/server/api\";\nimport { Packages, Accounts, Shops, Shipping, Cart, Orders } from \"/lib/collections\";\nimport { ShippoPackageConfig } from \"../../lib/collections/schemas\";\nimport { shippingRoles } from \"../lib/roles\";\nimport { ShippoApi } from \"./shippoapi\";\n\n// Creates an address (for sender or recipient) suitable for Shippo Api Calls given\n// a reaction address an email and a purpose(\"QUOTE\"|\"PURCHASE\")\nfunction createShippoAddress(reactionAddress, email, purpose) {\n  const shippoAddress = {\n    object_purpose: purpose,\n    name: reactionAddress.fullName,\n    street1: reactionAddress.address1,\n    street2: reactionAddress.address2 || \"\", // \"\" in order to be cleaned later by SimpleSchema.clean\n    city: reactionAddress.city,\n    company: reactionAddress.company || \"\",\n    state: reactionAddress.region,\n    zip: reactionAddress.postal,\n    country: reactionAddress.country,\n    phone: reactionAddress.phone,\n    email,\n    is_residential: !reactionAddress.isCommercial\n  };\n\n  return shippoAddress;\n}\n\n// Creates a parcel object suitable for Shippo Api Calls given\n// a reaction product's parcel and units of measure for mass and distance\nfunction createShippoParcel(reactionParcel, cartWeight, reactionMassUnit, reactionDistanceUnit) {\n  const shippoParcel = {\n    width: reactionParcel.width || 1,\n    length: reactionParcel.length || 1,\n    height: reactionParcel.height || 1,\n    weight: cartWeight,\n    distance_unit: reactionDistanceUnit,\n    mass_unit: reactionMassUnit\n  };\n\n  return shippoParcel;\n}\n\nfunction getTotalCartweight(cart) {\n  const totalWeight = cart.items.reduce((sum, cartItem) => {\n    const itemWeight = cartItem.quantity * cartItem.parcel.weight;\n    return sum + itemWeight;\n  }, 0);\n  return totalWeight;\n}\n\n// converts the Rates List fetched from the Shippo Api to Reaction Shipping Rates form\nfunction ratesParser(shippoRates, shippoDocs) {\n  return shippoRates.map((rate) => {\n    const rateAmount = parseFloat(rate.amount);\n    const reactionRate = {\n      carrier: rate.provider,\n      method: {\n        carrier: rate.provider,\n        enabled: true,\n        handling: 0,\n        label: rate.servicelevel_name,\n        rate: rateAmount,\n        settings: {\n          // carrierAccount: rate.carrier_account,\n          rateId: rate.object_id,\n          serviceLevelToken: rate.servicelevel_token\n        }\n      },\n      rate: rateAmount,\n      shopId: shippoDocs[rate.carrier_account].shopId\n    };\n\n    return reactionRate;\n  });\n}\n\n// Filters the carrier list and gets and parses only the ones that are activated in the Shippo Account\nfunction filterActiveCarriers(carrierList) {\n  const activeCarriers = [];\n  if (carrierList.results && carrierList.count) {\n    carrierList.results.forEach((carrier) => {\n      if (carrier.active) {\n        activeCarriers.push({\n          carrier: carrier.carrier, // this is a property of the returned result with value the name of the carrier\n          carrierAccountId: carrier.object_id\n        });\n      }\n    });\n\n    return activeCarriers;\n  }\n}\n\n// usps_express to USPS EXPRESS .We need a better approach - use a suitable static map object\nfunction formatCarrierLabel(carrierName) {\n  return carrierName.replace(/_/g, \" \").toUpperCase();\n}\n\n// get Shippo's Api Key from the Shippo package with the supplied shopId or alternatively of the current shop's Id\nfunction getApiKey(shopId = Reaction.getShopId()) {\n  const { settings } = Packages.findOne({\n    name: \"reaction-shippo\",\n    shopId\n  });\n\n  return settings.apiKey;\n}\n\n// Adds Shippo carriers in Shipping Collection (one doc per carrier) for the current Shop\nfunction addShippoProviders(carriers, shopId = Reaction.getShopId()) {\n  let result = true;\n  carriers.forEach((carrier) => {\n    const carrierName = carrier.carrier;\n    const carrierLabel = formatCarrierLabel(carrierName);\n    const currentResult = Shipping.insert({\n      name: `${carrierLabel}`, // check it later for a better name\n      methods: [],\n      provider: {\n        name: carrierName,\n        label: carrierLabel,\n        enabled: true,\n        shippoProvider: {\n          carrierAccountId: carrier.carrierAccountId\n        }\n      },\n      shopId\n    });\n    result = result && currentResult;\n  });\n\n  return result;\n}\n\n// Remove from Shipping Collection shop's Shippo Providers with carrier account Id in carriersIds\n// or all of them (if carriersIds is set to false)\nfunction removeShippoProviders(carriersIds, shopId = Reaction.getShopId()) {\n  if (carriersIds) {\n    return Shipping.remove({\n      shopId,\n      \"provider.shippoProvider.carrierAccountId\": { $in: carriersIds }\n    });\n  }\n\n  return Shipping.remove({\n    shopId,\n    \"provider.shippoProvider\": { $exists: true }\n  });\n}\n\n// After getting the current active Carriers of the Shippo Account removes\n// from the Shipping Collection the Shippo providers that are deactivated(don't exist in active carriers)\n// and inserts the newly active carriers in Shipping Collection as shippo providers.\n\nfunction updateShippoProviders(activeCarriers, shopId = Reaction.getShopId()) {\n  const currentShippoProviders = Shipping.find({\n    shopId,\n    \"provider.shippoProvider\": { $exists: true }\n  }, {\n    fields: { \"provider.shippoProvider.carrierAccountId\": 1 }\n  });\n\n  // Ids of Shippo Carriers that exist currently as docs in Shipping Collection\n  const currentCarriersIds = currentShippoProviders.map((doc) => doc.provider.shippoProvider.carrierAccountId);\n\n  const newActiveCarriers = [];\n  const unchangedActiveCarriersIds = [];\n  activeCarriers.forEach((carrier) => {\n    const carrierId = carrier.carrierAccountId;\n    if (!currentCarriersIds.includes(carrierId)) {\n      newActiveCarriers.push(carrier);\n    } else {\n      unchangedActiveCarriersIds.push(carrierId);\n    }\n  });\n\n  const deactivatedCarriersIds = _.difference(currentCarriersIds, unchangedActiveCarriersIds);\n  if (deactivatedCarriersIds.length) {\n    removeShippoProviders(deactivatedCarriersIds, shopId);\n  }\n  if (newActiveCarriers.length) {\n    addShippoProviders(newActiveCarriers, shopId);\n  }\n\n  return true;\n}\n\nexport const methods = {\n  /**\n   * Updates the Api key(Live/Test Token) used for connection with the Shippo account.\n   * Also inserts(and deletes if already exist) docs in the Shipping collection each of the\n   * activated Carriers of the Shippo account.\n   * This method is intended to be used mainly by Autoform.\n   * @param  {Object} details An object with _id and modifier props\n   * @param  {String} [docId] DEPRECATED. The _id, if details is the modifier.\n   * @return {Object|Boolean} result - The object returned.\n   * @return {String} {string(\"update\"|\"delete\")} result.type - The type of updating happened.\n   */\n  \"shippo/updateApiKey\"(details, docId) {\n    check(details, Object);\n\n    // Backward compatibility\n    check(docId, Match.Optional(String));\n    const id = docId || details._id;\n    const modifier = docId ? details : details.modifier;\n\n    // Important server-side checks for security and data integrity\n    check(id, String);\n    ShippoPackageConfig.validate(modifier, { modifier: true });\n\n    // Make sure user has proper rights to this package\n    const { shopId } = Packages.findOne({ _id: id }, { field: { shopId: 1 } });\n    if (shopId && Roles.userIsInRole(this.userId, shippingRoles, shopId)) {\n      // If user wants to delete existing key\n      if ({}.hasOwnProperty.call(modifier, \"$unset\")) {\n        const customModifier = { $set: { \"settings.apiKey\": null } };\n        Packages.update(id, customModifier);\n        // remove shop's existing Shippo Providers from Shipping Collection\n        removeShippoProviders(false, shopId);\n\n        return { type: \"delete\" };\n      }\n\n      const apiKey = modifier.$set[\"settings.apiKey\"];\n\n      // Tries to use the apiKey by fetching a list of the addresses of Shippo Account\n      // if not possible throws a relative Meteor Error (eg invalid_credentials)\n      ShippoApi.methods.getAddressList.call({ apiKey });\n      // if everything is ok proceed with the api key update\n      Packages.update(id, modifier);\n      // remove shop's existing Shippo Providers from Shipping Collection\n      removeShippoProviders(false, shopId);\n\n      const activeCarriers = filterActiveCarriers(ShippoApi.methods.getCarrierAccountsList.call({ apiKey }));\n      if (activeCarriers.length) {\n        addShippoProviders(activeCarriers, shopId);\n      }\n\n      return { type: \"update\" };\n    }\n\n    return false;\n  },\n\n  /**\n   * Fetches the current active Shippo Carriers from the Shippo Account and updates the\n   * Shipping Collection by keeping only these as Shippo Providers of the shop.\n   * @return {Boolean} result - if the updating happened successfully or not.\n   * */\n\n  \"shippo/fetchProviders\"() {\n    const shopId = Reaction.getShopId();\n\n    if (Roles.userIsInRole(this.userId, shippingRoles, shopId)) {\n      const apiKey = getApiKey(shopId);\n      if (!apiKey) {\n        return false;\n      }\n\n      const activeCarriers = filterActiveCarriers(ShippoApi.methods.getCarrierAccountsList.call({ apiKey }));\n      return updateShippoProviders(activeCarriers, shopId);\n    }\n\n    return false;\n  },\n\n  /**\n   * Fetches the tracking status of shipped orders from Shippo and updates the\n   * relevant orders' properties\n   * @param {String} orderId - optional orderId to get status of just one order.\n   * @return {Boolean} result - if the updating happened successfully or not.\n   * */\n  \"shippo/fetchTrackingStatusForOrders\"(orderId) {\n    check(orderId, Match.Optional(String));\n    const shopId = Reaction.getShopId();\n    let shippoOrders;\n    const apiKey = getApiKey(shopId);\n    if (!apiKey) {\n      return false;\n    }\n\n    if (orderId) {\n      // return a specific order\n      shippoOrders = Orders.find({\n        shopId,\n        orderId\n      });\n    } else {\n      // Find the orders of the shop that have shippo provider, tracking number, that are shipped\n      // but they are not yet delivered;\n      shippoOrders = Orders.find({\n        shopId,\n        \"shipping.0.shippo.transactionId\": { $exists: true },\n        \"shipping.0.tracking\": { $exists: true },\n        \"shipping.0.shipped\": true,\n        \"shipping.0.delivered\": { $ne: true }\n        // For now we don' t have logic for returned products\n      });\n    }\n\n\n    // no orders to update\n    if (!shippoOrders.count()) {\n      return true;\n    }\n\n    // For each order get from Shippo the transaction item ,check the tracking and if it has been updated\n    let updatingResult = true;\n    shippoOrders.forEach((order) => {\n      const orderShipment = order.shipping[0];\n      const { transactionId } = orderShipment.shippo;\n      const transaction = ShippoApi.methods.getTransaction.call({ apiKey, transactionId });\n\n      // For Testing:\n      // Comment First line of code, and uncomment following block to mock the updating of tracking status\n      // as Shippo's tracking status for test Shipments isn't getting updated.\n      const trackingStatus = transaction.tracking_status;\n      // const trackingStatus = {};\n      // if (transaction.object_state === \"VALID\") {\n      //   trackingStatus.status_date = (new Date).toString();\n      //   trackingStatus.status = (!orderShipment.shippo.trackingStatusStatus ? \"TRANSIT\" : \"DELIVERED\");\n      // }\n\n      if (trackingStatus &&\n        trackingStatus.status_date !== orderShipment.shippo.trackingStatusDate) {\n        //  Shippo's tracking_status.status enum Indicates the high level status of the shipment:\n        // 'UNKNOWN', 'DELIVERED', 'TRANSIT', 'FAILURE', 'RETURNED'.\n        if (trackingStatus.status === \"DELIVERED\") {\n          Meteor.call(\"orders/shipmentDelivered\", order);\n        }\n\n        // A batch update might be better option. Unfortunately Reaction.importer doesn't support\n        // .. Orders currently\n        const orderUpdating = Orders.update({\n          _id: order._id\n        }, {\n          $set: {\n            \"shipping.0.shippo.trackingStatusDate\": trackingStatus.status_date,\n            \"shipping.0.shippo.trackingStatusStatus\": trackingStatus.status\n          }\n        });\n        updatingResult = updatingResult && orderUpdating;\n      }\n    });\n\n    return updatingResult;\n  },\n\n  /**\n   * Returns the available Shippo Methods/Rates for a selected cart,\n   * in the same form shipping/getShippingRates returns them.\n   * @param {String} cartId - The id of the cart that rates are to be supplied.\n   * @param {Object} shippoDocs - Contains all the enabled shipping objects with\n   * provider.shippoProvider property. Each property has as key the Shippo's\n   * carrierAccountId and as value the corresponding document of shipping\n   * collection.\n   * @param {Array} retrialTargets - An array with the details of which\n   * methods for getting shipping methods failed in the most recent\n   * query of Shippo's API.\n   * @return {Array} errorDetailsAndRetryInfo - Details of any error that\n   * occurred while querying Shippo's API, and info about this package so\n   * as to know if this specific query is to be retried.\n   * @return {Array} rates - The rates of the enabled and available\n   * Shippo carriers, and an empty array.\n   */\n  \"shippo/getShippingRatesForCart\"(cartId, shippoDocs, retrialTargets) {\n    check(cartId, String);\n    check(shippoDocs, Object);\n    check(retrialTargets, Array);\n\n    const currentMethodInfo = {\n      packageName: \"shippo\",\n      fileName: \"shippo.js\"\n    };\n    const errorDetails = {\n      requestStatus: \"error\",\n      shippingProvider: \"shippo\"\n    };\n\n    let isRetry;\n    if (retrialTargets.length > 0) {\n      const isNotAmongFailedRequests = retrialTargets.every((target) =>\n        target.packageName !== currentMethodInfo.packageName &&\n        target.fileName !== currentMethodInfo.fileName);\n      if (isNotAmongFailedRequests) {\n        return [[], retrialTargets];\n      }\n\n      isRetry = true;\n    }\n\n    const cart = Cart.findOne(cartId);\n    if (cart && cart.userId === this.userId) { // confirm user has the right\n      let shippoAddressTo;\n      let shippoParcel;\n      const purpose = \"PURCHASE\";\n\n      const shop = Shops.findOne({\n        _id: cart.shopId\n      }, {\n        field: {\n          addressBook: 1,\n          emails: 1,\n          unitsOfMeasure: { $elemMatch: { default: true } }\n        }\n      });\n\n      const apiKey = getApiKey(cart.shopId);\n      // If for a weird reason Shop hasn't a Shippo Api key anymore return no-rates.\n      if (!apiKey) {\n        // In this case, and some similar ones below, there's no need\n        // for a retry.\n        errorDetails.message = \"No Shippo API key was found in this cart.\";\n        return [[errorDetails], []];\n      }\n      // TODO create a shipping address book record for shop.\n      const shippoAddressFrom = createShippoAddress(shop.addressBook[0], shop.emails[0].address, purpose);\n      // product in the cart has to have parcel property with the dimensions\n      if (cart.items && cart.items[0] && cart.items[0].parcel) {\n        const unitOfMeasure = (shop && shop.baseUOM) || \"kg\";\n        const unitOfLength = (shop && shop.baseUOL) || \"cm\";\n        const cartWeight = getTotalCartweight(cart);\n        shippoParcel = createShippoParcel(cart.items[0].parcel, cartWeight, unitOfMeasure, unitOfLength);\n      } else {\n        errorDetails.message = \"This cart has no items, or the first item has no 'parcel' property.\";\n        return [[errorDetails], []];\n      }\n\n      const buyer = Accounts.findOne({\n        _id: this.userId\n      }, {\n        field: { emails: 1 }\n      });\n      // check that there is address available in cart\n      if (cart.shipping && cart.shipping[0] && cart.shipping[0].address) {\n        // TODO take a more elegant approach to guest checkout -> no email address\n        // add Logger.trace if this smells\n        let email = shop.emails[0].address || \"noreply@localhost\";\n        if (buyer.emails.length > 0) {\n          if (buyer.emails[0].address) {\n            email = buyer.emails[0].address;\n          }\n        }\n        shippoAddressTo = createShippoAddress(cart.shipping[0].address, email, purpose);\n      } else {\n        errorDetails.message = \"The 'shipping' property of this cart is either missing or incomplete.\";\n        return [[errorDetails], []];\n      }\n\n      const carrierAccounts = Object.keys(shippoDocs);\n      let shippoShipment;\n      try {\n        shippoShipment = ShippoApi.methods.createShipment.call({\n          shippoAddressFrom,\n          shippoAddressTo,\n          shippoParcel,\n          purpose,\n          carrierAccounts,\n          apiKey\n        });\n      } catch (error) {\n        const errorData = {\n          requestStatus: \"error\",\n          shippingProvider: \"shippo\",\n          message: error.message\n        };\n\n        if (isRetry) {\n          errorDetails.message = \"The Shippo API call has failed again.\";\n          return [[errorDetails], []];\n        }\n\n        return [[errorData], [currentMethodInfo]];\n      }\n\n      const shippoRates = shippoShipment.rates_list;\n      if (!shippoRates || shippoRates.length === 0) {\n        const noShippingMethods = {\n          requestStatus: \"error\",\n          shippingProvider: \"shippo\",\n          message: \"Couldn't find any shipping methods. Try using another address.\"\n        };\n\n        if (isRetry) {\n          errorDetails.message = \"Didn't get any shipping methods. The Shippo API call has failed again.\";\n          return [[errorDetails], []];\n        }\n\n        return [[noShippingMethods], [currentMethodInfo]];\n      }\n\n      const reactionRates = ratesParser(shippoRates, shippoDocs);\n      return [reactionRates, []];\n    }\n\n    errorDetails.message = \"Error. Your cart is either undefined or has the wrong userId.\";\n    return [[errorDetails], []];\n  },\n\n  /**\n   * Confirms Shippo order based on buyer's choice at the time of purchase\n   * and supplies the order doc with the tracking and label infos\n   * @param {String} orderId - The id of the ordered that labels are purchased for\n   * @return {Boolean} result - True if procedure completed succesfully,otherwise false\n   */\n  \"shippo/confirmShippingMethodForOrder\"(orderId) {\n    check(orderId, String);\n    const order = Orders.findOne(orderId);\n    // Make sure user has permissions in the shop's order\n    if (Roles.userIsInRole(this.userId, shippingRoles, order.shopId)) {\n      const orderShipment = order.shipping[0];\n      // Here we done it for the first/unique Shipment only . in the near future it will be done for multiple ones\n      if (orderShipment && orderShipment.shipmentMethod && orderShipment.shipmentMethod.settings && orderShipment.shipmentMethod.settings.rateId) {\n        const apiKey = getApiKey(order.shopId);\n        // If for a weird reason Shop hasn't a Shippo Api key anymore you have to throw an error\n        // cause the Shippo label purchasing is not gonna happen.\n        if (!apiKey) {\n          throw new Meteor.Error(\"access-denied\", \"Invalid Shippo Credentials\");\n        }\n        const { rateId } = orderShipment.shipmentMethod.settings;\n        // make the actual purchase\n        const transaction = ShippoApi.methods.createTransaction.call({ rateId, apiKey });\n        if (transaction) {\n          return Orders.update({\n            _id: orderId\n          }, {\n            $set: {\n              \"shipping.0.shippingLabelUrl\": transaction.label_url,\n              \"shipping.0.tracking\": transaction.tracking_number,\n              \"shipping.0.shippo.transactionId\": transaction.object_id,\n              \"shipping.0.shippo.trackingStatusDate\": null,\n              \"shipping.0.shippo.trackingStatusStatus\": null\n            }\n          });\n        }\n      }\n    }\n    return false;\n  }\n};\n\nMeteor.methods(methods);\n\nHooks.Events.add(\"onOrderPaymentCaptured\", (orderId) => {\n  Meteor.call(\"shippo/confirmShippingMethodForOrder\", orderId);\n  return orderId;\n});\n","/* eslint camelcase: 0 */\nimport Shippo from \"shippo\";\nimport SimpleSchema from \"simpl-schema\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ValidatedMethod } from \"meteor/mdg:validated-method\";\nimport { Logger } from \"/server/api\";\nimport { purchaseAddressSchema, parcelSchema } from \"../lib/shippoApiSchema\";\n\nexport const ShippoApi = {\n  methods: {}\n};\n\n\n/**\n * Retrieves the address objects stored in Shippo Account\n * @see https://goshippo.com/docs/reference#addresses\n * @param {Object} parameter - ValidatedMethod's parameter\n * @param {String} parameter.apiKey - The Test or Live Token required\n * for authentication by Shippo's api\n * @return {Object} addressList - compound object returned returned by Shippo\n * @return {Array} addressList.results - An array with the address objects\n * @return {Number} addressList.count - the count of the address objects.\n * */\nShippoApi.methods.getAddressList = new ValidatedMethod({\n  name: \"ShippoApi.methods.getAddressList\",\n  validate: new SimpleSchema({\n    apiKey: {\n      type: String\n    }\n  }).validator(),\n  run({ apiKey }) {\n    const shippoObj = new Shippo(apiKey);\n    shippoObj.set(\"version\", \"2016-10-25\");\n    const getAddressListFiber = Meteor.wrapAsync(shippoObj.address.list, shippoObj.address);\n    try {\n      const addressList = getAddressListFiber();\n\n      return addressList;\n    } catch (error) {\n      Logger.error(error.message);\n      throw new Meteor.Error(\"server-error\", error.message);\n    }\n  }\n});\n\n\n/**\n * Retrieves all Shippo carriers from the Shippo Account\n * @see https://goshippo.com/docs/reference#carrier-accounts-list\n * @param {Object} parameter - ValidatedMethod's parameter\n * @param {String} parameter.apiKey - The Test or Live Token required\n * for authentication by Shippo's api\n * @return {Object} carrierAccountList - the compound object returned by Shippo\n * @return {Array} carrierAccountList.results - An array with the carrier accounts objects\n * @return {Number} carrierAccountList.count - the count of the carrier accounts objects.\n *\n */\nShippoApi.methods.getCarrierAccountsList = new ValidatedMethod({\n  name: \"ShippoApi.methods.getCarrierAccountsList\",\n  validate: new SimpleSchema({\n    apiKey: {\n      type: String\n    }\n  }).validator(),\n  run({ apiKey }) {\n    const shippoObj = new Shippo(apiKey);\n    shippoObj.set(\"version\", \"2016-10-25\");\n    let allCarriers = [];\n\n    // recursively fetch carriers because shippo returns paginated results\n    function fetchCarriers() {\n      try {\n        const response = Meteor.wrapAsync(shippoObj.carrieraccount.list, shippoObj.carrieraccount)();\n        allCarriers = allCarriers.concat(response.results);\n\n        if (!response.next) {\n          response.results = allCarriers;\n          return response;\n        }\n        // the Shippo module uses \"createFullPath\" to form the url for the request\n        // https://github.com/goshippo/shippo-node-client/blob/master/lib/Resource.js#L40-L48\n        // hence we're passing the next url in this way\n        shippoObj.carrieraccount.createFullPath = () => response.next;\n        return fetchCarriers();\n      } catch (error) {\n        Logger.error(error.message);\n        throw new Meteor.Error(\"server-error\", error.message);\n      }\n    }\n\n    return fetchCarriers();\n  }\n});\n\n/**\n * Creates a Shippo's Shipment object for the given addresses and gets Rates for the particular shipment)\n * @see https://goshippo.com/docs/reference#shipments-create\n * @param {Object} parameter - ValidatedMethod's parameter\n * @param {Object} parameter.shippoAddressFrom - The address of the sender\n * @param {Object} parameter.shippoAddressTo - The address of the receiver\n * @param {Object} parameter.shippoParcel - The parcel dimensions's/weight\n * @param {String} parameter.purpose  - \"QUOTE\" or \"PURCHASE\" - The reason of the shipment(check prices/ purchase labels)\n * @param {String} parameter.apiKey - The Test or Live Token required\n * for authentication by Shippo's api\n * @return {Object} shipment - The compound shipment object returned by Shippo\n * @return {Array} shipment.rates_list - The available rate objects\n * */\nShippoApi.methods.createShipment = new ValidatedMethod({\n  name: \"ShippoApi.methods.createShipment\",\n  validate: new SimpleSchema({\n    \"shippoAddressFrom\": purchaseAddressSchema,\n    \"shippoAddressTo\": purchaseAddressSchema,\n    \"shippoParcel\": parcelSchema,\n    \"purpose\": { type: String, allowedValues: [\"QUOTE\", \"PURCHASE\"] },\n    \"apiKey\": String,\n    \"carrierAccounts\": { type: Array, optional: true },\n    \"carrierAccounts.$\": String\n  }).validator(),\n  run({ shippoAddressFrom, shippoAddressTo, shippoParcel, purpose, apiKey, carrierAccounts }) {\n    const shippoObj = new Shippo(apiKey);\n    shippoObj.set(\"version\", \"2016-10-25\");\n\n    const createShipmentFiber = Meteor.wrapAsync(shippoObj.shipment.create, shippoObj.shipment);\n    try {\n      const shipment = createShipmentFiber({\n        object_purpose: purpose,\n        address_from: shippoAddressFrom,\n        address_to: shippoAddressTo,\n        parcel: shippoParcel,\n        carrier_accounts: carrierAccounts,\n        async: false\n      });\n\n      return shipment;\n    } catch (error) {\n      Logger.error(error.message);\n      throw new Meteor.Error(\"server-error\", error.message);\n    }\n  }\n});\n\n/**\n * Makes the transaction (purchasing of a shipping label from a shipping provider for a specific service)\n * for the specific rateId and returns its Shipping Label ,Tracking number etc\n * @see https://goshippo.com/docs/reference#transactions-create\n * @param {Object} parameter - ValidatedMethod's parameter\n * @param {String} parameter.rateId - unique identifier of the chosen rate object\n * @param {String} parameter.apiKey - The Test or Live Token required\n * for authentication by Shippo's api\n * @return {Object} transaction - The compound transaction object returned by Shippo\n * */\nShippoApi.methods.createTransaction = new ValidatedMethod({\n  name: \"ShippoApi.methods.createTransaction\",\n  validate: new SimpleSchema({\n    rateId: { type: String },\n    apiKey: { type: String }\n  }).validator(),\n  run({ rateId, apiKey }) {\n    const shippoObj = new Shippo(apiKey);\n    shippoObj.set(\"version\", \"2016-10-25\");\n\n    const createTransactionFiber = Meteor.wrapAsync(shippoObj.transaction.create, shippoObj.transaction);\n    try {\n      const transaction = createTransactionFiber({\n        rate: rateId,\n        label_file_type: \"PDF\",\n        async: false\n      });\n\n      if (transaction.object_status !== \"SUCCESS\") {\n        const error = transaction.messages[0].text;\n        Logger.error(error);\n        throw new Meteor.Error(\"server-error\", error);\n      }\n\n      return transaction;\n    } catch (error) {\n      Logger.debug(error.message);\n      throw new Meteor.Error(\"server-error\", error.message);\n    }\n  }\n});\n\n/**\n * Retrieves transaction with transactionId of Shippo Account\n * @see https://goshippo.com/docs/reference#transactions-retrieve\n * @param {Object} parameter - ValidatedMethod's parameter\n * @param {String} parameter.transactionId - unique identifier of the transaction object\n * @param {String} parameter.apiKey - The Test or Live Token required\n * for authentication by Shippo's api\n * @return {Object} transaction - transaction object returned by Shippo\n * */\nShippoApi.methods.getTransaction = new ValidatedMethod({\n  name: \"ShippoApi.methods.getTransaction\",\n  validate: new SimpleSchema({\n    transactionId: { type: String },\n    apiKey: { type: String }\n  }).validator(),\n  run({ transactionId, apiKey }) {\n    const shippoObj = new Shippo(apiKey);\n    shippoObj.set(\"version\", \"2016-10-25\");\n\n    const retrieveTransactionFiber = Meteor.wrapAsync(shippoObj.transaction.retrieve, shippoObj.transaction);\n    try {\n      const transaction = retrieveTransactionFiber(transactionId);\n      return transaction;\n    } catch (error) {\n      Logger.error(error.message);\n      throw new Meteor.Error(\"server-error\", error.message);\n    }\n  }\n});\n","import \"./methods\";\nimport \"./jobs\";\nimport \"./i18n\";\nimport \"./hooks\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Shippo\",\n  name: \"reaction-shippo\",\n  icon: \"fa fa-plane\",\n  autoEnable: false,\n  settings: {\n    shippo: {\n      enabled: false\n    },\n    // todo: move all settings in shippo subfield\n    apiKey: \"\",\n    refreshPeriod: \"every 2 hours\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    label: \"Shippo\",\n    description: \"Shippo service\",\n    icon: \"fa fa-plane\",\n    priority: 1,\n    container: \"connect\",\n    permissions: [{\n      label: \"Shippo\",\n      permission: \"dashboard/shippo\"\n    }]\n  }, {\n    label: \"Shippo\",\n    icon: \"fa fa-plane\",\n    name: \"shipping/settings/shippo\",\n    provides: [\"shippingSettings\"],\n    container: \"connection\",\n    template: \"shippoSettings\"\n  }\n    // WIP:\n    // TODO: Review custom shipping in checkout, are layout handling this requirement\n    // For now we use Flat Rate's checkout template( which inherits its methods from coreCheckoutShipping\n    // to show all shipping methods in the same panel.\n    // .If we are gonna proceed with different panel per provider, we need to enable the 'provides:\"Shipping Method\"',\n    // alter coreCheckoutShipping checkout.js and inherit from there (or write specific logic) for a shippo's\n    // checkout template.\n    //\n    // provides: [\"shippingMethod\"],\n    // name: \"shipping/methods/shippo\",\n    // template: \"shippoCheckoutShipping\"\n    // Not needed at the time cause the coreCheckoutShipping is enough(inherited from Flatrate)\n    // }\n  ]\n});\n","export const connectorsRoles = [\"admin\", \"owner\", \"connectors\", \"reaction-connectors-shopify\"];\n","import { Meteor } from \"meteor/meteor\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * @file Shopify connector api methods and helpers\n * @module connectors-shopify\n */\n\n/**\n * @method getApiInfo\n * @summary - get Shopify Api Key, Password and Domain from the Shopify Connect package with the supplied shopId or alternatly the active shopId. should only be used from authenticated methods within the connectors-shopify plugin\n * @private\n * @param  {string} [shopId=Reaction.getShopId()] Optional shopId to get the API info for. Defaults to current shop.\n * @return {object} Shopify API connection information\n */\nexport function getApiInfo(shopId = Reaction.getShopId()) {\n  const shopifyPkg = Reaction.getPackageSettingsWithOptions({\n    shopId,\n    name: \"reaction-connectors-shopify\"\n  });\n\n  if (!shopifyPkg) {\n    throw new Meteor.Error(\"server-error\", `No shopify package found for shop ${Reaction.getShopId()}`);\n  }\n\n  const { settings } = shopifyPkg;\n\n  return {\n    apiKey: settings.apiKey,\n    password: settings.password,\n    shopName: settings.shopName\n  };\n}\n","import Shopify from \"shopify-api-node\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Reaction } from \"/server/api\";\nimport { connectorsRoles } from \"../../lib/roles\";\nimport { getApiInfo } from \"./api\";\n\n/**\n * @file Shopify connector wrapper for api calls for\n *       checking credentials's validity\n * @module connectors-shopify\n */\n\nexport const methods = {\n  /**\n   * Check if Shopify API's credentials are valid or not.\n   *\n   * @async\n   * @method connectors/shopify/api/credentials/test\n   * @param {object} options An object of options for the shopify API call.\n   * @returns {boolean} credentials valid or not\n   */\n  async \"connectors/shopify/api/credentials/test\"() {\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    const apiCreds = getApiInfo();\n    try {\n      const shopify = new Shopify(apiCreds);\n      await shopify.product.count();\n    } catch (err) {\n      return false;\n    }\n    return true;\n  }\n};\n\nMeteor.methods(methods);\n","import \"./products\";\nimport \"./credentials\";\n\nexport * from \"./api\";\n","import Shopify from \"shopify-api-node\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { connectorsRoles } from \"../../lib/roles\";\nimport { getApiInfo } from \"./api\";\n\n/**\n * @file Shopify connector wrapper for api calls for products\n *       wraps shopify product api calls in reaction methods\n * @module connectors-shopify\n */\n\nexport const methods = {\n  /**\n   * Gets a count of the products from Shopify with the API credentials setup for your store.\n   *\n   * @async\n   * @method connectors/shopify/api/products/count\n   * @param {object} options An object of options for the shopify API call. Available options here: https://help.shopify.com/api/reference/product#count\n   * @returns {number} Number of products\n   */\n  async \"connectors/shopify/api/products/count\"(options) {\n    check(options, Match.Maybe(Object));\n\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    const apiCreds = getApiInfo();\n    const shopify = new Shopify(apiCreds);\n    const opts = Object.assign({}, { published_status: \"published\" }, { ...options }); // eslint-disable-line camelcase\n\n    try {\n      const count = await shopify.product.count(opts);\n      return count;\n    } catch (err) {\n      Logger.error(\"Something went wrong during Shopify products count\");\n    }\n  }\n};\n\nMeteor.methods(methods);\n","import \"./orders\";\n","/* eslint camelcase: 0 */\nimport accounting from \"accounting-js\";\nimport Shopify from \"shopify-api-node\";\nimport { parse, format } from \"libphonenumber-js\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Logger } from \"/server/api\";\nimport { convertWeight } from \"/lib/api\";\nimport { Orders, Shops } from \"/lib/collections\";\nimport { getApiInfo } from \"../api\";\n\n/**\n * @private\n * @summary build a new object for export to Shopify\n * @param {Object} doc - the order to convert\n * @param {Number} index - the sequence number of billing/shipping records we are processing\n * @param {String} shopId - the Id of the shop we are processing for\n * @param {Object} existingCustomer - the existing customer Id if it exists\n * @returns {Object} shopifyOrder - the converted order\n */\nfunction convertOrderToShopifyOrder(doc, index, shopId, existingCustomer = undefined) {\n  check(existingCustomer, Match.OneOf(Object, undefined));\n  const order = Orders.findOne(doc._id); // only this object has the original transforms defined\n  const paymentType = order.billing[index].method;\n  const itemsForShop = order.getItemsByShop()[shopId];\n  const shopifyOrder = {};\n  shopifyOrder.billing_address = convertAddress(order.billing[index].address);\n  shopifyOrder.shipping_address = convertAddress(order.shipping[index].address);\n  if (!existingCustomer) {\n    shopifyOrder.customer = convertCustomer(shopifyOrder.billing_address, order);\n  } else {\n    shopifyOrder.customer = existingCustomer;\n  }\n  shopifyOrder.email = order.email;\n  if (paymentType === \"credit\" && order.billing[index].mode === \"authorize\") {\n    shopifyOrder.financial_status = \"authorized\";\n  } else {\n    shopifyOrder.financial_status = \"paid\";\n  }\n  shopifyOrder.id = order._id;\n  shopifyOrder.line_items = convertLineItems(itemsForShop, order);\n  shopifyOrder.shipping_lines = convertShipping(order, index);\n  shopifyOrder.phone = order.billing[index].address.phone;\n  shopifyOrder.source_name = \"reaction_export\";\n  shopifyOrder.subtotal_price = order.getSubtotalByShop()[shopId];\n  shopifyOrder.token = order._id;\n  shopifyOrder.total_discounts = order.getDiscountsByShop()[shopId];\n  shopifyOrder.total_line_item_price = order.getItemsByShop()[shopId].reduce((total, item) => total + (item.variants.price * item.quantity), 0);\n  shopifyOrder.total_price = order.getTotalByShop()[shopId];\n  shopifyOrder.total_tax = order.getTaxesByShop()[shopId];\n  shopifyOrder.total_weight = shopifyOrder.line_items.reduce((sum, item) => sum + (item.grams * item.quantity), 0);\n  return shopifyOrder;\n}\n\n/**\n * @private\n * @summary Normalize all weights to grams\n * @param {Number} weight - the original weight value\n * @param {String} shopId - the shop we are converting for\n * @returns {Number} the normalized value\n */\nfunction normalizeWeight(weight, shopId) {\n  // if weight is not grams, convert to grams if is grams just return\n  const shop = Shops.findOne(shopId);\n  const { baseUOM } = shop;\n  if (baseUOM === \"g\") {\n    return weight;\n  }\n  if (baseUOM === \"lb\") {\n    return convertWeight(\"lb\", \"g\", weight);\n  }\n\n  if (baseUOM === \"oz\") {\n    return convertWeight(\"oz\", \"g\", weight);\n  }\n\n  if (baseUOM === \"kg\") {\n    return convertWeight(\"kg\", \"g\", weight);\n  }\n}\n\n/**\n * @private\n * @summary Convert individual line items of an order\n * @param {Array} items - The items on the order object\n * @param {Object} order - The order we are converting for\n * @returns {Array} An array of converted line items\n */\nfunction convertLineItems(items, order) {\n  const lineItems = items.map((item) => {\n    const lineItem = {};\n    lineItem.fulfillable_quantity = item.quantity;\n    lineItem.fulfillment_service = \"manual\";\n    lineItem.fullfillment_status = null;\n    if (item.parcel && item.parcel.weight) {\n      lineItem.grams = normalizeWeight(item.parcel.weight, item.shopId);\n    }\n    lineItem.id = item._id;\n    lineItem.product_id = item.productId;\n    lineItem.quantity = item.quantity;\n    lineItem.requires_shipping = item.product.requiresShipping;\n    if (item.variants.sku) { // this doesn't appear to be written anywhere but it's in the schema\n      lineItem.sku = item.variants.sku;\n    }\n    lineItem.title = item.product.title;\n    lineItem.variant_id = item.variants._id;\n    lineItem.variant_title = item.variants.title;\n    lineItem.vendor = item.product.vendor;\n    lineItem.taxable = item.variants.taxable;\n    lineItem.price = item.variants.price;\n    if (order.taxes) {\n      lineItem.tax_lines = [];\n      // when using Avalara we get tax detail\n      // get the tax iten for this particular line\n      const taxItem = order.taxes.find((tax) => tax.lineNumber === item._id);\n      taxItem.details.forEach((detail) => {\n        const taxLine = {\n          title: detail.taxName,\n          price: accounting.toFixed(detail.taxCalculated, 2),\n          rate: detail.rate\n        };\n        lineItem.tax_lines.push(taxLine);\n      });\n    }\n    // for custom tax codes we get this one data point\n    if (item.taxData) {\n      lineItem.tax_lines = [{\n        title: item.taxData.taxCode,\n        price: accounting.toFixed((item.taxData.rate / 100) * item.variants.price, 2),\n        rate: item.taxData.rate / 100\n      }];\n    }\n    return lineItem;\n  });\n  return lineItems;\n}\n\n/**\n * @private\n * @summary Convert address object into Shopify-compatible format\n * @param {Object} address - the address to convert\n * @returns {Object} converted address\n */\nfunction convertAddress(address) {\n  const convertedAddress = {};\n  convertedAddress.address1 = address.address1;\n  convertedAddress.address2 = address.address2 || \"\";\n  convertedAddress.city = address.city;\n  convertedAddress.country = address.country;\n  convertedAddress.country_code = address.country;\n  convertedAddress.name = address.fullName;\n  const [firstName, ...lastName] = address.fullName.split(\" \");\n  convertedAddress.first_name = firstName;\n  convertedAddress.last_name = lastName.join(\" \");\n  convertedAddress.phone = address.phone;\n  convertedAddress.zip = address.postal;\n  convertedAddress.province_code = address.region;\n  return convertedAddress;\n}\n\nasync function isExistingCustomer(address, email, shopify) {\n  const query = `email:${email}`;\n  const customerByEmailPromise = shopify.customer.search({ query });\n  return customerByEmailPromise;\n}\n\nfunction normalizePhone(phoneToNormalize, countryCode) {\n  const { phone } = parse(phoneToNormalize, countryCode);\n  const formattedPhone = format(phone, countryCode, \"International\").replace(/\\s/g, \"\");\n  return formattedPhone;\n}\n\n/**\n * @private\n * @summary Create a customer object in Shopify-compatible format\n * @param {Object} address - Converted address object\n * @param {Object} order - Original order we are converting\n * @returns {Object} Shopify-compatible customer object\n */\nfunction convertCustomer(address, order) {\n  const formattedPhone = normalizePhone(address.phone, address.country_code);\n  const customer = {\n    accepts_marketing: false,\n    email: order.email,\n    phone: formattedPhone,\n    first_name: address.first_name,\n    last_name: address.last_name\n  };\n  return customer;\n}\n\n/**\n * @private\n * @summary Create a shippingMethod object to record shipping on a Shopify order\n * @param {Object} order - The order with shipping data\n * @param {Number} index - The shop index to convert\n * @returns {Array} An array of shipping lines\n */\nfunction convertShipping(order, index) {\n  const shippingLines = [];\n  // I don't think we need to check this because we should **always** have a shipping record per shop\n  // so worst case shipmentMethod is undefined and we will skip\n  const method = order.shipping[index].shipmentMethod;\n  if (method) {\n    const shippingMethod = {\n      code: method.name,\n      price: method.rate,\n      title: method.name,\n      source: method.carrier\n    };\n    shippingLines.push(shippingMethod);\n  }\n  return shippingLines;\n}\n\n\n/**\n * @summary Export an order to Shopify\n * @param {Object} doc - The order to convert\n * @returns {Promise.<Array>} - An array of exported orders\n */\nexport async function exportToShopify(doc) {\n  const numShopOrders = doc.billing.length; // if we have multiple billing, we have multiple shops\n  Logger.debug(`Exporting ${numShopOrders} order(s) to Shopify`);\n  const shopifyOrders = [];\n  for (let index = 0; index < numShopOrders; index += 1) {\n    // send a shopify order once for each merchant order\n    const { shopId } = doc.billing[index];\n    const apiCreds = getApiInfo(shopId);\n    const shopify = new Shopify(apiCreds);\n    const existingCustomerQuery = await isExistingCustomer(doc.billing[index].address, doc.email, shopify); // eslint-disable-line no-await-in-loop\n    // this should never happen but I want a meaningful error here in case it does\n    if (existingCustomerQuery.length > 1) {\n      throw new Meteor.Error(\"duplicate-customer\", \"Discovered more than one customer in Shopify. Cannot continue\");\n    }\n    const existingCustomer = existingCustomerQuery[0];\n    const shopifyOrder = convertOrderToShopifyOrder(doc, index, shopId, existingCustomer);\n    Logger.debug(\"sending shopify order\", shopifyOrder, doc._id);\n    const newShopifyOrder = await shopify.order.create(shopifyOrder); // eslint-disable-line no-await-in-loop\n    markExported(newShopifyOrder, shopId, doc);\n    shopifyOrders.push(newShopifyOrder);\n  }\n  return shopifyOrders;\n}\n\n\n/**\n * @private\n * @summary Mark orders as exported after export\n * @param {Object} exportedOrder the converted order\n * @param {String} shopId - the shopId to attach\n * @param {Object} order - the order to be marked\n */\nfunction markExported(exportedOrder, shopId, order) {\n  Orders.update({ _id: order._id }, {\n    $push: {\n      exportHistory: {\n        status: \"success\",\n        dateAttempted: new Date(),\n        exportMethod: \"reaction-connectors-shopify\",\n        destinationIdentifier: exportedOrder.id,\n        shopId\n      }\n    }\n  });\n}\n","/* eslint camelcase: 0 */\nimport Shopify from \"shopify-api-node\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Random } from \"meteor/random\";\nimport { check, Match } from \"meteor/check\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\nimport { Accounts } from \"/lib/collections\";\nimport { getApiInfo } from \"../api/api\";\nimport { connectorsRoles } from \"../../lib/roles\";\n\n/**\n * @file Shopify connector import customer method\n *       contains methods and helpers for setting up and removing synchronization between\n *       a Shopify store and a Reaction shop\n * @module connectors-shopify\n */\n\n/**\n * Transforms a Shopify customer into a Reaction customer.\n * @private\n * @method createReactionCustomerFromShopifyCustomer\n * @param  {object} options Options object\n * @param  {object} options.shopifyCustomer the Shopify customer object\n * @param  {string} options.shopId The shopId we're importing for\n * @return {object} An object that fits the `Account` schema\n *\n * @todo consider abstracting private Shopify import helpers into a helpers file\n */\nfunction createReactionCustomerFromShopifyCustomer(options) {\n  const { shopifyCustomer, shopId } = options;\n\n  const userId = Random.id();\n  const reactionProfile = { currency: Reaction.getPrimaryShopCurrency() };\n  // shopify is very forgiving so expect plenty of nulls !!\n  const fakePhone = \"33888888888\";\n  const fakeZip = \"00000\";\n  const first_name = shopifyCustomer.first_name || \"no_first_name\";\n  const last_name = shopifyCustomer.last_name || \"no_last_name\";\n  const name = `${first_name} ${last_name}`;\n\n  const reactionCustomer = {\n    createdAt: shopifyCustomer.created_at,\n    name,\n    acceptsMarketing: shopifyCustomer.accepts_marketing,\n    note: shopifyCustomer.note,\n    metafields: [],\n    shopId, // set shopId to active shopId;\n    userId,\n    shopifyId: shopifyCustomer.id.toString(), // save it here to make sync lookups cheaper\n    tags: shopifyCustomer.tags,\n    orders_count: shopifyCustomer.orders_count,\n    updatedAt: new Date(),\n    workflow: {\n      status: \"new\",\n      workflow: [\"imported\"]\n    },\n    skipRevision: true\n  };\n\n  // shopify customer import will fail if we add a null email\n  if (shopifyCustomer.email !== null) {\n    // we make sure the email from shopify doesn't have typo like commas instead of dots\n    // which is a quite common typo\n    shopifyCustomer.email = shopifyCustomer.email.replace(/,/g, \".\");\n    // we remove any character that is not valid from email address.\n    // TODO use Reaction validate methods instead...\n    shopifyCustomer.email = shopifyCustomer.email.replace(/[^a-zA-Z0-9!#$%&'*+-/=?^_`{|}~@]/g, \"\");\n    try {\n      reactionCustomer.emails = [{ address: shopifyCustomer.email }];\n    } catch (error) {\n      Logger.error(\"There was a problem importing your customers email from Shopify\", error);\n      throw new Meteor.Error(\"There was a problem importing your customers email from Shopify\", error);\n    }\n  }\n  // if shopify customer has just registered chances are\n  // that's not even activated and there will no default_address field\n  // so I'll have to check against the length of addresses instead.\n  if (shopifyCustomer.addresses.length > 0) {\n    // some addresses are spammy and if address1 is empty\n    // high chances are that most fields will be missing\n    // so might stop here and forget about this addresses\n    if (shopifyCustomer.default_address.address1 !== \"\") {\n      // ok we have a default address, and does not look spammy\n      const shopifyCustomerAddress = shopifyCustomer.default_address;\n      // Shopify has phone fields with null value\n      // let's add a fakePhone so reaction validator will not whine about it\n      if (shopifyCustomerAddress.phone === \"\" || shopifyCustomerAddress.phone === null) {\n        shopifyCustomerAddress.phone = fakePhone;\n      }\n      // no province / state, np I'll stick the city in it\n      if (shopifyCustomerAddress.province === \"\" || shopifyCustomerAddress.province === null) {\n        shopifyCustomerAddress.province = shopifyCustomerAddress.city;\n      }\n      // no postal code... lets put a fakeZip TODO auto zip finder\n      if (shopifyCustomerAddress.zip === \"\" || shopifyCustomerAddress.zip === null) {\n        shopifyCustomerAddress.zip = fakeZip;\n      }\n\n      const reactionAddress = {\n        fullName: name,\n        address1: shopifyCustomerAddress.address1,\n        address2: shopifyCustomerAddress.address2,\n        city: shopifyCustomerAddress.city,\n        company: shopifyCustomerAddress.company,\n        phone: shopifyCustomerAddress.phone,\n        region: shopifyCustomerAddress.province,\n        postal: shopifyCustomerAddress.zip,\n        country: shopifyCustomerAddress.country,\n        isCommercial: false,\n        isBillingDefault: shopifyCustomerAddress.default,\n        isShippingDefault: shopifyCustomerAddress.default\n      };\n\n      reactionProfile.addressBook = [reactionAddress];\n\n      try {\n        reactionCustomer.profile = reactionProfile;\n      } catch (error) {\n        Logger.error(\"There was a problem importing your customers addresses from Shopify\", error);\n        throw new Meteor.Error(\"There was a problem importing your customers addresses from Shopify\", error);\n      }\n    }\n  }\n\n  return reactionCustomer;\n}\n\nexport const methods = {\n  /**\n   * Imports customers for the active Reaction Shop from Shopify with the API credentials setup for that shop.\n   *\n   * @async\n   * @method connectors/shopify/import/customers\n   * @param {object} options An object of options for the shopify API call. Available options here: https://help.shopify.com/api/reference/customer#index\n   * @returns {array} An array of the Reaction account _ids that were created.\n   */\n  async \"connectors/shopify/import/customers\"(options) {\n    check(options, Match.Maybe(Object));\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(403, \"Access Denied\");\n    }\n\n    const apiCreds = getApiInfo();\n    const shopify = new Shopify(apiCreds);\n    const shopId = Reaction.getShopId();\n    const limit = 250; // Shopify returns a maximum of 250 results per request\n    const ids = [];\n    const opts = Object.assign({}, {\n      published_status: \"published\",\n      limit\n    }, { ...options });\n\n    try {\n      const customerCount = await shopify.customer.count();\n      const numPages = Math.ceil(customerCount / limit);\n      const pages = [...Array(numPages).keys()];\n      Logger.info(`Shopify Connector is preparing to import ${customerCount} customers`);\n\n      for (const page of pages) {\n        Logger.debug(`Importing page ${page + 1} of ${numPages} - each page has ${limit} products`);\n        const shopifyCustomers = await shopify.customer.list({ ...opts, page }); // eslint-disable-line no-await-in-loop\n        for (const shopifyCustomer of shopifyCustomers) {\n          if (!Accounts.findOne({ shopifyId: shopifyCustomer.id }, { fields: { _id: 1 } })) {\n            // Setup reaction customer\n            const reactionCustomer = createReactionCustomerFromShopifyCustomer({ shopifyCustomer, shopId });\n\n            // Insert customer, save id\n            const reactionCustomerId = Accounts.insert(reactionCustomer, { publish: true });\n            Hooks.Events.run(\"afterAccountsInsert\", Meteor.userId(), reactionCustomerId);\n            ids.push(reactionCustomerId);\n\n            Accounts.update({ _id: reactionCustomerId }, { publish: true });\n            Hooks.Events.run(\"afterAccountsUpdate\", Meteor.userId(), {\n              accountId: reactionCustomerId,\n              updatedFields: [\"forceIndex\"]\n            });\n          } else { // customer already exists check\n            Logger.info(`Customer ${shopifyCustomer.last_name} ${shopifyCustomer.id} already exists`);\n          }\n        } // End customer loop\n      } // End pages loop\n      Logger.info(`Reaction Shopify Connector has finished importing ${ids.length} customers`);\n\n      return ids;\n    } catch (error) {\n      Logger.error(\"There was a problem importing your customers from Shopify\", error);\n      throw new Meteor.Error(\"There was a problem importing your customers from Shopify\", error);\n    }\n  }\n};\n\nMeteor.methods(methods);\n","import \"./products\";\nimport \"./customers\";\n","/* eslint camelcase: 0 */\nimport Shopify from \"shopify-api-node\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Logger, Reaction } from \"/server/api\";\nimport { check, Match } from \"meteor/check\";\nimport { Products, Jobs, Tags } from \"/lib/collections\";\nimport { getApiInfo } from \"../api/api\";\nimport { connectorsRoles } from \"../../lib/roles\";\nimport { importImages } from \"../../jobs/image-import\";\n\n/**\n * @file Shopify connector import product method\n *       contains methods and helpers for setting up and removing synchronization between\n *       a Shopify store and a Reaction shop\n * @module connectors-shopify\n */\n\n/**\n * Transforms a Shopify product into a Reaction product.\n * @private\n * @method createReactionProductFromShopifyProduct\n * @param  {object} options Options object\n * @param  {object} options.shopifyProduct the Shopify product object\n * @param  {string} options.shopId The shopId we're importing for\n * @param  {array} options.hashtags An array of hashtag strings that should be attached to this product.\n * @return {object} An object that fits the `Product` schema\n *\n * @todo consider abstracting private Shopify import helpers into a helpers file\n */\nfunction createReactionProductFromShopifyProduct(options) {\n  const { shopifyProduct, shopId, hashtags } = options;\n  const reactionProduct = {\n    ancestors: [],\n    createdAt: new Date(),\n    description: shopifyProduct.body_html.replace(/(<([^>]+)>)/ig, \"\"), // Strip HTML\n    handle: shopifyProduct.handle,\n    hashtags,\n    isDeleted: false,\n    isVisible: false,\n    isSoldOut: false,\n    isLowQuantity: false,\n    isBackorder: false,\n    metafields: [],\n    pageTitle: shopifyProduct.pageTitle,\n    price: { range: \"0\" },\n    productType: shopifyProduct.product_type,\n    requiresShipping: true,\n    shopId, // set shopId to active shopId;\n    shopifyId: shopifyProduct.id.toString(), // save it here to make sync lookups cheaper\n    template: \"productDetailSimple\",\n    title: shopifyProduct.title,\n    type: \"simple\",\n    updatedAt: new Date(),\n    vendor: shopifyProduct.vendor,\n    workflow: {\n      status: \"new\",\n      workflow: [\"imported\"]\n    },\n    skipRevision: true\n  };\n\n  // Add shopify options to meta fields as is.\n  if (Array.isArray(shopifyProduct.options)) {\n    shopifyProduct.options.forEach((option) => {\n      reactionProduct.metafields.push({\n        scope: \"shopify\",\n        key: option.name,\n        value: option.values.join(\", \"),\n        namespace: \"options\"\n      });\n    });\n  }\n\n  return reactionProduct;\n}\n\n/**\n * Transforms a Shopify variant into a Reaction variant.\n * @private\n * @method createReactionVariantFromShopifyVariant\n * @param  {object} options { shopifyVariant, variant, index, ancestors, shopId }\n * @return {object} An object that fits the `ProductVariant` schema\n */\nfunction createReactionVariantFromShopifyVariant(options) {\n  const { shopifyVariant, variant, index, ancestors, shopId } = options;\n  const reactionVariant = {\n    ancestors,\n    barcode: shopifyVariant.barcode,\n    compareAtPrice: shopifyVariant.compare_at_price,\n    createdAt: new Date(),\n    height: 0,\n    index,\n    inventoryManagement: true,\n    inventoryPolicy: shopifyVariant.inventory_policy === \"deny\",\n    inventoryQuantity: shopifyVariant.inventory_quantity >= 0 ? shopifyVariant.inventory_quantity : 0,\n    isDeleted: false,\n    isVisible: true,\n    length: 0,\n    lowInventoryWarningThreshold: 0,\n    metafields: [],\n    optionTitle: variant,\n    price: parseFloat(shopifyVariant.price),\n    requiresShipping: shopifyVariant.requires_shipping,\n    shopId,\n    shopifyId: shopifyVariant.id.toString(), // Save for easy sync lookups\n    sku: shopifyVariant.sku,\n    taxable: true,\n    taxCode: \"0000\",\n    title: variant,\n    type: \"variant\",\n    updatedAt: new Date(),\n    weight: normalizeWeight(shopifyVariant.grams),\n    weightInGrams: shopifyVariant.grams,\n    width: 0,\n    workflow: {\n      status: \"synced\",\n      workflow: [\"imported\"]\n    },\n    skipRevision: true\n  };\n\n  if (shopifyVariant.inventory_management === null) {\n    reactionVariant.inventoryQuantity = 0;\n    reactionVariant.inventoryManagement = false;\n  }\n\n  return reactionVariant;\n}\n\n/**\n * Finds the images associated with a particular shopify variant\n * @private\n * @method findVariantImages\n * @param  {number} shopifyVariantId The variant `id` from shopify\n * @param  {array} images An array of image objects from a Shopify product\n * @return {array} Returns an array of image objects that match the passed shopifyVariantId\n */\nfunction findVariantImages(shopifyVariantId, images) {\n  return images.filter((imageObj) => imageObj.variant_ids.indexOf(shopifyVariantId) !== -1);\n}\n\n/**\n * Finds the images associated with a particular shopify variant\n * @method findProductImages\n * @private\n * @param  {number} shopifyProductId The product `id` from shopify\n * @param  {array} images An array of image objects from a Shopify product\n * @return {array} Returns an array of image objects that match the passed shopifyProductId\n */\nfunction findProductImages(shopifyProductId, images) {\n  return images.filter((imageObj) => imageObj.product_id === shopifyProductId);\n}\n\n\n/**\n * cache all existing tags to memory {slug => id} so that when we're importing products we can\n * lookup tags without a database call.\n * @method createTagCache\n * @private\n * @return {object} Dictionary of tag slugs mapping to the associated _id\n * @todo: For apps with large collections of tags (5k+), this may be less desirable than checking each tag against mongo\n *        That would cause each product tag we find to hit the database at least once. We could make this optional\n */\nfunction createTagCache() {\n  return Tags.find({}).fetch().reduce((cache, tag) => {\n    if (!cache[tag.slug]) {\n      cache[tag.slug] = tag._id;\n    }\n    return cache;\n  }, {});\n}\n\n\n/**\n * Finds and returns arrays of option values for each of Shopify's option layers\n * returns an object consisting of the following three values:\n * shopifyVariants representing the first option on the shopify product (`option1` in the variant)\n * shopifyOptions representing the second option on the shopify product (`option2` in the variant)\n * shopifyTernary representing the third option on the shopify product (`option3` in the variant)\n * any of these will return undefined if the product does not have an option at that layer.\n * @private\n * @method getShopifyVariantsAndOptions\n * @param  {object} shopifyProduct The shopify product we are importing\n * @return {object} returns an object consisting of shopifyVariants, shopifyOptions, and shopifyTernaryOptions\n */\nfunction getShopifyVariantsAndOptions(shopifyProduct) {\n  let shopifyVariants;\n  let shopifyOptions;\n  let shopifyTernaryOptions;\n  // Get variant and option details\n  if (shopifyProduct.options && Array.isArray(shopifyProduct.options)) {\n    // This product has variants\n    if (shopifyProduct.options.length > 0) {\n      shopifyVariants = [...shopifyProduct.options[0].values];\n    }\n\n    // This product has options\n    if (shopifyProduct.options.length > 1) {\n      shopifyOptions = [...shopifyProduct.options[1].values];\n    }\n\n    if (shopifyProduct.options.length > 2) {\n      shopifyTernaryOptions = [...shopifyProduct.options[2].values];\n    }\n  }\n  return { shopifyVariants, shopifyOptions, shopifyTernaryOptions };\n}\n\n\n/**\n * Transforms a weight in grams to a weight in the shop's default unitsOfMeasure\n * @private\n * @method normalizeWeight\n * @param  {number} weight weight of the product in grams\n * @return {number} weight of the product in the shop's default unitsOfMeasure\n * @todo get store unitsOfMeasure, convert to store unitsOfMeasure from grams, return converted weight\n */\nfunction normalizeWeight(weight) {\n  return weight;\n}\n\n/**\n * Creates a new job to save an image from a given url\n * Saves an image from a url to the Collection FS image storage location\n * (default: Mongo GridFS)\n * @private\n * @method saveImage\n * @param  {string}  url url of the image to save\n * @param  {object}  metadata metadata to save with the image\n * @return {undefined}\n */\nfunction saveImage(url, metadata) {\n  new Job(Jobs, \"connectors/shopify/import/image\", { url, metadata })\n    .priority(\"normal\")\n    .retry({\n      retries: 5,\n      wait: 5000,\n      backoff: \"exponential\" // delay by twice as long for each subsequent retry\n    }).save();\n}\n\nexport const methods = {\n  /**\n   * Imports products for the active Reaction Shop from Shopify with the API credentials setup for that shop.\n   *\n   * @async\n   * @method connectors/shopify/import/products\n   * @param {object} options An object of options for the shopify API call. Available options here: https://help.shopify.com/api/reference/product#index\n   * @returns {array} An array of the Reaction product _ids (including variants and options) that were created.\n   */\n  async \"connectors/shopify/import/products\"(options) {\n    check(options, Match.Maybe(Object));\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const apiCreds = getApiInfo();\n    const shopify = new Shopify(apiCreds);\n    const shopId = Reaction.getShopId();\n    const limit = 50; // Shopify returns a maximum of 250 results per request\n    const tagCache = createTagCache();\n    const ids = [];\n    const opts = Object.assign({}, {\n      published_status: \"published\",\n      limit\n    }, { ...options });\n\n    try {\n      const productCount = await shopify.product.count();\n      const numPages = Math.ceil(productCount / limit);\n      const pages = [...Array(numPages).keys()];\n      Logger.info(`Shopify Connector is preparing to import ${productCount} products`);\n\n      for (const page of pages) {\n        Logger.debug(`Importing page ${page + 1} of ${numPages} - each page has ${limit} products`);\n        const shopifyProducts = await shopify.product.list({ ...opts, page }); // eslint-disable-line no-await-in-loop\n        for (const shopifyProduct of shopifyProducts) {\n          if (!Products.findOne({ shopifyId: shopifyProduct.id }, { fields: { _id: 1 } })) {\n            Logger.debug(`Importing ${shopifyProduct.title}`);\n            const price = { min: null, max: null, range: \"0.00\" };\n            let isSoldOut = true;\n            let isBackorder = false;\n\n            // Get tags from shopify and register them if they don't exist.\n            // push tag Id's into our hashtags array for use in the product\n            // We can't load all tags beforehand because Shopify doesn't have a tags API\n            const hashtags = [];\n            const shopifyTags = shopifyProduct.tags.split(\",\");\n            for (const tag of shopifyTags) {\n              if (tag !== \"\") {\n                const normalizedTag = {\n                  name: tag,\n                  slug: Reaction.getSlug(tag),\n                  shopId,\n                  isTopLevel: false,\n                  updatedAt: new Date(),\n                  createdAt: new Date()\n                };\n\n                // If we have a cached tag for this slug, we don't need to create a new one\n                if (!tagCache[normalizedTag.slug]) {\n                  // this tag doesn't exist, create it, add it to our tag cache\n                  normalizedTag._id = Tags.insert(normalizedTag);\n                  tagCache[normalizedTag.slug] = normalizedTag._id;\n                }\n                // push the tag's _id into hashtags from the cache\n                hashtags.push(tagCache[normalizedTag.slug]);\n              }\n            }\n\n            // Get Shopify variants, options and ternary options\n            const { shopifyVariants, shopifyOptions, shopifyTernaryOptions } = getShopifyVariantsAndOptions(shopifyProduct);\n\n            // Setup reaction product\n            const reactionProduct = createReactionProductFromShopifyProduct({ shopifyProduct, shopId, hashtags });\n\n            // Insert product, save id\n            const reactionProductId = Products.insert(reactionProduct, { selector: { type: \"simple\" }, publish: true });\n            ids.push(reactionProductId);\n\n            // Save the primary image to the grid and as priority 0\n            saveImage(shopifyProduct.image.src, {\n              ownerId: Meteor.userId(),\n              productId: reactionProductId,\n              variantId: reactionProductId,\n              shopId,\n              priority: 0,\n              toGrid: 1\n            });\n\n            // Save all remaining product images to product\n            const productImages = findProductImages(shopifyProduct.id, shopifyProduct.images);\n            for (const productImage of productImages) {\n              if (shopifyProduct.image.id !== productImage.id) {\n                saveImage(productImage.src, {\n                  ownerId: Meteor.userId(),\n                  productId: reactionProductId,\n                  variantId: reactionProductId,\n                  shopId,\n                  priority: productImage.position, // Shopify index positions starting at 1.\n                  toGrid: 0\n                });\n              }\n            }\n\n            // If variantLabel exists, we have at least one variant\n            if (shopifyVariants) {\n              Logger.debug(`Importing ${shopifyProduct.title} variants`);\n\n              shopifyVariants.forEach((variant, i) => {\n                const shopifyVariant = shopifyProduct.variants.find((v) => v.option1 === variant);\n\n                if (shopifyVariant) {\n                  // create the Reaction variant\n                  const reactionVariant = createReactionVariantFromShopifyVariant({\n                    shopifyVariant,\n                    variant,\n                    index: i,\n                    ancestors: [reactionProductId],\n                    shopId\n                  });\n\n                  // insert the Reaction variant\n                  const reactionVariantId = Products.insert(reactionVariant, { publish: true });\n                  ids.push(reactionVariantId);\n\n                  // If we have shopify options, create reaction options\n                  if (shopifyOptions) {\n                    Logger.debug(`Importing ${shopifyProduct.title} ${variant} options`);\n                    shopifyOptions.forEach((option, j) => {\n                      // Find the option that nests under our current variant.\n                      const shopifyOption = shopifyProduct.variants.find((o) => o.option1 === variant && o.option2 === option);\n\n                      if (shopifyOption) {\n                        const reactionOption = createReactionVariantFromShopifyVariant({\n                          shopifyVariant: shopifyOption,\n                          variant: option,\n                          index: j,\n                          ancestors: [reactionProductId, reactionVariantId],\n                          shopId\n                        });\n\n                        const reactionOptionId = Products.insert(reactionOption, { type: \"variant\" });\n                        ids.push(reactionOptionId);\n                        Logger.debug(`Imported ${shopifyProduct.title} ${variant}/${option}`);\n\n                        // Update max price\n                        if (price.max === null || price.max < reactionOption.price) {\n                          price.max = reactionOption.price;\n                        }\n\n                        // Update min price\n                        if (price.min === null || price.min > reactionOption.price) {\n                          price.min = reactionOption.price;\n                        }\n\n                        // Update denormalized sold out status\n                        if (isSoldOut && reactionOption.inventoryQuantity > 0) {\n                          isSoldOut = false;\n                        }\n\n                        // Update denormalized backordered status\n                        // if at least one variant has inventoryPolicy = false, then the product isBackorder\n                        if (!isBackorder) {\n                          isBackorder = !reactionOption.inventoryPolicy;\n                        }\n\n                        // Save all relevant variant images to our option\n                        const optionImages = findVariantImages(shopifyOption.id, shopifyProduct.images);\n                        for (const [index, optionImage] of optionImages.entries()) {\n                          saveImage(optionImage.src, {\n                            ownerId: Meteor.userId(),\n                            productId: reactionProductId,\n                            variantId: reactionOptionId,\n                            shopId,\n                            priority: 1,\n                            toGrid: index === 0 ? 1 : 0 // We save the first of each variant image to the grid\n                          });\n                        }\n\n                        // THIS LOOP INSERTS PRODUCTS A LEVEL DEEPER THAN THE REACTION\n                        // UI CURRENTLY SUPPORTS. IF YOUR SHOPIFY STORE USES THREE OPTION\n                        // LEVELS, YOU WILL NEED TO BUILD UI SUPPORT FOR THAT.\n                        if (shopifyTernaryOptions) {\n                          Logger.warn(\"Importing shopify product with 3 options. The Reaction UI does not currently support this.\");\n                          Logger.debug(`Importing ${shopifyProduct.title} ${variant} ${option} options`);\n                          shopifyTernaryOptions.forEach((ternaryOption, k) => {\n                            // Find the option that nests under our current variant.\n                            const shopifyTernaryOption = shopifyProduct.variants.find((o) => o.option1 === variant && o.option2 === option && o.option3 === ternaryOption); // eslint-disable-line max-len\n\n                            if (shopifyTernaryOption) {\n                              const reactionTernaryOption = createReactionVariantFromShopifyVariant({\n                                shopifyVariant: shopifyTernaryOption,\n                                variant: ternaryOption,\n                                index: k,\n                                ancestors: [reactionProductId, reactionVariantId, reactionOptionId],\n                                shopId\n                              });\n\n                              const reactionTernaryOptionId = Products.insert(reactionTernaryOption, { type: \"variant\" });\n                              ids.push(reactionTernaryOptionId);\n                              Logger.debug(`Imported ${shopifyProduct.title} ${variant}/${option}/${ternaryOption}`);\n\n                              // Update max price\n                              if (price.max === null || price.max < reactionTernaryOption.price) {\n                                price.max = reactionTernaryOption.price;\n                              }\n\n                              // Update min price\n                              if (price.min === null || price.min > reactionTernaryOption.price) {\n                                price.min = reactionTernaryOption.price;\n                              }\n\n                              // Update denormalized sold out status\n                              if (isSoldOut && reactionTernaryOption.inventoryQuantity > 0) {\n                                isSoldOut = false;\n                              }\n\n                              // Update denormalized backordered status\n                              // if at least one variant has inventoryPolicy = false, then the product isBackorder\n                              if (!isBackorder) {\n                                isBackorder = !reactionTernaryOption.inventoryPolicy;\n                              }\n\n                              // Save all relevant variant images to our option\n                              const ternaryOptionImages = findVariantImages(shopifyTernaryOption.id, shopifyProduct.images);\n                              for (const [index, ternaryOptionImage] of ternaryOptionImages.entries()) {\n                                saveImage(ternaryOptionImage.src, {\n                                  ownerId: Meteor.userId(),\n                                  productId: reactionProductId,\n                                  variantId: reactionOptionId,\n                                  shopId,\n                                  priority: 1,\n                                  toGrid: index === 0 ? 1 : 0 // We save the first of each variant image to the grid\n                                });\n                              } // So many close parens and brackets. Don't get lost.\n                            }\n                          }); // End shopifyTernaryOptions forEach loop\n                        }\n                      }\n                    }); // End shopifyOptions forEach loop\n                  } else {\n                    // Product does not have options, just variants\n                    // Update max price\n                    if (price.max === null || price.max < reactionVariant.price) {\n                      price.max = reactionVariant.price;\n                    }\n\n                    // Update min price\n                    if (price.min === null || price.min > reactionVariant.price) {\n                      price.min = reactionVariant.price;\n                    }\n\n                    // Update denormalized sold out status\n                    if (isSoldOut && reactionVariant.inventoryQuantity > 0) {\n                      isSoldOut = false;\n                    }\n\n                    // Update denormalized backordered status\n                    // if at least one variant has inventoryPolicy = false, then the product isBackorder\n                    if (!isBackorder) {\n                      isBackorder = !reactionVariant.inventoryPolicy;\n                    }\n\n                    // Save all relevant variant images to our variant.\n                    const variantImages = findVariantImages(shopifyVariant.id, shopifyProduct.images);\n                    for (const [index, variantImage] of variantImages.entries()) {\n                      saveImage(variantImage.src, {\n                        ownerId: Meteor.userId(),\n                        productId: reactionProductId,\n                        variantId: reactionVariantId,\n                        shopId,\n                        priority: 1,\n                        toGrid: index === 0 ? 1 : 0 // We save the first of each variant image to the grid\n                      });\n                    }\n                    Logger.debug(`Imported ${shopifyProduct.title} ${variant}`);\n                  }\n                }\n              });\n            }\n\n            // Set final product price\n            if (price.min !== price.max) {\n              price.range = `${price.min} - ${price.max}`;\n            } else {\n              price.range = `${price.max}`;\n            }\n            Products.update({\n              _id: reactionProductId\n            }, {\n              $set: {\n                price,\n                isSoldOut,\n                isBackorder\n              }\n            }, { selector: { type: \"simple\" }, publish: true });\n\n            Logger.debug(`Product ${shopifyProduct.title} added`);\n          } else { // product already exists check\n            Logger.debug(`Product ${shopifyProduct.title} already exists`);\n          }\n        } // End product loop\n      } // End pages loop\n      Logger.info(`Reaction Shopify Connector has finished importing ${ids.length} products and variants`);\n\n      // Run jobs to import all queued images;\n      importImages();\n      return ids;\n    } catch (error) {\n      Logger.error(\"There was a problem importing your products from Shopify\", error);\n      throw new Meteor.Error(\"There was a problem importing your products from Shopify\", error);\n    }\n  }\n};\n\nMeteor.methods(methods);\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\nimport { connectorsRoles } from \"../../lib/roles\";\n\nexport const methods = {\n  /**\n   * @summary define hooks handlers for adding event hooks\n   * @param {String} hook - The name of the hook to add a handler for\n   * @returns {Number} Results of Packages update\n   */\n  \"synchooks/shopify/addHook\": (hook) => {\n    check(hook, { name: String, checked: Boolean });\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const [topic, event, syncType] = hook.name.split(\":\");\n    const hookSetting = { topic, event, syncType };\n    return Packages.update({\n      \"name\": \"reaction-connectors-shopify\",\n      \"shopId\": Reaction.getShopId(),\n      // This $not $elemMatch block prevents us from creating duplicate synchooks as we won't find a package to update that\n      // matches this shopId and existing synchook\n      \"settings.synchooks\": {\n        $not: {\n          $elemMatch: {\n            topic: \"orders\",\n            event: \"orders/create\",\n            syncType: \"exportToShopify\"\n          }\n        }\n      }\n    }, {\n      $push: { \"settings.synchooks\": hookSetting }\n    });\n  },\n  /**\n   * @summary define hooks handlers for removing event hooks\n   * @param {String} hook - The name of the hook to remove a handler for\n   * @returns {Number} Results of Packages update\n   */\n  \"synchooks/shopify/removeHook\": (hook) => {\n    if (!Reaction.hasPermission(connectorsRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    check(hook, { name: String, checked: Boolean });\n    const [topic, event, syncType] = hook.name.split(\":\");\n    const hookSetting = { topic, event, syncType };\n    return Packages.update(\n      { name: \"reaction-connectors-shopify\", shopId: Reaction.getShopId() },\n      { $pull: { \"settings.synchooks\": hookSetting } }\n    );\n  }\n};\n\nMeteor.methods(methods);\n","import \"./sync\";\nimport \"./orders\";\nimport \"./hooks\";\n","import { check } from \"meteor/check\";\nimport { Hooks } from \"/server/api\";\nimport { Products } from \"/lib/collections\";\n\n/**\n * @file Methods for syncing Shopify orders\n *       contains methods and helpers for synchronization of orders between a Shopify store and a Reaction shop\n * @module connectors-shopify\n */\n\n/**\n * Given a list of variants in an ancestor chain, finds the bottommost variant\n * @private\n * @method findBottomVariant\n * @param  {array} variants Array of variant objects\n * @return {object} Bottommost variant object\n */\nfunction findBottomVariant(variants) {\n  return variants.reduce((bottomVariant, variant) => {\n    if (!bottomVariant.ancestors || !Array.isArray(bottomVariant.ancestors)) {\n      return variant;\n    }\n    if (Array.isArray(variant.ancestors)) {\n      if (variant.ancestors.length > bottomVariant.ancestors.length) {\n        return variant;\n      }\n    }\n    return bottomVariant;\n  });\n}\n\nexport const methods = {\n  /**\n   * Given an array of line items from a Shopify order, this method updates the inventory quantity for all variants\n   * in the Reaction store which have a matching shopifyId to the line items in the order\n   * @method connectors/shopify/sync/orders/created\n   * @param {object} lineItems array of line items from a Shopify order\n   * @returns {undefined}\n   */\n  adjustInventory: (lineItems) => {\n    check(lineItems, [Object]);\n\n    lineItems.forEach((lineItem) => {\n      const variantsWithShopifyId = Products.find({ shopifyId: lineItem.variant_id }).fetch();\n\n      // iterate through the variants that match this shopifyId\n      // return the one with the longest list of ancestors\n      const variant = findBottomVariant(variantsWithShopifyId);\n\n      // adjust inventory for variant and push an event into the eventLog\n      Products.update({\n        _id: variant._id\n      }, {\n        $inc: { inventoryQuantity: (lineItem.quantity * -1) },\n        $push: {\n          eventLog: {\n            title: \"Product inventory updated by Shopify webhook\",\n            type: \"update-webhook\",\n            description: `Shopify order created which caused inventory to be reduced by ${lineItem.quantity}`,\n            createdAt: new Date()\n          }\n        }\n      }, { selector: { type: \"variant\" }, publish: true });\n      Hooks.Events.run(\"afterUpdateCatalogProduct\", variant);\n    });\n  }\n};\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\n\n/**\n * @file **Shopify Connector** - Methods for setting up and removing synchronization between a Shopify store and a Reaction shop\n * @module connectors-shopify\n */\n\nexport const methods = {\n  /**\n   * Given an array of integrations, creates and registers a webhook with the Shopify store for each integration\n   * @method connectors/shopify/sync/setup\n   * @param {array} integrations Array of integrations. Each integration should take the form\n   *                                topic:method - e.g. orders/create:updateInventory\n   *                                The top will be used to subscribe to a webhook and each integration will be stored\n   *                                in the integrations array within the shopify webhooks settings\n   *  @returns {undefined}\n   */\n  \"connectors/shopify/sync/setup\"(integrations, webhooksDomain) {\n    check(integrations, [String]);\n    check(webhooksDomain, String);\n\n    // Check for permissions\n    if (!Reaction.hasPermission([\"owner\", \"settings/connectors\", \"settings/connectors/shopify\"])) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    const integrationsByTopic = integrations.reduce((topics, integration) => {\n      const splitIntegration = integration.split(\":\");\n      const topic = splitIntegration[0];\n\n      if (topics[topic]) {\n        topics[topic].push(integration);\n      } else {\n        topics[topic] = [integration];\n      }\n\n      return topics;\n    }, {});\n\n    const topics = Object.keys(integrationsByTopic);\n    topics.forEach((topic) => {\n      Logger.info(`Setting up shopify webhook ${topic} for ${integrationsByTopic[topic]}`);\n      Meteor.call(\"connectors/shopify/webhooks/create\", {\n        topic,\n        integrations: integrationsByTopic[topic],\n        webhooksDomain\n      });\n    });\n  },\n  /**\n   * wrapper method for deleting all the shopify webhooks.\n   * May be used in the future to do some checks before deleting\n   * or to be a way to selectively delete webhooks.\n   * @method connectors/shopify/sync/teardown\n   * @returns {undefined}\n   */\n  \"connectors/shopify/sync/teardown\"() {\n    // Check for permissions\n    if (!Reaction.hasPermission([\"owner\", \"settings/connectors\", \"settings/connectors/shopify\"])) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    Meteor.call(\"connectors/shopify/webhooks/deleteAll\");\n  }\n  // TODO: Add a \"connectors/shopify/sync/update\" method that can remove and add subscriptions based on integrations\n  //       Once more than one sync integration is available for Shopify, we'll need a way to update webhooks,\n  //       as well as selectively remove or add webhooks, or to add integrations to other webhooks\n};\n\nMeteor.methods(methods);\n","import \"./webhooks\";\n","import Shopify from \"shopify-api-node\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\n\n/**\n * @file Shopify connector webhook methods\n *       contains methods for creating and deleting webhooks providing\n *       synchronization between a Shopify store and a Reaction shop\n * @module connectors-shopify\n */\nexport const methods = {\n  /**\n   * Meteor method for creating a shopify webhook for the active shop\n   * See: https://help.shopify.com/api/reference/webhook for list of valid topics\n   * @async\n   * @method connectors/shopify/webhooks/create\n   * @param {object} options options object\n   * @param {string} options.topic - the shopify topic to subscribe to\n   * @param {string} [options.absoluteUrl] - Url to send webhook requests - should only be used in development mode\n   * @return {undefined}\n   */\n  async \"connectors/shopify/webhooks/create\"(options) {\n    check(options, Object);\n\n    // Check for permissions\n    if (!Reaction.hasPermission([\"owner\", \"settings/connectors\", \"settings/connectors/shopify\"])) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    // This code is duplicated in `../api/api`\n    // But is left here intentionally as we are updating the specific shopifyPkg that this returns later in this method\n    const shopifyPkg = Reaction.getPackageSettingsWithOptions({\n      shopId: Reaction.getShopId(),\n      name: \"reaction-connectors-shopify\"\n    });\n\n    if (!shopifyPkg) {\n      throw new Meteor.Error(\"server-error\", `No shopify package found for shop ${Reaction.getShopId()}`);\n    }\n\n    const { settings } = shopifyPkg;\n    const shopify = new Shopify({\n      apiKey: settings.apiKey,\n      password: settings.password,\n      shopName: settings.shopName\n    });\n\n    const host = options.webhooksDomain || Meteor.absoluteUrl();\n    const webhookAddress = `${host}webhooks/shopify/${options.topic.replace(/\\//g, \"-\")}?shopId=${Reaction.getShopId()}`;\n\n    try {\n      let shopifyId;\n      // Create webhook on Shopify if it isn't installed yet\n      const webhooks = await shopify.webhook.list({\n        address: webhookAddress\n      });\n      if (webhooks.length === 0) {\n        const webhookResponse = await shopify.webhook.create({\n          topic: options.topic,\n          address: webhookAddress,\n          format: \"json\"\n        });\n        shopifyId = webhookResponse.id;\n      } else {\n        shopifyId = webhooks[0].id;\n      }\n      const webhook = {\n        shopifyId,\n        topic: options.topic,\n        address: webhookAddress,\n        format: \"json\",\n        integrations: options.integrations\n        // TODO: Add method to update an existing webhook if we want to change the integrations that use it\n        //       E.g. turn on inventory sync, but turn off order sync - both might use the same webhook subscription\n      };\n\n\n      // Add webhook to webhooks array in Shop specific connectors-shopify pkg\n      Packages.update({ _id: shopifyPkg._id }, {\n        $addToSet: {\n          \"settings.webhooks\": webhook\n        }\n      });\n    } catch (error) {\n      Logger.error(\"server-error\", `Shopify API Error creating new webhook: ${error.message}`, error);\n      throw new Meteor.Error(\"server-error\", `Shopify API Error creating new webhook: ${error.message}`);\n    }\n  },\n  /**\n   * Given a shopifyWebhookId, delete that webhook via the Shopify API\n   * @async\n   * @method connectors/shopify/webhooks/delete\n   * @param {number} shopifyWebhookId The shopifyId of the webhook to delete\n   * @returns {number} the number of Packages updated (either 1 or 0)\n   */\n  async \"connectors/shopify/webhooks/delete\"(shopifyWebhookId) {\n    check(shopifyWebhookId, Number);\n\n    // Check for permissions\n    if (!Reaction.hasPermission([\"owner\", \"settings/connectors\", \"settings/connectors/shopify\"])) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    // This code is duplicated in `../api/api`\n    // But is left here intentionally as we are updating the specific shopifyPkg that this returns later in this method\n    const shopifyPkg = Reaction.getPackageSettingsWithOptions({\n      shopId: Reaction.getShopId(),\n      name: \"reaction-connectors-shopify\"\n    });\n\n    if (!shopifyPkg) {\n      throw new Meteor.Error(\"server-error\", `No shopify package found for shop ${Reaction.getShopId()}`);\n    }\n\n    const { settings } = shopifyPkg;\n    const shopify = new Shopify({\n      apiKey: settings.apiKey,\n      password: settings.password,\n      shopName: settings.shopName\n    });\n\n    try {\n      // delete webhook on Shopify\n      await shopify.webhook.delete(shopifyWebhookId);\n\n      // Remove webhook from webhooks array in Shop specific connectors-shopify pkg\n      return Packages.update({ _id: shopifyPkg._id }, {\n        $pull: {\n          \"settings.webhooks\": { shopifyId: shopifyWebhookId }\n        }\n      });\n    } catch (error) {\n      // If Shopify returns a 404, it means this webhook doesn't exist\n      if (error.statusCode === 404) {\n        Logger.warn(\"api-error\", \"Shopify API Error, error deleting webhook, webhook not found.\");\n\n        // In this case, we need to delete the webhook from our database anyway\n        return Packages.update({ _id: shopifyPkg._id }, {\n          $pull: {\n            \"settings.webhooks\": { shopifyId: shopifyWebhookId }\n          }\n        });\n      }\n      // If there is another error, throw it.\n      throw new Meteor.Error(\"server-error\", `Shopify API Error, error deleting webhook: ${error}`);\n    }\n  },\n  /**\n   * Delete all registered Shopify webhooks via the Shopify API\n   * @async\n   * @method connectors/shopify/webhooks/deleteAll\n   * @returns {number} the number of Packages updated (either 1 or 0)\n   */\n  async \"connectors/shopify/webhooks/deleteAll\"() {\n    // Check for permissions\n    if (!Reaction.hasPermission([\"owner\", \"settings/connectors\", \"settings/connectors/shopify\"])) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n\n    const shopifyPkg = Reaction.getPackageSettingsWithOptions({\n      shopId: Reaction.getShopId(),\n      name: \"reaction-connectors-shopify\"\n    });\n\n    if (!shopifyPkg) {\n      throw new Meteor.Error(\"server-error\", `No shopify package found for shop ${Reaction.getShopId()}`);\n    }\n\n    const { settings } = shopifyPkg;\n    const shopify = new Shopify({\n      apiKey: settings.apiKey,\n      password: settings.password,\n      shopName: settings.shopName\n    });\n\n    const registeredShopifyWebhooks = settings.webhooks;\n\n    // Exit early if no Shopify webhooks registered\n    if (!Array.isArray(registeredShopifyWebhooks) || registeredShopifyWebhooks.length <= 0) {\n      return Logger.debug(\"No Shopify webhooks registered. Exiting.\");\n    }\n\n    const responses = [];\n    // Start all asynchronous operations immediately.\n    for (const webhook of registeredShopifyWebhooks) {\n      responses.push(shopify.webhook.delete(webhook.shopifyId));\n    }\n\n    try {\n      const results = await Promise.all(responses);\n      Logger.debug(\"results\", results);\n    } catch (error) {\n      if (error.statusCode === 404) {\n        Logger.warn(\"api-warning\", \"At least one of the webhooks registered in Reaction was not found on Shopify\");\n      } else {\n        // TODO: Implement retry queue with exponential back-off for requests which are rejected\n        // because of too many requests\n        // In that case, we may need to resolve promises one-by-one instead of using Promise.all\n        Logger.error(\"api-error\", \"There was an error deleting webhooks on Shopify.\", error);\n      }\n    }\n\n    // Remove all registered webhooks\n    return Packages.update({ _id: shopifyPkg._id }, {\n      $set: {\n        \"settings.webhooks\": []\n      }\n    });\n  }\n};\n\nMeteor.methods(methods);\n","import \"./api\";\nimport \"./import\";\nimport \"./export\";\nimport \"./sync\";\nimport \"./webhooks\";\n","export * from \"./shopifyProduct\";\nexport * from \"./shopifyCustomer\";\n","/* eslint camelcase: 0 */\nimport SimpleSchema from \"simpl-schema\";\nimport { Accounts } from \"/lib/collections\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @file ShopifyCustomer\n *\n * @module connectors-shopify\n */\n\n/**\n * @name ShopifyCustomer\n * @summary ShopifyCustomer schema attached to Accounts\n * @type {SimpleSchema}\n * @property {Number} shopifyId Shopify ID\n */\nexport const ShopifyCustomer = new SimpleSchema({\n  shopifyId: {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  orders_count: {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  tags: {\n    type: String,\n    optional: true\n  }\n});\n\nregisterSchema(\"ShopifyCustomer\", ShopifyCustomer);\n\nAccounts.attachSchema(ShopifyCustomer);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { Products } from \"/lib/collections\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @file ShopifyProduct\n *\n * @module connectors-shopify\n */\n\n/**\n * @name ShopifyProduct\n * @summary ShopifyProduct schema attached to Products type \"simple\" and \"variant\"\n * @type {SimpleSchema}\n * @property {Number} shopifyId Shopify ID\n */\nexport const ShopifyProduct = new SimpleSchema({\n  shopifyId: {\n    type: SimpleSchema.Integer,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShopifyProduct\", ShopifyProduct);\n\nProducts.attachSchema(ShopifyProduct, { selector: { type: \"simple\" } });\nProducts.attachSchema(ShopifyProduct, { selector: { type: \"variant\" } });\n","import crypto from \"crypto\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Reaction } from \"/server/api\";\nimport { methods } from \"../methods/sync/orders\";\n\n/**\n * verifies that the request coming from a webhook is from the connected Shopify shop\n * We varify by hashing the body of the request with the shared secret\n * and comparing it with the sha256 hash that is sent as a header\n * @private\n * @method verifyWebhook\n * @param  {object} req request object that comes in with POST request\n * @return {boolean} true if webhook is verifiable, false otherwise\n */\nfunction verifyWebhook(req) {\n  // ensure we have a shopId in the request query string\n  if (!req || !req.query || !req.query.shopId) {\n    throw new Meteor.Error(\"access-denied\", \"webhook requests must include a shopId\");\n  }\n\n  // We'll verify the shop-domain in addition to the Reaction shopId\n  const shopUrl = req.headers[\"x-shopify-shop-domain\"];\n  const shopName = shopUrl && shopUrl.split(\".\")[0];\n\n  // Find the correct shopify package\n  const shopifyPkg = Reaction.getPackageSettingsWithOptions({\n    \"shopId\": req.query.shopId,\n    \"name\": \"reaction-connectors-shopify\",\n    \"settings.shopName\": shopName\n  });\n\n  // Fail if we can't find a shopify package\n  if (!shopifyPkg || !shopifyPkg.settings) {\n    throw new Meteor.Error(\"server-error\", `No shopify package found for shop ${Reaction.getShopId()}`);\n  }\n\n  const hmac = crypto.createHmac(\"sha256\", shopifyPkg.settings.sharedSecret).update(req.rawBody).digest(\"base64\");\n  if (hmac !== req.headers[\"x-shopify-hmac-sha256\"]) {\n    throw new Meteor.Error(\"access-denied\", \"Could not verify webhook request was from Shopify\");\n  }\n\n  return true;\n}\n\nReaction.Endpoints.add(\"post\", \"/webhooks/shopify/orders-create\", (req, res) => {\n  // We'll move the code that's in the orders-updated hook into here once it's functional\n  // easier to iterate in that hook for now.\n  Reaction.Endpoints.sendResponse(res);\n\n  // If we can verify that this request is legitimate, call our shopify/sync/orders/created\n  if (verifyWebhook(req)) {\n    methods.adjustInventory(req.body.line_items);\n  }\n});\n","import \"./orders\";\n","import { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Hooks, Reaction } from \"/server/api\";\nimport { Jobs } from \"/lib/collections\";\n\n\nfunction addExportJob(orderId) {\n  new Job(Jobs, \"connectors/shopify/export/order\", { orderId })\n    .priority(\"normal\")\n    .retry({\n      retries: 5,\n      wait: 5000,\n      backoff: \"exponential\"\n    }).save();\n}\n\n\nHooks.Events.add(\"afterOrderInsert\", (doc) => {\n  // Ensure we have items\n  if (doc && doc.items && Array.isArray(doc.items)) {\n    // Get all shopIds represented in this cart\n    const shopIdsInCart = doc.items.map((item) => item.shopId);\n\n    // get the unique set of shopIds in this cart\n    const uniqueShopIds = [...new Set(shopIdsInCart)];\n\n    // For each shopid check to see if there are synchooks are respond appropriately\n    uniqueShopIds.forEach((shopId) => {\n      const shopifyPkg = Reaction.getPackageSettingsWithOptions({\n        shopId,\n        name: \"reaction-connectors-shopify\"\n      });\n      if (shopifyPkg) {\n        const { settings } = shopifyPkg;\n        const { synchooks } = settings;\n        if (synchooks) {\n          synchooks.forEach((hook) => {\n            if (hook.topic === \"orders\" && hook.event === \"orders/create\" && hook.syncType === \"exportToShopify\") {\n              addExportJob(doc._id);\n            }\n          });\n        }\n      }\n    });\n  }\n\n  return doc;\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { FileRecord } from \"@reactioncommerce/file-collections\";\nimport { Jobs } from \"/lib/collections\";\nimport { Media } from \"/imports/plugins/core/files/server\";\nimport fetch from \"node-fetch\";\n\nasync function addMediaFromUrl({ url, metadata }) {\n  const fileRecord = await FileRecord.fromUrl(url, { fetch });\n\n  // Set workflow to \"published\" to bypass revision control on insert for this image.\n  fileRecord.metadata = { ...metadata, workflow: \"published\" };\n\n  return Media.insert(fileRecord);\n}\n\nexport const importImages = () => {\n  Jobs.processJobs(\"connectors/shopify/import/image\", {\n    pollInterval: 60 * 60 * 1000, // Retry failed images after an hour\n    workTimeout: 5 * 1000 // No image import should last more than 5 seconds\n  }, (job, callback) => {\n    const { data } = job;\n    const { url } = data;\n    try {\n      Promise.await(addMediaFromUrl(data));\n      job.done(`Finished importing image from ${url}`);\n      callback();\n    } catch (error) {\n      job.fail(`Failed to import image from ${url}.`);\n      callback();\n    }\n  });\n};\n","import exportOrders from \"./order-export\";\n\nexportOrders();\n","import { Orders, Jobs } from \"/lib/collections\";\nimport { Logger } from \"/server/api\";\nimport { exportToShopify } from \"../methods/export/orders\";\n\n/**\n * @private\n * @summary Mark orders as exported after export\n * @param {Object} order - the order to mark as failed\n */\nfunction markExportFailed(order) {\n  const shops = Object.keys(order.getItemsByShop());\n  shops.forEach((shopId) => {\n    Orders.update({ _id: order._id }, {\n      $push: {\n        exportHistory: {\n          status: \"failure\",\n          dateAttempted: new Date(),\n          exportMethod: \"reaction-connectors-shopify\",\n          shopId\n        }\n      }\n    });\n  });\n}\n\n\nexport default () => {\n  const exportOrders = Jobs.processJobs(\"connectors/shopify/export/order\", {\n    pollInterval: 5 * 60 * 1000, // Retry failed orders after 5 minutes\n    workTimeout: 30 * 1000\n  }, (job, callback) => {\n    Logger.info(\"Starting exportOrders job\");\n    const { orderId } = job.data;\n    const order = Orders.findOne(orderId);\n    try {\n      exportToShopify(order)\n        .then((exportedOrders) => {\n          Logger.debug(\"exported order(s)\", exportedOrders);\n        })\n        .catch((error) => {\n          Logger.error(\"Encountered error when exporting to shopify\", error);\n          if (error.response && error.response.body) {\n            Logger.error(error.response.body);\n          }\n          markExportFailed(order);\n        });\n      job.done(`Finished exporting order ${orderId}`);\n      callback();\n    } catch (error) {\n      job.fail(`Failed to export order ${orderId}.`);\n      callback();\n    }\n  });\n  Jobs.find({\n    type: \"connectors/shopify/export/order\",\n    status: \"ready\"\n  }).observe({\n    added() {\n      return exportOrders.trigger();\n    }\n  });\n};\n","import \"./collections\";\nimport \"./i18n\";\nimport \"./methods\";\nimport \"./endpoints/webhooks\";\nimport \"./hooks\";\nimport \"./jobs\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Shopify Connect\",\n  name: \"reaction-connectors-shopify\",\n  icon: \"fa fa-exchange\",\n  autoEnable: false,\n  settings: {\n    apiKey: \"\",\n    password: \"\",\n    sharedSecret: \"\",\n    shopName: \"\",\n    webhooks: [],\n    webhooksDomain: \"\"\n  },\n  registry: [{\n    label: \"Shopify Connect Settings\",\n    name: \"settings/connectors/shopify\",\n    icon: \"fa fa-exchange\",\n    route: \"/dashboard/connectors/shopify\",\n    provides: [\"connectorSettings\"],\n    container: \"dashboard\",\n    template: \"shopifyConnectSettings\"\n  }]\n});\n","/* eslint camelcase: 0 */\nimport { Meteor } from \"meteor/meteor\";\nimport { Packages } from \"/lib/collections\";\nimport Reaction from \"/lib/api\";\n\nfunction getSettings(settings, ref, valueName) {\n  if (settings !== null) {\n    return settings[valueName];\n  } else if (ref !== null) {\n    return ref[valueName];\n  }\n  return {};\n}\n\n// using global instance of Reaction\n// Paypal is a shared client/server stub\n// to provide normalized PayPal tooling\n\nexport const Express = {\n  expressCheckoutAccountOptions() {\n    const shopId = Reaction.getShopId();\n    const { settings } = Packages.findOne({\n      name: \"reaction-paypal\",\n      shopId,\n      enabled: true\n    });\n    let mode;\n\n    if ((settings !== null ? settings.express_mode : undefined) === true) {\n      mode = \"production\";\n    } else {\n      mode = \"sandbox\";\n    }\n    const ref = Meteor.settings.paypal;\n\n    const options = {\n      enabled: settings !== null ? settings.express.enabled : undefined,\n      mode,\n      username: getSettings(settings, ref, \"username\"),\n      password: getSettings(settings, ref, \"password\"),\n      signature: getSettings(settings, ref, \"signature\"),\n      merchantId: getSettings(settings, ref, \"merchantId\"),\n      return_url: Reaction.getAbsoluteUrl(\"paypal/done\"),\n      cancel_url: Reaction.getAbsoluteUrl(\"paypal/cancel\")\n    };\n    if (options.mode === \"sandbox\") {\n      options.url = \"https://api-3t.sandbox.paypal.com/nvp\";\n    } else {\n      options.url = \"https://api-3t.paypal.com/nvp\";\n    }\n    return options;\n  },\n  config(options) {\n    this.accountOptions = options;\n  }\n};\n","import * as PayFlow from \"./payflow\";\nimport * as Express from \"./express\";\n\nexport const PayPal = Object.assign({}, Express.Express, PayFlow.PayFlow);\n","/* eslint camelcase: 0 */\nimport { Meteor } from \"meteor/meteor\";\nimport { Packages } from \"/lib/collections\";\nimport Reaction from \"/lib/api\";\n\n// using global instance of Reaction\n// Paypal is a shared client/server stub\n// to provide normalized PayPal tooling\n\nexport const PayFlow = {\n  payflowAccountOptions() {\n    const { settings } = Packages.findOne({\n      name: \"reaction-paypal\",\n      shopId: Reaction.getShopId(),\n      enabled: true\n    });\n    let mode;\n    if ((settings !== null ? settings.payflow_mode : undefined) === true) {\n      mode = \"live\";\n    } else {\n      mode = \"sandbox\";\n    }\n    const ref = Meteor.settings.paypal;\n    const options = {\n      mode,\n      enabled: getSettings(settings, ref, \"payflow_enabled\"),\n      client_id: getSettings(settings, ref, \"client_id\"),\n      client_secret: getSettings(settings, ref, \"client_secret\")\n    };\n    if (!options.client_id) {\n      throw new Meteor.Error(\"invalid-credentials\", \"Invalid PayPal Credentials\");\n    }\n    return options;\n  },\n  authorize(cardInfo, paymentInfo, callback) {\n    Meteor.call(\"payflowpro/payment/submit\", \"authorize\", cardInfo, paymentInfo, callback);\n  },\n  capture(transactionId, amount, callback) {\n    const captureDetails = {\n      amount: {\n        currency: \"USD\", // todo should this be locale.currency\n        total: parseFloat(amount, 10)\n      },\n      is_final_capture: true\n    };\n    Meteor.call(\"payflowpro/payment/capture\", transactionId, captureDetails, callback);\n  },\n  config(options) {\n    this.accountOptions = options;\n  },\n  paymentObj() {\n    return {\n      intent: \"sale\",\n      payer: {\n        payment_method: \"credit_card\",\n        funding_instruments: []\n      },\n      transactions: []\n    };\n  },\n  parseCardData(data) {\n    return {\n      credit_card: {\n        type: data.type,\n        number: data.number,\n        first_name: data.first_name,\n        last_name: data.last_name,\n        cvv2: data.cvv2,\n        expire_month: data.expire_month,\n        expire_year: data.expire_year\n      }\n    };\n  },\n  parsePaymentData(data) {\n    return {\n      amount: {\n        total: parseFloat(data.total, 10),\n        currency: data.currency\n      }\n    };\n  }\n};\n\nfunction getSettings(settings, ref, valueName) {\n  if (settings !== null) {\n    return settings[valueName];\n  } else if (ref !== null) {\n    return ref[valueName];\n  }\n  return {};\n}\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import _ from \"lodash\";\nimport accounting from \"accounting-js\";\nimport { HTTP } from \"meteor/http\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { PayPal } from \"../../lib/api\";\nimport { Shops, Cart, Packages } from \"/lib/collections\";\nimport { Logger } from \"/server/api\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\nconst nvpVersion = \"52.0\";\n\nexport const methods = {\n  /**\n   * Acquire the Token required for PayPal Express transactions\n   * https://developer.paypal.com/docs/classic/api/merchant/SetExpressCheckout_API_Operation_NVP/\n   * @param  {String} cartId Reference to the Cart object to be processed\n   * @return {String} PayPal Token\n   */\n  \"getExpressCheckoutToken\"(cartId) {\n    check(cartId, String);\n    this.unblock();\n    const cart = Cart.findOne(cartId);\n    if (!cart) {\n      throw new Meteor.Error(\"invalid-parameter\", \"Bad cart ID\");\n    }\n    const shop = Shops.findOne(cart.shopId);\n    if (!shop) {\n      throw new Meteor.Error(\"invalid-parameter\", \"Bad shop ID\");\n    }\n    const amount = Number(cart.getTotal());\n    const shippingAmt = Number(cart.getShippingTotal());\n    const taxAmt = Number(cart.getTaxTotal());\n    const itemAmt = Number(cart.getSubTotal() - cart.getDiscounts());\n    const description = `${shop.name} Ref: ${cartId}`;\n    const { currency } = shop;\n    const options = PayPal.expressCheckoutAccountOptions();\n    let response;\n\n    try {\n      response = HTTP.post(options.url, {\n        params: {\n          USER: options.username,\n          PWD: options.password,\n          SIGNATURE: options.signature,\n          SOLUTIONTYPE: \"Mark\",\n          VERSION: nvpVersion,\n          PAYMENTACTION: \"Authorization\",\n          AMT: amount,\n          ITEMAMT: itemAmt,\n          SHIPPINGAMT: shippingAmt,\n          TAXAMT: taxAmt,\n          RETURNURL: options.return_url,\n          CANCELURL: options.cancel_url,\n          DESC: description,\n          NOSHIPPING: 1,\n          ALLOWNOTE: 1,\n          CURRENCYCODE: currency,\n          METHOD: \"SetExpressCheckout\",\n          INVNUM: cartId,\n          CUSTOM: `${cartId}|${amount}|${currency}`\n        }\n      });\n    } catch (error) {\n      throw new Meteor.Error(\"checkout-failed\", error.message);\n    }\n    if (!response || response.statusCode !== 200) {\n      throw new Meteor.Error(\"bad-response\", \"Bad response from PayPal\");\n    }\n    const parsedResponse = parseResponse(response);\n    if (parsedResponse.ACK !== \"Success\") {\n      throw new Meteor.Error(`ACK ${parsedResponse.ACK}: ${parsedResponse.L_LONGMESSAGE0}`);\n    }\n    return parsedResponse.TOKEN;\n  },\n  /**\n   * Perform the PayPal Express payment application\n   * https://developer.paypal.com/docs/classic/api/merchant/DoExpressCheckoutPayment_API_Operation_NVP/\n   * @param  {String} cartId Reference to the cart we are checking out\n   * @param  {String} token The Token provided by PayPal for this transaction\n   * @param  {String} payerId Reference to the payer\n   * @return {Object} results from PayPal normalized\n   */\n  \"confirmPaymentAuthorization\"(cartId, token, payerId) {\n    check(cartId, String);\n    check(token, String);\n    check(payerId, String);\n    this.unblock();\n    const cart = Cart.findOne(cartId);\n    if (!cart) {\n      throw new Meteor.Error(\"invalid-parameter\", \"Bad cart ID\");\n    }\n    const amount = Number(cart.getTotal());\n    const shippingAmt = Number(cart.getShippingTotal());\n    const taxAmt = Number(cart.getTaxTotal());\n    const itemAmt = Number(cart.getSubTotal() - cart.getDiscounts());\n    const shop = Shops.findOne(cart.shopId);\n    const { currency } = shop;\n    const options = PayPal.expressCheckoutAccountOptions();\n    const captureAtAuth = getSetting(cart.shopId, \"expressAuthAndCapture\");\n    let paymentAction;\n    if (captureAtAuth) {\n      paymentAction = \"Sale\";\n    } else {\n      paymentAction = \"Authorization\";\n    }\n    let response;\n    try {\n      response = HTTP.post(options.url, {\n        params: {\n          USER: options.username,\n          PWD: options.password,\n          SIGNATURE: options.signature,\n          VERSION: nvpVersion,\n          PAYMENTACTION: paymentAction,\n          AMT: amount,\n          ITEMAMT: itemAmt,\n          SHIPPINGAMT: shippingAmt,\n          TAXAMT: taxAmt,\n          METHOD: \"DoExpressCheckoutPayment\",\n          CURRENCYCODE: currency,\n          TOKEN: token,\n          PAYERID: payerId\n        }\n      });\n    } catch (error) {\n      throw new Meteor.Error(\"confirmation-failed\", error.message);\n    }\n    if (!response || response.statusCode !== 200) {\n      throw new Meteor.Error(\"bad-response\", \"Bad response from PayPal\");\n    }\n    const parsedResponse = parseResponse(response);\n\n    if (parsedResponse.ACK !== \"Success\") {\n      throw new Meteor.Error(`ACK ${parsedResponse.ACK}: ${parsedResponse.L_LONGMESSAGE0}:${parsedResponse.L_ERRORCODE0}`);\n    }\n    return parsedResponse;\n  },\n\n  /**\n   * Return the settings for the PayPal Express payment Method\n   * @return {Object} Express Checkout settings\n   */\n  \"getExpressCheckoutSettings\"() {\n    const settings = PayPal.expressCheckoutAccountOptions();\n    const expressCheckoutSettings = {\n      merchantId: settings.merchantId,\n      mode: settings.mode,\n      enabled: settings.enabled\n    };\n    return expressCheckoutSettings;\n  },\n\n  /**\n   * Capture an authorized PayPalExpress transaction\n   * https://developer.paypal.com/docs/classic/api/merchant/DoCapture_API_Operation_NVP/\n   * @param  {Object} paymentMethod A PaymentMethod object\n   * @return {Object} results from PayPal normalized\n   */\n  \"paypalexpress/payment/capture\"(paymentMethod) {\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n    this.unblock();\n    const options = PayPal.expressCheckoutAccountOptions();\n    const amount = accounting.toFixed(paymentMethod.amount, 2);\n    const authorizationId = paymentMethod.transactions[0].TRANSACTIONID;\n    const currencycode = paymentMethod.transactions[0].CURRENCYCODE;\n    let response;\n\n    // 100% discounts are not valid when using PayPal Express\n    // If discount is 100%, void authorization instead of applying discount\n    if (amount === accounting.toFixed(0, 2)) {\n      try {\n        response = HTTP.post(options.url, {\n          params: {\n            USER: options.username,\n            PWD: options.password,\n            SIGNATURE: options.signature,\n            VERSION: nvpVersion,\n            METHOD: \"DoVoid\",\n            AUTHORIZATIONID: authorizationId,\n            NOTE: \"Your order has been discounted 100%, and will appear as voided or canceled inside your payment account.\"\n          }\n        });\n      } catch (error) {\n        throw new Meteor.Error(\"capture-failed\", error.message);\n      }\n    } else {\n      try {\n        response = HTTP.post(options.url, {\n          params: {\n            USER: options.username,\n            PWD: options.password,\n            SIGNATURE: options.signature,\n            VERSION: nvpVersion,\n            METHOD: \"DoCapture\",\n            AUTHORIZATIONID: authorizationId,\n            CURRENCYCODE: currencycode,\n            AMT: amount,\n            COMPLETETYPE: \"Complete\" // TODO: Allow for partial captures\n          }\n        });\n      } catch (error) {\n        throw new Meteor.Error(\"capture-failed\", error.message);\n      }\n    }\n\n    if (!response || response.statusCode !== 200) {\n      throw new Meteor.Error(\"bad-response\", \"Bad Response from PayPal during Capture\");\n    }\n\n    const parsedResponse = parseResponse(response);\n\n    if (parsedResponse.ACK !== \"Success\") {\n      throw new Meteor.Error(`ACK ${parsedResponse.ACK}: ${parsedResponse.L_LONGMESSAGE0}`);\n    }\n\n    const result = {\n      saved: true,\n      authorizationId: parsedResponse.AUTHORIZATIONID,\n      transactionId: parsedResponse.TRANSACTIONID,\n      currencycode,\n      metadata: {},\n      rawTransaction: parsedResponse\n    };\n\n    return result;\n  },\n\n  /**\n   * Refund an order using the PayPay Express method\n   * https://developer.paypal.com/docs/classic/api/merchant/RefundTransaction_API_Operation_NVP/\n   * @param  {Object} paymentMethod A PaymentMethod object\n   * @param {Number} amount to be refunded\n   * @return {Object} Transaction results from PayPal normalized\n   */\n  \"paypalexpress/refund/create\"(paymentMethod, amount) {\n    check(amount, Number);\n\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n    this.unblock();\n\n    const options = PayPal.expressCheckoutAccountOptions();\n    const previousTransaction = _.last(paymentMethod.transactions);\n    const { transactionId, currencycode } = previousTransaction;\n\n    let response;\n    try {\n      response = HTTP.post(options.url, {\n        params: {\n          USER: options.username,\n          PWD: options.password,\n          SIGNATURE: options.signature,\n          VERSION: nvpVersion,\n          METHOD: \"RefundTransaction\",\n          TRANSACTIONID: transactionId,\n          REFUNDTYPE: \"Partial\",\n          AMT: amount,\n          CURRENCYCODE: currencycode\n        }\n      });\n    } catch (error) {\n      Logger.debug(error, \"Failed paypalexpress/refund/create\");\n      throw new Meteor.Error(\"refund-create-failed\", error.message);\n    }\n\n    if (!response || response.statusCode !== 200) {\n      Logger.debug(\"Bad Response from PayPal during Refund Creation\");\n      throw new Meteor.Error(\"bad-response\", \"Bad Response from PayPal during Refund Creation\");\n    }\n\n    const parsedResponse = parseResponse(response);\n    if (parsedResponse.ACK !== \"Success\") {\n      throw new Meteor.Error(`ACK ${parsedResponse.ACK}: ${parsedResponse.L_LONGMESSAGE0}`);\n    }\n\n    const amountFormatted = {\n      total: amount,\n      currency: currencycode\n    };\n\n    const result = {\n      saved: true,\n      type: \"refund\",\n      created: new Date(),\n      transactionId,\n      refundTransactionId: parsedResponse.REFUNDTRANSACTIONID,\n      grossRefundAmount: parsedResponse.GROSSREFUNDAMT,\n      netRefundAmount: parsedResponse.NETREFUNDAMT,\n      correlationId: parsedResponse.CORRELATIONID,\n      currencycode: parsedResponse.CURRENCYCODE,\n      amount: amountFormatted,\n      rawTransaction: parsedResponse\n    };\n    return result;\n  },\n  /**\n   * Query PayPal Express NVP API for Refund transactions\n   * Refunds returned here are listed in the dashboard\n   * https://developer.paypal.com/docs/classic/api/merchant/GetTransactionDetails_API_Operation_NVP/\n   * @param  {Object} paymentMethod A PaymentMethod object\n   * @return {array}  Refunds from PayPal query, normalized\n   */\n  \"paypalexpress/refund/list\"(paymentMethod) {\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n    this.unblock();\n\n    const options = PayPal.expressCheckoutAccountOptions();\n    const { transactionId } = paymentMethod;\n    let response;\n\n    try {\n      response = HTTP.post(options.url, {\n        params: {\n          USER: options.username,\n          PWD: options.password,\n          SIGNATURE: options.signature,\n          VERSION: nvpVersion,\n          METHOD: \"TransactionSearch\",\n          STARTDATE: \"2013-08-24T05:38:48Z\",\n          TRANSACTIONID: transactionId,\n          TRANSACTIONCLASS: \"Refund\"\n        }\n      });\n    } catch (error) {\n      throw new Meteor.Error(\"refund-list-failed\", error.message);\n    }\n\n    if (!response || response.statusCode !== 200) {\n      throw new Meteor.Error(\"bad-response\", \"Bad Response from PayPal during refund list\");\n    }\n\n    const parsedResponse = parseResponse(response);\n\n    if (parsedResponse.ACK !== \"Success\") {\n      throw new Meteor.Error(`ACK ${parsedResponse.ACK}: ${parsedResponse.L_LONGMESSAGE0}`);\n    }\n    const result = parseRefundReponse(parsedResponse);\n    return result;\n  }\n\n};\n\n// internal helpers\nfunction parseResponse(response) {\n  const result = {};\n  const pieces = response.content.split(\"&\");\n  pieces.forEach((piece) => {\n    const subpieces = piece.split(\"=\");\n    result[subpieces[0]] = decodeURIComponent(subpieces[1]);\n    const decodedResult = result[subpieces[0]];\n    return decodedResult;\n  });\n  return result;\n}\n\n/**\n * Parse PayPal's 'unique' Transaction Query response to look for refunds\n * @param  {Object} response The response from PayPal\n * @return {Object} Refunds, normalized to an Array\n */\nfunction parseRefundReponse(response) {\n  const paypalArray = [];\n\n  Promise.await(lazyLoadMoment());\n\n  for (let i = 0; i < 101; i += 1) {\n    const timeStampKey = `L_TIMESTAMP${i}`;\n    const timestamp = response[timeStampKey];\n    const typeKey = `L_TYPE${i}`;\n    const transactionType = response[typeKey];\n    const amountKey = `L_AMT${i}`;\n    const amount = response[amountKey];\n    const currencyCodeKey = `L_CURRENCYCODE${i}`;\n    const currencyCode = response[currencyCodeKey];\n\n    if (timestamp !== undefined && transactionType === \"Refund\") {\n      const responseObject = {\n        created: moment(timestamp).valueOf(),\n        type: \"refund\",\n        amount: Math.abs(Number(amount, 10)),\n        currency: currencyCode\n      };\n      paypalArray.push(responseObject);\n    }\n  }\n\n  return paypalArray;\n}\n\nfunction getSetting(shopId, parameter) {\n  const { settings } = Packages.findOne({\n    name: \"reaction-paypal\",\n    shopId,\n    enabled: true\n  });\n  return settings[parameter];\n}\n\n// export methods to Meteor\nMeteor.methods(methods);\n","import { Meteor } from \"meteor/meteor\";\nimport * as PayflowproMethods from \"./payflowproMethods\";\n\nMeteor.methods({\n  \"payflowpro/payment/submit\": PayflowproMethods.paymentSubmit,\n  \"payflowpro/payment/capture\": PayflowproMethods.paymentCapture,\n  \"payflowpro/refund/create\": PayflowproMethods.createRefund,\n  \"payflowpro/refund/list\": PayflowproMethods.listRefunds,\n  \"payflowpro/settings\": PayflowproMethods.getSettings\n});\n","import PayFlow from \"paypal-rest-sdk\"; // PayFlow is PayPal PayFlow lib\nimport accounting from \"accounting-js\";\nimport _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Shops } from \"/lib/collections\";\nimport { PayPal } from \"../../lib/api\"; // PayPal is the reaction api\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\nexport const PayflowproApi = {};\nPayflowproApi.apiCall = {};\n\n\nPayflowproApi.apiCall.paymentSubmit = function (paymentSubmitDetails) {\n  PayFlow.configure(PayPal.payflowAccountOptions());\n\n  const paymentObj = PayPal.paymentObj();\n  paymentObj.intent = paymentSubmitDetails.transactionType;\n  paymentObj.payer.funding_instruments.push(PayPal.parseCardData(paymentSubmitDetails.cardData));\n  paymentObj.transactions.push(PayPal.parsePaymentData(paymentSubmitDetails.paymentData));\n  const wrappedFunc = Meteor.wrapAsync(PayFlow.payment.create, PayFlow.payment);\n  let result;\n  try {\n    result = {\n      saved: true,\n      response: wrappedFunc(paymentObj)\n    };\n  } catch (error) {\n    Logger.warn(error);\n    result = {\n      saved: false,\n      error\n    };\n  }\n  return result;\n};\n\n\nPayflowproApi.apiCall.captureCharge = function (paymentCaptureDetails) {\n  PayFlow.configure(PayPal.payflowAccountOptions());\n\n  let result;\n  // TODO: This should be changed to some ReactionCore method\n  const shop = Shops.findOne(Reaction.getShopId());\n  const wrappedFunc = Meteor.wrapAsync(PayFlow.authorization.capture, PayFlow.authorization);\n  const wrappedFuncVoid = Meteor.wrapAsync(PayFlow.authorization.void, PayFlow.authorization);\n  const captureTotal = Math.round(parseFloat(paymentCaptureDetails.amount) * 100) / 100;\n  const captureDetails = {\n    amount: {\n      currency: shop.currency,\n      total: captureTotal\n    },\n    is_final_capture: true // eslint-disable-line camelcase\n  };\n  const capturedAmount = accounting.toFixed(captureDetails.amount.total, 2);\n\n  if (capturedAmount === accounting.toFixed(0, 2)) {\n    try {\n      const response = wrappedFuncVoid(paymentCaptureDetails.authorizationId, captureDetails);\n\n      result = {\n        saved: true,\n        metadata: {\n          parentPaymentId: response.parent_payment,\n          captureId: response.id\n        },\n        rawTransaction: response\n      };\n    } catch (error) {\n      Logger.warn(error);\n      result = {\n        saved: false,\n        error\n      };\n    }\n    return result;\n  }\n  try {\n    const response = wrappedFunc(paymentCaptureDetails.authorizationId, captureDetails);\n\n    result = {\n      saved: true,\n      metadata: {\n        parentPaymentId: response.parent_payment,\n        captureId: response.id\n      },\n      rawTransaction: response\n    };\n  } catch (error) {\n    Logger.warn(error);\n    result = {\n      saved: false,\n      error\n    };\n  }\n  return result;\n};\n\n\nPayflowproApi.apiCall.createRefund = function (refundDetails) {\n  PayFlow.configure(PayPal.payflowAccountOptions());\n\n  const createRefund = Meteor.wrapAsync(PayFlow.capture.refund, PayFlow.capture);\n  let result;\n\n  try {\n    Logger.debug(\"payflowpro/refund/create: paymentMethod.metadata.captureId\", refundDetails.captureId);\n    const response = createRefund(refundDetails.captureId, {\n      amount: {\n        total: refundDetails.amount,\n        currency: \"USD\"\n      }\n    });\n\n    result = {\n      saved: true,\n      type: \"refund\",\n      created: response.create_time,\n      amount: response.amount.total,\n      currency: response.amount.currency,\n      rawTransaction: response\n    };\n  } catch (error) {\n    result = {\n      saved: false,\n      error\n    };\n  }\n  return result;\n};\n\n\nPayflowproApi.apiCall.listRefunds = function (refundListDetails) {\n  PayFlow.configure(PayPal.payflowAccountOptions());\n\n  const listPayments = Meteor.wrapAsync(PayFlow.payment.get, PayFlow.payment);\n  let result = [];\n  // todo: review parentPaymentId vs authorizationId, are they both correct?\n  // added authorizationId without fully understanding the intent of parentPaymentId\n  // let authId = paymentMethod.metadata.parentPaymentId || paymentMethod.metadata.authorizationId;\n  const authId = refundListDetails.transactionId;\n\n  if (authId) {\n    Logger.debug(\"payflowpro/refund/list: paymentMethod.metadata.parentPaymentId\", authId);\n    try {\n      const response = listPayments(authId);\n\n      for (const transaction of response.transactions) {\n        for (const resource of transaction.related_resources) {\n          if (_.isObject(resource.refund)) {\n            if (resource.refund.state === \"completed\") {\n              Promise.await(lazyLoadMoment());\n              result.push({\n                type: \"refund\",\n                created: moment(resource.refund.create_time).unix() * 1000,\n                amount: Math.abs(resource.refund.amount.total),\n                currency: resource.refund.amount.currency,\n                raw: response\n              });\n            }\n          }\n        }\n      }\n    } catch (error) {\n      Logger.warn(\"Failed payflowpro/refund/list\", error);\n      result = {\n        error\n      };\n    }\n  }\n  return result;\n};\n","import { Logger } from \"/server/api\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\nimport { check } from \"meteor/check\";\nimport { PayPal } from \"../../lib/api\"; // PayPal is the reaction api\nimport { PayflowproApi } from \"./payflowproApi\";\n\n/**\n * payflowpro/payment/submit\n * Create and Submit a PayPal PayFlow transaction\n * @param  {Object} transactionType transactionType\n * @param  {Object} cardData cardData object\n * @param  {Object} paymentData paymentData object\n * @return {Object} results from PayPal payment create\n */\nexport function paymentSubmit(transactionType, cardData, paymentData) {\n  check(transactionType, String);\n  check(cardData, Object);\n  check(paymentData, Object);\n\n  const paymentSubmitDetails = {\n    transactionType,\n    cardData,\n    paymentData\n  };\n\n  let result;\n\n  try {\n    const refundResult = PayflowproApi.apiCall.paymentSubmit(paymentSubmitDetails);\n    Logger.debug(refundResult);\n    result = refundResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot Submit Payment: ${error.message}`\n    };\n    Logger.fatal(\"PayPal PayFlow call failed, payment was not submitted\");\n  }\n\n  return result;\n}\n\n\n/**\n * payflowpro/payment/capture\n * Capture an authorized PayPal PayFlow transaction\n * @param  {Object} paymentMethod A PaymentMethod object\n * @return {Object} results from PayPal normalized\n */\nexport function paymentCapture(paymentMethod) {\n  // Call both check and validate because by calling `clean`, the audit pkg\n  // thinks that we haven't checked paymentMethod arg\n  check(paymentMethod, Object);\n  PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n  const paymentCaptureDetails = {\n    authorizationId: paymentMethod.metadata.authorizationId,\n    amount: paymentMethod.amount\n  };\n\n  let result;\n\n  try {\n    const refundResult = PayflowproApi.apiCall.captureCharge(paymentCaptureDetails);\n    Logger.debug(refundResult);\n    result = refundResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot Capture Payment: ${error.message}`\n    };\n    Logger.fatal(\"PayPal PayFlow call failed, payment was not captured\");\n  }\n\n  return result;\n}\n\n\n/**\n * createRefund\n * Refund PayPal PayFlow payment\n * @param {Object} paymentMethod - Object containing everything about the transaction to be settled\n * @param {Number} amount - Amount to be refunded if not the entire amount\n * @return {Object} results - Object containing the results of the transaction\n */\nexport function createRefund(paymentMethod, amount) {\n  check(amount, Number);\n\n  // Call both check and validate because by calling `clean`, the audit pkg\n  // thinks that we haven't checked paymentMethod arg\n  check(paymentMethod, Object);\n  PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n  const refundDetails = {\n    captureId: paymentMethod.metadata.captureId,\n    amount\n  };\n\n  let result;\n\n  try {\n    const refundResult = PayflowproApi.apiCall.createRefund(refundDetails);\n    Logger.debug(refundResult);\n    result = refundResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot issue refund: ${error.message}`\n    };\n    Logger.fatal(\"PayPal PayFlow call failed, refund was not issued\");\n  }\n\n  return result;\n}\n\n\n/**\n * listRefunds\n * List all refunds for a PayPal PayFlow transaction\n * https://developers.braintreepayments.com/reference/request/transaction/find/node\n * @param {Object} paymentMethod - Object containing everything about the transaction to be settled\n * @return {Array} results - An array of refund objects for display in admin\n */\nexport function listRefunds(paymentMethod) {\n  // Call both check and validate because by calling `clean`, the audit pkg\n  // thinks that we haven't checked paymentMethod arg\n  check(paymentMethod, Object);\n  PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n  const refundListDetails = {\n    transactionId: paymentMethod.metadata.transactionId\n  };\n\n  let result;\n\n  try {\n    const refundResult = PayflowproApi.apiCall.listRefunds(refundListDetails);\n    Logger.debug(refundResult);\n    result = refundResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot issue refund: ${error.message}`\n    };\n    Logger.fatal(\"PayPal PayFlow call failed, refund was not issued\");\n  }\n\n  return result;\n}\n\n\nexport function getSettings() {\n  const settings = PayPal.payflowAccountOptions();\n  const payflowSettings = {\n    mode: settings.mode,\n    enabled: settings.enabled\n  };\n  return payflowSettings;\n}\n","import { BrowserPolicy } from \"meteor/browser-policy-common\";\n\nBrowserPolicy.content.allowEval();\nBrowserPolicy.content.allowOriginForAll(\"http://www.paypal.com\");\nBrowserPolicy.content.allowOriginForAll(\"http://www.paypalobjects.com\");\nBrowserPolicy.content.allowOriginForAll(\"https://www.sandbox.paypal.com\");\nBrowserPolicy.content.allowOriginForAll(\"https://www.paypal.com\");\nBrowserPolicy.content.allowOriginForAll(\"https://www.paypalobjects.com\");\nBrowserPolicy.content.allowOriginForAll(\"https://tracking.qa.paypal.com\");\nBrowserPolicy.content.allowOriginForAll(\"https://akamai.mathtag.com\");\n","import { Reaction, Hooks } from \"/server/api\";\n\nHooks.Events.add(\"afterCoreInit\", () => {\n  Reaction.addRolesToGroups({\n    allShops: true,\n    groups: [\"customer\", \"guest\"],\n    roles: [\"reaction-paypal/paypalDone\", \"reaction-paypal/paypalCancel\"]\n  });\n});\n","import \"./i18n\";\nimport \"./methods/express\";\nimport \"./methods/payflow\";\nimport \"./security/paypal\";\nimport \"./startup/startup\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"PayPal\",\n  name: \"reaction-paypal\",\n  icon: \"fa fa-paypal\",\n  autoEnable: false,\n  settings: {\n    expressAuthAndCapture: false,\n    express: {\n      enabled: false,\n      support: [\n        \"Authorize\",\n        \"Capture\",\n        \"Refund\"\n      ]\n    },\n    payflow: {\n      enabled: false,\n      support: [\n        \"Authorize\",\n        \"Capture\",\n        \"Refund\"\n      ]\n    }\n  },\n  registry: [\n    {\n      label: \"PayPal Express\",\n      provides: [\"paymentSettings\"],\n      name: \"paypal/settings/express\",\n      icon: \"fa fa-paypal\",\n      template: \"paypalExpressSettings\"\n    }, {\n      label: \"PayPal PayFlow\",\n      provides: [\"paymentSettings\"],\n      name: \"paypal/settings/payflow\",\n      icon: \"fa fa-cc-paypal\",\n      template: \"paypalPayFlowSettings\"\n    }, {\n      route: \"/paypal/done\",\n      template: \"paypalDone\",\n      workflow: \"coreWorkflow\"\n    }, {\n      route: \"/paypal/cancel\",\n      template: \"paypalCancel\",\n      workflow: \"coreWorkflow\"\n    }, {\n      template: \"paypalCheckoutButton\",\n      label: \"Express\",\n      name: \"payment/method/express\",\n      provides: [\"paymentMethod\"],\n      icon: \"fa fa-paypal\",\n      priority: 1\n    }, {\n      template: \"paypalPayflowForm\",\n      label: \"Credit Card\",\n      name: \"payment/method/payflow\",\n      provides: [\"paymentMethod\"],\n      icon: \"fa fa-cc-paypal\"\n    }\n  ]\n});\n","\nexport default function blocks() {\n  return [\n\n    // Header block (Full Width)\n    {\n      type: \"block\",\n      columns: 12,\n      element: \"header\",\n      className: \"pdp header\",\n      permissions: [\"admin\"], // Permissions for staff\n      audience: [\"guest\", \"anonymous\"], // Permissions for customers\n      children: [\n        // Title\n        {\n          component: \"ProductField\",\n          // Example, you can set permissions components that are children of a block\n          permissions: [\"admin\"],\n          audience: [\"guest\", \"anonymous\"],\n          props: {\n            fieldName: \"title\",\n            fieldTitle: \"Title\",\n            element: \"h1\",\n            textFieldProps: {\n              i18nKeyPlaceholder: \"productDetailEdit.title\",\n              placeholder: \"Title\"\n            }\n          }\n        },\n\n        // PageTitle\n        {\n          component: \"ProductField\",\n          permissions: [\"admin\"],\n          audience: [\"guest\", \"anonymous\"],\n          props: {\n            // editable: this.editable,\n            fieldName: \"pageTitle\",\n            fieldTitle: \"SubTitle\",\n            element: \"h2\",\n            textFieldProps: {\n              i18nKeyPlaceholder: \"productDetailEdit.pageTitle\",\n              placeholder: \"Subtitle\"\n            }\n          }\n        }\n      ]\n    },\n\n    // Media block\n    // Contains\n    // - Medai Gallery\n    // - Tags\n    // - Details\n    {\n      type: \"block\",\n      columns: 6,\n      size: \"half\",\n      permissions: [\"admin\"],\n      audience: [\"guest\", \"anonymous\"],\n      style: {\n        \"@media  only screen and (max-width: 921px)\": {\n          minWidth: \"100%\",\n          maxWidth: \"100%\"\n        }\n      },\n      children: [\n        // Media Gallery\n        {\n          component: \"MediaGalleryContainer\"\n        },\n\n        // Tags\n        {\n          component: \"ProductTags\"\n        },\n\n        // Metadata\n        {\n          component: \"ProductMetadata\"\n        }\n      ]\n    },\n\n    // Variant block\n    {\n      type: \"block\",\n      columns: 6,\n      size: \"half\",\n      permissions: [\"admin\"],\n      audience: [\"guest\", \"anonymous\"],\n      style: {\n        \"@media  only screen and (max-width: 921px)\": {\n          minWidth: \"100%\",\n          maxWidth: \"100%\"\n        }\n      },\n      children: [\n        // Price /  Social Buttons split\n        {\n          axis: \"horizontal\",\n          align: \"center\",\n          type: \"block\",\n          size: \"static variable\",\n          permissions: [\"createProduct\"],\n          audience: [\"guest\", \"anonymous\"],\n          style: {\n            padding: 0\n          },\n          children: [\n            // Price Range\n            {\n              type: \"block\",\n              size: \"variable\",\n              style: {\n                padding: 0\n              },\n              children: [\n                {\n                  component: \"PriceRange\"\n                }\n              ]\n            },\n            // Social Buttons\n            {\n              type: \"block\",\n              size: \"static\",\n              justify: \"end\",\n              style: {\n                padding: 0\n              },\n              children: [\n                {\n                  component: \"SocialContainer\"\n                }\n              ]\n            }\n          ]\n        },\n\n        // Vendor\n        {\n          component: \"ProductField\",\n          props: {\n            fieldName: \"vendor\",\n            fieldTitle: \"Vendor\",\n            textFieldProps: {\n              i18nKeyPlaceholder: \"productDetailEdit.vendor\",\n              placeholder: \"Vendor\"\n            }\n          }\n        },\n        {\n          component: \"ProductField\",\n          props: {\n            fieldName: \"description\",\n            fieldTitle: \"Description\",\n            multiline: true,\n            textFieldProps: {\n              i18nKeyPlaceholder: \"productDetailEdit.description\",\n              placeholder: \"Description\"\n            }\n          }\n        },\n\n        // Variant List\n        {\n          component: \"VariantListContainer\"\n        },\n\n        // Divider\n        {\n          component: \"Divider\"\n        },\n\n        // Alerts for checkout\n        {\n          component: \"AlertContainer\",\n          props: {\n            placement: \"productDetail\"\n          }\n        },\n\n        // Add to cart button\n        {\n          component: \"AddToCartButton\",\n          props: {\n            style: {\n              paddingTop: 20\n            }\n          }\n        }\n\n      ]\n    }\n  ];\n}\n","\nexport default function twoColumn() {\n  return [\n    // Media block\n    // Contains\n    // - Media Gallery\n    // - Tags\n    // - Details\n    {\n      type: \"block\",\n      columns: 6,\n      size: \"half\",\n      permissions: [\"admin\"],\n      audience: [\"guest\", \"anonymous\"],\n      children: [\n        // Media Gallery\n        {\n          component: \"MediaGalleryContainer\"\n        },\n\n        // Tags\n        {\n          component: \"ProductTags\"\n        },\n\n        // Metadata\n        {\n          component: \"ProductMetadata\"\n        }\n      ]\n    },\n\n    // Product Details Block\n    // Contains\n    // - Title\n    // - Subtitle\n    // - Price\n    // - Social\n    // - Vendor\n    // - Description\n    // - Variants\n    // - Add to Cart button\n    {\n      type: \"block\",\n      columns: 6,\n      size: \"half\",\n      style: {\n        display: \"block\"\n      },\n      permissions: [\"admin\"],\n      audience: [\"guest\", \"anonymous\"],\n      children: [\n        // Header block (Full Width)\n        {\n          type: \"block\",\n          columns: 12,\n          element: \"header\",\n          className: \"pdp header\",\n          permissions: [\"admin\"], // Permissions for staff\n          audience: [\"guest\", \"anonymous\"], // Permissions for customers\n          children: [\n            // Title\n            {\n              component: \"ProductField\",\n              // Example, you can set permissions components that are children of a block\n              permissions: [\"admin\"],\n              audience: [\"guest\", \"anonymous\"],\n              props: {\n                fieldName: \"title\",\n                fieldTitle: \"Title\",\n                element: \"h1\",\n                textFieldProps: {\n                  i18nKeyPlaceholder: \"productDetailEdit.title\",\n                  placeholder: \"Title\"\n                }\n              }\n            },\n\n            // PageTitle\n            {\n              component: \"ProductField\",\n              permissions: [\"admin\"],\n              audience: [\"guest\", \"anonymous\"],\n              props: {\n                // editable: this.editable,\n                fieldName: \"pageTitle\",\n                fieldTitle: \"SubTitle\",\n                element: \"h2\",\n                textFieldProps: {\n                  i18nKeyPlaceholder: \"productDetailEdit.pageTitle\",\n                  placeholder: \"Subtitle\"\n                }\n              }\n            }\n          ]\n        },\n\n        // Price /  Social Buttons split\n        {\n          axis: \"horizontal\",\n          align: \"center\",\n          type: \"block\",\n          size: \"static variable\",\n          permissions: [\"createProduct\"],\n          audience: [\"guest\", \"anonymous\"],\n          style: {\n            padding: 0\n          },\n          children: [\n            // Price Range\n            {\n              type: \"block\",\n              size: \"variable\",\n              style: {\n                padding: 0\n              },\n              children: [\n                {\n                  component: \"PriceRange\"\n                }\n              ]\n            },\n            // Social Buttons\n            {\n              type: \"block\",\n              size: \"static\",\n              justify: \"end\",\n              style: {\n                padding: 0\n              },\n              children: [\n                {\n                  component: \"SocialContainer\"\n                }\n              ]\n            }\n          ]\n        },\n\n        // Vendor\n        {\n          component: \"ProductField\",\n          props: {\n            fieldName: \"vendor\",\n            fieldTitle: \"Vendor\",\n            textFieldProps: {\n              i18nKeyPlaceholder: \"productDetailEdit.vendor\",\n              placeholder: \"Vendor\"\n            }\n          }\n        },\n        {\n          component: \"ProductField\",\n          props: {\n            fieldName: \"description\",\n            fieldTitle: \"Description\",\n            multiline: true,\n            textFieldProps: {\n              i18nKeyPlaceholder: \"productDetailEdit.description\",\n              placeholder: \"Description\"\n            }\n          }\n        },\n\n        // Variant List\n        {\n          component: \"VariantListContainer\"\n        },\n\n        // Divider\n        {\n          component: \"Divider\"\n        },\n\n        // Alerts for checkout\n        {\n          component: \"AlertContainer\",\n          props: {\n            placement: \"productDetail\"\n          }\n        },\n\n        // Add to cart button\n        {\n          component: \"AddToCartButton\",\n          props: {\n            style: {\n              paddingTop: 20\n            }\n          }\n        }\n\n      ]\n    }\n  ];\n}\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Reaction } from \"/server/api\";\nimport SimpleLayout from \"../lib/layout/simple\";\nimport TwoColumnLayout from \"../lib/layout/twoColumn\";\nimport \"./i18n\";\n\nReaction.registerTemplate({\n  name: \"productDetailSimple\",\n  title: \"Product Detail Simple Layout\",\n  type: \"react\",\n  templateFor: [\"pdp\"],\n  permissions: [\"admin\", \"owner\"],\n  audience: [\"anonymous\", \"guest\"],\n  template: SimpleLayout()\n});\n\nReaction.registerTemplate({\n  name: \"productDetailTwoColumn\",\n  title: \"Product Detail Two Column Layout\",\n  type: \"react\",\n  templateFor: [\"pdp\"],\n  permissions: [\"admin\", \"owner\"],\n  audience: [\"anonymous\", \"guest\"],\n  template: TwoColumnLayout()\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Product Detail Simple\",\n  name: \"product-detail-simple\",\n  icon: \"fa fa-cubes\",\n  autoEnable: true,\n  registry: [{\n    route: \"/product/:handle/:variantId?\",\n    name: \"product\",\n    template: \"productDetailSimple\",\n    workflow: \"coreProductWorkflow\"\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreProductWorkflow\",\n    collection: \"Products\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"productDetailSimple\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"\",\n      notFound: \"productNotFound\",\n      dashboardHeader: \"productDetailSimpleToolbar\",\n      dashboardControls: \"productDetailDashboardControls\",\n      dashboardHeaderControls: \"\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }]\n});\n","export const shippingRoles = [\"admin\", \"owner\", \"shipping\", \"reaction-shippo\"];\n","import { Meteor } from \"meteor/meteor\";\nimport { Shipping, Packages } from \"/lib/collections\";\nimport { Logger, Reaction, Hooks } from \"/server/api\";\nimport { Cart as CartSchema } from \"/lib/collections/schemas\";\n\n/**\n * getShippingRates - Returns a list of shipping rates based on the\n * items in a cart.\n * @param {Array} previousQueryResults - an array of shipping rates and\n * info about failed calls to the APIs of some shipping methods providers\n * e.g Shippo.\n * @param {Object} cart - details about the purchase a user wants to make.\n * @return {Array} - an array that contains two arrays: the first array will\n * be an updated list of shipping rates, and the second will contain info for\n * retrying this specific package if any errors occurred while retrieving the\n * shipping rates.\n */\nfunction getShippingRates(previousQueryResults, cart) {\n  CartSchema.validate(cart);\n  const [rates, retrialTargets] = previousQueryResults;\n  const shops = [];\n  const products = cart.items;\n\n  const currentMethodInfo = {\n    packageName: \"flat-rate-shipping\",\n    fileName: \"hooks.js\"\n  };\n  if (retrialTargets.length > 0) {\n    const isNotAmongFailedRequests = retrialTargets.every((target) =>\n      target.packageName !== currentMethodInfo.packageName &&\n      target.fileName !== currentMethodInfo.fileName);\n    if (isNotAmongFailedRequests) {\n      return previousQueryResults;\n    }\n  }\n\n  // Verify that we have shipping records\n  if (!cart.shipping || !cart.shipping.length) {\n    const errorDetails = {\n      requestStatus: \"error\",\n      shippingProvider: \"flat-rate-shipping\",\n      message: \"this cart is missing shipping records\"\n    };\n    return [[errorDetails], []];\n  }\n\n  // Verify that we have a valid address to work with\n  let shippingErrorDetails;\n  if (cart.shipping.find((shippingRecord) => !shippingRecord.address)) {\n    shippingErrorDetails = {\n      requestStatus: \"error\",\n      shippingProvider: \"flat-rate-shipping\",\n      message: \"The address property on one or more shipping records are incomplete\"\n    };\n    return [[shippingErrorDetails], []];\n  }\n\n  // Validate that we have valid items to work with. We should never get here since we filter for this\n  // at the cart level\n  if (!cart.items || !cart.items.length) {\n    const errorDetails = {\n      requestStatus: \"error\",\n      shippingProvider: \"flat-rate-shipping\",\n      message: \"this cart has no items\"\n    };\n    return [[errorDetails], []];\n  }\n\n  let merchantShippingRates = false;\n  const marketplaceSettings = Reaction.getMarketplaceSettings();\n  if (marketplaceSettings && marketplaceSettings.enabled) {\n    ({ merchantShippingRates } = marketplaceSettings.public);\n  }\n\n  let pkgData;\n  if (merchantShippingRates) {\n    // TODO this needs to be rewritten to handle getting rates from each shops that's represented on the order\n    Logger.fatal(\"Multiple shipping providers is currently not supported\");\n    throw new Meteor.Error(\"not-implemented\", \"Multiple shipping providers is currently not supported\");\n  } else {\n    pkgData = Packages.findOne({\n      name: \"reaction-shipping-rates\",\n      shopId: Reaction.getPrimaryShopId()\n    });\n  }\n\n\n  if (!pkgData || !cart.items || pkgData.settings.flatRates.enabled !== true) {\n    return [rates, retrialTargets];\n  }\n\n  // default selector is primary shop\n  let selector = {\n    \"shopId\": Reaction.getPrimaryShopId(),\n    \"provider.enabled\": true\n  };\n\n  // Get rates from shops if merchantShippingRates is enabled\n  // Otherwise just get them from the primaryShop\n  if (merchantShippingRates) {\n    // create an array of shops, allowing\n    // the cart to have products from multiple shops\n    for (const product of products) {\n      if (product.shopId) {\n        shops.push(product.shopId);\n      }\n    }\n    // if we have multiple shops in cart\n    if ((shops !== null ? shops.length : undefined) > 0) {\n      selector = {\n        \"shopId\": {\n          $in: shops\n        },\n        \"provider.enabled\": true\n      };\n    }\n  }\n\n  const shippingCollection = Shipping.find(selector);\n  const initialNumOfRates = rates.length;\n  shippingCollection.forEach((doc) => {\n    const _results = [];\n    for (const method of doc.methods) {\n      if (!method.enabled) {\n        continue;\n      }\n      if (!method.rate) {\n        method.rate = 0;\n      }\n      if (!method.handling) {\n        method.handling = 0;\n      }\n      // Store shipping provider here in order to have it available in shipmentMethod\n      // for cart and order usage\n      if (!method.carrier) {\n        method.carrier = doc.provider.label;\n      }\n      const rate = method.rate + method.handling;\n      _results.push(rates.push({\n        carrier: doc.provider.label,\n        method,\n        rate,\n        shopId: doc.shopId\n      }));\n    }\n    return _results;\n  });\n\n  if (rates.length === initialNumOfRates) {\n    const errorDetails = {\n      requestStatus: \"error\",\n      shippingProvider: \"flat-rate-shipping\",\n      message: \"Flat rate shipping did not return any shipping methods.\"\n    };\n    rates.push(errorDetails);\n    retrialTargets.push(currentMethodInfo);\n    return [rates, retrialTargets];\n  }\n\n  Logger.debug(\"Flat rate onGetShippingRates\", rates);\n  return [rates, retrialTargets];\n}\n// run getShippingRates when the onGetShippingRates event runs\nHooks.Events.add(\"onGetShippingRates\", getShippingRates);\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport { Shipping } from \"/lib/collections\";\nimport { ShippingMethod } from \"/lib/collections/schemas\";\nimport { Reaction } from \"/server/api\";\nimport { shippingRoles } from \"../lib/roles\";\n\nexport const methods = {\n  /**\n   * shipping/rates/add\n   * add new shipping flat rate methods\n   * @summary insert shipping method for a flat rate provider\n   * @param { Object } rate a valid ShippingMethod object\n   * @return { Number } insert result\n   */\n  \"shipping/rates/add\"(rate) {\n    check(rate, {\n      _id: Match.Optional(String),\n      name: String,\n      label: String,\n      group: String,\n      cost: Match.Optional(Number),\n      handling: Match.Optional(Number),\n      rate: Number,\n      enabled: Boolean\n    });\n    if (!Reaction.hasPermission(shippingRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    // a little trickery\n    // we passed in the providerId\n    // as _id, perhaps cleanup\n    let providerId;\n    if (rate._id) {\n      providerId = rate._id;\n    } else if (!Shipping.find({}).count()) { // There is no default provider, so add it\n      const defaultProvider = Shipping.insert({\n        name: \"Default Shipping Provider\",\n        provider: {\n          name: \"flatRates\",\n          label: \"Flat Rate\"\n        }\n      });\n      providerId = defaultProvider;\n    } else {\n      throw new Meteor.Error(\"bad-provider-id\", \"No Provider ID provided when adding methods\");\n    }\n\n    rate._id = Random.id();\n    return Shipping.update({\n      _id: providerId\n    }, {\n      $addToSet: {\n        methods: rate\n      }\n    });\n  },\n\n  /**\n   * shipping/rates/update\n   * @summary update shipping rate methods\n   * @param { Object } method shipping method object\n   * @return { Number } update result\n   */\n  \"shipping/rates/update\"(method) {\n    ShippingMethod.validate(method);\n    if (!Reaction.hasPermission(shippingRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const methodId = method._id;\n\n    return Shipping.update({\n      \"methods._id\": methodId\n    }, {\n      $set: {\n        \"methods.$\": method\n      }\n    });\n  },\n\n  /**\n   * shipping/rates/delete\n   * @summary delete shipping rate method\n   * @param { String } rateId id of method to delete\n   * @return { Number } update result\n   */\n  \"shipping/rates/delete\"(rateId) {\n    check(rateId, String);\n\n    if (!Reaction.hasPermission(shippingRoles)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const rates = Shipping.findOne({ \"methods._id\": rateId });\n    const { methods: shippingMethods } = rates;\n    const updatedMethods = shippingMethods.filter((method) => method._id !== rateId);\n\n    // HACK: not sure why we need to do this.. but it works.\n    // Replaced a $pull which in theory is better, but was broken.\n    // Issue w/ pull was introduced during the simpl-schema update\n    const deleted = Shipping.update({\n      \"methods._id\": rateId\n    }, {\n      $set: {\n        methods: updatedMethods\n      }\n    });\n\n    return deleted;\n  }\n};\n\nMeteor.methods(methods);\n","import \"./i18n\";\nimport \"./methods/rates\";\nimport \"./hooks/hooks\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Shipping Rates\",\n  name: \"reaction-shipping-rates\",\n  icon: \"fa fa-truck-o\",\n  autoEnable: true,\n  settings: {\n    name: \"Flat Rate Service\",\n    flatRates: {\n      enabled: false\n    }\n  },\n  registry: [\n    {\n      provides: [\"dashboard\"],\n      route: \"/shipping/rates\",\n      name: \"shipping\",\n      label: \"Shipping\",\n      description: \"Provide shipping rates\",\n      icon: \"fa fa-truck\",\n      priority: 1,\n      container: \"core\",\n      workflow: \"coreDashboardWorkflow\"\n    },\n    {\n      provides: [\"shippingSettings\"],\n      name: \"shipping/settings/flatRates\",\n      label: \"Flat Rate\",\n      description: \"Provide shipping rates\",\n      icon: \"fa fa-truck\",\n      template: \"shippingRatesSettings\"\n    },\n    {\n      template: \"flatRateCheckoutShipping\",\n      name: \"shipping/flatRates\",\n      provides: [\"shippingMethod\"]\n    }\n  ]\n});\n","// Tempalte paths relative to /private/email/templates\n// Templates registered in /imports/plugins/included/email-templates/server/index.js\n\n/*\n * Default email templates\n * Used when no other template is found\n */\nexport const coreDefaultTemplate = \"coreDefault\";\n\n\n/*\n * Account related email templates\n */\nexport const inviteNewShopMemberTemplate = \"accounts/inviteNewShopMember\";\nexport const inviteShopMemberTemplate = \"accounts/inviteShopMember\";\nexport const inviteShopOwnerTemplate = \"accounts/inviteShopOwner\";\nexport const resetPaswordTemplate = \"accounts/resetPassword\";\nexport const welcomeEmailTemplate = \"accounts/sendWelcomeEmail\";\nexport const verifyUpdatedEmailTemplate = \"accounts/verifyUpdatedEmail\";\n// TODO: Used by launchdock, I haven't been able to test efficiently\nexport const verifyEmailTemplate = \"accounts/verifyEmail\";\n\n\n/*\n * Order (coreOrder) related email templates\n */\nexport const coreOrderNewTemplate = \"orders/new\";\nexport const orderShipped = \"orders/shipped\";\nexport const orderRefunded = \"orders/refunded\";\nexport const orderItemRefund = \"orders/itemRefund\";\n","import { Reaction } from \"/server/api\";\nimport * as TemplatePaths from \"../lib/paths.js\";\n\n/*\n * Default email templates\n * Used when no other template is found\n */\nReaction.registerTemplate({\n  title: \"Default\",\n  name: TemplatePaths.coreDefaultTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.coreDefaultTemplate),\n  subject: \"A message from {{shop.name}}\"\n});\n\n\n/*\n * Account related email templates\n */\n\n/*\n * Accounts - Invite Shop member with an Existing User Account\n * When: Admin invites new member to shop\n */\nReaction.registerTemplate({\n  title: \"Accounts - Invite Shop Member - Existing User Account\",\n  name: TemplatePaths.inviteShopMemberTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.inviteShopMemberTemplate),\n  subject: \"You have been invited to join the group \\\"{{groupName}}\\\" in the store \\\"{{shop.name}}\\\"\"\n});\n\n/*\n * Accounts - Invite Shop member and create new user account\n * When: Admin invites new member to shop\n */\nReaction.registerTemplate({\n  title: \"Accounts - Invite Shop Member - New User Account\",\n  name: TemplatePaths.inviteNewShopMemberTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.inviteNewShopMemberTemplate),\n  subject: \"You have been invited to join the group \\\"{{groupName}}\\\" in the store \\\"{{shop.name}}\\\"\"\n});\n\n/*\n * Accounts - Invite Shop Owner\n * When: A new shop is created. This is sent to the new shop owner\n */\nReaction.registerTemplate({\n  title: \"Accounts - Invite Shop Owner\",\n  name: TemplatePaths.inviteShopOwnerTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.inviteShopOwnerTemplate),\n  subject: \"{{shop.name}} has invited you to manage a store\"\n});\n\n/*\n * Accounts - Reset Password\n * When: User requests to reset their password\n */\nReaction.registerTemplate({\n  title: \"Accounts - Reset Password\",\n  name: TemplatePaths.resetPaswordTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.resetPaswordTemplate),\n  subject: \"{{shop.name}}: Here's your password reset link\"\n});\n\n/*\n * Accounts - Welcome Email\n * When: New user signs up for an account\n */\nReaction.registerTemplate({\n  title: \"Accounts - Welcome Email\",\n  name: TemplatePaths.welcomeEmailTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.welcomeEmailTemplate),\n  subject: \"You're In. Welcome to {{shop.name}}!\"\n});\n\n/*\n * Accounts - Verify Email\n * When: A user signs up through launchdock\n * TODO: Used by launchdock, I haven't been able to test efficiently\n */\nReaction.registerTemplate({\n  title: \"Accounts - Verify Account (via LaunchDock)\",\n  name: TemplatePaths.verifyEmailTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.verifyEmailTemplate),\n  subject: \"{{shopName}}: Please verify your email address\"\n});\n\n/*\n * Accounts - Verify Updated Email\n * When: A user signs up through launchdock\n * TODO: Used by launchdock, I haven't been able to test efficiently\n */\nReaction.registerTemplate({\n  title: \"Accounts - Verify Updated Email Address\",\n  name: TemplatePaths.verifyUpdatedEmailTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.verifyUpdatedEmailTemplate),\n  subject: \"Verify your new email address\"\n});\n\n\n/*\n * Order (coreOrder) related email templates\n */\n\n/*\n * Orders - New Order Place\n * When: A user completes the cart checkout flow and a new order is placed\n */\nReaction.registerTemplate({\n  title: \"Orders - New Order Placed\",\n  name: TemplatePaths.coreOrderNewTemplate,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.coreOrderNewTemplate),\n  subject: \"Your order is confirmed - {{order._id}}\"\n});\n\n/*\n * Orders - Order Shipped\n * When: Admin completes the order flow and item is shipped\n * When: Admin resends shipment notification\n */\nReaction.registerTemplate({\n  title: \"Orders - Order Shipped\",\n  name: TemplatePaths.orderShipped,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.orderShipped),\n  subject: \"{{shop.name}}: Your order has shipped - {{order._id}}\"\n});\n\n/*\n * Orders - Order Refunded\n * When: Admin completes the order flow and item is shipped\n * When: Admin resends shipment notification\n */\nReaction.registerTemplate({\n  title: \"Orders - Order Refunded\",\n  name: TemplatePaths.orderRefunded,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.orderRefunded),\n  subject: \"{{shop.name}}: Confirmation of refund for {{order._id}}\"\n});\n\n/*\n  * Orders - Order Refunded\n  * When: Admin completes the order flow and item is shipped\n  * When: Admin refunds line items\n  */\nReaction.registerTemplate({\n  title: \"Orders - Order Item Refunded\",\n  name: TemplatePaths.orderItemRefund,\n  type: \"email\",\n  template: Reaction.Email.getTemplateFile(TemplatePaths.orderItemRefund),\n  subject: \"{{shop.name}}: Refund confirmation - {{order._id}}\"\n});\n","\nexport const SHOP_WORKFLOW_STATUS_ACTIVE = \"active\";\nexport const SHOP_WORKFLOW_STATUS_DISABLED = \"disabled\";\nexport const SHOP_WORKFLOW_STATUS_ARCHIVED = \"archived\";\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./methods.js\";\nimport \"./i18n\";\nimport \"./publications.js\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction } from \"/lib/api\";\nimport { Shops } from \"/lib/collections\";\nimport { SHOP_WORKFLOW_STATUS_ACTIVE, SHOP_WORKFLOW_STATUS_DISABLED } from \"../lib/constants\";\n\nconst status = [\n  SHOP_WORKFLOW_STATUS_ACTIVE,\n  SHOP_WORKFLOW_STATUS_DISABLED\n];\n\nexport function marketplaceUpdateShopWorkflow(shopId, workflowStatus) {\n  check(shopId, String);\n  check(workflowStatus, String);\n\n  if (shopId === Reaction.getPrimaryShopId()) {\n    throw new Meteor.Error(\"access-denied\", \"Cannot change shop status\");\n  }\n\n  if (!Reaction.hasPermission(\"admin\", this.userId, Reaction.getPrimaryShopId())) {\n    throw new Meteor.Error(\"access-denied\", \"Cannot change shop status\");\n  }\n\n  if (status.includes(workflowStatus)) {\n    try {\n      return Shops.update({\n        _id: shopId\n      }, {\n        $set: {\n          \"workflow.status\": workflowStatus\n        }\n      });\n    } catch (error) {\n      throw new Meteor.Error(\"server-error\", error.message);\n    }\n  }\n\n  throw new Meteor.Error(\"server-error\", \"Workflow status could not be updated, should be 'active' or 'disabled'\");\n}\n\nMeteor.methods({\n  \"marketplace/updateShopWorkflow\": marketplaceUpdateShopWorkflow\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction } from \"/lib/api\";\nimport { Shops } from \"/lib/collections\";\n\n\nMeteor.publish(\"SellerShops\", function (shopIds) {\n  check(shopIds, Match.Optional([String]));\n\n  const sellerShopId = Reaction.getSellerShopId(this.userId, true);\n\n  // sub publication for all shops that don't belong to current user\n  const sellerShopsSubPub = () => {\n    const selector = {};\n\n    if (shopIds) {\n      if (sellerShopId) {\n        const pubShopIds = _.without(shopIds, sellerShopId);\n        selector._id = { $in: pubShopIds };\n      }\n    } else if (sellerShopId) {\n      selector._id = { $ne: sellerShopId };\n    }\n\n    const sellerShopsObserver = Shops.find(selector, {\n      fields: { paymentMethods: 0 }\n    }).observe({\n      added: (document) => {\n        this.added(\"SellerShops\", document._id, document);\n      },\n      changed: (document) => {\n        this.changed(\"SellerShops\", document._id, document);\n      },\n      removed: (document) => {\n        this.removed(\"SellerShops\", document._id);\n      }\n    });\n\n    this.onStop(() => {\n      sellerShopsObserver.stop();\n    });\n  };\n\n  // subPublication for the owner of the shop\n  const ownedSellerShopSubPub = () => {\n    const ownedSellerShopObserver = Shops.find({ _id: sellerShopId }).observe({\n      added: (document) => {\n        this.added(\"SellerShops\", document._id, document);\n      },\n      changed: (document) => {\n        this.changed(\"SellerShops\", document._id, document);\n      },\n      removed: (document) => {\n        this.removed(\"SellerShops\", document._id);\n      }\n    });\n    this.onStop(() => {\n      ownedSellerShopObserver.stop();\n    });\n  };\n\n  if (sellerShopId && (!shopIds || shopIds.includes(sellerShopId))) {\n    ownedSellerShopSubPub();\n  }\n\n  // if we aren't try to get only the shop of the current logged-in seller\n  if (!(sellerShopId && shopIds && shopIds.length === 1 && sellerShopId === shopIds[0])) {\n    sellerShopsSubPub();\n  }\n\n  this.ready();\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Marketplace\",\n  name: \"reaction-marketplace\",\n  icon: \"fa fa-globe\",\n  autoEnable: false,\n  settings: {\n    name: \"Marketplace\",\n    enabled: true,\n    shops: {\n      enabledShopTypes: [{\n        shopType: \"merchant\",\n        active: true\n      }, {\n        shopType: \"affiliate\",\n        active: false\n      }],\n      enabledPackagesByShopTypes: [{\n        shopType: \"merchant\",\n        enabledPackages: [\n          \"reaction-dashboard\",\n          \"reaction-accounts\",\n          \"reaction-orders\",\n          \"reaction-connectors\",\n          \"reaction-connectors-shopify\",\n          \"reaction-product-admin\",\n          \"product-detail-simple\",\n          \"reaction-product-simple\",\n          \"reaction-product-variant\",\n          \"reaction-notification\",\n          \"reaction-marketplace\",\n          \"reaction-analytics\",\n          \"reaction-inventory\",\n          \"reaction-sms\",\n          \"reaction-social\",\n          \"reaction-stripe\",\n          \"reaction-taxes\",\n          \"discount-codes\"]\n      }, {\n        shopType: \"affiliate\",\n        enabledPackages: [\n          \"reaction-dashboard\",\n          \"reaction-product-simple\",\n          \"reaction-product-variant\",\n          \"reaction-notification\",\n          \"reaction-analytics\",\n          \"reaction-sms\"]\n      }]\n    },\n    public: {\n      allowMerchantSignup: false, // Merchants can sign up without an invite\n      marketplaceNakedRoutes: true, // Routes to the primary marketplace shop should not use shop prefix\n      merchantCart: false, // Unique cart for each merchant\n      merchantFulfillment: true, // Fulfillment comes from merchant which supplies product\n      merchantLocale: false, // Currency and Language come from active merchant shop\n      // merchantLanguage: false, // Language comes from active merchant shop\n      // merchantCurrency: false, // Currency comes from active merchant shop\n      merchantTheme: false, // Theme comes from active merchant shop\n      merchantShippingRates: false, // Each merchant defines their own shipping rates\n      shopPrefix: \"/shop\" // The prefix for the shop URL\n    }\n  },\n  registry: [{\n    label: \"Marketplace\",\n    icon: \"fa fa-globe\",\n    provides: [\"shopSettings\"],\n    container: \"dashboard\",\n    template: \"marketplaceShopSettings\",\n    showForShopTypes: [\"primary\"]\n  }, {\n    route: \"shop/settings/shops\",\n    template: \"MarketplaceShops\",\n    name: \"marketplaceShops\",\n    label: \"Marketplace Shops\",\n    icon: \"fa fa-globe\",\n    provides: [\"settings\"],\n    container: \"dashboard\",\n    showForShopTypes: [\"primary\"],\n    meta: {\n      actionView: {\n        dashboardSize: \"lg\"\n      }\n    },\n    permissions: [{\n      label: \"Marketplace Shops\",\n      permission: \"marketplaceShops\"\n    }]\n  }, {\n    // This provides the settings container for marketplaceMerchantSettings\n    label: \"My Shop Settings\",\n    icon: \"fa fa-briefcase\",\n    provides: [\"shopSettings\"],\n    container: \"dashboard\",\n    template: \"marketplaceMerchantSettings\",\n    hideForShopTypes: [\"primary\"]\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","/* eslint camelcase: 0 */\nimport { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Reaction Default Theme\",\n  name: \"reaction-default-theme\"\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Cart, Orders, Products } from \"/lib/collections\";\nimport { Logger, Hooks } from \"/server/api\";\nimport { registerInventory } from \"../methods/inventory\";\n\n/**\n* @method afterAddItemsToCart\n* @summary reserves inventory when item is added to cart\n* @param {String} cartId - current cartId\n* @param {Object} options - product document\n* @return {undefined}\n*/\nHooks.Events.add(\"afterAddItemsToCart\", (cartId, options) => {\n  // Adding a new product or variant to the cart\n  Logger.debug(\"after cart update, call inventory/addReserve\");\n  // Look up cart to get items added to it\n  const { items } = Cart.findOne({ _id: cartId }) || {};\n  // Reserve item\n  Meteor.call(\"inventory/addReserve\", items.filter((item) => item._id === options.newItemId));\n});\n\n/**\n* @method afterModifyQuantityInCart\n* @summary reserves inventory when cart quantity is updated\n* @param {String} cartId - current cartId\n* @param {Object} options - product document\n* @return {undefined}\n*/\nHooks.Events.add(\"afterModifyQuantityInCart\", (cartId, options) => {\n  // Modifying item quantity in cart.\n  Logger.debug(\"after variant increment, call inventory/addReserve\");\n\n  // Look up cart to get items that have been added to it\n  const { items } = Cart.findOne({ _id: cartId }) || {};\n\n  // Item to increment quantity\n  const item = items.filter((i) => (i.product._id === options.productId && i.variants._id === options.variantId));\n  Meteor.call(\"inventory/addReserve\", item);\n});\n\n\n/**\n* @method afterRemoveCatalogProduct\n* @summary updates product inventory after variant is removed\n* @param {String} userId - userId of user making the call\n* @param {Object} doc - product document\n* @return {undefined}\n*/\nHooks.Events.add(\"afterRemoveCatalogProduct\", (userId, doc) => {\n  if (doc.type === \"variant\") {\n    const variantItem = {\n      productId: doc.ancestors[0],\n      variantId: doc._id,\n      shopId: doc.shopId\n    };\n    Logger.debug(`remove inventory variants for variant: ${doc._id\n    }, call inventory/remove`);\n    Meteor.call(\"inventory/remove\", variantItem);\n  }\n\n  return doc;\n});\n\n/**\n* @method afterUpdateCatalogProduct\n* @summary adjust inventory of variants after an update\n* @param {String} userId - userId of user making the call\n* @param {Object} doc - product document\n* @return {undefined}\n*/\nHooks.Events.add(\"afterUpdateCatalogProduct\", (doc) => {\n  // Find the most recent version of the product document based on\n  // the passed in doc._id\n  const productDocument = Products.findOne({\n    _id: doc._id\n  });\n\n  if (doc.type === \"variant\") {\n    Meteor.call(\"inventory/adjust\", productDocument);\n  }\n\n  return productDocument;\n});\n\n/**\n* @method afterInsertCatalogProduct\n* @summary adds product inventory when new product is created\n* @param {String} userId - userId of user making the call\n* @param {Object} doc - product document\n* @return {undefined}\n*/\nHooks.Events.add(\"afterInsertCatalogProduct\", (doc) => {\n  if (doc.type !== \"variant\") {\n    return false;\n  }\n  registerInventory(doc);\n\n  return doc;\n});\n\n/**\n * markInventoryShipped\n * @summary check a product and update Inventory collection with inventory documents.\n * @param {Object} product - valid Schemas.Product object\n * @return {Number} - returns the total amount of new inventory created\n */\nfunction markInventoryShipped(doc) {\n  const order = Orders.findOne(doc._id);\n  const orderItems = order.items;\n  const cartItems = [];\n  for (const orderItem of orderItems) {\n    const cartItem = {\n      _id: orderItem.cartItemId || orderItem._id,\n      shopId: orderItem.shopId,\n      quantity: orderItem.quantity,\n      productId: orderItem.productId,\n      product: orderItem.product,\n      variants: orderItem.variants,\n      title: orderItem.title\n    };\n    cartItems.push(cartItem);\n  }\n  Meteor.call(\"inventory/shipped\", cartItems);\n\n  return doc;\n}\n\n/**\n * markInventorySold\n * @summary check a product and update Inventory collection with inventory documents.\n * @param {Object} doc - valid Schemas.Product object\n * @return {Number} - returns the total amount of new inventory created\n */\nfunction markInventorySold(doc) {\n  const orderItems = doc.items;\n  const cartItems = [];\n  // If a cartItemId exists it's a legacy order and we use that\n  for (const orderItem of orderItems) {\n    const cartItem = {\n      _id: orderItem.cartItemId || orderItem._id,\n      shopId: orderItem.shopId,\n      quantity: orderItem.quantity,\n      productId: orderItem.productId,\n      product: orderItem.product,\n      variants: orderItem.variants,\n      title: orderItem.title\n    };\n    cartItems.push(cartItem);\n  }\n  Meteor.call(\"inventory/sold\", cartItems);\n\n  return doc;\n}\n\n/**\n* @method afterOrderInsert\n* @summary marks inventory as sold when order is created\n* @param {Object} order - order document\n* @return {Object} order - order document\n*/\nHooks.Events.add(\"afterOrderInsert\", (order) => {\n  Logger.debug(\"Inventory module handling Order insert\");\n  markInventorySold(order);\n\n  return order;\n});\n\n/**\n* @method onOrderShipmentShipped\n* @summary marks inventory as shipped when order workflow is completed\n* @param {Object} doc - order document\n* @return {undefined}\n*/\nHooks.Events.add(\"onOrderShipmentShipped\", (doc) => {\n  Logger.debug(\"Inventory module handling Order update\");\n  markInventoryShipped(doc);\n\n  return doc;\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { Catalog } from \"/lib/api\";\nimport { Inventory, Products } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\n\n/**\n * inventory/register\n * @summary check a product and update Inventory collection with inventory documents.\n * @param {Object} product - valid Schemas.Product object\n * @return {Number} - returns the total amount of new inventory created\n */\nexport function registerInventory(product) {\n  // Retrieve schemas\n  // TODO: Permit product type registration and iterate through product types and schemas\n  Products.simpleSchema(product).validate(product);\n  const { type } = product;\n\n  let totalNewInventory = 0;\n  const productId = type === \"variant\" ? product.ancestors[0] : product._id;\n  const variants = Catalog.getVariants(productId);\n\n  // we'll check each variant to see if it has been fully registered\n  for (const variant of variants) {\n    const inventory = Inventory.find({\n      productId,\n      variantId: variant._id,\n      shopId: product.shopId\n    });\n    // we'll return this as well\n    const inventoryVariantCount = inventory.count();\n    // if the variant exists already we're remove from the inventoryVariants\n    // so that we don't process it as an insert\n    if (inventoryVariantCount < variant.inventoryQuantity) {\n      const newQty = variant.inventoryQuantity || 0;\n      let i = inventoryVariantCount + 1;\n\n      Logger.debug(`inserting ${newQty - inventoryVariantCount} new inventory items for ${variant._id}`);\n\n      const batch = Inventory._collection.rawCollection().initializeUnorderedBulkOp();\n      while (i <= newQty) {\n        const id = Inventory._makeNewID();\n        batch.insert({\n          _id: id,\n          productId,\n          variantId: variant._id,\n          shopId: product.shopId,\n          createdAt: new Date(),\n          updatedAt: new Date(),\n          workflow: { // we add this line because `batchInsert` doesn't know\n            status: \"new\" // about SimpleSchema, so `defaultValue` will not\n          }\n        });\n        i += 1;\n      }\n\n      // took from: http://guide.meteor.com/collections.html#bulk-data-changes\n      const execute = Meteor.wrapAsync(batch.execute, batch);\n      const inventoryItem = execute();\n      const inserted = inventoryItem.nInserted;\n\n      if (!inserted) { // or maybe `inventory.length === 0`?\n        // throw new Meteor.Error(\"Inventory Anomaly Detected. Abort! Abort!\");\n        return totalNewInventory;\n      }\n      Logger.debug(`registered ${inserted}`);\n      totalNewInventory += inserted;\n    }\n  }\n  // returns the total amount of new inventory created\n  return totalNewInventory;\n}\n\nfunction adjustInventory(product, userId, context) {\n  // TODO: This can fail even if updateVariant succeeds.\n  Products.simpleSchema(product).validate(product);\n  const { type } = product;\n  let results;\n\n  // calledByServer is only true if this method was triggered by the server, such as from a webhook.\n  // there will be a null connection and no userId.\n  const calledByServer = (context && context.connection === null && !Meteor.userId());\n  // if this method is calledByServer, skip permission check.\n  // user needs createProduct permission to adjust inventory\n  // REVIEW: Should this be checking shop permission instead?\n  if (!calledByServer && !Reaction.hasPermission(\"createProduct\", userId, product.shopId)) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  // Quantity and variants of this product's variant inventory\n  if (type === \"variant\") {\n    const variant = {\n      _id: product._id,\n      qty: product.inventoryQuantity || 0\n    };\n\n    const inventory = Inventory.find({\n      productId: product.ancestors[0],\n      variantId: product._id\n    });\n    const itemCount = inventory.count();\n\n    if (itemCount !== variant.qty) {\n      if (itemCount < variant.qty) {\n        // we need to register some new variants to inventory\n        results = itemCount + Meteor.call(\"inventory/register\", product);\n      } else if (itemCount > variant.qty) {\n        // determine how many records to delete\n        const removeQty = itemCount - variant.qty;\n        // we're only going to delete records that are new\n        const removeInventory = Inventory.find({\n          \"variantId\": variant._id,\n          \"workflow.status\": \"new\"\n        }, {\n          sort: {\n            updatedAt: -1\n          },\n          limit: removeQty\n        }).fetch();\n\n        results = itemCount;\n        // delete latest inventory \"status:new\" records\n        for (const inventoryItem of removeInventory) {\n          results -= Meteor.call(\"inventory/remove\", inventoryItem);\n          // we could add handling for the case when aren't enough \"new\" items\n        }\n      }\n      Logger.debug(`adjust variant ${variant._id} from ${itemCount} to ${results}`);\n    }\n  }\n}\n\nMeteor.methods({\n  \"inventory/register\"(product) {\n    if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    registerInventory(product);\n  },\n  \"inventory/adjust\"(product) { // TODO: this should be variant\n    Products.simpleSchema(product).validate(product);\n    adjustInventory(product, this.userId, this);\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Inventory } from \"/lib/collections\";\nimport * as Schemas from \"/lib/collections/schemas\";\nimport { Logger, Reaction } from \"/server/api\";\n\n// TODO statusChanges DDP limiting Disabled for now, needs more testing.\n\n// // Define a rate limiting rule that matches update attempts by non-admin users\n// const addReserveRule = {\n//   userId: function (userId) {\n//     return Roles.userIsInRole(userId, \"createProduct\", Reaction.getShopId());\n//   },\n//   type: \"subscription\",\n//   method: \"Inventory\"\n// };\n//\n// // Define a rate limiting rule that matches backorder attempts by non-admin users\n// const addBackorderRule = {\n//   userId: function (userId) {\n//     return Roles.userIsInRole(userId, \"createProduct\", Reaction.getShopId());\n//   },\n//   type: \"method\",\n//   method: \"inventory/backorder\"\n// };\n//\n// // Add the rule, allowing up to 5 messages every 1000 milliseconds.\n// DDPRateLimiter.addRule(addReserveRule, 5, 1000);\n// DDPRateLimiter.addRule(addBackorderRule, 5, 1000);\n\n/**\n * @file Methods for Inventory. Run these methods using `Meteor.call()`\n *\n *\n * @namespace Methods/Inventory\n*/\nMeteor.methods({\n  /**\n   * @name inventory/setStatus\n   * @method\n   * @memberof Methods/Inventory\n   * @summary Sets status from one status to a new status. Defaults to `new` to `reserved`\n   * @example Meteor.call(\"inventory/backorder\", reservation, backOrderQty);\n   * @param  {Array} cartItems array of objects of type Schemas.CartItems\n   * @param  {String} status optional - sets the inventory workflow status, defaults to `reserved`\n   * @param  {String} currentStatus - what is the current status to change `from`\n   * @param  {String} notFoundStatus - what to use if the status is not found\n   * @todo move this to bulkOp\n   * @return {Number} returns reservationCount\n   */\n  \"inventory/setStatus\"(cartItems, status, currentStatus, notFoundStatus) {\n    Schemas.CartItem.validate(cartItems);\n    check(status, Match.Optional(String));\n    check(currentStatus, Match.Optional(String));\n    check(notFoundStatus, Match.Optional(String));\n    this.unblock();\n\n    // check basic user permissions\n    // if (!Reaction.hasPermission([\"guest\", \"anonymous\"])) {\n    //   throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    // }\n\n    // set defaults\n    const reservationStatus = status || \"reserved\"; // change status to options object\n    const defaultStatus = currentStatus || \"new\"; // default to the \"new\" status\n    const backorderStatus = notFoundStatus || \"backorder\"; // change status to options object\n    let reservationCount;\n    Logger.debug(`Moving Inventory items from ${defaultStatus} to ${reservationStatus}`);\n\n    // update inventory status for cartItems\n    for (const item of cartItems) {\n      // check of existing reserved inventory for this cart\n      const existingReservations = Inventory.find({\n        productId: item.productId,\n        variantId: item.variants._id,\n        shopId: item.shopId,\n        orderItemId: item._id\n      });\n\n      // define a new reservation\n      const availableInventory = Inventory.find({\n        \"productId\": item.productId,\n        \"variantId\": item.variants._id,\n        \"shopId\": item.shopId,\n        \"workflow.status\": defaultStatus\n      });\n\n      const totalRequiredQty = item.quantity;\n      const availableInventoryQty = availableInventory.count();\n      let existingReservationQty = existingReservations.count();\n\n      Logger.debug(\"totalRequiredQty\", totalRequiredQty);\n      Logger.debug(\"availableInventoryQty\", availableInventoryQty);\n\n      // if we don't have existing inventory we create backorders\n      if (totalRequiredQty > availableInventoryQty) {\n        // TODO put in a dashboard setting to allow backorder or altenate handler to be used\n        const backOrderQty = Number(totalRequiredQty - availableInventoryQty - existingReservationQty);\n        Logger.debug(`no inventory found, create ${backOrderQty} ${backorderStatus}`);\n        // define a new reservation\n        const reservation = {\n          productId: item.productId,\n          variantId: item.variants._id,\n          shopId: item.shopId,\n          orderItemId: item._id,\n          workflow: {\n            status: backorderStatus\n          }\n        };\n\n        Meteor.call(\"inventory/backorder\", reservation, backOrderQty);\n        existingReservationQty = backOrderQty;\n      }\n      // if we have inventory available, only create additional required reservations\n      Logger.debug(\"existingReservationQty\", existingReservationQty);\n      reservationCount = existingReservationQty;\n      let newReservedQty;\n      if (reservationStatus === \"reserved\" && defaultStatus === \"new\") {\n        newReservedQty = totalRequiredQty - existingReservationQty + 1;\n      } else {\n        // when moving from one \"reserved\" type status, we don't need to deal with existingReservationQty\n        newReservedQty = totalRequiredQty + 1;\n      }\n\n      let i = 1;\n      while (i < newReservedQty) {\n        // updated existing new inventory to be reserved\n        Logger.debug(`updating reservation status ${i} of ${newReservedQty - 1}/${totalRequiredQty} items.`);\n        // we should be updating existing inventory here.\n        // backorder process created additional backorder inventory if there\n        // wasn't enough.\n        Inventory.update({\n          \"productId\": item.productId,\n          \"variantId\": item.variants._id,\n          \"shopId\": item.shopId,\n          \"workflow.status\": defaultStatus\n        }, {\n          $set: {\n            \"orderItemId\": item._id,\n            \"workflow.status\": reservationStatus\n          }\n        });\n        reservationCount += 1;\n        i += 1;\n      }\n    }\n    Logger.debug(`finished creating ${reservationCount} new ${reservationStatus} reservations`);\n    return reservationCount;\n  },\n\n  /**\n   * @name inventory/clearStatus\n   * @method\n   * @memberof Methods/Inventory\n   * @summary Used to reset status on inventory item (defaults to `new`)\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @param  {Array} status optional reset workflow.status, defaults to `new`\n   * @param  {Array} currentStatus optional matching workflow.status, defaults to `reserved`\n   * @return {undefined} undefined\n   */\n  \"inventory/clearStatus\"(cartItems, status, currentStatus) {\n    Schemas.CartItem.validate(cartItems);\n    check(status, Match.Optional(String)); // workflow status\n    check(currentStatus, Match.Optional(String));\n    this.unblock();\n\n    // // check basic user permissions\n    // if (!Reaction.hasPermission([\"guest\", \"anonymous\"])) {\n    //   throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    // }\n\n    // optional workflow status or default to \"new\"\n    const newStatus = status || \"new\";\n    const oldStatus = currentStatus || \"reserved\";\n\n    // remove each cart item in inventory\n    for (const item of cartItems) {\n      // check of existing reserved inventory for this cart\n      const existingReservations = Inventory.find({\n        \"productId\": item.productId,\n        \"variantId\": item.variants._id,\n        \"shopId\": item.shopId,\n        \"orderItemId\": item._id,\n        \"workflow.status\": oldStatus\n      });\n      const reservationsCount = existingReservations.count();\n      let clearCount = item.quantity;\n      // reset existing cartItem reservations\n      while (clearCount && reservationsCount) {\n        Inventory.update({\n          \"productId\": item.productId,\n          \"variantId\": item.variants._id,\n          \"shopId\": item.shopId,\n          \"orderItemId\": item._id,\n          \"workflow.status\": oldStatus\n        }, {\n          $set: {\n            \"orderItemId\": \"\", // clear order/cart\n            \"workflow.status\": newStatus // reset status\n          }\n        });\n\n        clearCount -= 1;\n      }\n    }\n    Logger.debug(\"inventory/clearReserve\", newStatus);\n  },\n\n  /**\n   * @name inventory/clearReserve\n   * @method\n   * @memberof Methods/Inventory\n   * @example Meteor.call(\"inventory/clearReserve\", cart.items)\n   * @summary Resets `reserved` items to `new`\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @return {undefined}\n   */\n  \"inventory/clearReserve\"(cartItems) {\n    Schemas.CartItem.validate(cartItems);\n    return Meteor.call(\"inventory/clearStatus\", cartItems);\n  },\n\n  /**\n   * @name inventory/addReserve\n   * @summary Converts new items to reserved, or backorders\n   * @method\n   * @example Meteor.call(\"inventory/addReserve\", cart.items)\n   * @memberof Methods/Inventory\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @return {undefined}\n   */\n  \"inventory/addReserve\"(cartItems) {\n    Schemas.CartItem.validate(cartItems);\n    return Meteor.call(\"inventory/setStatus\", cartItems);\n  },\n\n  /**\n   * @name inventory/backorder\n   * @summary Used by the cart process to create a new Inventory backorder item,\n   * but this could be used for inserting any custom inventory.\n   * @method\n   * A note on DDP Limits: As these are wide open we defined some {@link http://docs.meteor.com/#/full/ddpratelimiter ddp limiting rules}\n   * @memberof Methods/Inventory\n   * @param {Object} reservation Schemas.Inventory\n   * @param {Number} backOrderQty number of backorder items to create\n   * @returns {Number} number of inserted backorder documents\n   */\n  \"inventory/backorder\"(reservation, backOrderQty) {\n    Schemas.Inventory.validate(reservation);\n    check(backOrderQty, Number);\n    this.unblock();\n\n    // this use case could happen when mergeCart is fired. We don't add anything\n    // or remove, just item owner changed. We need to add this check here\n    // because of bulk operation. It throws exception if nothing to operate.\n    if (backOrderQty === 0) {\n      return 0;\n    }\n\n    // TODO inventory/backorder need to look carefully and understand is it possible ho have a\n    // negative `backOrderQty` value here?\n\n    // check basic user permissions\n    // if (!Reaction.hasPermission([\"guest\",\"anonymous\"])) {\n    //   throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    // }\n\n    // set defaults\n    const newReservation = reservation;\n    if (!newReservation.workflow) {\n      newReservation.workflow = {\n        status: \"backorder\"\n      };\n    }\n\n    // insert backorder\n    let i = 0;\n    const batch = Inventory.rawCollection().initializeUnorderedBulkOp();\n    if (batch) {\n      while (i < backOrderQty) {\n        const id = Inventory._makeNewID();\n        batch.insert(Object.assign({ _id: id }, newReservation));\n        i += 1;\n      }\n\n      const execute = Meteor.wrapAsync(batch.execute, batch);\n      if (batch.length) {\n        const inventoryBackorder = execute();\n        const inserted = inventoryBackorder.nInserted;\n        Logger.debug(`created ${inserted} backorder records for product ${newReservation.productId}, variant ${newReservation.variantId}`);\n        return inserted;\n      }\n    }\n    //\n    // TODO implement a backup inventory/backorder method if bulk operations fail.\n    //\n    Logger.error(\"skipped bulk operations backorder updates.\");\n    return null;\n  },\n\n  /**\n   * @name inventory/lowStock\n   * @summary Send low stock warnings\n   * @method\n   * @memberof Methods/Inventory\n   * @param  {Object} product object type Product\n   * @return {undefined}\n   * @todo implement inventory/lowstock calculations\n   */\n  \"inventory/lowStock\"(product) {\n    Schemas.Product.validate(product);\n    // placeholder is here to give plugins a place to hook into\n    Logger.debug(\"inventory/lowStock\");\n  },\n\n  /**\n   * @name inventory/remove\n   * @summary Delete an inventory item permanently\n   * @method\n   * @memberof Methods/Inventory\n   * @param  {Object} inventoryItem object type Schemas.Inventory\n   * @return {String} return remove result\n   */\n  \"inventory/remove\"(inventoryItem) {\n    Schemas.Inventory.validate(inventoryItem);\n    // user needs createProduct permission to adjust inventory\n    // REVIEW: Should this be checking against shop permissions instead?\n\n    // calledByServer is only true if this method was triggered by the server, such as from a webhook.\n    // there will be a null connection and no userId.\n    const calledByServer = (this.connection === null && !Meteor.userId());\n\n    if (!calledByServer && !Reaction.hasPermission(\"createProduct\", this.userId, inventoryItem.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    // this.unblock();\n    // TODO: add bulkOp here\n\n    Logger.debug(\"inventory/remove\", inventoryItem);\n    return Inventory.remove(inventoryItem);\n  },\n\n  /**\n   * @name inventory/shipped\n   * @method\n   * @memberof Methods/Inventory\n   * @summary Mark inventory as shipped\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @return {undefined}\n   */\n  \"inventory/shipped\"(cartItems) {\n    Schemas.CartItem.validate(cartItems);\n    return Meteor.call(\"inventory/setStatus\", cartItems, \"shipped\", \"sold\");\n  },\n\n  /**\n   * @name inventory/sold\n   * @method\n   * @memberof Methods/Inventory\n   * @summary Mark inventory as sold\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @return {undefined}\n   */\n  \"inventory/sold\"(cartItems) {\n    Schemas.CartItem.validate(cartItems);\n    return Meteor.call(\"inventory/setStatus\", cartItems, \"sold\", \"reserved\");\n  },\n\n  /**\n   * @name inventory/return\n   * @method\n   * @memberof Methods/Inventory\n   * @summary Mark inventory as returned\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @return {undefined}\n   */\n  \"inventory/return\"(cartItems) {\n    Schemas.CartItem.validate(cartItems);\n    return Meteor.call(\"inventory/setStatus\", cartItems, \"return\");\n  },\n\n  /**\n   * @name inventory/returnToStock\n   * @method\n   * @memberof Methods/Inventory\n   * @summary Mark inventory as return and available for sale\n   * @param  {Array} cartItems array of objects Schemas.CartItem\n   * @return {undefined}\n   */\n  \"inventory/returnToStock\"(cartItems) {\n    Schemas.CartItem.validate(cartItems);\n    return Meteor.call(\"inventory/clearStatus\", cartItems, \"new\", \"return\");\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Inventory } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\nMeteor.publish(\"Inventory\", function () {\n  if (this.userId === null) {\n    return this.ready();\n  }\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n  if (Roles.userIsInRole(\n    this.userId, [\"admin\", \"owner\", \"createProduct\"],\n    shopId\n  )) {\n    return Inventory.find({\n      shopId\n    });\n  }\n  return this.ready();\n});\n","import { Hooks, Logger } from \"/server/api\";\nimport { Products, Inventory } from \"/lib/collections\";\nimport { registerInventory } from \"../methods/inventory\";\n\n// On first-time startup init the Inventory collection with entries for each product\nHooks.Events.add(\"afterCoreInit\", () => {\n  // If we already have any inventory record, skip\n  const inventory = Inventory.find().count();\n  if (!inventory) {\n    const products = Products.find().fetch();\n    for (const product of products) {\n      Logger.debug(`Registering product ${product.title}`);\n      registerInventory(product);\n    }\n  }\n});\n","import \"./methods/statusChanges\";\nimport \"./methods/inventory\";\n\nimport \"./publications/inventory\";\n\nimport \"./hooks/hooks\";\nimport \"./startup/init\";\nimport \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Inventory\",\n  name: \"reaction-inventory\",\n  icon: \"fa fa-building\",\n  autoEnable: true,\n  settings: {\n    name: \"Inventory\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    label: \"Inventory\",\n    description: \"Inventory utilities\",\n    icon: \"fa fa-building\",\n    priority: 1,\n    container: \"utilities\",\n    permissions: [{\n      label: \"Inventory\",\n      permission: \"dashboard/inventory\"\n    }]\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreInventoryWorkflow\",\n    collection: \"Inventory\",\n    theme: \"default\",\n    enabled: true\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Accounts, Cart, Jobs } from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\nimport { ServerSessions } from \"/server/publications/collections/sessions\";\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\n\n/**\n * {Function} that fetches stale carts\n * @param {Object} olderThan older than date\n * @return {Object} stale carts\n */\nconst getstaleCarts = (olderThan) => Cart.find({ updatedAt: { $lte: olderThan } }).fetch();\n\n\nexport function setupStaleCartHook() {\n  Hooks.Events.add(\"afterCoreInit\", () => {\n    Logger.debug(\"Adding Job removeStaleCart and Accounts to jobControl\");\n    const settings = Reaction.getShopSettings();\n    if (settings.cart) {\n      new Job(Jobs, \"cart/removeFromCart\", {})\n        .priority(\"normal\")\n        .retry({\n          retries: 5,\n          wait: 60000,\n          backoff: \"exponential\" // delay by twice as long for each subsequent retry\n        })\n        .repeat({\n          schedule: Jobs.later.parse.text(\"every day\")\n        })\n        .save({\n          cancelRepeats: true\n        });\n    } else {\n      Logger.debug(\"No cart cleanup schedule\");\n    }\n  });\n}\n\nexport function cartCleanupJob() {\n  const removeStaleCart = Jobs.processJobs(\"cart/removeFromCart\", {\n    pollInterval: 60 * 60 * 1000, // backup polling, see observer below\n    workTimeout: 180 * 1000\n  }, (job, callback) => {\n    Logger.debug(\"Processing cart/removeFromCart\");\n    const settings = Reaction.getShopSettings();\n    if (settings.cart) {\n      Promise.await(lazyLoadMoment());\n      const schedule = (settings.cart.cleanupDurationDays).match(/\\d/);// configurable in shop settings\n      const olderThan = moment().subtract(Number(schedule[0]), \"days\")._d;\n      const carts = getstaleCarts(olderThan);\n      carts.forEach((cart) => {\n        const user = Accounts.findOne({ _id: cart.userId });\n        if (!user.emails.length) {\n          const removeCart = Cart.remove({ userId: user._id });\n          const removeAccount = Accounts.remove({\n            _id: cart.userId,\n            emails: []\n          });\n          Hooks.Events.run(\"afterAccountsRemove\", null, user._id);\n          const destroySession = ServerSessions.remove({ _id: cart.sessionId });\n          Meteor.users.remove({ _id: user._id, emails: [] }); // clears out anonymous user\n          if (removeCart && removeAccount && destroySession) {\n            const success = \"Stale anonymous user cart and account successfully cleaned\";\n            Logger.debug(success);\n            job.done(success, { repeatId: true });\n          }\n        } else {\n          Cart.remove({ userId: user._id });\n          const success = \"Stale user cart successfully cleaned\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n        }\n      });\n    } else {\n      Logger.debug(\"No cart cleanup schedule\");\n    }\n    callback();\n  });\n  Jobs.find({\n    type: \"cart/removeFromCart\",\n    status: \"ready\"\n  }).observe({\n    added() {\n      return removeStaleCart.trigger();\n    }\n  });\n}\n","import { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Jobs } from \"/lib/collections\";\nimport { Hooks, Logger } from \"/server/api\";\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\nexport function addCleanupJobControlHook() {\n  Hooks.Events.add(\"onJobServerStart\", () => {\n    Logger.debug(\"Adding Job jobControl/removeStaleJobs to JobControl\");\n\n    new Job(Jobs, \"jobControl/removeStaleJobs\", {})\n      .retry({\n        retries: 5,\n        wait: 60000,\n        backoff: \"exponential\"\n      })\n      .repeat({\n        schedule: Jobs.later.parse.text(\"every day\")\n      })\n      .save({\n        cancelRepeats: true\n      });\n  });\n}\n\nexport function cleanupJob() {\n  const removeStaleJobs = Jobs.processJobs(\"jobControl/removeStaleJobs\", {\n    pollInterval: 60 * 60 * 1000, // backup polling, see observer below\n    workTimeout: 60 * 1000\n  }, (job, callback) => {\n    Logger.debug(\"Processing jobControl/removeStaleJobs...\");\n\n    // TODO: set this interval in the admin UI\n    Promise.await(lazyLoadMoment());\n    const olderThan = moment().subtract(3, \"days\")._d;\n\n    const ids = Jobs.find({\n      type: {\n        $nin: [\"sendEmail\"]\n      },\n      status: {\n        $in: [\"cancelled\", \"completed\", \"failed\"]\n      },\n      updated: {\n        $lt: olderThan\n      }\n    }, {\n      fields: {\n        _id: 1\n      }\n    }).map((d) => d._id);\n\n    let success;\n    if (ids.length > 0) {\n      Jobs.removeJobs(ids);\n      success = `Removed ${ids.length} stale jobs`;\n      Logger.debug(success);\n    } else {\n      success = \"No eligible jobs to cleanup\";\n      Logger.debug(success);\n    }\n    job.done(success, { repeatId: true });\n    return callback();\n  });\n\n  Jobs.find({\n    type: \"jobControl/removeStaleJobs\",\n    status: \"ready\"\n  }).observe({\n    added() {\n      return removeStaleJobs.trigger();\n    }\n  });\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Jobs } from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\n\n\nexport function setupFetchFlushCurrencyHooks() {\n  // While we don't necessarily need to wait for anything to add a job\n  // in this case we need to have packages loaded so we can check for the OER API key\n  Hooks.Events.add(\"afterCoreInit\", () => {\n    const settings = Reaction.getShopSettings();\n    const exchangeConfig = settings.openexchangerates || {};\n\n    if (exchangeConfig.appId) {\n      const refreshPeriod = exchangeConfig.refreshPeriod || \"every 4 hours\";\n      Logger.debug(`Adding shop/fetchCurrencyRates to JobControl. Refresh ${refreshPeriod}`);\n      new Job(Jobs, \"shop/fetchCurrencyRates\", {})\n        .retry({\n          retries: 5,\n          wait: 60000,\n          backoff: \"exponential\" // delay by twice as long for each subsequent retry\n        })\n        .repeat({\n          schedule: Jobs.later.parse.text(refreshPeriod)\n        })\n        .save({\n          // Cancel any jobs of the same type,\n          // but only if this job repeats forever.\n          cancelRepeats: true\n        });\n\n      // Run the first time immediately after server start. The repeat({schedule}) option via\n      // later.js scheduling won't run before the first scheduled time, even with delay() or after()\n      new Job(Jobs, \"shop/fetchCurrencyRates\", {})\n        .retry({\n          retries: 5,\n          wait: 10000\n        })\n        .save();\n    } else {\n      Logger.warn(\"OpenExchangeRates API not configured. Not adding fetchRates job\");\n    }\n  });\n\n  Hooks.Events.add(\"afterCoreInit\", () => {\n    const settings = Reaction.getShopSettings();\n    const exchangeConfig = settings.openexchangerates || {};\n\n    if (exchangeConfig.appId) {\n      Logger.debug(\"Adding shop/flushCurrencyRates to JobControl\");\n      // TODO: Add this as a configurable option\n      const refreshPeriod = \"Every 24 hours\";\n      new Job(Jobs, \"shop/flushCurrencyRates\", {})\n        .retry({\n          retries: 5,\n          wait: 60000,\n          backoff: \"exponential\"\n        })\n        .repeat({\n          schedule: Jobs.later.parse.text(refreshPeriod)\n        })\n        .save({\n          cancelRepeats: true\n        });\n    } else {\n      Logger.warn(\"OpenExchangeRates API not configured. Not adding flushRates job\");\n    }\n  });\n}\n\n\nexport function fetchRateJobs() {\n  const fetchCurrencyRates = Jobs.processJobs(\"shop/fetchCurrencyRates\", {\n    pollInterval: 60 * 60 * 1000, // backup polling, see observer below\n    workTimeout: 180 * 1000\n  }, (job, callback) => {\n    Meteor.call(\"shop/fetchCurrencyRate\", (error) => {\n      if (error) {\n        if (error.error === \"notConfigured\") {\n          Logger.error(error.message);\n          job.done(error.message, { repeatId: true });\n        } else {\n          job.done(error.toString(), { repeatId: true });\n        }\n      } else {\n        // we should always return \"completed\" job here, because errors are fine\n        // result for this task, so that's why we show message if error happens\n        // and return job.done();\n        // you can read more about job.repeat() here:\n        // https://github.com/vsivsi/meteor-job-collection#set-how-many-times-this\n        // -job-will-be-automatically-re-run-by-the-job-collection\n        const success = \"Latest exchange rates were fetched successfully.\";\n        Logger.debug(success);\n        job.done(success, { repeatId: true });\n      }\n    });\n    callback();\n  });\n\n  Jobs.find({\n    type: \"shop/fetchCurrencyRates\",\n    status: \"ready\"\n  }).observe({\n    added() {\n      return fetchCurrencyRates.trigger();\n    }\n  });\n\n\n  const flushCurrencyRates = Jobs.processJobs(\n    \"shop/flushCurrencyRates\", {\n      pollInterval: 60 * 60 * 1000, // backup polling, see observer below\n      workTimeout: 180 * 1000\n    },\n    (job, callback) => {\n      Meteor.call(\"shop/flushCurrencyRate\", (error) => {\n        if (error) {\n          if (error.error === \"notExists\") {\n            Logger.error(error.message);\n            job.done(error.message, { repeatId: true });\n          } else {\n            // Logger.error(error.toString());\n            job.done(error.toString(), { repeatId: true });\n          }\n        } else {\n          // https://github.com/vsivsi/meteor-job-collection#set-how-many-times-this\n          // -job-will-be-automatically-re-run-by-the-job-collection\n          const success = \"Stale exchange rates were flushed.\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n        }\n      });\n      callback();\n    }\n  );\n\n  Jobs.find({\n    type: \"shop/flushCurrencyRates\",\n    status: \"ready\"\n  }).observe({\n    added() {\n      return flushCurrencyRates.trigger();\n    }\n  });\n}\n","import { cleanupJob, addCleanupJobControlHook } from \"./jobs/cleanup\";\nimport { fetchRateJobs, setupFetchFlushCurrencyHooks } from \"./jobs/exchangerates\";\nimport { cartCleanupJob, setupStaleCartHook } from \"./jobs/cart\";\nimport \"./i18n\";\n\naddCleanupJobControlHook();\ncleanupJob();\n\nsetupFetchFlushCurrencyHooks();\nfetchRateJobs();\n\nsetupStaleCartHook();\ncartCleanupJob();\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Job Control\",\n  name: \"reaction-jobcontrol\",\n  icon: \"fa fa-vine\",\n  autoEnable: true\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Logger, MethodHooks, Reaction } from \"/server/api\";\n\nconst getAdminUserId = () => {\n  // TODO validate with multiple show owners\n  // switch to using getShopId for role lookup\n  const admin = Meteor.users.findOne({\n    \"roles.__global_roles__\": \"owner\"\n  });\n  if (admin && typeof admin === \"object\") {\n    return admin._id;\n  }\n  return false;\n};\n\nconst sendNotificationToAdmin = (adminId) => {\n  const type = \"forAdmin\";\n  const prefix = Reaction.getShopPrefix();\n  const url = `${prefix}/dashboard/orders`;\n  const sms = true;\n  // Sending notification to admin\n  Logger.debug(\"sending notification to admin\");\n  return Meteor.call(\"notification/send\", adminId, type, url, sms);\n};\n\nMethodHooks.after(\"cart/copyCartToOrder\", (options) => {\n  const userId = Meteor.userId();\n  const type = \"newOrder\";\n  const prefix = Reaction.getShopPrefix();\n  const url = `${prefix}/notifications`;\n  const sms = true;\n\n  // Send notification to user who made the order\n  Logger.debug(`sending notification to user: ${userId}`);\n  Meteor.call(\"notification/send\", userId, type, url, sms);\n\n  // Sending notification to admin\n  const adminId = getAdminUserId();\n  if (adminId) {\n    return sendNotificationToAdmin(adminId);\n  }\n  return options.result;\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./notifications.js\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Notifications, Packages } from \"/lib/collections\";\n\n/**\n * @file Methods for Notifications. Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/Notification\n*/\nMeteor.methods({\n  /**\n  * @name notification/send\n  * @memberof Methods/Notification\n  * @method\n  * @summary This send a notification to a user\n  * @param {String} userId - The user\n  * @param {String} type - The type of Notification\n  * @param {String} url - url link\n  * @param {Boolean} sms - sms enabled check.\n  * @param {String} details - details of the Notification\n  * @return {Object} returns result\n  */\n  \"notification/send\"(userId, type, url, sms, details) {\n    check(userId, String);\n    check(type, String);\n    check(sms, Boolean);\n    check(details, Match.OptionalOrNull(String));\n    check(url, String);\n\n    const values = {};\n    const types = {\n      orderCanceled: \"Your order was canceled.\",\n      newOrder: \"Your order was accepted\",\n      forAdmin: \"You have a new order.\",\n      orderDelivered: \"Your order has been delivered.\",\n      orderProcessing: \"Your order is being processed.\",\n      orderShipped: \"Your order has been shipped.\"\n    };\n\n    if (userId && type && url) {\n      values.type = type;\n      values.to = userId;\n      values.url = url;\n      values.message = types[type];\n      values.hasDetails = false;\n      if (details) {\n        values.hasDetails = true;\n        values.details = details;\n      }\n    }\n\n    if (sms) {\n      const result = Packages.findOne({ name: \"reaction-sms\", shopId: Reaction.getShopId() });\n      if (result && result.enabled) {\n        Meteor.call(\"sms/send\", values.message, userId, Reaction.getShopId(), (error) => {\n          if (error) {\n            Logger.warn(\"Error: error occured while sending sms\", error);\n          }\n        });\n      } else {\n        Logger.debug(\"Sms is not enabled\");\n      }\n    }\n    Logger.debug(`Sending notification to ${userId}`);\n    return Notifications.insert(values);\n  },\n\n  /**\n   * @name notification/markOneAsRead\n   * @memberof Methods/Notification\n   * @method\n   * @summary This marks all user's notification as ready\n   * @param {String} id - The notification id\n   * @return {Object} returns cursor\n   */\n  \"notification/markOneAsRead\": (id) => {\n    check(id, String);\n\n    return Notifications.update({ _id: id }, {\n      $set: {\n        status: \"read\"\n      }\n    });\n  },\n\n  /**\n   * @name notification/delete\n   * @memberof Methods/Notification\n   * @method\n   * @summary This deletes a notification\n   * @param {String} id - The notification id\n   * @return {Object} return cursor\n   */\n  \"notification/delete\": (id) => {\n    check(id, String);\n\n    return Notifications.remove({ _id: id });\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Logger } from \"/server/api\";\nimport { Notifications } from \"/lib/collections\";\n\n/**\n * Notification list publication\n * @param {String} userId\n * @return {Object} return notification cursor\n */\nMeteor.publish(\"Notification\", function (userId) {\n  check(userId, Match.OptionalOrNull(String));\n\n  if (!userId) {\n    Logger.debug(\"Ingnoring null request on Notification Subscription\");\n    return this.ready();\n  }\n\n  const result = Notifications.find({ to: userId });\n\n  return result;\n});\n","import \"./publications/notifications\";\nimport \"./methods\";\nimport \"./hooks/notification\";\nimport \"./init.js\";\nimport \"./i18n\";\n","import { Reaction, Hooks } from \"/server/api\";\n\nHooks.Events.add(\"afterCoreInit\", () => {\n  Reaction.addRolesToGroups({\n    allShops: true,\n    groups: [\"guest\", \"customer\"],\n    roles: [\"notifications\"]\n  });\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Notifications\",\n  name: \"reaction-notification\",\n  icon: \"fa fa-bell\",\n  autoEnable: false,\n  registry: [{\n    label: \"Notifications\",\n    name: \"notifications\",\n    route: \"/notifications\",\n    workflow: \"coreWorkflow\",\n    permissions: [{\n      label: \"Notifications\",\n      permission: \"notifications\"\n    }],\n    template: \"notificationRoute\"\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","/* eslint camelcase: 0 */\n/* eslint quote-props: 0 */\n// meteor modules\nimport accounting from \"accounting-js\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Promise } from \"meteor/promise\";\n\nimport AuthNetAPI from \"authorize-net\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\nimport { ValidCardNumber, ValidExpireMonth, ValidExpireYear, ValidCVV } from \"/lib/api\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\n\nfunction getAccountOptions(isPayment) {\n  const queryConditions = {\n    name: \"reaction-auth-net\",\n    shopId: Reaction.getShopId()\n  };\n  if (isPayment) {\n    queryConditions.enabled = true;\n  }\n\n  const packageData = Packages.findOne(queryConditions);\n  const { settings } = packageData;\n  const ref = Meteor.settings.authnet;\n  const options = {\n    login: getSettings(settings, ref, \"api_id\"),\n    tran_key: getSettings(settings, ref, \"transaction_key\")\n  };\n\n  if (!options.login) {\n    throw new Meteor.Error(\"invalid-credentials\", \"Invalid Authnet Credentials\");\n  }\n  return options;\n}\n\nfunction getSettings(settings, ref, valueName) {\n  if (settings !== null) {\n    return settings[valueName];\n  } else if (ref !== null) {\n    return ref[valueName];\n  }\n  return undefined;\n}\n\nMeteor.methods({\n  authnetSubmit(transactionType = \"authorizeTransaction\", cardInfo, paymentInfo) {\n    check(transactionType, String);\n    try {\n      check(cardInfo, {\n        cardNumber: ValidCardNumber,\n        expirationYear: ValidExpireYear,\n        expirationMonth: ValidExpireMonth,\n        cvv2: ValidCVV\n      });\n    } catch (error) {\n      throw new Meteor.Error(\"invalid-card-details\", \"Invalid card details\");\n    }\n    check(paymentInfo, {\n      total: String,\n      currency: String\n    });\n\n    const order = {\n      amount: paymentInfo.total\n    };\n    const creditCard = {\n      creditCardNumber: cardInfo.cardNumber,\n      cvv2: cardInfo.cvv2,\n      expirationYear: cardInfo.expirationYear,\n      expirationMonth: cardInfo.expirationMonth\n    };\n    const isPayment = true;\n    const authnetService = getAuthnetService(getAccountOptions(isPayment));\n    const authnetTransactionFunc = authnetService[transactionType];\n    let authResult;\n    if (authnetTransactionFunc) {\n      try {\n        authResult = authnetTransactionFunc.call(\n          authnetService,\n          order,\n          creditCard\n        );\n      } catch (error) {\n        Logger.fatal(error);\n      }\n    } else {\n      throw new Meteor.Error(\"invalid-transaction-type\", \"Invalid Transaction Type\");\n    }\n    try {\n      const result = Promise.await(authResult);\n      return result;\n    } catch (error) {\n      throw new Meteor.Error(\"auth-failed\", error.message);\n    }\n  },\n\n  \"authnet/payment/capture\"(paymentMethod) {\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    const {\n      transactionId,\n      amount\n    } = paymentMethod;\n\n    const authnetService = getAuthnetService(getAccountOptions());\n    const roundedAmount = parseFloat(amount.toFixed(2));\n    const capturedAmount = accounting.toFixed(amount, 2);\n    let result;\n    if (capturedAmount === accounting.toFixed(0, 2)) {\n      try {\n        const captureResult = voidTransaction(\n          transactionId,\n          authnetService\n        );\n        if (captureResult.responseCode[0] === \"1\") {\n          result = {\n            saved: true,\n            response: captureResult\n          };\n        } else {\n          result = {\n            saved: false,\n            error: captureResult\n          };\n        }\n      } catch (error) {\n        Logger.fatal(error);\n        result = {\n          saved: false,\n          error\n        };\n      }\n      return result;\n    }\n    try {\n      const captureResult = priorAuthCaptureTransaction(\n        transactionId,\n        roundedAmount,\n        authnetService\n      );\n      if (captureResult.responseCode[0] === \"1\") {\n        result = {\n          saved: true,\n          response: captureResult\n        };\n      } else {\n        result = {\n          saved: false,\n          error: captureResult\n        };\n      }\n    } catch (error) {\n      Logger.fatal(error);\n      result = {\n        saved: false,\n        error\n      };\n    }\n    return result;\n  },\n\n  \"authnet/refund/create\"(paymentMethod, amount) {\n    check(amount, Number);\n\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    const result = {\n      saved: false,\n      error: \"Reaction does not yet support direct refund processing from Authorize.net. \" +\n      \"Please visit their web portal to perform this action. https://account.authorize.net/\"\n    };\n\n    return result;\n  },\n  \"authnet/refund/list\"(...args) {\n    check(args, [Match.Any]);\n    Meteor.Error(\"not-implemented\", \"Authorize.net does not yet support retrieving a list of refunds.\");\n    return [];\n  }\n});\n\nfunction getAuthnetService(accountOptions) {\n  const {\n    login,\n    tran_key,\n    mode\n  } = accountOptions;\n\n  return new AuthNetAPI({\n    API_LOGIN_ID: login,\n    TRANSACTION_KEY: tran_key,\n    testMode: !mode\n  });\n}\n\nfunction priorAuthCaptureTransaction(transId, amount, service) {\n  const body = {\n    transactionType: \"priorAuthCaptureTransaction\",\n    amount,\n    refTransId: transId\n  };\n  // This call returns a Promise to the cb so we need to use Promise.await\n  const transactionRequest = service.sendTransactionRequest.call(service, body, (trans) => trans);\n  return Promise.await(transactionRequest);\n}\n\nfunction voidTransaction(transId, service) {\n  const body = {\n    transactionType: \"voidTransaction\",\n    refTransId: transId\n  };\n  // This call returns a Promise to the cb so we need to use Promise.await\n  const transactionRequest = service.sendTransactionRequest.call(service, body, (trans) => trans);\n  return Promise.await(transactionRequest);\n}\n","import \"./i18n\";\nimport \"./methods/authnet\";\n","/* eslint camelcase: 0 */\nimport { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Authorize.net\",\n  name: \"reaction-auth-net\",\n  icon: \"fa fa-credit-card\",\n  autoEnable: false,\n  settings: {\n    \"api_id\": \"\",\n    \"transaction_key\": \"\",\n    \"mode\": false,\n    \"authnet\": {\n      enabled: false\n    },\n    \"reaction-auth-net\": {\n      enabled: false,\n      support: [\n        \"Authorize\",\n        \"Capture\"\n      ]\n    }\n  },\n  registry: [\n    // Settings panel\n    {\n      provides: [\"paymentSettings\"],\n      label: \"Authorize.net\",\n      container: \"dashboard\",\n      template: \"authnetSettings\"\n    },\n\n    // Payment form for checkout\n    {\n      template: \"authnetPaymentForm\",\n      provides: [\"paymentMethod\"],\n      icon: \"fa fa-credit-card\"\n    }\n  ]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport * as BraintreeMethods from \"./braintreeMethods\";\n\nMeteor.methods({\n  \"braintreeSubmit\": BraintreeMethods.paymentSubmit,\n  \"braintree/payment/capture\": BraintreeMethods.paymentCapture,\n  \"braintree/refund/create\": BraintreeMethods.createRefund,\n  \"braintree/refund/list\": BraintreeMethods.listRefunds\n});\n","/* eslint camelcase: 0 */\nimport Braintree from \"braintree\";\nimport accounting from \"accounting-js\";\nimport Future from \"fibers/future\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\n\nexport const BraintreeApi = {};\nBraintreeApi.apiCall = {};\n\n\nfunction getPaymentObj() {\n  return {\n    amount: \"\",\n    options: { submitForSettlement: true }\n  };\n}\n\nfunction parseCardData(data) {\n  return {\n    cardholderName: data.name,\n    number: data.number,\n    expirationMonth: data.expirationMonth,\n    expirationYear: data.expirationYear,\n    cvv: data.cvv\n  };\n}\n\n\nfunction getSettings(settings, ref, valueName) {\n  if (settings !== null) {\n    return settings[valueName];\n  } else if (ref !== null) {\n    return ref[valueName];\n  }\n  return undefined;\n}\n\nfunction getAccountOptions(isPayment) {\n  const queryConditions = {\n    name: \"reaction-braintree\",\n    shopId: Reaction.getShopId()\n  };\n  if (isPayment) {\n    queryConditions.enabled = true;\n  }\n\n  const { settings } = Packages.findOne(queryConditions);\n  let environment;\n  if (typeof settings !== \"undefined\" && settings !== null ? settings.mode : undefined === true) {\n    environment = \"production\";\n  } else {\n    environment = \"sandbox\";\n  }\n\n  const ref = Meteor.settings.braintree;\n  const options = {\n    environment,\n    merchantId: getSettings(settings, ref, \"merchant_id\"),\n    publicKey: getSettings(settings, ref, \"public_key\"),\n    privateKey: getSettings(settings, ref, \"private_key\")\n  };\n  if (!options.merchantId) {\n    throw new Meteor.Error(\"invalid-credentials\", \"Invalid Braintree Credentials\");\n  }\n  return options;\n}\n\nfunction getGateway(isNewPayment) {\n  const accountOptions = getAccountOptions(isNewPayment);\n  if (accountOptions.environment === \"production\") {\n    accountOptions.environment = Braintree.Environment.Production;\n  } else {\n    accountOptions.environment = Braintree.Environment.Sandbox;\n  }\n  const gateway = Braintree.connect(accountOptions);\n  return gateway;\n}\n\nfunction getRefundDetails(refundId) {\n  check(refundId, String);\n  const gateway = getGateway();\n  const braintreeFind = Meteor.wrapAsync(gateway.transaction.find, gateway.transaction);\n  const findResults = braintreeFind(refundId);\n  return findResults;\n}\n\n\nBraintreeApi.apiCall.paymentSubmit = function (paymentSubmitDetails) {\n  const isNewPayment = true;\n  const gateway = getGateway(isNewPayment);\n  const paymentObj = getPaymentObj();\n  if (paymentSubmitDetails.transactionType === \"authorize\") {\n    paymentObj.options.submitForSettlement = false;\n  }\n  paymentObj.creditCard = parseCardData(paymentSubmitDetails.cardData);\n  paymentObj.amount = paymentSubmitDetails.paymentData.total;\n  const fut = new Future();\n  gateway.transaction.sale(paymentObj, Meteor.bindEnvironment((error, result) => {\n    if (error) {\n      fut.return({\n        saved: false,\n        error\n      });\n    } else if (!result.success) {\n      fut.return({\n        saved: false,\n        response: result\n      });\n    } else {\n      fut.return({\n        saved: true,\n        response: result\n      });\n    }\n  }, (error) => {\n    Reaction.Events.warn(error);\n  }));\n\n  return fut.wait();\n};\n\n\nBraintreeApi.apiCall.captureCharge = function (paymentCaptureDetails) {\n  const { transactionId } = paymentCaptureDetails;\n  const amount = accounting.toFixed(paymentCaptureDetails.amount, 2);\n  const gateway = getGateway();\n  const fut = new Future();\n\n  if (amount === accounting.toFixed(0, 2)) {\n    gateway.transaction.void(transactionId, (error, result) => {\n      if (error) {\n        fut.return({\n          saved: false,\n          error\n        });\n      } else {\n        fut.return({\n          saved: true,\n          response: result\n        });\n      }\n    }, (e) => {\n      Logger.warn(e);\n    });\n    return fut.wait();\n  }\n  gateway.transaction.submitForSettlement(transactionId, amount, Meteor.bindEnvironment((error, result) => {\n    if (error) {\n      fut.return({\n        saved: false,\n        error\n      });\n    } else {\n      fut.return({\n        saved: true,\n        response: result\n      });\n    }\n  }, (e) => {\n    Logger.warn(e);\n  }));\n\n  return fut.wait();\n};\n\n\nBraintreeApi.apiCall.createRefund = function (refundDetails) {\n  const { amount, transactionId } = refundDetails;\n  const gateway = getGateway();\n  const fut = new Future();\n  gateway.transaction.refund(transactionId, amount, Meteor.bindEnvironment((error, result) => {\n    if (error) {\n      fut.return({\n        saved: false,\n        error\n      });\n    } else if (!result.success) {\n      if (result.errors.errorCollections.transaction.validationErrors.base[0].code === \"91506\") {\n        fut.return({\n          saved: false,\n          error: \"Braintree does not allow refunds until transactions are settled. This can take up to 24 hours. Please try again later.\"\n        });\n      } else {\n        fut.return({\n          saved: false,\n          error: result.message\n        });\n      }\n    } else {\n      fut.return({\n        saved: true,\n        response: result\n      });\n    }\n  }, (e) => {\n    Logger.fatal(e);\n  }));\n  return fut.wait();\n};\n\n\nBraintreeApi.apiCall.listRefunds = function (refundListDetails) {\n  const { transactionId } = refundListDetails;\n  const gateway = getGateway();\n  const braintreeFind = Meteor.wrapAsync(gateway.transaction.find, gateway.transaction);\n  const findResults = braintreeFind(transactionId);\n  const result = [];\n  if (findResults.refundIds.length > 0) {\n    Promise.await(lazyLoadMoment());\n    for (const refund of findResults.refundIds) {\n      const refundDetails = getRefundDetails(refund);\n      result.push({\n        type: \"refund\",\n        amount: parseFloat(refundDetails.amount),\n        created: moment(refundDetails.createdAt).unix() * 1000,\n        currency: refundDetails.currencyIsoCode,\n        raw: refundDetails\n      });\n    }\n  }\n\n  return result;\n};\n","import { check } from \"meteor/check\";\nimport { BraintreeApi } from \"./braintreeApi\";\nimport { Logger } from \"/server/api\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\n\n/**\n * braintreeSubmit\n * Authorize, or authorize and capture payments from Braintree\n * https://developers.braintreepayments.com/reference/request/transaction/sale/node\n * @param {String} transactionType - either authorize or capture\n * @param {Object} cardData - Object containing everything about the Credit card to be submitted\n * @param {Object} paymentData - Object containing everything about the transaction to be settled\n * @return {Object} results - Object containing the results of the transaction\n */\nexport function paymentSubmit(transactionType, cardData, paymentData) {\n  check(transactionType, String);\n  check(cardData, {\n    name: String,\n    number: String,\n    expirationMonth: String,\n    expirationYear: String,\n    cvv2: String,\n    type: String\n  });\n  check(paymentData, {\n    total: String,\n    currency: String\n  });\n\n  const paymentSubmitDetails = {\n    transactionType,\n    cardData,\n    paymentData\n  };\n\n  let result;\n\n  try {\n    const paymentSubmitResult = BraintreeApi.apiCall.paymentSubmit(paymentSubmitDetails);\n    Logger.debug(paymentSubmitResult);\n    result = paymentSubmitResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot Submit Payment: ${error.message}`\n    };\n    Logger.fatal(\"Braintree call failed, payment was not submitted\");\n  }\n\n  return result;\n}\n\n\n/**\n * paymentCapture\n * Capture payments from Braintree\n * https://developers.braintreepayments.com/reference/request/transaction/submit-for-settlement/node\n * @param {Object} paymentMethod - Object containing everything about the transaction to be settled\n * @return {Object} results - Object containing the results of the transaction\n */\nexport function paymentCapture(paymentMethod) {\n  // Call both check and validate because by calling `clean`, the audit pkg\n  // thinks that we haven't checked paymentMethod arg\n  check(paymentMethod, Object);\n  PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n  const paymentCaptureDetails = {\n    transactionId: paymentMethod.transactionId,\n    amount: paymentMethod.amount\n  };\n\n  let result;\n\n  try {\n    const paymentCaptureResult = BraintreeApi.apiCall.captureCharge(paymentCaptureDetails);\n    Logger.debug(paymentCaptureResult);\n    result = paymentCaptureResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot Capture Payment: ${error.message}`\n    };\n    Logger.fatal(\"Braintree call failed, payment was not captured\");\n  }\n\n  return result;\n}\n\n\n/**\n * createRefund\n * Refund BrainTree payment\n * https://developers.braintreepayments.com/reference/request/transaction/refund/node\n * @param {Object} paymentMethod - Object containing everything about the transaction to be settled\n * @param {Number} amount - Amount to be refunded if not the entire amount\n * @return {Object} results - Object containing the results of the transaction\n */\nexport function createRefund(paymentMethod, amount) {\n  check(amount, Number);\n\n  // Call both check and validate because by calling `clean`, the audit pkg\n  // thinks that we haven't checked paymentMethod arg\n  check(paymentMethod, Object);\n  PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n  const refundDetails = {\n    transactionId: paymentMethod.transactionId,\n    amount\n  };\n\n  let result;\n\n  try {\n    const refundResult = BraintreeApi.apiCall.createRefund(refundDetails);\n    Logger.debug(refundResult);\n    result = refundResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot issue refund: ${error.message}`\n    };\n    Logger.fatal(\"Braintree call failed, refund was not issued\");\n  }\n\n  return result;\n}\n\n\n/**\n * listRefunds\n * List all refunds for a transaction\n * https://developers.braintreepayments.com/reference/request/transaction/find/node\n * @param {Object} paymentMethod - Object containing everything about the transaction to be settled\n * @return {Array} results - An array of refund objects for display in admin\n */\nexport function listRefunds(paymentMethod) {\n  check(paymentMethod, Object);\n\n  const refundListDetails = {\n    transactionId: paymentMethod.transactionId\n  };\n\n  let result;\n\n  try {\n    const refundListResult = BraintreeApi.apiCall.listRefunds(refundListDetails);\n    Logger.debug(refundListResult);\n    result = refundListResult;\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error: `Cannot list refunds: ${error.message}`\n    };\n    Logger.fatal(\"Braintree call failed, refunds not listed\");\n  }\n\n  return result;\n}\n","import \"./i18n\";\nimport \"./methods/braintree\";\n","/* eslint camelcase: 0 */\nimport { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"BrainTree\",\n  icon: \"fa fa-credit-card\",\n  autoEnable: false,\n  name: \"reaction-braintree\", // usually same as meteor package\n  settings: // private package settings config (blackbox)\n  {\n    \"mode\": false,\n    \"merchant_id\": \"\",\n    \"public_key\": \"\",\n    \"private_key\": \"\",\n    \"reaction-braintree\": {\n      enabled: false,\n      support: [\n        \"Authorize\",\n        \"Capture\",\n        \"Refund\"\n      ]\n    }\n  },\n  registry: [\n    {\n      label: \"Braintree\",\n      provides: [\"paymentSettings\"],\n      container: \"dashboard\",\n      template: \"braintreeSettings\"\n    },\n    // configures template for checkout\n    // paymentMethod dynamic template\n    {\n      template: \"braintreePaymentForm\",\n      provides: [\"paymentMethod\"],\n      icon: \"fa fa-credit-card\"\n    }\n  ]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { HTTP } from \"meteor/http\";\nimport { check } from \"meteor/check\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\n\nexport const methods = {\n  // separate url into params\n  // save params into sellerShop collection\n  \"stripe/connect/authorizeMerchant\"(shopId, authCode) {\n    check(shopId, String);\n    check(authCode, String);\n\n    if (!Reaction.hasPermission([\"owner\", \"admin\", \"reaction-stripe\"], Meteor.userId(), shopId)) {\n      Logger.warn(`user: ${Meteor.userId()} attempted to authorize merchant account\n        for shopId ${shopId} but was denied access due to insufficient privileges.`);\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    let result;\n    const primaryShopId = Reaction.getPrimaryShopId();\n    const stripePkg = Reaction.getPackageSettingsWithOptions({\n      shopId: primaryShopId,\n      name: \"reaction-stripe\"\n    });\n\n    if (!stripePkg || !stripePkg.settings || !stripePkg.settings.api_key) {\n      throw new Meteor.Error(\"invalid-parameters\", \"Cannot authorize stripe connect merchant. Primary shop stripe must be configured.\");\n    }\n\n    const merchantStripePkg = Reaction.getPackageSettingsWithOptions({\n      shopId,\n      name: \"reaction-stripe\"\n    });\n\n    if (merchantStripePkg &&\n        merchantStripePkg.settings &&\n        merchantStripePkg.settings.connectAuth &&\n        typeof merchantStripePkg.settings.connectAuth.stripe_user_id === \"string\") {\n      return true;\n    }\n\n\n    const apiKey = stripePkg.settings.api_key;\n    const stripeAuthUrl = \"https://connect.stripe.com/oauth/token\";\n    try {\n      result = HTTP.call(\"POST\", stripeAuthUrl, {\n        params: {\n          client_secret: apiKey, // eslint-disable-line camelcase\n          code: authCode,\n          grant_type: \"authorization_code\" // eslint-disable-line camelcase\n        }\n      });\n\n      if (result.error) {\n        throw new Meteor.Error(\"There was a problem authorizing stripe connect\", result.error, result.error_description);\n      }\n\n      if (result && result.data) {\n        // Setup connectAuth settings for this merchant\n        Packages.update({ _id: merchantStripePkg._id }, {\n          $set: {\n            \"settings.connectAuth\": result.data\n          }\n        });\n      }\n    } catch (error) {\n      Logger.error(error);\n      result = { error };\n    }\n    return result;\n  }\n};\n\nMeteor.methods(methods);\n","import accounting from \"accounting-js\";\nimport stripeNpm from \"stripe\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport { Reaction, Logger, Hooks } from \"/server/api\";\nimport { Cart, Shops, Accounts, Packages } from \"/lib/collections\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\n\nfunction parseCardData(data) {\n  return {\n    number: data.number,\n    name: data.name,\n    cvc: data.cvv2,\n    exp_month: data.expire_month, // eslint-disable-line camelcase\n    exp_year: data.expire_year // eslint-disable-line camelcase\n  };\n}\n\n\n// Stripe uses a \"Decimal-less\" format so 10.00 becomes 1000\nfunction formatForStripe(amount) {\n  return Math.round(amount * 100);\n}\nfunction unformatFromStripe(amount) {\n  return (amount / 100);\n}\n\nexport const utils = {};\n\nutils.getStripeApi = function (paymentPackageId) {\n  const stripePackage = Packages.findOne(paymentPackageId);\n  const stripeKey = stripePackage.settings.api_key || stripePackage.settings.connectAuth.access_token;\n  return stripeKey;\n};\n\n/**\n * @summary Capture the results of a previous charge\n * @param {object} paymentMethod - Object containing info about the previous transaction\n * @returns {object} Object indicating the result, saved = true means success\n */\nfunction stripeCaptureCharge(paymentMethod) {\n  let result;\n  const captureDetails = {\n    amount: formatForStripe(paymentMethod.amount)\n  };\n\n\n  const stripeKey = utils.getStripeApi(paymentMethod.paymentPackageId);\n  const stripe = stripeNpm(stripeKey);\n\n  try {\n    const capturePromise = stripe.charges.capture(paymentMethod.transactionId, captureDetails);\n    const captureResult = Promise.await(capturePromise);\n\n    if (captureResult.status === \"succeeded\") {\n      result = {\n        saved: true,\n        response: captureResult\n      };\n    } else {\n      result = {\n        saved: false,\n        response: captureResult\n      };\n    }\n  } catch (error) {\n    Logger.error(error);\n    result = {\n      saved: false,\n      error\n    };\n    return { error, result };\n  }\n  return result;\n}\n\n/**\n * normalizes the status of a transaction\n * @method normalizeStatus\n * @param  {object} transaction - The transaction that we need to normalize\n * @return {string} normalized status string - either failed, settled, or created\n */\nfunction normalizeStatus(transaction) {\n  if (!transaction) {\n    throw new Meteor.Error(\"invalid-parameter\", \"normalizeStatus requires a transaction\");\n  }\n\n  // if this transaction failed, mode is \"failed\"\n  if (transaction.failure_code) {\n    return \"failed\";\n  }\n\n  // if this transaction was captured, status is \"settled\"\n  if (transaction.captured) { // Transaction was authorized but not captured\n    return \"settled\";\n  }\n\n  // Otherwise status is \"created\"\n  return \"created\";\n}\n\n/**\n * normalizes the mode of a transaction\n * @method normalizeMode\n * @param  {object} transaction The transaction that we need to normalize\n * @return {string} normalized status string - either failed, capture, or authorize\n */\nfunction normalizeMode(transaction) {\n  if (!transaction) {\n    throw new Meteor.Error(\"invalid-parameter\", \"normalizeMode requires a transaction\");\n  }\n\n  // if this transaction failed, mode is \"failed\"\n  if (transaction.failure_code) {\n    return \"failed\";\n  }\n\n  // If this transaction was captured, mode is \"capture\"\n  if (transaction.captured) {\n    return \"capture\";\n  }\n\n  // Anything else, mode is \"authorize\"\n  return \"authorize\";\n}\n\n/**\n * @method normalizeRiskLevel\n * @private\n * @summary Normalizes the risk level response of a transaction to the values defined in paymentMethod schema\n * @param  {object} transaction - The transaction that we need to normalize\n * @return {string} normalized status string - either elevated, high, or normal\n */\nfunction normalizeRiskLevel(transaction) {\n  if (!transaction) {\n    throw new Meteor.Error(\"invalid-parameter\", \"normalizeRiskLevel requires a transaction\");\n  }\n\n  const outcome = transaction.outcome && transaction.outcome.risk_level;\n\n  if (outcome === \"elevated\") {\n    return \"elevated\";\n  }\n\n  if (outcome === \"highest\") {\n    return \"high\";\n  }\n\n  // default to normal if no other flagged\n  return \"normal\";\n}\n\n\nfunction buildPaymentMethods(options) {\n  const { cardData, cartItemsByShop, transactionsByShopId } = options;\n  if (!transactionsByShopId) {\n    throw new Meteor.Error(\"invalid-parameter\", \"Creating a payment method log requries transaction data\");\n  }\n\n  const shopIds = Object.keys(transactionsByShopId);\n  const storedCard = `${cardData.type.charAt(0).toUpperCase() + cardData.type.slice(1)} ${cardData.number.slice(-4)}`;\n  const paymentMethods = [];\n\n\n  shopIds.forEach((shopId) => {\n    if (transactionsByShopId[shopId]) {\n      const cartItems = cartItemsByShop[shopId].map((item) => ({\n        _id: item._id,\n        productId: item.productId,\n        variantId: item.variants._id,\n        shopId,\n        quantity: item.quantity\n      }));\n\n      // we need to grab this per shop to get the API key\n      const packageData = Packages.findOne({\n        name: \"reaction-stripe\",\n        shopId\n      });\n\n      const paymentMethod = {\n        processor: \"Stripe\",\n        storedCard,\n        method: \"credit\",\n        paymentPackageId: packageData._id,\n        // TODO: REVIEW WITH AARON - why is paymentSettings key important\n        // and why is it just defined on the client?\n        paymentSettingsKey: packageData.name.split(\"/\").splice(-1)[0],\n        transactionId: transactionsByShopId[shopId].id,\n        amount: transactionsByShopId[shopId].amount * 0.01,\n        status: normalizeStatus(transactionsByShopId[shopId]),\n        mode: normalizeMode(transactionsByShopId[shopId]),\n        riskLevel: normalizeRiskLevel(transactionsByShopId[shopId]),\n        createdAt: new Date(transactionsByShopId[shopId].created),\n        transactions: [],\n        items: cartItems,\n        shopId\n      };\n      paymentMethod.transactions.push(transactionsByShopId[shopId]);\n      paymentMethods.push(paymentMethod);\n    }\n  });\n\n  return paymentMethods;\n}\n\nexport const methods = {\n  async \"stripe/payment/createCharges\"(transactionType, cardData, cartId) {\n    check(transactionType, String);\n    check(cardData, {\n      name: String,\n      number: String,\n      expire_month: String, // eslint-disable-line camelcase\n      expire_year: String, // eslint-disable-line camelcase\n      cvv2: String,\n      type: String\n    });\n    check(cartId, String);\n\n    const primaryShopId = Reaction.getPrimaryShopId();\n\n    const stripePkg = Reaction.getPackageSettingsWithOptions({\n      shopId: primaryShopId,\n      name: \"reaction-stripe\"\n    });\n\n    const card = parseCardData(cardData);\n\n    if (!stripePkg || !stripePkg.settings || !stripePkg.settings.api_key) {\n      // Fail if we can't find a Stripe API key\n      throw new Meteor.Error(\"not-configured\", \"Attempted to create multiple stripe charges, but stripe was not configured properly.\");\n    }\n\n    const capture = transactionType === \"capture\";\n\n    // Must have an email\n    const cart = Cart.findOne({ _id: cartId });\n    const customerAccount = Accounts.findOne({ _id: cart.userId });\n    let customerEmail;\n\n    if (!customerAccount || !Array.isArray(customerAccount.emails)) {\n      // TODO: Is it okay to create random email here if anonymous?\n      Logger.Error(\"cart email missing!\");\n      throw new Meteor.Error(\"invalid-parameter\", \"Email is required for marketplace checkouts.\");\n    }\n\n    const defaultEmail = customerAccount.emails.find((email) => email.provides === \"default\");\n    if (defaultEmail) {\n      customerEmail = defaultEmail.address;\n    } else if (!defaultEmail) {\n      customerEmail = cart.email;\n    } else {\n      throw new Meteor.Error(\"invalid-parameter\", \"Customer does not have default email\");\n    }\n\n    // Initialize stripe api lib\n    const stripeApiKey = stripePkg.settings.api_key;\n    const stripe = stripeNpm(stripeApiKey);\n\n    // get array of shopIds that exist in this cart\n    const shopIds = cart.items.reduce((uniqueShopIds, item) => {\n      if (uniqueShopIds.indexOf(item.shopId) === -1) {\n        uniqueShopIds.push(item.shopId);\n      }\n      return uniqueShopIds;\n    }, []);\n\n    const transactionsByShopId = {};\n\n    // TODO: If there is only one transactionsByShopId and the shopId is primaryShopId -\n    // Create a standard charge and bypass creating a customer for this charge\n    const primaryShop = Shops.findOne({ _id: primaryShopId });\n    const { currency } = primaryShop;\n\n    try {\n      // Creates a customer object, adds a source via the card data\n      // and waits for the promise to resolve\n      const customer = Promise.await(stripe.customers.create({\n        email: customerEmail\n      }).then((cust) => {\n        const customerCard = stripe.customers.createSource(cust.id, { source: { ...card, object: \"card\" } });\n        return customerCard;\n      }));\n\n      // Get cart totals for each Shop\n      const cartTotals = cart.getTotalByShop();\n      const cartSubtotals = cart.getSubtotalByShop();\n\n      // Loop through all shopIds represented in cart\n      shopIds.forEach((shopId) => {\n        // TODO: If shopId is primaryShopId - create a non-connect charge with the\n        // stripe customer object\n\n        const isPrimaryShop = shopId === primaryShopId;\n\n        let merchantStripePkg;\n        // Initialize options - this is where idempotency_key\n        // and, if using connect, stripe_account go\n        const stripeOptions = {};\n        const stripeCharge = {\n          amount: formatForStripe(cartTotals[shopId]),\n          capture,\n          currency\n          // TODO: add product metadata to stripe charge\n        };\n\n        if (isPrimaryShop) {\n          // If this is the primary shop, we can make a direct charge to the\n          // customer object we just created.\n          stripeCharge.customer = customer.customer;\n        } else {\n          // If this is a merchant shop, we need to tokenize the customer\n          // and charge the token with the merchant id\n          merchantStripePkg = Reaction.getPackageSettingsWithOptions({\n            shopId,\n            name: \"reaction-stripe\"\n          });\n\n          // If this merchant doesn't have stripe setup, fail.\n          // We should _never_ get to this point, because\n          // this will not roll back the entire transaction\n          if (!merchantStripePkg ||\n            !merchantStripePkg.settings ||\n            !merchantStripePkg.settings.connectAuth ||\n            !merchantStripePkg.settings.connectAuth.stripe_user_id) {\n            throw new Meteor.Error(\"server-error\", `Error processing payment for merchant with shopId ${shopId}`);\n          }\n\n          // get stripe account for this shop\n          const stripeUserId = merchantStripePkg.settings.connectAuth.stripe_user_id;\n          stripeOptions.stripe_account = stripeUserId; // eslint-disable-line camelcase\n\n          // Create token from our customer object to use with merchant shop\n          const token = Promise.await(stripe.tokens.create({\n            customer: customer.customer\n          }, stripeOptions));\n\n          // TODO: Add description to charge in Stripe\n          stripeCharge.source = token.id;\n\n          // Get the set application fee from the dashboard\n          const dashboardAppFee = stripePkg.settings.applicationFee || 0;\n          const percentAppFee = dashboardAppFee / 100; // Convert whole number app fee to percentage\n\n          // Initialize applicationFee - this can be adjusted by the onCalculateStripeApplicationFee event hook\n          const coreApplicationFee = formatForStripe(cartSubtotals[shopId] * percentAppFee);\n\n          /**\n           * Hook for affecting the application fee charged. Any hooks that `add` \"onCalculateStripeApplicationFee\" will\n           * run here\n           * @module hooks/payments/stripe\n           * @method onCalculateStripeApplicationFee\n           * @param {number} applicationFee the exact application fee in cents (must be returned by every hook)\n           * @param {object} options object containing properties passed into the hook\n           * @param {object} options.cart the cart object\n           * @param {object} options.shopId the shopId\n           * @todo Consider abstracting the application fee out of the Stripe implementation, into core payments\n           * @returns {number} the application fee after having been through all hooks (must be returned by ever hook)\n           */\n          const applicationFee = Hooks.Events.run(\"onCalculateStripeApplicationFee\", coreApplicationFee, {\n            cart, // The cart\n            shopId // currentShopId\n          });\n\n          // TODO: Consider discounts when determining application fee\n\n          // Charge the application fee created by hooks. If it doesn't exist, that means that a hook has fouled up\n          // the application fee. Review hooks and plugins.\n          // Fall back to the application fee that comes from the stripe dashboard when hook based app fee is undefined\n          // eslint-disable-next-line camelcase\n          stripeCharge.application_fee = applicationFee || coreApplicationFee;\n        }\n\n        // We should only do this once per shop per cart\n        stripeOptions.idempotency_key = `${shopId}${cart._id}${Random.id()}`; // eslint-disable-line camelcase\n\n        // Create a charge with the options set above\n        const charge = Promise.await(stripe.charges.create(stripeCharge, stripeOptions));\n\n        transactionsByShopId[shopId] = charge;\n      });\n\n\n      // get cartItemsByShop to build paymentMethods\n      const cartItemsByShop = cart.getItemsByShop();\n\n      // Build paymentMethods from transactions, card data and cart items\n      const paymentMethods = buildPaymentMethods({ cardData, cartItemsByShop, transactionsByShopId });\n\n      // If successful, call cart/submitPayment and return success back to client.\n      Meteor.call(\"cart/submitPayment\", paymentMethods);\n      return { success: true, transactions: transactionsByShopId };\n    } catch (error) {\n      // If unsuccessful\n      // return failure back to client if error is a standard stripe card error\n      if (error.rawType === \"card_error\") {\n        return {\n          success: false,\n          error: {\n            message: error.message,\n            code: error.code,\n            type: error.type,\n            rawType: error.rawType,\n            detail: error.detail\n          }\n        };\n      }\n      // If we get an unexpected error, log and return a censored error message\n      Logger.error(`Received unexpected error type: ${error.rawType}`);\n      Logger.error(error);\n      throw new Meteor.Error(\"server-error\", \"An unexpected error occurred while creating multiple stripe charges\");\n    }\n  },\n  /**\n   * Capture a Stripe charge\n   * @see https://stripe.com/docs/api#capture_charge\n   * @param  {Object} paymentMethod A PaymentMethod object\n   * @return {Object} results from Stripe normalized\n   */\n  \"stripe/payment/capture\"(paymentMethod) {\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    const captureDetails = {\n      amount: formatForStripe(paymentMethod.amount)\n    };\n\n    // 100% discounts are not valid when using Stripe\n    // If discount is 100%, capture 100% and then refund 100% of transaction\n    if (captureDetails.amount === accounting.unformat(0)) {\n      const voidedAmount = unformatFromStripe(paymentMethod.transactions[0].amount);\n      stripeCaptureCharge(paymentMethod);\n\n      return Meteor.call(\"stripe/refund/create\", paymentMethod, voidedAmount);\n    }\n    return stripeCaptureCharge(paymentMethod);\n  },\n\n  /**\n   * Issue a refund against a previously captured transaction\n   * @see https://stripe.com/docs/api#refunds\n   * @param  {Object} paymentMethod object\n   * @param  {Number} amount to be refunded\n   * @param  {String} reason refund was issued (currently unused by client)\n   * @return {Object} result\n   */\n  \"stripe/refund/create\"(paymentMethod, amount, reason = \"requested_by_customer\") {\n    check(amount, Number);\n    check(reason, String);\n\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    let result;\n    try {\n      const stripeKey = utils.getStripeApi(paymentMethod.paymentPackageId);\n      const stripe = stripeNpm(stripeKey);\n      const refundPromise = stripe.refunds.create({ charge: paymentMethod.transactionId, amount: formatForStripe(amount) });\n      const refundResult = Promise.await(refundPromise);\n      Logger.debug(refundResult);\n      if (refundResult && refundResult.object === \"refund\") {\n        result = {\n          saved: true,\n          response: refundResult\n        };\n      } else {\n        result = {\n          saved: false,\n          response: refundResult\n        };\n        Logger.warn(\"Stripe call succeeded but refund not issued\");\n      }\n    } catch (error) {\n      Logger.error(error);\n      result = {\n        saved: false,\n        error: `Cannot issue refund: ${error.message}`\n      };\n      Logger.fatal(\"Stripe call failed, refund was not issued\", error.message);\n    }\n    return result;\n  },\n\n  /**\n   * List refunds\n   * @param  {Object} paymentMethod object\n   * @return {Object} result\n   */\n  \"stripe/refund/list\"(paymentMethod) {\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    const stripeKey = utils.getStripeApi(paymentMethod.paymentPackageId);\n    const stripe = stripeNpm(stripeKey);\n    let refundListResults;\n    try {\n      const refundListPromise = stripe.refunds.list({ charge: paymentMethod.transactionId });\n      refundListResults = Promise.await(refundListPromise);\n    } catch (error) {\n      Logger.error(\"Encountered an error when trying to list refunds\", error.message);\n    }\n\n    const result = [];\n    if (refundListResults && refundListResults.data) {\n      for (const refund of refundListResults.data) {\n        result.push({\n          type: refund.object,\n          amount: refund.amount / 100,\n          created: refund.created * 1000,\n          currency: refund.currency,\n          raw: refund\n        });\n      }\n    }\n    return result;\n  }\n};\n\nMeteor.methods(methods);\n","import { Reaction, Hooks } from \"/server/api\";\n\nHooks.Events.add(\"afterCoreInit\", () => {\n  Reaction.addRolesToGroups({\n    allShops: true,\n    groups: [\"owner\", \"shop manager\", \"customer\", \"guest\"],\n    roles: [\"stripe/connect/authorize\"]\n  });\n});\n","import \"./i18n\";\nimport \"./methods/stripe\";\nimport \"./methods/stripe-connect\";\nimport \"./startup/startup\";\n\n","/* eslint camelcase: 0 */\nimport { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Stripe\",\n  name: \"reaction-stripe\",\n  icon: \"fa fa-cc-stripe\",\n  autoEnable: false,\n  settings: {\n    \"mode\": false,\n    \"api_key\": \"\",\n    \"reaction-stripe\": {\n      enabled: false,\n      support: [\n        \"Authorize\",\n        \"Capture\",\n        \"Refund\"\n      ]\n    },\n    \"public\": {\n      client_id: \"\"\n    },\n    \"connectAuth\": {}\n  },\n  registry: [\n    // Settings panel\n    {\n      label: \"Stripe\",\n      provides: [\"paymentSettings\"],\n      container: \"dashboard\",\n      template: \"stripeSettings\",\n      hideForShopTypes: [\"merchant\", \"affiliate\"]\n    },\n\n    // Payment form for checkout\n    {\n      template: \"stripePaymentForm\",\n      provides: [\"paymentMethod\", \"marketplacePaymentMethod\"],\n      icon: \"fa fa-cc-stripe\"\n    },\n\n    // Redirect for Stripe Connect Sign-In\n    {\n      route: \"/stripe/connect/authorize\",\n      template: \"stripeConnectAuthorize\"\n    },\n\n    // Payment Signup for Merchants\n    {\n      label: \"Stripe Merchant Account\",\n      icon: \"fa fa-cc-stripe\",\n      container: \"dashboard\",\n      provides: [\"marketplaceMerchantSettings\"],\n      template: \"stripeConnectMerchantSignup\",\n      hideForShopTypes: [\"primary\"]\n    }\n  ]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Product Admin\",\n  name: \"reaction-product-admin\",\n  autoEnable: true\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./populateTaxCodes.js\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { TaxCodes } from \"/imports/plugins/core/taxes/lib/collections\";\n\nconst taxCodes = {};\n\n/*\n * taxes/insertTaxCodes\n * @summary populate TaxCodes collection\n * @param {String} shopID - current shop's id\n * @param {Object} code - tax code object to insert into TaxCodes collection\n * @param {String} providerName - tax code provider\n * @return {} undefined\n */\ntaxCodes.populateTaxCodes = function (shopId, code, providerName) {\n  check(shopId, String);\n  check(code, Object);\n  check(providerName, String);\n\n  try {\n    TaxCodes.insert({\n      id: code.id,\n      shopId,\n      taxCode: code.taxCode || code.id,\n      taxCodeProvider: providerName,\n      ssuta: code.isSSTCertified,\n      title: code.title || \"\",\n      label: code.description || code.label,\n      parent: code.parentTaxCode || code.parent,\n      children: code.children || []\n    });\n  } catch (err) {\n    throw new Meteor.Error(\"Error populating TaxCodes collection\", err);\n  }\n};\n\nMeteor.methods({\n  \"taxes/insertTaxCodes\": taxCodes.populateTaxCodes\n});\n","import \"./i18n\";\nimport \"./methods\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Products\",\n  name: \"reaction-product-variant\",\n  icon: \"fa fa-cubes\",\n  autoEnable: true,\n  registry: [{\n    route: \"/tag/:slug?\",\n    name: \"tag\",\n    template: \"products\",\n    workflow: \"coreProductGridWorkflow\"\n  }, {\n    route: \"/products/createProduct\",\n    name: \"createProduct\",\n    label: \"Add Product\",\n    icon: \"fa fa-plus\",\n    template: \"productDetail\",\n    provides: [\"shortcut\"],\n    container: \"addItem\",\n    priority: 1,\n    permissions: [{\n      label: \"Create Product\",\n      permission: \"createProduct\"\n    }]\n  }],\n  layout: [{\n    layout: \"coreLayout\",\n    workflow: \"coreProductWorkflow\",\n    collection: \"Products\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"productDetail\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"\",\n      notFound: \"productNotFound\",\n      dashboardHeader: \"productDetailSimpleToolbar\",\n      dashboardControls: \"productDetailDashboardControls\",\n      dashboardHeaderControls: \"\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }, {\n    layout: \"coreLayout\",\n    workflow: \"coreProductGridWorkflow\",\n    collection: \"Products\",\n    theme: \"default\",\n    enabled: true,\n    structure: {\n      template: \"products\",\n      layoutHeader: \"NavBar\",\n      layoutFooter: \"\",\n      notFound: \"productNotFound\",\n      dashboardHeader: \"gridPublishControls\",\n      dashboardControls: \"productDetailDashboardControls\",\n      dashboardHeaderControls: \"\",\n      adminControlsFooter: \"adminControlsFooter\"\n    }\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./sms\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Sms } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { formatPhoneNumber } from \"/lib/api\";\n\n// We lazy load these in order to shave a few seconds off the time\n// it takes Meteor to start/restart the app.\nlet Twilio;\nasync function lazyLoadTwilio() {\n  if (Twilio) return;\n  const mod = await import(\"twilio\");\n  Twilio = mod.default;\n}\n\nlet Nexmo;\nasync function lazyLoadNexmo() {\n  if (Nexmo) return;\n  const mod = await import(\"nexmo\");\n  Nexmo = mod.default;\n}\n\n/**\n * @file Meteor methods for SMS. Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/SMS\n*/\nMeteor.methods({\n  /**\n   * @name sms/saveSettings\n   * @method\n   * @memberof Methods/SMS\n   * @summary This save the sms provider settings\n   * @param {Object} settings - settings\n   * @return {object} returns result\n   */\n  \"sms/saveSettings\": (settings) => {\n    check(settings, Object);\n    settings.shopId = Reaction.getShopId();\n\n    const smsDetails = Sms.find().count();\n    if (smsDetails >= 1) {\n      return Sms.update({ shopId: Reaction.getShopId() }, {\n        $set: settings\n      });\n    }\n    return Sms.insert(settings);\n  },\n\n  /**\n   * @name sms/send\n   * @method\n   * @memberof Methods/SMS\n   * @summary This send the sms to the user\n   * @param {String} message - The message to send\n   * @param {String} userId - The user to receive the message\n   * @param {String} shopId - The currenct shopId\n   * @return {object} returns result\n   */\n  \"sms/send\": (message, userId, shopId) => {\n    check(message, String);\n    check(userId, String);\n    check(shopId, String);\n\n    const user = Meteor.users.findOne(userId);\n    if (!user) return;\n\n    const addressBook = user.profile && user.profile.addressBook;\n\n    // check for addressBook phone\n    const phone = addressBook && addressBook.phone;\n    const country = addressBook && addressBook.country;\n\n    if (!phone || !country) {\n      return;\n    }\n\n    const smsSettings = Sms.findOne({ shopId });\n    if (!smsSettings) {\n      return;\n    }\n\n    const formattedPhone = formatPhoneNumber(phone, country);\n\n    const { apiKey, apiToken, smsPhone, smsProvider } = smsSettings;\n    if (smsProvider === \"twilio\") {\n      Logger.debug(\"choose twilio\");\n      Promise.await(lazyLoadTwilio());\n      const client = new Twilio(apiKey, apiToken);\n      client.messages.create({\n        to: formattedPhone,\n        from: smsPhone,\n        body: message\n      }, (err) => {\n        if (err) {\n          return Logger.error(err);\n        }\n      });\n      return;\n    }\n\n    if (smsProvider === \"nexmo\") {\n      Logger.debug(\"choose nexmo\");\n      Promise.await(lazyLoadNexmo());\n      const client = new Nexmo({ apiKey, apiSecret: apiToken });\n      client.message.sendSms(smsPhone, formattedPhone, message, (err, result) => {\n        if (err) {\n          Logger.error(\"Nexmo error\", err);\n        }\n\n        if (result && Array.isArray(result.messages) && result.messages[0][\"error-text\"]) {\n          Logger.error(\"Nexmo error sending sms\", result.messages[0][\"error-text\"]);\n        }\n\n        Logger.debug(JSON.stringify(result));\n      });\n    }\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Sms } from \"/lib/collections\";\n\n/**\n * Sms publication\n * @return {Object} return sms cursor\n */\nMeteor.publish(\"SmsSettings\", function () {\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    Logger.warn(\"Ignoring null request on Sms Subscription\");\n    return this.ready();\n  }\n\n  const result = Sms.find({ shopId });\n\n  return result;\n});\n","import \"./publications/smsPublication\";\nimport \"./methods\";\nimport \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"SMS\",\n  name: \"reaction-sms\",\n  icon: \"fa fa-mobile\",\n  autoEnable: false,\n  settings: {\n    name: \"SMS\"\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    label: \"SMS\",\n    description: \"Notifications\",\n    icon: \"fa fa-mobile fa-2x\",\n    priority: 3,\n    container: \"core\",\n    workflow: \"coreDashboardWorkflow\"\n  }, {\n    label: \"SMS Settings\",\n    icon: \"fa fa-mobile\",\n    route: \"/dashboard/sms\",\n    provides: [\"settings\"],\n    container: \"dashboard\",\n    template: \"smsSettings\",\n    showForShopTypes: [\"primary\"]\n  }]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./policy\";\nimport \"./i18n\";\nimport \"./methods\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\nexport function updateSocialSetting(provider, field, value) {\n  check(provider, String);\n  check(field, String);\n  check(value, Match.OneOf(String, Boolean));\n\n  if (!Reaction.hasPermission([\"reaction-social\"])) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  return Packages.update({\n    name: \"reaction-social\",\n    shopId: Reaction.getShopId()\n  }, {\n    $set: {\n      [`settings.public.apps.${provider}.${field}`]: value\n    }\n  });\n}\n\nexport function updateSocialSettings(values) {\n  check(values, Match.OneOf(Object, String, Boolean, Number, null, undefined));\n\n  if (!Reaction.hasPermission([\"reaction-social\"])) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  return Packages.update({\n    name: \"reaction-social\",\n    shopId: Reaction.getShopId()\n  }, {\n    $set: {\n      settings: values\n    }\n  });\n}\n\nMeteor.methods({\n  \"reaction-social/updateSocialSetting\": updateSocialSetting,\n  \"reaction-social/updateSocialSettings\": updateSocialSettings\n});\n","import { BrowserPolicy } from \"meteor/browser-policy-common\";\n/*\n * set browser policies\n */\nBrowserPolicy.content.allowOriginForAll(\"*.facebook.com\");\n\nBrowserPolicy.content.allowOriginForAll(\"connect.facebook.net\");\n","import _ from \"lodash\";\nimport { Reaction } from \"/server/api\";\n\nconst DefaultSocialApp = {\n  profilePage: \"\",\n  enabled: false\n};\n\nReaction.registerPackage({\n  label: \"Social\",\n  name: \"reaction-social\",\n  icon: \"fa fa-share-alt\",\n  autoEnable: false,\n  settings: {\n    public: {\n      autoInit: true,\n      apps: {\n        facebook: _.extend({\n          appId: \"\",\n          version: \"v2.1\"\n        }, DefaultSocialApp),\n        twitter: _.extend({\n          username: \"\"\n        }, DefaultSocialApp),\n        googleplus: _.extend({}, DefaultSocialApp),\n        pinterest: _.extend({}, DefaultSocialApp)\n      },\n      appsOrder: [\"facebook\", \"twitter\", \"pinterest\", \"googleplus\"],\n      iconOnly: true,\n      faSize: \"fa-2x\",\n      faClass: \"square\",\n      targetWindow: \"_self\"\n    }\n  },\n  registry: [{\n    provides: [\"dashboard\"],\n    label: \"Social\",\n    description: \"Social Channel configuration\",\n    icon: \"fa fa-share-alt\",\n    priority: 2,\n    container: \"connect\",\n    permissions: [{\n      label: \"Social\",\n      permission: \"dashboard/social\"\n    }]\n  }, {\n    label: \"Social Settings\",\n    icon: \"fa fa-share-alt\",\n    route: \"/dashboard/social\",\n    provides: [\"settings\"],\n    container: \"dashboard\",\n    template: \"socialSettings\"\n  }, {\n    template: \"reactionSocial\",\n    provides: [\"social\"]\n  }]\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Logger, MethodHooks } from \"/server/api\";\nimport { Cart, Orders } from \"/lib/collections\";\nimport taxCalc from \"../methods/taxCalc\";\n\nfunction linesToTaxes(lines) {\n  const taxes = lines.map((line) => ({\n    lineNumber: line.lineNumber,\n    discountAmount: line.discountAmount,\n    taxable: line.isItemTaxable,\n    tax: line.tax,\n    taxableAmount: line.taxableAmount,\n    taxCode: line.taxCode,\n    details: line.details\n  }));\n  return taxes;\n}\n/**\n * @method markCartTax\n * @summary Calls the method accounts/markTaxCalculationFailed\n * through meteor.\n * @param {Boolean} value - the value to be set\n */\nfunction markCartTax(value = true) {\n  Meteor.call(\"accounts/markTaxCalculationFailed\", value, (error) => {\n    if (error) {\n      return Logger.error(error, \"Unable to mark the cart\");\n    }\n  });\n}\n\n\nMethodHooks.after(\"taxes/calculate\", (options) => {\n  const cartId = options.arguments[0];\n  const cartToCalc = Cart.findOne(cartId);\n  if (cartToCalc.bypassAddressValidation) {\n    // User bypassed address validation so we can't calc taxes so don't even try\n    return options.result;\n  }\n  const pkg = taxCalc.getPackageData();\n\n  Logger.debug(\"Avalara triggered on taxes/calculate for cartId:\", cartId);\n\n  if (pkg && pkg.settings.avalara.enabled && pkg.settings.avalara.performTaxCalculation) {\n    taxCalc.estimateCart(cartToCalc, (result) => {\n      // we don't use totalTax, that just tells us we have a valid tax calculation\n      if (result && !result.error && typeof result.totalTax === \"number\" && result.lines) {\n        const taxes = linesToTaxes(result.lines);\n        const taxAmount = taxes.reduce((totalTaxes, tax) => totalTaxes + tax.tax, 0);\n        const taxRate = taxAmount / taxCalc.calcTaxable(cartToCalc);\n        Meteor.call(\"taxes/setRate\", cartId, taxRate, taxes);\n        markCartTax(false);\n        // for bad auth, timeout, or misconfiguration there's nothing we can do so keep moving\n      } else if ([503, 400, 401].includes(result.error.errorCode)) {\n        Logger.error(\"Timeout, Authentification, or Misconfiguration error: Not trying to estimate cart\");\n        markCartTax(true);\n      } else if (result.error.errorCode === 300) {\n        Logger.error(\"Cannot validate address so we cannot calculate tax, skipping\");\n        markCartTax(true);\n      } else {\n        Logger.error(\"Unknown error\", result.error.errorCode);\n        markCartTax(true);\n      }\n    });\n  }\n  return options;\n});\n\nMethodHooks.after(\"cart/copyCartToOrder\", (options) => {\n  const pkg = taxCalc.getPackageData();\n  if (pkg && pkg.settings.avalara.enabled && pkg.settings.avalara.performTaxCalculation) {\n    const cartId = options.arguments[0];\n    const order = Orders.findOne({ cartId });\n    taxCalc.recordOrder(order, (result) => {\n      if (result) {\n        Logger.info(`Order ${order._id} recorded with Avalara`);\n      }\n    });\n  }\n  return options.result;\n});\n\nMethodHooks.after(\"orders/refunds/create\", (options) => {\n  const pkg = taxCalc.getPackageData();\n  if (pkg && pkg.settings.avalara.enabled && pkg.settings.avalara.performTaxCalculation) {\n    const orderId = options.arguments[0];\n    const order = Orders.findOne(orderId);\n    const refundAmount = options.arguments[2];\n    taxCalc.reportRefund(order, refundAmount, (result) => {\n      if (result) {\n        Logger.info(`Refund for order ${order._id} recorded with Avalara`);\n      }\n    });\n  }\n  return options;\n});\n","import \"./hooks\";\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import { Meteor } from \"meteor/meteor\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Jobs, Logs } from \"/lib/collections\";\nimport { Hooks, Logger } from \"/server/api\";\nimport taxCalc from \"../methods/taxCalc\";\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\n/**\n * @summary Remove logs older than the configured number of days\n * @param {Function} callback - function to call when process complete\n * @returns {Number} results of remmoval query\n */\nfunction cleanupAvalaraJobs(callback) {\n  Promise.await(lazyLoadMoment());\n  const pkgData = taxCalc.getPackageData();\n  if (pkgData && pkgData.settings.avalara.enabled) {\n    const saveDuration = pkgData.settings.avalara.logRetentionDuration;\n    const olderThan = moment().subtract(saveDuration, \"days\");\n    const result = Logs.remove({\n      date: {\n        $lt: olderThan\n      }\n    });\n    Logger.debug(`Removed ${result} Avalara log records`);\n  }\n  callback();\n}\n\nexport function setupAvalaraCleanupHook() {\n  Hooks.Events.add(\"afterCoreInit\", () => {\n    if (!Meteor.isAppTest) {\n      Logger.debug(\"Adding Avalara log cleanup job and removing existing\");\n      new Job(Jobs, \"logs/removeOldAvalaraLogs\", {})\n        .priority(\"normal\")\n        .retry({\n          retries: 5,\n          wait: 60000,\n          backoff: \"exponential\"\n        })\n        .save({\n          cancelRepeats: true\n        });\n    }\n  });\n}\n\nexport function cleanupAvalogs() {\n  Jobs.processJobs(\n    \"logs/removeOldAvalaraLogs\",\n    {\n      pollInterval: 30 * 1000,\n      workTimeout: 180 * 1000\n    },\n    (job, callback) => {\n      Logger.debug(\"Avalara log cleanup running\");\n      cleanupAvalaraJobs((error) => {\n        if (error) {\n          job.done(error.toString(), { repeatId: true });\n          callback();\n        } else {\n          const success = \"Avalara Log Cleanup ran successfully\";\n          Logger.debug(success);\n          job.done(success, { repeatId: true });\n          callback();\n        }\n      });\n    }\n  );\n}\n","import { bunyan } from \"@reactioncommerce/logger\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Logs } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\nconst level = \"INFO\";\n\nclass BunyanMongo {\n  levelToName = {\n    10: \"trace\",\n    20: \"debug\",\n    30: \"info\",\n    40: \"warn\",\n    50: \"error\",\n    60: \"fatal\"\n  };\n\n  write = Meteor.bindEnvironment((logData) => {\n    const avalog = {\n      logType: \"avalara\",\n      shopId: Reaction.getShopId(),\n      data: logData,\n      level: this.levelToName[logData.level]\n    };\n    Logs.insert(avalog);\n  });\n}\n\nconst streams = [\n  {\n    type: \"raw\",\n    stream: new BunyanMongo()\n  }\n];\n\n\nconst Avalogger = bunyan.createLogger({\n  level,\n  name: \"Avalara\",\n  streams\n});\n\nexport default Avalogger;\n","import os from \"os\";\nimport _ from \"lodash\";\nimport accounting from \"accounting-js\";\nimport SimpleSchema from \"simpl-schema\";\nimport { Meteor } from \"meteor/meteor\";\nimport { HTTP } from \"meteor/http\";\nimport { check } from \"meteor/check\";\nimport { Shops, Accounts } from \"/lib/collections\";\nimport { TaxCodes } from \"/imports/plugins/core/taxes/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\nimport Avalogger from \"./avalogger\";\n\nconst errorDetails = new SimpleSchema({\n  message: {\n    type: String\n  },\n  description: {\n    type: String,\n    optional: true\n  }\n});\n\n  // Validate that whenever we return an error we return the same format\nconst ErrorObject = new SimpleSchema({\n  \"type\": {\n    type: String\n  },\n  \"errorCode\": {\n    type: Number\n  },\n  \"errorDetails\": {\n    type: Array,\n    optional: true\n  },\n  \"errorDetails.$\": {\n    type: errorDetails,\n    optional: true\n  }\n});\n\nlet moment;\nasync function lazyLoadMoment() {\n  if (moment) return;\n  moment = await import(\"moment\");\n}\n\nconst countriesWithRegions = [\"US\", \"CA\", \"DE\", \"AU\"];\nconst requiredFields = [\"username\", \"password\", \"apiLoginId\", \"companyCode\", \"shippingTaxCode\"];\nconst taxCalc = {};\n\ntaxCalc.getPackageData = function () {\n  const pkgData = Reaction.getPackageSettings(\"taxes-avalara\");\n  return pkgData;\n};\n\n// Private methods\n\n/**\n * @summary Get the root URL for REST calls\n * @returns {String} Base url\n */\nfunction getUrl() {\n  const packageData = taxCalc.getPackageData();\n  const { mode } = packageData.settings.avalara;\n  let baseUrl;\n  if (mode) {\n    baseUrl = \"https://rest.avatax.com/api/v2/\";\n  } else {\n    baseUrl = \"https://sandbox-rest.avatax.com/api/v2/\";\n  }\n  return baseUrl;\n}\n\n/**\n * @summary Verify that we have all required configuration data before attempting to use the API\n * @param {Object} packageData - Package data retrieved from the database\n * @returns {boolean} - isValid Is the current configuration valid\n */\nfunction checkConfiguration(packageData = taxCalc.getPackageData()) {\n  let isValid = true;\n  const settings = _.get(packageData, \"settings.avalara\", {});\n  for (const field of requiredFields) {\n    if (!settings[field]) {\n      const msg = `The Avalara package cannot function unless ${field} is configured`;\n      Logger.warn(msg);\n      Avalogger.error({ error: msg });\n      isValid = false;\n    }\n  }\n  if (!isValid) {\n    Logger.error(\"The Avalara package is not configured correctly. Cannot continue\");\n  }\n  return isValid;\n}\n\n/**\n * @summary Get the auth info to authenticate to REST API\n * @param {Object} packageData - Optionally pass in packageData if we already have it\n * @returns {String} Username/Password string\n */\nfunction getAuthData(packageData = taxCalc.getPackageData()) {\n  if (checkConfiguration(packageData)) {\n    const settings = _.get(packageData, \"settings.avalara\", {});\n    const { username, password } = settings;\n    const auth = `${username}:${password}`;\n    return auth;\n  }\n}\n\n/**\n * @summary Get exempt tax settings to pass to REST API\n * @param {String} userId id of user to find settings\n * @returns {Object} containing exemptCode and customerUsageType\n */\nfunction getTaxSettings(userId) {\n  return _.get(Accounts.findOne({ _id: userId }), \"taxSettings\");\n}\n\n/**\n * @summary: Break Avalara error object into consistent format\n * @param {Object} error The error result from Avalara\n * @returns {Object} Error object with code and errorDetails\n */\nfunction parseError(error) {\n  let errorData;\n  // The Avalara API constantly times out, so handle this special case first\n  if (error && (error.code === \"ETIMEDOUT\" || error.code === \"ESOCKETTIMEDOUT\")) {\n    errorData = {\n      errorCode: 503,\n      type: \"apiFailure\",\n      errorDetails: [{ message: error.message, description: error.description }]\n    };\n  } else if (error && error.response && error.response.statusCode === 401) {\n    // authentification error\n    errorData = {\n      errorCode: 401,\n      type: \"apiFailure\",\n      errorDetails: {\n        message: error.message,\n        description: error.description\n      }\n    };\n  } else if (error && error.response && error.response.statusCode === 400) {\n    // address validation error\n    if (error.response.data.error.code === \"GetTaxError\") {\n      errorData = {\n        errorCode: 300,\n        type: \"addressError\"\n      };\n      errorData.errorDetails = error.response.data.error.details.map((errorDetail) => { // eslint-disable-line\n        return ({ message: errorDetail.message, description: errorDetail.description });\n      });\n    }\n  } else {\n    Logger.error(error, \"Unknown Error\");\n    Avalogger.error(error, \"Unknown error or error format\");\n  }\n  const errorObjectContext = ErrorObject.newContext();\n  // No Generic errors ever\n  errorObjectContext.validate(errorData);\n  if (!errorObjectContext.isValid()) {\n    throw new Meteor.Error(\"invalid-return\", \"Returning invalid Error results\");\n  }\n  return errorData;\n}\n\n\n/**\n * @summary function to get HTTP data and pass in extra Avalara-specific headers\n * @param {String} requestUrl - The URL to make the request to\n * @param {Object} options - An object of other options\n * @param {Boolean} testCredentials - determines skipping of configuration check\n * @returns {Object} Response from call\n */\nfunction avaGet(requestUrl, options = {}, testCredentials = true) {\n  const logObject = {};\n  const pkgData = taxCalc.getPackageData();\n\n  if (testCredentials) {\n    if (!checkConfiguration(pkgData)) {\n      return undefined;\n    }\n  }\n\n  const appVersion = Reaction.getAppVersion();\n  const meteorVersion = _.split(Meteor.release, \"@\")[1];\n  const machineName = os.hostname();\n  const avaClient = `Reaction; ${appVersion}; Meteor HTTP; ${meteorVersion}; ${machineName}`;\n  const headers = {\n    headers: {\n      \"X-Avalara-Client\": avaClient,\n      \"X-Avalara-UID\": \"a0o33000004K8g3\"\n    }\n  };\n  const auth = options.auth || getAuthData();\n  const timeout = { timeout: options.timeout || pkgData.settings.avalara.requestTimeout };\n  const allOptions = Object.assign({}, options, headers, { auth }, timeout);\n  if (pkgData.settings.avalara.enableLogging) {\n    logObject.request = allOptions;\n  }\n\n  let result;\n  try {\n    result = HTTP.get(requestUrl, allOptions);\n  } catch (error) {\n    Logger.error(`Encountered error while calling Avalara API endpoint ${requestUrl}`);\n    Logger.error(error);\n    logObject.error = error;\n    Avalogger.error(logObject);\n    const parsedError = parseError(error);\n    result = { error: parsedError };\n  }\n\n  if (pkgData.settings.avalara.enableLogging) {\n    logObject.duration = _.get(result, \"headers.serverDuration\");\n    logObject.result = result.data;\n    Avalogger.info(logObject);\n  }\n\n  return result;\n}\n\n\n/**\n * @summary to POST HTTP data and pass in extra Avalara-specific headers\n * @param {String} requestUrl - The URL to make the request to\n * @param {Object} options - An object of others options, usually data\n * @returns {Object} Response from call\n */\nfunction avaPost(requestUrl, options) {\n  const logObject = {};\n  const pkgData = taxCalc.getPackageData();\n  // If package is not configured don't bother making an API call\n  if (!checkConfiguration(pkgData)) {\n    return {\n      error: {\n        errorCode: 400,\n        type: \"apiFailure\",\n        errorDetails: {\n          message: \"API is not configured\"\n        }\n      }\n    };\n  }\n  const appVersion = Reaction.getAppVersion();\n  const meteorVersion = Meteor.release.split(\"@\")[1];\n  const machineName = os.hostname();\n  const avaClient = `Reaction; ${appVersion}; Meteor HTTP; ${meteorVersion}; ${machineName}`;\n  const headers = {\n    headers: {\n      \"X-Avalara-Client\": avaClient,\n      \"X-Avalara-UID\": \"a0o33000004K8g3\"\n    }\n  };\n  const auth = { auth: getAuthData() };\n  const timeout = { timeout: pkgData.settings.avalara.requestTimeout };\n  const allOptions = Object.assign({}, options, headers, auth, timeout);\n  if (pkgData.settings.avalara.enableLogging) {\n    logObject.request = allOptions;\n  }\n\n  let result;\n  try {\n    result = HTTP.post(requestUrl, allOptions);\n  } catch (error) {\n    Logger.error(`Encountered error while calling API at ${requestUrl}`);\n    Logger.error(error);\n    logObject.error = error;\n    // whether logging is enabled or not we log out errors\n    Avalogger.error(logObject);\n    const parsedError = parseError(error);\n    result = { error: parsedError };\n  }\n\n  if (pkgData.settings.avalara.enableLogging) {\n    logObject.duration = _.get(result, \"headers.serverDuration\");\n    logObject.result = result.data;\n    Avalogger.info(logObject);\n  }\n\n  return result;\n}\n\n/**\n * @summary Gets the full list of Avalara-supported entity use codes.\n * @returns {Object[]} API response\n */\ntaxCalc.getEntityCodes = function () {\n  if (checkConfiguration()) {\n    const baseUrl = getUrl();\n    const requestUrl = `${baseUrl}definitions/entityusecodes`;\n    const result = avaGet(requestUrl);\n\n    if (result && result.code === \"ETIMEDOUT\") {\n      throw new Meteor.Error(\"request-timeout\", \"Request timed out while populating entity codes.\");\n    }\n\n    return _.get(result, \"data.value\", []);\n  }\n  throw new Meteor.Error(\"bad-configuration\", \"Avalara package is enabled, but is not properly configured\");\n};\n\n// API Methods\n\n/**\n * @summary Calculate the taxable subtotal for a cart\n * @param {Cart} cart - Cart to calculate subtotal for\n * @returns {Number} Taxable subtotal\n */\ntaxCalc.calcTaxable = function (cart) {\n  let subTotal = 0;\n  for (const item of cart.items) {\n    if (item.variants.taxable) {\n      subTotal += (item.variants.price * item.quantity);\n    }\n  }\n  return subTotal;\n};\n\n/**\n * @summary Validate a particular address\n * @param {Object} address Address to validate\n * @returns {Object} The validated result\n */\ntaxCalc.validateAddress = function (address) {\n  check(address, Object);\n\n  const packageData = taxCalc.getPackageData();\n  const { countryList } = packageData.settings.addressValidation;\n\n  if (!_.includes(countryList, address.country)) {\n    // if this is a country selected for validation, proceed\n    // else use current address as response\n    return { validatedAddress: address, errors: [] };\n  }\n\n  let messages;\n  let validatedAddress = \"\"; // set default as falsy value\n  const errors = [];\n  const addressToValidate = {\n    line1: address.address1,\n    city: address.city,\n    postalCode: address.postal,\n    country: address.country\n  };\n\n  if (_.includes(countriesWithRegions, address.country)) {\n    // if this is a country with regions, pass in region\n    addressToValidate.region = address.region;\n  }\n  if (address.address2) {\n    addressToValidate.line2 = address.address2;\n  }\n  const baseUrl = getUrl();\n  const requestUrl = `${baseUrl}addresses/resolve`;\n  const result = avaPost(requestUrl, { data: addressToValidate });\n  // Handle errors where we don't get back an address\n  if (result.error && result.error.type) {\n    if (result.error.type === \"apiError\") {\n      // If we have a problem with the API there's no reason to tell the customer\n      // so let's consider this unvalidated but move along\n      Logger.error(\"API error, ignoring address validation\");\n    }\n\n    if (result.error.type === \"addressError\") {\n      // We received a validation error so we need somehow pass this up to the client\n      Logger.info(\"Address Validation Error\");\n      // package up errors\n      return { validatedAddress: {}, errors: [result.error] };\n    }\n  }\n  const content = result.data;\n  if (content && content.messages) {\n    ({ messages } = content);\n  }\n  if (messages) {\n    for (const message of messages) {\n      errors.push({ summary: message.summary, details: message.details });\n    }\n  }\n\n  if (result && result.data && result.data.validatedAddresses.length !== 0) {\n    const resultAddress = result.data.validatedAddresses[0];\n    validatedAddress = {\n      address1: resultAddress.line1,\n      city: resultAddress.city,\n      region: resultAddress.region,\n      postal: resultAddress.postalCode,\n      country: resultAddress.country\n    };\n    if (resultAddress.line2) {\n      validatedAddress.address2 = resultAddress.line2;\n    }\n  }\n  return { validatedAddress, errors };\n};\n\n/**\n * @summary Tests supplied Avalara credentials by calling company endpoint\n * @param {Object} credentials callback Callback function for asynchronous execution\n * @param {Boolean} testCredentials To be set as false so avaGet skips config check\n * @returns {Object} Object containing \"statusCode\" on success, empty response on error\n */\ntaxCalc.testCredentials = function (credentials, testCredentials = false) {\n  check(credentials, Object);\n\n  const baseUrl = getUrl();\n  const auth = `${credentials.username}:${credentials.password}`;\n  const requestUrl = `${baseUrl}companies/${credentials.companyCode}/transactions`;\n  const result = avaGet(requestUrl, { auth, timeout: credentials.requestTimeout }, testCredentials);\n\n  if (result && result.code === \"ETIMEDOUT\") {\n    throw new Meteor.Error(\"request-timeout\", \"Request Timed out. Increase your timeout settings\");\n  }\n\n  if (result.statusCode === 200) {\n    if (TaxCodes.find({}).count() === 0) {\n      Meteor.call(\"avalara/getTaxCodes\", (error, res) => {\n        if (error) {\n          if (typeof error === \"object\") {\n            Meteor.call(\"logging/logError\", \"avalara\", error);\n          } else {\n            Meteor.call(\"logging/logError\", \"avalara\", { error });\n          }\n        } else if (res && Array.isArray(res)) {\n          res.forEach((code) => {\n            Meteor.call(\"taxes/insertTaxCodes\", Reaction.getShopId(), code, \"taxes-avalara\", (err) => {\n              if (err) {\n                throw new Meteor.Error(\"error-occurred\", \"Error populating TaxCodes collection\", err);\n              }\n            });\n          });\n        }\n      });\n    }\n  }\n\n  return { statusCode: result.statusCode };\n};\n\n/**\n * @summary get Avalara Tax Codes\n * @returns {Array} An array of Tax code objects\n */\ntaxCalc.getTaxCodes = function () {\n  if (checkConfiguration()) {\n    const baseUrl = getUrl();\n    const requestUrl = `${baseUrl}definitions/taxcodes`;\n    const result = avaGet(requestUrl);\n    return _.get(result, \"data.value\", []);\n  }\n  throw new Meteor.Error(\"bad-configuration\", \"Avalara Tax package is enabled but not properly configured\");\n};\n\n/**\n * @summary Translate RC cart into format for submission\n * @param {Object} cart RC cart to send for tax estimate\n * @returns {Object} SalesOrder in Avalara format\n */\nfunction cartToSalesOrder(cart) {\n  const pkgData = taxCalc.getPackageData();\n  const { companyCode, shippingTaxCode } = pkgData.settings.avalara;\n  const company = Shops.findOne(Reaction.getShopId());\n  const companyShipping = _.filter(company.addressBook, (o) => o.isShippingDefault)[0];\n  const currencyCode = company.currency;\n  const cartShipping = cart.getShippingTotal();\n  Promise.await(lazyLoadMoment());\n  const cartDate = moment(cart.createdAt).format();\n  let lineItems = [];\n  if (cart.items) {\n    lineItems = cart.items.reduce((items, item) => {\n      if (item.variants.taxable) {\n        const itemObj = {\n          number: item._id,\n          itemCode: item.productId,\n          quantity: item.quantity,\n          amount: item.variants.price * item.quantity,\n          description: item.taxDescription || item.title,\n          taxCode: item.variants.taxCode\n        };\n        items.push(itemObj);\n      }\n      return items;\n    }, []);\n    if (cartShipping) {\n      lineItems.push({\n        number: \"shipping\",\n        itemCode: \"shipping\",\n        quantity: 1,\n        amount: cartShipping,\n        description: \"Shipping\",\n        taxCode: shippingTaxCode\n      });\n    }\n  }\n\n  const salesOrder = {\n    companyCode,\n    type: \"SalesOrder\",\n    customerCode: cart.userId,\n    date: cartDate,\n    currencyCode,\n    addresses: {\n      ShipFrom: {\n        line1: companyShipping.address1,\n        line2: companyShipping.address2,\n        city: companyShipping.city,\n        region: companyShipping.region,\n        country: companyShipping.country,\n        postalCode: companyShipping.postal\n      },\n      ShipTo: {\n        line1: cart.shipping[0].address.address1,\n        line2: cart.shipping[0].address.address2 || \"\",\n        city: cart.shipping[0].address.city,\n        region: cart.shipping[0].address.region,\n        country: cart.shipping[0].address.country || \"US\"\n      }\n    },\n    lines: lineItems\n  };\n\n  // current \"coupon code\" discount are based at the cart level, and every iten has it's\n  // discounted property set to true.\n  if (cart.discount) {\n    salesOrder.discount = accounting.toFixed(cart.discount, 2);\n    for (const line of salesOrder.lines) {\n      if (line.itemCode !== \"shipping\") {\n        line.discounted = true;\n      }\n    }\n  }\n  return salesOrder;\n}\n\n/**\n * @summary Submit cart for tax calculation\n * @param {Cart} cart Cart object for estimation\n * @param {Function} callback callback when using async version\n * @returns {Object} result Result of SalesOrder call\n */\ntaxCalc.estimateCart = function (cart, callback) {\n  Reaction.Schemas.Cart.validate(cart);\n  check(callback, Function);\n\n  if (cart.items && cart.shipping && cart.shipping[0] && cart.shipping[0].address) {\n    const salesOrder = Object.assign({}, cartToSalesOrder(cart), getTaxSettings(cart.userId));\n    const baseUrl = getUrl();\n    const requestUrl = `${baseUrl}transactions/create`;\n    const result = avaPost(requestUrl, { data: salesOrder });\n    if (!result.error) {\n      return callback(result.data);\n    }\n    return callback(result);\n  }\n  return callback({\n    error: {\n      errorCode: 300\n    }\n  });\n};\n\n/**\n * @summary Translate RC order into format for final submission\n * @param {Object} order RC order to send for tax reporting\n * @returns {Object} SalesOrder in Avalara format\n */\nfunction orderToSalesInvoice(order) {\n  let documentType;\n  const pkgData = taxCalc.getPackageData();\n  const { companyCode, shippingTaxCode, commitDocuments } = pkgData.settings.avalara;\n  if (commitDocuments) {\n    documentType = \"SalesInvoice\";\n  } else {\n    documentType = \"SalesOrder\";\n  }\n  const company = Shops.findOne(Reaction.getShopId());\n  const companyShipping = _.filter(company.addressBook, (o) => o.isShippingDefault)[0];\n  const currencyCode = company.currency;\n  const orderShipping = order.getShippingTotal();\n  Promise.await(lazyLoadMoment());\n  const orderDate = moment(order.createdAt).format();\n  const lineItems = order.items.reduce((items, item) => {\n    if (item.variants.taxable) {\n      const itemObj = {\n        number: item._id,\n        itemCode: item.productId,\n        quantity: item.quantity,\n        amount: item.variants.price * item.quantity,\n        description: item.taxDescription || item.title,\n        taxCode: item.variants.taxCode\n      };\n      items.push(itemObj);\n    }\n    return items;\n  }, []);\n\n  if (orderShipping) {\n    lineItems.push({\n      number: \"shipping\",\n      itemCode: \"shipping\",\n      quantity: 1,\n      amount: orderShipping,\n      description: \"Shipping\",\n      taxCode: shippingTaxCode\n    });\n  }\n\n  const salesInvoice = {\n    companyCode,\n    type: documentType,\n    commit: commitDocuments,\n    code: order._id,\n    customerCode: order.userId,\n    date: orderDate,\n    currencyCode,\n    addresses: {\n      ShipFrom: {\n        line1: companyShipping.address1,\n        line2: companyShipping.address2,\n        city: companyShipping.city,\n        region: companyShipping.region,\n        country: companyShipping.country,\n        postalCode: companyShipping.postal\n      },\n      ShipTo: {\n        line1: order.shipping[0].address.address1,\n        line2: order.shipping[0].address.address2 || \"\",\n        city: order.shipping[0].address.city,\n        region: order.shipping[0].address.region,\n        country: order.shipping[0].address.country || \"US\"\n      }\n    },\n    lines: lineItems\n  };\n\n  if (order.discount) {\n    salesInvoice.discount = accounting.toFixed(order.discount, 2);\n    for (const line of salesInvoice.lines) {\n      if (line.itemCode !== \"shipping\") {\n        line.discounted = true;\n      }\n    }\n  }\n  return salesInvoice;\n}\n\n/**\n * @summary Submit order for tax reporting\n * @param {Order} order Order object for submission\n * @param {Function} callback callback when using async version\n * @returns {Object} result Result of SalesInvoice call\n */\ntaxCalc.recordOrder = function (order, callback) {\n  check(callback, Function);\n  // unlike the other functions, we expect this to always be called asynchronously\n  if (order && order.shipping && order.shipping[0].address) {\n    const salesOrder = Object.assign({}, orderToSalesInvoice(order), getTaxSettings(order.userId));\n    const baseUrl = getUrl();\n    const requestUrl = `${baseUrl}transactions/create`;\n    try {\n      const result = avaPost(requestUrl, { data: salesOrder });\n      return callback(result.data);\n    } catch (error) {\n      Logger.error(\"Encountered error while recording order to Avalara\");\n      Logger.error(error);\n    }\n  }\n};\n\n/**\n * @summary Report refund to Avalara\n * @param {Order} order - The original order the refund was against\n * @param {Number} refundAmount - Amount to be refunded\n * @param {Function} callback - Callback\n * @returns {Object} Results from transaction call\n */\ntaxCalc.reportRefund = function (order, refundAmount, callback) {\n  check(refundAmount, Number);\n  check(callback, Function);\n  const pkgData = taxCalc.getPackageData();\n  const { companyCode } = pkgData.settings.avalara;\n  const company = Shops.findOne(Reaction.getShopId());\n  const companyShipping = _.filter(company.addressBook, (o) => o.isShippingDefault)[0];\n  const currencyCode = company.currency;\n  const baseUrl = getUrl();\n  const requestUrl = `${baseUrl}transactions/create`;\n  const returnAmount = refundAmount * -1;\n  Promise.await(lazyLoadMoment());\n  const orderDate = moment(order.createdAt);\n  const refundDate = moment();\n  const refundReference = `${order.cartId}:${refundDate}`;\n  const lineItems = {\n    number: \"01\",\n    quantity: 1,\n    amount: returnAmount,\n    description: \"refund\"\n  };\n  const returnInvoice = {\n    companyCode,\n    type: \"ReturnInvoice\",\n    code: refundReference,\n    commit: true,\n    customerCode: order._id,\n    date: refundDate,\n    currencyCode,\n    addresses: {\n      ShipFrom: {\n        line1: companyShipping.address1,\n        line2: companyShipping.address2,\n        city: companyShipping.city,\n        region: companyShipping.region,\n        country: companyShipping.country,\n        postalCode: companyShipping.postal\n      },\n      ShipTo: {\n        line1: order.shipping[0].address.address1,\n        line2: order.shipping[0].address.address2 || \"\",\n        city: order.shipping[0].address.city,\n        region: order.shipping[0].address.region,\n        country: order.shipping[0].address.country || \"US\"\n      }\n    },\n    lines: [lineItems]\n  };\n\n  if (orderDate.diff(refundDate, \"days\") !== 0) {\n    returnInvoice.taxOverride = {\n      type: \"TaxDate\",\n      taxDate: orderDate.format(),\n      reason: \"Refunded after order placed\"\n    };\n  }\n\n  const result = avaPost(requestUrl, { data: returnInvoice });\n  return callback(result.data);\n};\n\nexport default taxCalc;\n\nMeteor.methods({\n  \"avalara/addressValidation\": taxCalc.validateAddress,\n  \"avalara/getTaxCodes\": taxCalc.getTaxCodes,\n  \"avalara/testCredentials\": taxCalc.testCredentials,\n  \"avalara/getEntityCodes\": taxCalc.getEntityCodes\n});\n","import \"./hooks\";\nimport \"./i18n\";\nimport { cleanupAvalogs, setupAvalaraCleanupHook } from \"./jobs/cleanup\";\n\nsetupAvalaraCleanupHook();\ncleanupAvalogs();\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Avalara\",\n  name: \"taxes-avalara\",\n  icon: \"fa fa-university\",\n  autoEnable: false,\n  settings: {\n    avalara: {\n      enabled: false,\n      apiLoginId: \"\",\n      username: \"\",\n      password: \"\",\n      mode: false,\n      commitDocuments: true,\n      performTaxCalculation: true,\n      enableLogging: false,\n      requestTimeout: 3000,\n      logRetentionDuration: 30\n    },\n    addressValidation: {\n      enabled: true,\n      countryList: [\"US\", \"CA\"],\n      addressValidationMethod: \"avalara/addressValidation\"\n    },\n    taxCodes: {\n      getTaxCodeMethod: \"avalara/getTaxCodes\"\n    }\n  },\n  registry: [\n    {\n      label: \"Avalara\",\n      name: \"taxes/settings/avalara\",\n      provides: [\"taxSettings\"],\n      template: \"avalaraSettings\"\n    },\n    {\n      label: \"Avalara Address Validation\",\n      name: \"taxes/addressValidation/avalara\",\n      provides: [\"addressValidation\"]\n    },\n    {\n      label: \"Avalara Tax Calculation\",\n      provides: [\"taxMethod\"],\n      name: \"taxes/calculation/avalara\"\n    },\n    {\n      label: \"Avalara Tax Codes\",\n      provides: [\"taxCodes\"],\n      name: \"taxes/taxcodes/avalara\"\n    }\n  ]\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { HTTP } from \"meteor/http\";\nimport { Logger, MethodHooks } from \"/server/api\";\nimport { Shops, Cart, Packages } from \"/lib/collections\";\n\n//\n// this entire method will run after the core/taxes\n// plugin runs the taxes/calculate method\n// it overrwites any previous tax calculation\n// tax methods precendence is determined by\n// load order of plugins\n//\nMethodHooks.after(\"taxes/calculate\", (options) => {\n  const result = options.result || {};\n  let origin = {};\n\n  const cartId = options.arguments[0];\n  const cartToCalc = Cart.findOne(cartId);\n  if (cartToCalc) {\n    const { shopId } = cartToCalc;\n    const shop = Shops.findOne(shopId);\n    const pkg = Packages.findOne({\n      name: \"taxes-taxcloud\",\n      shopId,\n      enabled: true\n    });\n\n    // check if package is configured\n    if (shop && pkg && pkg.settings.taxcloud) {\n      const { apiKey, apiLoginId } = pkg.settings.taxcloud;\n\n      // get shop address\n      // this will need some refactoring\n      // for multi-vendor/shop orders\n      if (shop.addressBook) {\n        const shopAddress = shop.addressBook[0];\n        origin = {\n          Address1: shopAddress.address1,\n          City: shopAddress.city,\n          State: shopAddress.region,\n          Zip5: shopAddress.postal\n        };\n      }\n\n      // check if plugin is enabled and this calculation method is enabled\n      if (pkg && pkg.enabled === true && pkg.settings.taxcloud.enabled === true) {\n        if (!apiKey || !apiLoginId) {\n          Logger.warn(\"TaxCloud API Key is required.\");\n        }\n        if (Array.isArray(cartToCalc.shipping) && cartToCalc.shipping.length > 0 && cartToCalc.items) {\n          const shippingAddress = cartToCalc.shipping[0].address;\n\n          if (shippingAddress) {\n            Logger.debug(\"TaxCloud triggered on taxes/calculate for cartId:\", cartId);\n            const url = \"https://api.taxcloud.net/1.0/TaxCloud/Lookup\";\n            const cartItems = [];\n            const destination = {\n              Address1: shippingAddress.address1,\n              City: shippingAddress.city,\n              State: shippingAddress.region,\n              Zip5: shippingAddress.postal\n            };\n\n            // format cart items to TaxCloud structure\n            let index = 0;\n            for (const items of cartToCalc.items) {\n              // only processs taxable products\n              if (items.variants.taxable === true) {\n                const item = {\n                  Index: index,\n                  ItemID: items.variants._id,\n                  TIC: \"00000\",\n                  Price: items.variants.price,\n                  Qty: items.quantity\n                };\n                index += 1;\n                cartItems.push(item);\n              }\n            }\n\n            // request object\n            const request = {\n              headers: {\n                \"accept\": \"application/json\",\n                \"content-type\": \"application/json\"\n              },\n              data: {\n                apiKey,\n                apiLoginId,\n                customerID: cartToCalc.userId,\n                cartItems,\n                origin,\n                destination,\n                cartID: cartId,\n                deliveredBySeller: false\n              }\n            };\n\n            HTTP.post(url, request, (error, response) => {\n              let taxRate = 0;\n              // ResponseType 3 is a successful call.\n              if (!error && response.data.ResponseType === 3) {\n                let totalTax = 0;\n                for (const item of response.data.CartItemsResponse) {\n                  totalTax += item.TaxAmount;\n                }\n                // don't run this calculation if there isn't tax.\n                if (totalTax > 0) {\n                  taxRate = (totalTax / cartToCalc.getSubTotal());\n                }\n                // we should consider if we want percentage and dollar\n                // as this is assuming that subTotal actually contains everything\n                // taxable\n                Meteor.call(\"taxes/setRate\", cartId, taxRate, response.CartItemsResponse);\n              } else {\n                let errMsg = \"Unable to access service. Check credentials.\";\n                if (response && response.data.Messages[0].Message) {\n                  errMsg = response.data.Messages[0].Message;\n                }\n                Logger.warn(\"Error fetching tax rate from TaxCloud:\", errMsg);\n              }\n            });\n          }\n        }\n      }\n    }\n  }\n  // Default return value is the return value of previous call in method chain\n  // or an empty object if there's no result yet.\n  return result;\n});\n","import \"./hooks\";\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./methods\";\n","import { Meteor } from \"meteor/meteor\";\nimport { HTTP } from \"meteor/http\";\n\nMeteor.methods({\n  /**\n   * We're using https://taxcloud.net\n   * just to get an intial import data set\n   * this service doesn't require taxcloud id\n   * but other services need authorization\n   * use TAXCODE_SRC  to override source url\n   * @returns {Array} An array of Tax code objects\n   */\n  \"taxcloud/getTaxCodes\"() {\n    const taxCodeArray = [];\n    const TAXCODE_SRC = \"https://taxcloud.net/tic/?format=json\";\n    const taxCodes = HTTP.get(TAXCODE_SRC);\n\n    if (taxCodes) {\n      taxCodes.data.tic_list.forEach((code) => {\n        if (code.tic.children) {\n          code.tic.children.forEach((child) => {\n            taxCodeArray.push(child.tic);\n          });\n        }\n        taxCodeArray.push(code.tic);\n      });\n      return taxCodeArray;\n    }\n    throw new Meteor.Error(\"retrieval-failed\", \"Error getting tax codes\");\n  }\n});\n","import \"./hooks\";\nimport \"./i18n\";\n\n// TODO decide if we want to use tax codes\n// these imports was start a job to import TaxCloud taxCodes\n\nimport \"./methods\";\n// import \"./jobs\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Taxes\",\n  name: \"taxes-taxcloud\",\n  icon: \"fa fa-university\",\n  autoEnable: false,\n  settings: {\n    taxcloud: {\n      enabled: false,\n      apiLoginId: \"\",\n      apiKey: \"\",\n      refreshPeriod: \"every 7 days\",\n      taxCodeUrl: \"https://taxcloud.net/tic/?format=json\"\n    },\n    taxCodes: {\n      getTaxCodeMethod: \"taxcloud/getTaxCodes\"\n    }\n  },\n  registry: [\n    {\n      label: \"TaxCloud\",\n      name: \"taxes/settings/taxcloud\",\n      provides: [\"taxSettings\"],\n      template: \"taxCloudSettings\"\n    },\n    {\n      label: \"TaxCloud Tax Codes\",\n      provides: [\"taxCodes\"],\n      name: \"taxes/taxcodes/taxcloud\"\n    }\n  ]\n});\n","import { Reaction, Logger, MethodHooks } from \"/server/api\";\nimport { Packages } from \"/lib/collections\";\n\n// // Meteor.after to call after\nMethodHooks.after(\"taxes/calculate\", (options) => {\n  const result = options.result || {};\n  const pkg = Packages.findOne({\n    name: \"taxes-taxjar\",\n    shopId: Reaction.getShopId(),\n    enabled: true\n  });\n\n  // check if plugin is enabled and this calculation method is enabled\n  if (pkg && pkg && pkg.enabled === true && pkg.settings.taxjar.enabled === true) {\n    Logger.warn(\"TaxJar triggered on taxes/calculate for cartId:\", options.arguments[0]);\n  }\n\n  // Default return value is the return value of previous call in method chain\n  // or an empty object if there's no result yet.\n  return result;\n});\n","import \"./hooks\";\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./hooks\";\nimport \"./i18n\";\n","import { loadTranslations } from \"/server/startup/i18n\";\n\n// import ar from \"./ar.json\";\n// import bg from \"./bg.json\";\n// import de from \"./de.json\";\n// import el from \"./el.json\";\nimport en from \"./en.json\";\n// import es from \"./es.json\";\n// import fr from \"./fr.json\";\n// import he from \"./he.json\";\n// import hr from \"./hr.json\";\n// import it from \"./it.json\";\n// import my from \"./my.json\";\n// import nb from \"./nb.json\";\n// import nl from \"./nl.json\";\n// import pl from \"./pl.json\";\n// import pt from \"./pt.json\";\n// import ro from \"./ro.json\";\n// import ru from \"./ru.json\";\n// import sl from \"./sl.json\";\n// import sv from \"./sv.json\";\n// import tr from \"./tr.json\";\n// import vi from \"./vi.json\";\n// import zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([en]);\n// loadTranslations([ar, bg, de, el, en, es, fr, he, hr, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","import \"./i18n\";\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"Search UI\",\n  name: \"reaction-ui-search\",\n  icon: \"fa fa-search\",\n  autoEnable: true,\n  registry: [\n    {\n      name: \"Search Modal\",\n      provides: [\"ui-search\"],\n      template: \"searchModal\"\n    }\n  ]\n});\n","import { loadTranslations } from \"/server/startup/i18n\";\n\nimport ar from \"./ar.json\";\nimport bg from \"./bg.json\";\nimport cs from \"./cs.json\";\nimport de from \"./de.json\";\nimport el from \"./el.json\";\nimport en from \"./en.json\";\nimport es from \"./es.json\";\nimport fr from \"./fr.json\";\nimport he from \"./he.json\";\nimport hr from \"./hr.json\";\nimport hu from \"./hu.json\";\nimport it from \"./it.json\";\nimport my from \"./my.json\";\nimport nb from \"./nb.json\";\nimport nl from \"./nl.json\";\nimport pl from \"./pl.json\";\nimport pt from \"./pt.json\";\nimport ro from \"./ro.json\";\nimport ru from \"./ru.json\";\nimport sl from \"./sl.json\";\nimport sv from \"./sv.json\";\nimport tr from \"./tr.json\";\nimport vi from \"./vi.json\";\nimport zh from \"./zh.json\";\n\n//\n// we want all the files in individual\n// imports for easier handling by\n// automated translation software\n//\nloadTranslations([ar, bg, cs, de, el, en, es, fr, he, hr, hu, it, my, nb, nl, pl, pt, ro, ru, sl, sv, tr, vi, zh]);\n","Meteor.methods({\n  // arguments @param OBJECT Parameters using hashitis pattern.\n  'knoledgePayments/authorize': function(arguments){\n\n    //TODO SS: Remove exesive logging.\n    console.log('Knoledge Method Started');\n    console.log(arguments);\n\n    // TODO SS: check each argument. At the time being we don't know the arguments.\n    check(arguments, Object);\n\n    try{\n      const response = HTTP.get('https://jsonplaceholder.typicode.com/posts/1');\n    } catch(error){\n      console.error(error);\n      throw new Meteor.Error('API error', error);\n    }\n    return true;\n  }\n});\n","/* eslint camelcase: 0 */\n// meteor modules\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\n// reaction modules\nimport { Reaction, Logger } from \"/server/api\";\nimport { ExampleApi } from \"./exampleapi\";\n\nfunction luhnValid(x) {\n  return [...x].reverse().reduce((sum, c, i) => {\n    let d = parseInt(c, 10);\n    if (i % 2 !== 0) { d *= 2; }\n    if (d > 9) { d -= 9; }\n    return sum + d;\n  }, 0) % 10 === 0;\n}\n\nconst ValidCardNumber = Match.Where((x) => /^[0-9]{13,16}$/.test(x) && luhnValid(x));\n\nconst ValidExpireMonth = Match.Where((x) => /^[0-9]{1,2}$/.test(x));\n\nconst ValidExpireYear = Match.Where((x) => /^[0-9]{4}$/.test(x));\n\nconst ValidCVV = Match.Where((x) => /^[0-9]{3,4}$/.test(x));\n\n// function chargeObj() {\n//   return {\n//     amount: \"\",\n//     currency: \"\",\n//     card: {},\n//     capture: true\n//   };\n// }\n\n// function parseCardData(data) {\n//   return {\n//     number: data.number,\n//     name: data.name,\n//     cvc: data.cvv2,\n//     expireMonth: data.expire_month,\n//     expireYear: data.expire_year\n//   };\n// }\n\n\nMeteor.methods({\n  /**\n   * Submit a card for Authorization\n   * @param  {Object} transactionType authorize or capture\n   * @param  {Object} cardData card Details\n   * @param  {Object} paymentData The details of the Payment Needed\n   * @return {Object} results normalized\n   */\n  \"exampleSubmit\"(transactionType, cardData, paymentData) {\n    check(transactionType, String);\n    check(cardData, {\n      name: String,\n      number: ValidCardNumber,\n      expireMonth: ValidExpireMonth,\n      expireYear: ValidExpireYear,\n      cvv2: ValidCVV,\n      type: String\n    });\n\n    check(paymentData, {\n      total: String,\n      currency: String\n    });\n    const total = parseFloat(paymentData.total);\n    let result;\n    try {\n      const transaction = ExampleApi.methods.authorize.call({\n        transactionType,\n        cardData,\n        paymentData\n      });\n\n      result = {\n        saved: true,\n        status: \"created\",\n        currency: paymentData.currency,\n        amount: total,\n        riskLevel: normalizeRiskLevel(transaction),\n        transactionId: transaction.id,\n        response: {\n          amount: total,\n          transactionId: transaction.id,\n          currency: paymentData.currency\n        }\n      };\n    } catch (error) {\n      Logger.warn(error);\n      result = {\n        saved: false,\n        error\n      };\n    }\n    return result;\n  },\n\n  /**\n   * Capture a Charge\n   * @param {Object} paymentData Object containing data about the transaction to capture\n   * @return {Object} results normalized\n   */\n  \"example/payment/capture\"(paymentData) {\n    check(paymentData, Reaction.Schemas.PaymentMethod);\n    const authorizationId = paymentData.transactionId;\n    const { amount } = paymentData;\n    const response = ExampleApi.methods.capture.call({\n      authorizationId,\n      amount\n    });\n    const result = {\n      saved: true,\n      response\n    };\n    return result;\n  },\n\n  /**\n   * Create a refund\n   * @param  {Object} paymentMethod object\n   * @param  {Number} amount The amount to be refunded\n   * @return {Object} result\n   */\n  \"knowledge/refund/create\"(paymentMethod, amount) {\n    check(paymentMethod, Reaction.Schemas.PaymentMethod);\n    check(amount, Number);\n    const { transactionId } = paymentMethod;\n    const response = ExampleApi.methods.refund.call({\n      transactionId,\n      amount\n    });\n    const results = {\n      saved: true,\n      response\n    };\n    return results;\n  },\n\n  /**\n   * List refunds\n   * @param  {Object} paymentMethod Object containing the pertinant data\n   * @return {Object} result\n   */\n  \"knowledge/refund/list\"(paymentMethod) {\n    check(paymentMethod, Reaction.Schemas.PaymentMethod);\n    const { transactionId } = paymentMethod;\n    const response = ExampleApi.methods.refunds.call({\n      transactionId\n    });\n    const result = [];\n    for (const refund of response.refunds) {\n      result.push(refund);\n    }\n\n    // The results retured from the GenericAPI just so happen to look like exactly what the dashboard\n    // wants. The return package should ba an array of objects that look like this\n    // {\n    //   type: \"refund\",\n    //   amount: Number,\n    //   created: Number: Epoch Time,\n    //   currency: String,\n    //   raw: Object\n    // }\n    const emptyResult = [];\n    return emptyResult;\n  }\n});\n\n/**\n * @method normalizeRiskLevel\n * @private\n * @summary Normalizes the risk level response of a transaction to the values defined in paymentMethod schema\n * @param  {object} transaction - The transaction that we need to normalize\n * @return {string} normalized status string - either elevated, high, or normal\n */\nfunction normalizeRiskLevel(transaction) {\n  // the values to be checked against will depend on the return codes/values from the payment API\n  if (transaction.riskStatus === \"low_risk_level\") {\n    return \"elevated\";\n  }\n\n  if (transaction.riskStatus === \"highest_risk_level\") {\n    return \"high\";\n  }\n\n  // default to normal if no other flagged\n  return \"normal\";\n}\n","import { ValidatedMethod } from \"meteor/mdg:validated-method\";\nimport { SimpleSchema } from \"meteor/aldeed:simple-schema\";\nimport { Random } from \"meteor/random\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n// Test card to use to add risk level flag for testing purposes only.\nexport const RISKY_TEST_CARD = \"4000000000009235\";\n\n// You should not implement ThirdPartyAPI. It is supposed to represent your third party API\n// And is called so that it can be stubbed out for testing. This would be a library\n// like Stripe or Authorize.net usually just included with a NPM.require\n\nconst ThirdPartyAPI = {\n  authorize(transactionType, cardData, paymentData) {\n    if (transactionType === \"authorize\") {\n      const results = {\n        success: true,\n        id: Random.id(),\n        cardNumber: cardData.number.slice(-4),\n        amount: paymentData.total,\n        currency: \"USD\"\n      };\n      // This is for testing risk evaluation. Proper payment methods have dectection mechanisms for this.\n      // This is just a sample\n      if (cardData.number === RISKY_TEST_CARD) {\n        results.riskStatus = \"highest_risk_level\";\n      }\n      return results;\n    }\n    return {\n      success: false\n    };\n  },\n  capture(authorizationId, amount) {\n    return {\n      authorizationId,\n      amount,\n      success: true\n    };\n  },\n  refund(transactionId, amount) {\n    return {\n      success: true,\n      transactionId,\n      amount\n    };\n  },\n  listRefunds(transactionId) {\n    return {\n      transactionId,\n      refunds: [\n        {\n          type: \"refund\",\n          amount: 3.99,\n          created: 1454034562000,\n          currency: \"usd\",\n          raw: {}\n        }\n      ]\n    };\n  }\n};\n\n// This is the \"wrapper\" functions you should write in order to make your code more\n// testable. You can either mirror the API calls or normalize them to the authorize/capture/refund/refunds\n// that Reaction is expecting\nexport const ExampleApi = {};\nExampleApi.methods = {};\n\nexport const cardSchema = new SimpleSchema({\n  number: { type: String },\n  name: { type: String },\n  cvv2: { type: String },\n  expireMonth: { type: String },\n  expireYear: { type: String },\n  type: { type: String }\n});\n\nregisterSchema(\"cardSchema\", cardSchema);\n\nexport const paymentDataSchema = new SimpleSchema({\n  total: { type: String },\n  currency: { type: String }\n});\n\nregisterSchema(\"paymentDataSchema\", paymentDataSchema);\n\n\nExampleApi.methods.authorize = new ValidatedMethod({\n  name: \"ExampleApi.methods.authorize\",\n  validate: new SimpleSchema({\n    transactionType: { type: String },\n    cardData: { type: cardSchema },\n    paymentData: { type: paymentDataSchema }\n  }).validator(),\n  run({ transactionType, cardData, paymentData }) {\n    const results = ThirdPartyAPI.authorize(transactionType, cardData, paymentData);\n    return results;\n  }\n});\n\n\nExampleApi.methods.capture = new ValidatedMethod({\n  name: \"ExampleApi.methods.capture\",\n  validate: new SimpleSchema({\n    authorizationId: { type: String },\n    amount: { type: Number, decimal: true }\n  }).validator(),\n  run(args) {\n    const transactionId = args.authorizationId;\n    const { amount } = args;\n    const results = ThirdPartyAPI.capture(transactionId, amount);\n    return results;\n  }\n});\n\n\nExampleApi.methods.refund = new ValidatedMethod({\n  name: \"ExampleApi.methods.refund\",\n  validate: new SimpleSchema({\n    transactionId: { type: String },\n    amount: { type: Number, decimal: true }\n  }).validator(),\n  run(args) {\n    const { transactionId, amount } = args.transactionId;\n    const results = ThirdPartyAPI.refund(transactionId, amount);\n    return results;\n  }\n});\n\n\nExampleApi.methods.refunds = new ValidatedMethod({\n  name: \"ExampleApi.methods.refunds\",\n  validate: new SimpleSchema({\n    transactionId: { type: String }\n  }).validator(),\n  run(args) {\n    const { transactionId } = args;\n    const results = ThirdPartyAPI.listRefunds(transactionId);\n    return results;\n  }\n});\n","import \"./methods/example\";\nimport \"./i18n\";\nimport \"./methods/authorize\";\n\nexport * from \"./methods/exampleapi\";\n\nexport * from \"./methods/authorize\";\n","/* eslint camelcase: 0 */\nimport { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  label: \"KnowledgePayment\",\n  name: \"knowledge-paymentmethod\",\n  icon: \"fa fa-credit-card-alt\",\n  autoEnable: true,\n  settings: {\n    \"mode\": false,\n    \"apiKey\": \"\",\n    \"example\": {\n      enabled: true\n    },\n    \"knowledge-paymentmethod\": {\n      enabled: true,\n      support: [\n        \"Authorize\",\n        \"Capture\",\n      ]\n    }\n  },\n  registry: [\n    // Settings panel\n    {\n      label: \"Knowledge Payment\", // this key (minus spaces) is used for translations\n      provides: [\"paymentSettings\"],\n      container: \"dashboard\",\n      template: \"knowledgeSettings\"\n    },\n\n    // Payment form for checkout\n    {\n      template: \"knowledgePaymentForm\",\n      provides: [\"paymentMethod\"],\n      icon: \"fa fa-credit-card-alt\"\n    }\n  ]\n});\n","import { Reaction } from \"/server/api\";\n\nReaction.registerPackage({\n  // Label that shows up in tooltips and places where the package is accessable for settings\n  label: \"Knowledge-Theme\",\n  name: \"my-theme\",\n  icon: \"fa fa-bars\",\n  settings: {},\n  registry: []\n});\n","import { ReactionProduct, getShopId, Reaction } from \"/lib/api\";\nimport { Shops, SellerShops } from \"/lib/collections\";\n\n/**\n * @method MetaData\n * @memberof Router\n * @summary Populates title and meta tags for routes\n * accepts Router.current() as context\n * @param context\n * @example MetaData.init(Router.current());\n */\nexport const MetaData = {\n  init(context) {\n    const { params } = context;\n    const product = ReactionProduct.selectedProduct();\n    const shop = Shops.findOne(getShopId());\n    const meta = [];\n    let title = \"\";\n    let description = \"\";\n    let keywords = [];\n\n    // case helper\n    const titleCase = (param) => param.charAt(0).toUpperCase() + param.substring(1);\n\n    // populate meta from shop\n    if (shop) {\n      // shop defaults\n      if (shop.description) {\n        description = shop.description.substring(0, 160);\n      }\n\n      if (shop.keywords) {\n        keywords.push(shop.keywords.toString());\n      }\n\n      // set title defaults\n      MetaData.name = shop.name;\n\n      // product title default\n      if (params && params.handle) {\n        if (product && product.title) {\n          title = titleCase(product.title);\n        } else {\n          title = titleCase(params.handle);\n        }\n\n      // tag slugs\n      } else if (params && params.slug) {\n        title = titleCase(params.slug);\n\n      // fallback to route name\n      } else if (context.route && context.route.name) {\n        const { route } = context;\n        const routeName = route.name;\n\n        // default index to Shop Name\n        if (routeName === \"index\") {\n          title = titleCase(shop.name);\n\n        // seller shop homepage\n        } else if (routeName === \"shop\") {\n          const currentShop = SellerShops.findOne(params.shopId);\n          if (currentShop) {\n            title = titleCase(currentShop.name);\n          } else {\n            title = titleCase(routeName);\n          }\n        // check for meta in package route\n        } else if (route.options.meta && route.options.meta.title) {\n          title = titleCase(route.options.meta.title);\n        } else {\n          // default routes to route's name\n          title = titleCase(routeName);\n        }\n      }\n\n      //  product details\n      if (params && params.handle && product) {\n        // discard defaults\n        Reaction.DOM.removeDocHeadAddedTags();\n\n        if (product.description) {\n          description = product.description.substring(0, 160);\n        }\n\n        if (product && product.metafields) {\n          // Clear shop keywords, to make keywords specific to this product page.\n          keywords = [];\n          for (const key of product.metafields) {\n            keywords.push(key.value);\n          }\n        }\n      }\n    } // end shop\n\n    Reaction.DOM.setMetaTag({\n      name: \"description\",\n      content: description\n    });\n\n    Reaction.DOM.setMetaTag({\n      name: \"keywords\",\n      content: keywords ? keywords.toString() : \"\"\n    });\n\n    // set site defaults\n    document.title = title;\n    MetaData.title = title;\n    MetaData.meta = meta;\n\n    return meta;\n  } // end update\n};\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\n\n/**\n * @file Methods for Account Validation\n * Methods for validating account username, email and password. Methods are exported globally in the `LoginFormValidation` object and they are also registered as Meteor methods. Call the methods using\n * `Meteor.call()` or `LoginFormValidation.method`.\n * @example LoginFormValidation.password(password, { validationLevel: \"exists\" })\n * @example Meteor.call(\"accounts/validation/email\", newEmail, false, (result, error))\n * @namespace Methods/Accounts/Validation\n */\n\nconst validationMethods = {\n  /**\n   * @name accounts/validation/username\n   * @method\n   * @memberof Methods/Accounts/Validation\n   * @summary Determines if a username meets the minimum requirement of 3 characters\n   * @param  {String} username Username to validate\n   * @return {Boolean|Object} true if valid, error object if invalid\n   */\n  username(username) {\n    check(username, Match.OptionalOrNull(String));\n\n    // Valid\n    if (username.length >= 3) {\n      return true;\n    }\n\n    // Invalid\n    return {\n      error: \"INVALID_USERNAME\",\n      reason: \"Username must be at least 3 characters long\",\n      i18nKeyReason: \"accountsUI.error.usernameMinLength\"\n    };\n  },\n\n  /**\n   * @name accounts/validation/email\n   * @method\n   * @memberof Methods/Accounts/Validation\n   * @summary Validates both required and optional email addresses.\n   * @example LoginFormValidation.email(emailAddress)\n   * @example Meteor.call(\"accounts/validation/email\", newEmail, false, callbackFunction())\n   * @param  {String} email Email address to validate\n   * @param  {Boolean} optional If set to true, validation will pass if email is blank\n   * @return {Boolean|Object} Returns true if valid; Returns an error object if invalid\n   */\n  email(email, optional) {\n    check(email, Match.OptionalOrNull(String));\n    check(optional, Match.OptionalOrNull(Boolean));\n\n    const processedEmail = email.trim();\n\n    // Valid\n    if (optional === true && processedEmail.length === 0) {\n      return true;\n    } else if (processedEmail.indexOf(\"@\") !== -1) {\n      return true;\n    }\n\n    // Invalid\n    return {\n      error: \"INVALID_EMAIL\",\n      reason: \"Email address is invalid\",\n      i18nKeyReason: \"accountsUI.error.invalidEmail\"\n    };\n  },\n\n  /**\n   * @name accounts/validation/password\n   * @method\n   * @memberof Methods/Accounts/Validation\n   * @summary Passwords may be validated 2 ways.\n   * 1. \"exists\" `(options.validationLevel = \"exists\")` - Password must not be blank.\n   * Thats is the only rule. Used to validate a sign in.\n   * 2. undefined `(options.validationLevel = undefined)` - Password must meet the lenght and other criteria to validate.\n   * Used for validating a new sign up.\n   * @example LoginFormValidation.password(pword, { validationLevel: \"exists\" })\n   * @param  {String} password Password to validate\n   * @param  {Object} options Options to apply to the password validator\n   * @param  {String} options.validationLevel \"exists\" | undefined (default)\n   * @return {Boolean|Object} true if valid | Error object otherwise: {error: String, reason: String}\n   */\n  password(password, options) {\n    check(password, Match.OptionalOrNull(String));\n    check(options, Match.OptionalOrNull(Object));\n\n    const passwordOptions = options || {};\n    const errors = [];\n\n    // Only check if a password has been entered at all.\n    // This is usefull for the login forms\n    if (passwordOptions.validationLevel === \"exists\") {\n      if (password && password.length > 0) {\n        return true;\n      }\n\n      errors.push({\n        error: \"INVALID_PASSWORD\",\n        reason: \"Password is required\",\n        i18nKeyReason: \"accountsUI.error.passwordRequired\"\n      });\n    } else if (password.length < 6) {\n      // Validate the password on some rules\n      // This is useful for cases where a password needs to be created or updated.\n      errors.push({\n        error: \"INVALID_PASSWORD\",\n        reason: \"Password must be at least 6 characters long.\",\n        i18nKeyReason: \"accountsUI.error.passwordMustBeAtLeast6CharactersLong\"\n      });\n    }\n\n    if (errors.length) {\n      return errors;\n    }\n\n    // Otherwise the password is valid\n    return true;\n  }\n};\n\n// Export object globally\nexport const LoginFormValidation = validationMethods;\n\n// Register validation methods as meteor methods\nMeteor.methods({\n  \"accounts/validation/username\": validationMethods.username,\n  \"accounts/validation/email\": validationMethods.email,\n  \"accounts/validation/password\": validationMethods.password\n});\n","import _ from \"lodash\";\nimport { Products } from \"/lib/collections\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { applyProductRevision } from \"/lib/api/products\";\n\n/**\n * @file Catalog methods\n *\n * @namespace Catalog\n */\n\nexport default {\n  /**\n   * @method setProduct\n   * @memberof Catalog\n   * @summary method to set default/parameterized product variant\n   * @param {String} currentProductId - set current productId\n   * @param {String} currentVariantId - set current variantId\n   * @return {undefined} return nothing, sets in session\n   */\n  setProduct(currentProductId, currentVariantId) {\n    let productId = currentProductId;\n    const variantId = currentVariantId;\n    if (!productId.match(/^[A-Za-z0-9]{17}$/)) {\n      const product = Products.findOne({\n        handle: productId.toLowerCase()\n      });\n      if (product) {\n        productId = product._id;\n      }\n    }\n    ReactionProduct.setCurrentVariant(variantId);\n  },\n\n  /**\n   * @method getProductPriceRange\n   * @memberof Catalog\n   * @summary get price range of a product\n   * if only one price available, return it\n   * otherwise return a string range\n   * @todo move all this methods this to export function after 1.3\n   * @param {String} [productId] - current product _id\n   * @return {Object} range, min, max\n   */\n  getProductPriceRange(productId) {\n    const product = applyProductRevision(Products.findOne(productId));\n    if (!product) {\n      return {\n        range: \"0\",\n        min: 0,\n        max: 0\n      };\n    }\n\n    const variants = this.getTopVariants(product._id);\n    // if we have variants we have a price range.\n    // this processing will default on the server\n    const visibileVariant = variants.filter((variant) => variant.isVisible === true);\n\n    if (visibileVariant.length > 0) {\n      const variantPrices = [];\n      variants.forEach((variant) => {\n        if (variant.isVisible === true) {\n          const range = this.getVariantPriceRange(variant._id);\n          if (typeof range === \"string\") {\n            const firstPrice = parseFloat(range.substr(0, range.indexOf(\" \")));\n            const lastPrice = parseFloat(range.substr(range.lastIndexOf(\" \") + 1));\n            variantPrices.push(firstPrice, lastPrice);\n          } else {\n            variantPrices.push(range);\n          }\n        } else {\n          variantPrices.push(0, 0);\n        }\n      });\n      const priceMin = _.min(variantPrices);\n      const priceMax = _.max(variantPrices);\n      let priceRange = `${priceMin} - ${priceMax}`;\n      // if we don't have a range\n      if (priceMin === priceMax) {\n        priceRange = priceMin.toString();\n      }\n      return {\n        range: priceRange,\n        min: priceMin,\n        max: priceMax\n      };\n    }\n\n    if (!product.price) {\n      return {\n        range: \"0\",\n        min: 0,\n        max: 0\n      };\n    }\n\n    // if we have no variants subscribed to (client)\n    // we'll get the price object previously from the product\n    return product.price;\n  },\n\n  /**\n   * @method getVariantPriceRange\n   * @memberof Catalog\n   * @summary get price range of a variant if it has child options.\n   * if no child options, return main price value\n   * @todo remove string return and replace with object\n   * @param {String} [variantId] - current variant _Id\n   * @return {String} formatted price or price range\n   */\n  getVariantPriceRange(variantId) {\n    const children = this.getVariants(variantId);\n    const visibleChildren = children.filter((child) => child.isVisible);\n\n    switch (visibleChildren.length) {\n      case 0: {\n        const topVariant = applyProductRevision(Products.findOne(variantId));\n        // topVariant could be undefined when we removing last top variant\n        return topVariant && topVariant.price;\n      }\n      case 1: {\n        return visibleChildren[0].price;\n      }\n      default: {\n        let priceMin = Number.POSITIVE_INFINITY;\n        let priceMax = Number.NEGATIVE_INFINITY;\n\n        children.forEach((child) => {\n          if (child.isVisible === true) {\n            if (child.price < priceMin) {\n              priceMin = child.price;\n            }\n            if (child.price > priceMax) {\n              priceMax = child.price;\n            }\n          }\n        });\n\n        if (priceMin === priceMax) {\n          // TODO check impact on i18n/formatPrice from moving return to string\n          return priceMin.toString();\n        }\n        return `${priceMin} - ${priceMax}`;\n      }\n    }\n  },\n\n  /**\n   * @method getVariantQuantity\n   * @memberof Catalog\n   * @description calculate a sum of descendants `inventoryQuantity`\n   * @param {Object} variant - top-level variant\n   * @return {Number} summary of options quantity\n   */\n  getVariantQuantity(variant) {\n    const options = this.getVariants(variant._id);\n    if (options && options.length) {\n      return options.reduce((sum, option) =>\n        sum + parseInt(option.inventoryQuantity, 10) || 0, 0);\n    }\n    return variant.inventoryQuantity || 0;\n  },\n\n  /**\n   * @method getPublishedOrRevision\n   * @memberof Catalog\n   * @description return top product revision if available\n   * @param {Object} product product or variant document\n   * @return {Object} product document\n   */\n  getPublishedOrRevision(product) {\n    return applyProductRevision(product);\n  },\n\n  /**\n  * @method getProduct\n  * @method\n  * @memberof ReactionProduct\n  * @summary Get product object. Could be useful for products and for top level variants\n  * @param {String} [id] - product _id\n  * @return {Object} Product data\n  */\n  getProduct(id) {\n    return Products.findOne(id);\n  },\n\n  /**\n   * @method getVariants\n   * @memberof Catalog\n   * @description Get all parent variants\n   * @summary could be useful for products and for top level variants\n   * @param {String} [id] - product _id\n   * @param {String} [type] - type of variant\n   * @return {Array} Parent variants or empty array\n   */\n  getVariants(id, type) {\n    return Products.find({\n      ancestors: { $in: [id] },\n      type: type || \"variant\"\n    }).map(this.getPublishedOrRevision);\n  },\n\n  /**\n   * @method getVariantParent\n   * @memberof Catalog\n   * @description Get direct parent variant\n   * @summary could be useful for lower level variants to get direct parents\n   * @param {Object} [variant] - product / variant object\n   * @return {Array} Parent variant or empty\n   */\n  getVariantParent(variant) {\n    const parent = Products.findOne({\n      _id: { $in: variant.ancestors },\n      type: \"variant\"\n    });\n    return this.getPublishedOrRevision(parent);\n  },\n\n  /**\n   * @method getSiblings\n   * @memberof Catalog\n   * @description Get all sibling variants - variants with the same ancestor tree\n   * @summary could be useful for child variants relationships with top-level variants\n   * @param {Object} [variant] - product / variant object\n   * @param {String} [type] - type of variant\n   * @param {Boolean} [includeSelf] - include current variant in results\n   * @return {Array} Sibling variants or empty array\n   */\n  getSiblings(variant, type) {\n    return Products.find({\n      ancestors: variant.ancestors,\n      type: type || \"variant\"\n    }).map(this.getPublishedOrRevision);\n  },\n\n  /**\n   * @method getTopVariants\n   * @memberof Catalog\n   * @description Get only product top level variants\n   * @param {String} [id] - product _id\n   * @return {Array} Product top level variants or empty array\n   */\n  getTopVariants(id) {\n    return Products.find({\n      ancestors: [id],\n      type: \"variant\"\n    }).map(this.getPublishedOrRevision);\n  }\n};\n","import { isEqual } from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Accounts, Shops, SellerShops } from \"/lib/collections\";\n\nlet Core;\n\n// TODO: Decide how we want to approach this problem - duplicate content on both client\n// and server, or detecting client/server and DRYing up the code.\nif (Meteor.isServer) {\n  Core = require(\"/server/api\");\n} else {\n  Core = require(\"/client/api\");\n}\n\n/**\n * @method isPackageEnabled\n * @memberof Core\n * @summary Check if package is enabled\n * @example Reaction.isPackageEnabled()\n * @param  {String}  name - Package name\n * @return {Boolean}      True if the package is enabled\n */\nfunction isPackageEnabled(name) {\n  const settings = this.getPackageSettings(name);\n\n  return !!settings.enabled;\n}\n\n/**\n * @method getSeller\n * @memberof Core\n * @example Reaction.getSeller(shopId)\n * @param  {String} shopId ID of shop\n * @return {Object}        Account object of seller\n */\nfunction getSeller(shopId) {\n  let sellerShopId;\n\n  if (!shopId) {\n    const currentUser = Meteor.user();\n    if (currentUser) {\n      [sellerShopId] = Roles.getGroupsForUser(currentUser.id, \"admin\");\n    }\n  } else {\n    sellerShopId = shopId;\n  }\n\n  return Accounts.findOne({ shopId: sellerShopId });\n}\n\n/**\n * @method getSellerShopId\n * @memberof Core\n * @summary Get a seller's shopId or default to parent shopId\n * @example Reaction.getSellerShopId(this.userId, true)\n * @param {String|Object} user - An optional user hash or userId to find a shop for\n * @param {Boolean} [noFallback=false] - Optional.If set to true doesn't fallback to owner shopId\n * when user doesn't have a shop.\n * @returns {String|Boolean} - The shopId belonging to userId, or loggedIn seller, or the parent shopId\n */\nfunction getSellerShopId(user, noFallback = false) {\n  let seller = user;\n\n  if (Meteor.isClient && !seller) {\n    seller = Meteor.user();\n  }\n\n  if (seller) {\n    const group = Roles.getGroupsForUser(seller, \"admin\")[0];\n    if (group) {\n      return group;\n    }\n  }\n\n\n  if (noFallback) {\n    return false;\n  }\n\n  return Core.Reaction.getShopId();\n}\n\n/**\n * @method getSellerShop\n * @memberof Core\n * @summary Get a seller's shop or default to parent shop\n * @param {String|Object} user - An optional user hash or userId to find a shop for\n * @param {Boolean} [noFallback=false] - Optional.If set to true doesn't fallback to owner shop\n * when user doesn't have a shop.\n * @returns {String|Boolean} - The shop hash belonging to userId, or loggedIn seller, or the parent shop\n */\nfunction getSellerShop(user, noFallback = false) {\n  const _id = getSellerShopId(user, noFallback);\n\n  if (!_id) {\n    return false;\n  }\n\n  if (Meteor.isClient && _id !== Core.Reaction.getShopId()) {\n    return SellerShops.findOne({ _id });\n  }\n\n  return Shops.findOne({ _id });\n}\n\n/**\n  * getShopsForUser -\n  * @summary gets shopIds of shops where user has provided permissions\n  * @param {Array} roles - roles to check if user has\n  * @param {Object} userId - userId to check permissions for (defaults to current user)\n  * @return {Array} - shopIds user has provided permissions for\n  */\nfunction getShopsForUser(roles, userId = Meteor.userId()) {\n  // Get full user object, and get shopIds of all shops they are attached to\n  const user = Meteor.user(userId);\n  if (!user || !user.roles) {\n    return [];\n  }\n  const shopIds = Object.keys(user.roles);\n  // Remove \"__global_roles__\" from the list of shopIds, as this function will always return true for\n  // marketplace admins if that \"id\" is left in the check\n  const filteredShopIds = shopIds.filter((shopId) => shopId !== \"__global_roles__\");\n\n  // Reduce shopIds to shopsWithPermission, using the roles passed in to this function\n  const shopIdsWithRoles = filteredShopIds.reduce((shopsWithPermission, shopId) => {\n    // Get list of roles user has for this shop\n    const rolesUserHas = user.roles[shopId];\n\n    // Find first role that is included in the passed in roles array, otherwise hasRole is undefined\n    const hasRole = rolesUserHas.find((roleUserHas) => roles.includes(roleUserHas));\n\n    // if we found the role, then the user has permission for this shop. Add shopId to shopsWithPermission array\n    if (hasRole) {\n      shopsWithPermission.push(shopId);\n    }\n    return shopsWithPermission;\n  }, []);\n\n  return shopIdsWithRoles;\n}\n\n/**\n  * hasPermissionForAll -\n  * @summary return if the user has permissions for all the shops\n  * @param {Array} roles - roles to check if user has\n  * @param {String} userId - userId to check permissions for (defaults to current user)\n  * @param {Array} shopsOfUser - shopIds to be checked\n  * @return {Boolean} - true if the user has permissions for all the shops\n  */\nfunction hasPermissionForAll(roles, userId = Meteor.userId(), shopsOfUser) {\n  return !isEqual(getShopsForUser([\"admin\"], userId), shopsOfUser);\n}\n\nconst Reaction = Object.assign(Core.Reaction, {\n  isPackageEnabled,\n  getSeller,\n  getSellerShopId,\n  getSellerShop,\n  getShopsForUser,\n  hasPermissionForAll\n});\n\nexport { Reaction };\n","import url from \"url\";\nimport { parse, isValidNumber, getPhoneCode } from \"libphonenumber-js\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Router } from \"/imports/plugins/core/router/lib\";\nimport { Shops } from \"/lib/collections\";\n\n// Array of ISO Language codes for all languages that use latin based char sets\n// list is based on this matrix http://w3c.github.io/typography/gap-analysis/language-matrix.html\n// list of lang codes https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\nexport const latinLangs = [\"az\", \"da\", \"de\", \"en\", \"es\", \"ff\", \"fr\", \"ha\", \"hr\", \"hu\", \"ig\", \"is\", \"it\", \"jv\", \"ku\", \"ms\", \"nl\", \"no\", \"om\", \"pl\", \"pt\", \"ro\", \"sv\", \"sw\", \"tl\", \"tr\", \"uz\", \"vi\", \"yo\"]; // eslint-disable-line max-len\n\n// dynamic import of slugiy/transliteration.slugify\nlet slugify;\nasync function lazyLoadSlugify() {\n  let mod;\n  // getting the shops base language\n  let lang;\n  if (Meteor.isServer) {\n    lang = getPrimaryShopLang();\n  } else {\n    lang = getShopLang();\n  }\n\n  // if slugify has been loaded but the language has changed\n  // to be a non latin based language then load transliteration\n  if (slugify && slugify.name === \"replace\" && latinLangs.indexOf(lang) === -1) {\n    mod = await import(\"transliteration\");\n  } else if (slugify) {\n    // if slugify/transliteration is loaded and no lang change\n    return;\n  } else if (latinLangs.indexOf(lang) >= 0) {\n    // if the shops language use latin based chars load slugify else load transliterations's slugify\n    mod = await import(\"slugify\");\n  } else {\n    mod = await import(\"transliteration\");\n  }\n  // slugify is exported to modules.default while transliteration is exported to modules.slugify\n  slugify = mod.default || mod.slugify;\n}\n\n\nlet Media;\nif (Meteor.isClient) {\n  ({ Media } = require(\"/imports/plugins/core/files/client\"));\n} else {\n  ({ Media } = require(\"/imports/plugins/core/files/server\"));\n}\n\n/**\n * @file Various helper methods\n *\n * @namespace Helpers\n */\n\nlet Core;\nif (Meteor.isClient) {\n  Core = require(\"/client/api\");\n} else {\n  Core = require(\"/server/api\");\n}\n\n/**\n * @name getShopId\n * @method\n * @memberof Helpers\n * @return {String} returns current shopId\n */\nexport function getShopId() {\n  return Core.Reaction.getShopId();\n}\n\n/**\n * @name getPrimaryShopId\n * @method\n * @memberof Helpers\n * @return {String} returns primary shopId\n */\nexport function getPrimaryShopId() {\n  return Core.Reaction.getPrimaryShopId();\n}\n\n/**\n * getShopSettings\n * @return {Object} returns current shop settings\n */\nexport function getShopSettings() {\n  return Core.Reaction.getShopSettings();\n}\n\n/**\n * @name getShopName\n * @method\n * @memberof Helpers\n * @return {String} returns current shop name\n */\nexport function getShopName() {\n  const shopId = getShopId();\n  let shop;\n  if (shopId) {\n    shop = Shops.findOne({\n      _id: shopId\n    });\n    return (shop && shop.name) || \"\";\n  }\n\n  const domain = url.parse(Meteor.absoluteUrl()).hostname;\n\n  shop = Shops.findOne({ domains: { $in: [domain] } });\n\n  return shop ? shop.name : \"\";\n}\n\n/**\n * @name getShopLang\n * @method\n * @memberof Helpers\n * @return {String} returns current shop language\n */\nexport function getShopLang() {\n  const shopId = getShopId();\n  const shop = Shops.findOne({ _id: shopId });\n  return shop ? shop.language : \"\";\n}\n\n/**\n * @name getPrimaryShopLang\n * @method\n * @memberof Helpers\n * @return {String} returns primary shop language\n */\nexport function getPrimaryShopLang() {\n  const shopId = getPrimaryShopId();\n  const shop = Shops.findOne({ _id: shopId });\n  return shop ? shop.language : \"\";\n}\n\n\n/**\n * @name getShopPrefix\n * @method\n * @memberof Helpers\n * @param {String} leading - Default \"/\", prefix, the prefix with a leading shash\n * @return {String} returns shop url prefix\n */\nexport function getShopPrefix(leading = \"/\") {\n  const shopId = getShopId();\n\n  if (shopId) {\n    const shop = Shops.findOne({\n      _id: shopId\n    }, {\n      fields: {\n        _id: 1,\n        name: 1,\n        shopType: 1\n      }\n    });\n\n    const settings = Core.Reaction.getMarketplaceSettings();\n    const slug = leading + getSlug(shop.slug || getShopName().toLowerCase());\n\n    if (shop.shopType === \"primary\") {\n      // If naked routes is turned off, use the shop slug for our primary shop routes\n      if (settings && settings.marketplaceNakedRoutes === false) {\n        return slug;\n      }\n\n      return \"\";\n    }\n\n    // If this is not the primary shop, use the shop slug in routes for this shop\n    // TODO: \"/shop\" should be configurable in marketplace settings\n    return `/shop${slug}`;\n  }\n\n  return \"\";\n}\n\n/**\n * @name getAbsoluteUrl\n * @method\n * @memberof Helpers\n * @param {String} path - path to append to absolute Url, path should be prefixed with / if necessary\n * @return {String} returns absolute url (shop prefix + path)\n */\nexport function getAbsoluteUrl(path) {\n  const prefix = getShopPrefix(\"\");\n  if (prefix) {\n    const absUrl = Meteor.absoluteUrl(`${prefix}/${path}`);\n    return absUrl;\n  }\n  const absUrl = Meteor.absoluteUrl(`${path}`);\n  return absUrl;\n}\n\n/**\n * @name getCurrentTag\n * @method\n * @memberof Helpers\n * @return {String} returns current tag\n */\nexport function getCurrentTag() {\n  if (Router.getRouteName() === \"tag\") {\n    return Router.current().params.slug;\n  }\n  return null;\n}\n\n/**\n * @name getSlug\n * @method\n * @memberof Helpers\n * @summary return a slugified string using \"slugify\" from transliteration\n * https://www.npmjs.com/package/transliteration\n * @param  {String} slugString - string to slugify\n * @return {String} slugified string\n */\nexport function getSlug(slugString) {\n  let slug;\n  Promise.await(lazyLoadSlugify());\n  if (slugString) {\n    slug = slugify(slugString.toLowerCase());\n  } else {\n    slug = \"\";\n  }\n  return slug;\n}\n\n/**\n * @name formatPhoneNumber\n * @method\n * @memberof Helpers\n * @summary prepends country code to phone no. if required\n * @param  {String} phone the original phone no.\n * @param  {String} countryCode the country's code to which the phone no. belongs to\n * @return {String} the phone no. with country extension.\n */\nexport function formatPhoneNumber(phone, countryCode) {\n  try {\n    // phone no. already has the country code attached\n    if (isValidNumber(phone)) {\n      return phone;\n    }\n    const phoneNumber = parse(phone, countryCode).phone;\n    const countryExtension = getPhoneCode(countryCode);\n    if (phoneNumber && countryExtension) {\n      // try attaching the country code to phone number\n      return `${countryExtension}${phoneNumber}`;\n    }\n    throw new Meteor.Error(\"invalid-parameter\", `Incorrect format for phone number ${phone} with country ${countryCode}`);\n  } catch (error) {\n    throw new Meteor.Error(\"invalid-parameter\", error);\n  }\n}\n\n/**\n * @name toCamelCase\n * @method\n * @memberof Helpers\n * @summary helper for i18n - special toCamelCase for converting a string to camelCase for use with i18n keys\n * @param {String} needscamels String to be camel cased.\n * @return {String} camelCased string\n */\nexport function toCamelCase(needscamels) {\n  let s;\n  s = needscamels.replace(/([^a-zA-Z0-9_\\- ])|^[_0-9]+/g, \"\").trim().toLowerCase();\n  s = s.replace(/([ -]+)([a-zA-Z0-9])/g, (a, b, c) => c.toUpperCase());\n  s = s.replace(/([0-9]+)([a-zA-Z])/g, (a, b, c) => b + c.toUpperCase());\n  return s;\n}\n\n/**\n * @name translateRegistry\n * @method\n * @memberof Helpers\n * @summary adds i18n strings to registry object\n * @param {Object} registry registry object\n * @param {Object} [app] complete package object\n * @return {Object} with updated registry\n */\nexport function translateRegistry(registry, app) {\n  let registryLabel = \"\";\n  let i18nKey = \"\";\n  // first we check the default place for a label\n  if (registry.label) {\n    registryLabel = toCamelCase(registry.label);\n    i18nKey = `admin.${registry.provides}.${registryLabel}`;\n    // and if we don\"t find it, we are trying to look at first\n    // registry entry\n  } else if (app && app.registry && app.registry.length &&\n    app.registry[0].label) {\n    registryLabel = toCamelCase(app.registry[0].label);\n    i18nKey = `admin.${app.registry[0].provides}.${registryLabel}`;\n  }\n  registry.i18nKeyLabel = `${i18nKey}Label`;\n  registry.i18nKeyDescription = `${i18nKey}Description`;\n  registry.i18nKeyPlaceholder = `${i18nKey}Placeholder`;\n  registry.i18nKeyTooltip = `${i18nKey}Tooltip`;\n  registry.i18nKeyTitle = `${i18nKey}Title`;\n  // return registry object with added i18n keys\n  return registry;\n}\n\n/**\n * @name isObject\n * @method\n * @memberof Helpers\n * @summary Simple is object check.\n * @param {Object} item item to check if is an object\n * @returns {boolean} return true if object\n */\nexport function isObject(item) {\n  return (item && typeof item === \"object\" && !Array.isArray(item) && item !== null);\n}\n\n/**\n * @name mergeDeep\n * @method\n * @memberof Helpers\n * @summary Helper for Deep merge two objects.\n * @param {Object} target deep merge into this object\n * @param {Object} source merge this object\n * @returns {Object} return deep merged object\n */\nexport function mergeDeep(target, source) {\n  if (isObject(target) && isObject(source)) {\n    Object.keys(source).forEach((key) => {\n      if (isObject(source[key])) {\n        if (!target[key]) Object.assign(target, { [key]: {} });\n        mergeDeep(target[key], source[key]);\n      } else {\n        Object.assign(target, { [key]: source[key] });\n      }\n    });\n  }\n  return target;\n}\n\n/**\n * @name convertWeight\n * @method\n * @memberOf Helpers\n * @summary Convert weight from/to different Units of Measure\n * @param {String} from The UOM to convert from\n * @param {String} to The UOM to convert to\n * @param {Number} weight The value to convert\n * @returns {Number} The converted value\n */\nexport function convertWeight(from, to, weight) {\n  check(from, String); // we need to check for specific values\n  check(to, String);\n  check(weight, Number);\n\n  if (from === to) {\n    return weight;\n  }\n  // grams\n  if (from === \"lb\" && to === \"g\") {\n    const convertedWeight = weight * 453.592;\n    return convertedWeight;\n  }\n\n  if (from === \"kg\" && to === \"g\") {\n    const convertedWeight = weight * 1000;\n    return convertedWeight;\n  }\n\n  if (from === \"oz\" && to === \"g\") {\n    const convertedWeight = weight * 28.3495;\n    return convertedWeight;\n  }\n\n  // lbs\n  if (from === \"kg\" && to === \"lb\") {\n    const convertedWeight = weight * 2.20462;\n    return convertedWeight;\n  }\n\n  if (from === \"g\" && to === \"lb\") {\n    const convertedWeight = weight * 0.00220462;\n    return convertedWeight;\n  }\n\n  if (from === \"oz\" && to === \"lb\") {\n    const convertedWeight = weight * 0.0625;\n    return convertedWeight;\n  }\n\n  // oz\n  if (from === \"lb\" && to === \"oz\") {\n    const convertedWeight = weight * 16;\n    return convertedWeight;\n  }\n\n  if (from === \"g\" && to === \"oz\") {\n    const convertedWeight = weight * 0.035274;\n    return convertedWeight;\n  }\n\n  if (from === \"kg\" && to === \"oz\") {\n    const convertedWeight = weight * 35.274;\n    return convertedWeight;\n  }\n\n  // kilograms\n  if (from === \"g\" && to === \"kg\") {\n    const convertedWeight = weight * 0.001;\n    return convertedWeight;\n  }\n\n  if (from === \"oz\" && to === \"kg\") {\n    const convertedWeight = weight * 0.0283495;\n    return convertedWeight;\n  }\n\n  if (from === \"lb\" && to === \"kg\") {\n    const convertedWeight = weight * 0.453592;\n    return convertedWeight;\n  }\n  // if we made it here, something has gone wrong\n  throw new Meteor.Error(\"invalid-parameter\", \"Invalid from or to value specified\");\n}\n\n/**\n * @name getPrimaryMediaForItem\n * @summary Gets the FileRecord for the primary media item associated with the variant or product\n *   for the given item\n * @param {Object} item Must have `productId` and/or `variantId` set to get back a result.\n * @return {FileRecord|null}\n */\nexport function getPrimaryMediaForItem({ productId, variantId } = {}) {\n  let result;\n\n  if (variantId) {\n    result = Media.findOneLocal({\n      \"metadata.variantId\": variantId\n    }, { sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 } });\n  }\n\n  if (!result && productId) {\n    result = Media.findOneLocal({\n      \"metadata.productId\": productId\n    }, { sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 } });\n  }\n\n  return result || null;\n}\n\n/**\n * @name getPrimaryMediaForOrderItem\n * @summary Gets the FileRecord for the primary media item associated with the variant or product\n *   for the given item\n * @param {Object} item Must have `productId` and/or `variants._id` set to get back a result.\n * @return {FileRecord|null}\n */\nexport function getPrimaryMediaForOrderItem({ productId, variants } = {}) {\n  const { _id: variantId } = variants || {}; // Order item format\n  return getPrimaryMediaForItem({ productId, variantId });\n}\n\n/*\n * @name luhnValid\n * @method\n * @memberOf Helpers\n * @summary Checks if a number passes Luhn's test\n * @param {String} cardNumber The card number to check\n * @returns {Boolean} The result of the test\n */\nfunction luhnValid(cardNumber) {\n  return [...cardNumber].reverse().reduce((sum, c, i) => {\n    let d = parseInt(c, 10);\n    if (i % 2 !== 0) { d *= 2; }\n    if (d > 9) { d -= 9; }\n    return sum + d;\n  }, 0) % 10 === 0;\n}\n\n// Regex to do card validations\nexport const ValidCardNumber = Match.Where((x) => /^[0-9]{12,19}$/.test(x) && luhnValid(x));\n\nexport const ValidExpireMonth = Match.Where((x) => /^[0-9]{1,2}$/.test(x));\n\nexport const ValidExpireYear = Match.Where((x) => /^[0-9]{4}$/.test(x));\n\nexport const ValidCVV = Match.Where((x) => /^[0-9]{3,4}$/.test(x));\n\n// Email regex\nexport const ValidEmail = (x) => /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/.test(x); // eslint-disable-line max-len\n","export * from \"./account-validation\";\nexport { default as Catalog } from \"./catalog\";\nexport { default as ReactionProduct } from \"./products\";\nexport { PropTypes } from \"./prop-types\";\nexport * from \"./core\";\nexport * from \"./helpers\";\n","import { Match } from \"meteor/check\";\n\n/**\n * @file **Meteor Match** - Extending {@link http://docs.meteor.com/api/check.html Meteor Match} argument checking\n * @see https://github.com/meteor/meteor/tree/master/packages/check\n * @extends Meteor/Check\n * @namespace Match\n */\n\n/**\n * @name OptionalOrNull\n * @method\n * @memberof Match\n * @summary Return whether an argument is optional or null\n * @example check(options, Match.OptionalOrNull(Object))\n * @param {String} pattern - match pattern\n * @return {Boolean} matches - void, null, or pattern\n */\nMatch.OptionalOrNull = function (pattern) {\n  return Match.OneOf(undefined, null, pattern);\n};\n\n/**\n * @name OrderHookOption\n * @method\n * @memberof Match\n * @example check(options, Match.OrderHookOptions())\n * @return {Boolean} matches - void, null, or pattern\n */\nMatch.OrderHookOptions = function () {\n  return Match.OneOf(Object);\n};\n","import i18next from \"i18next\";\nimport orderBy from \"lodash/orderBy\";\nimport _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactiveDict } from \"meteor/reactive-dict\";\nimport { ReactiveVar } from \"meteor/reactive-var\";\nimport { Router } from \"/imports/plugins/core/router/lib\";\nimport { getCurrentTag, getShopName } from \"/lib/api\";\nimport { Products, Revisions } from \"/lib/collections\";\nimport Catalog from \"./catalog\";\nimport { MetaData } from \"/lib/api/router/metadata\";\n\n/**\n * @file ReactionProduct is only intended to be used on the client, but it's placed\n * in common code because it is imported by the Products schema.\n * ReactionProduct is a\n * {@link https://github.com/meteor/meteor/blob/master/packages/reactive-dict/README.md| ReactiveDict},\n * a general-purpose reactive datatype to use with\n * {@link https://github.com/meteor/meteor/tree/master/packages/tracker|Meteor Tracker}.\n * ReactionProduct allows the current product to be reactive, without Session.\n * @namespace ReactionProduct\n */\n\n/**\n * @name ReactionProduct\n * @method\n * @memberof ReactionProduct\n * @summary Reactive current product dependency, ensuring reactive products, without session\n * ReactionProduct is a `ReactiveDict`, a general-purpose reactive datatype to use with Meteor Tracker.\n * @see {@link https://github.com/meteor/meteor/blob/master/packages/reactive-dict/README.md|Meteor ReactiveDict}\n * @see {@link https://github.com/meteor/meteor/tree/master/packages/tracker|Meteor Tracker}\n * @todo this is a messy class implementation, normalize it.\n */\nconst ReactionProduct = new ReactiveDict(\"currentProduct\");\n\n/**\n * @name applyProductRevision\n * @method\n * @memberof ReactionProduct\n * @summary Apply revision to product\n * @example applyProductRevision(product)\n * @param  {Object} product product\n * @return {Object|null} product or null, if no product found\n */\nexport function applyProductRevision(product) {\n  if (product) {\n    if (product.__revisions && product.__revisions.length) {\n      const cleanProduct = Object.assign({}, product);\n      delete cleanProduct.__revisions;\n      let revisedProduct;\n      // check for product revisions and set that as the current product\n      for (const revision of product.__revisions) {\n        if (!revision.parentDocument) {\n          revisedProduct = product.__revisions[0].documentData;\n        }\n      }\n\n      // if there are no revision to product (image and/or tag only) just set the original product as the product\n      if (!revisedProduct) {\n        revisedProduct = cleanProduct;\n      }\n\n      return Object.assign(\n        {},\n        revisedProduct,\n        {\n          __published: cleanProduct,\n          __draft: product.__revisions[0]\n        }\n      );\n    }\n    return product;\n  }\n\n  return null;\n}\n\n/**\n * @name variantIsSelected\n * @method\n * @memberof ReactionProduct\n * @param  {String} variantId ID of variant to check\n * @return {Boolean}          True if variant is selected\n */\nexport function variantIsSelected(variantId) {\n  const current = Object.assign({}, ReactionProduct.selectedVariant());\n  if (current.ancestors && (variantId === current._id || current.ancestors.indexOf(variantId) >= 0)) {\n    return true;\n  }\n  return false;\n}\n\n/**\n * @name sortProducts\n * @method\n * @memberof ReactionProduct\n * @summary Sort products by tag, creation date by tag and creation date\n * @param  {Array} products Array of products\n * @param  {String} tag     Tag\n * @return {Array}         Array of products\n */\nReactionProduct.sortProducts = (products, tag) => {\n  let sorted = [];\n\n  sorted = orderBy(\n    products,\n    // Sort by postion for tag\n    (product) => product.positions && product.positions[tag] && product.positions[tag].position,\n    // Then by creation date for tag\n    (product) => product.positions && product.positions[tag] && product.positions[tag].createdAt,\n    // Finally sort by creation date\n    \"createdAt\"\n  );\n\n  return sorted;\n};\n\n/**\n * @name setCurrentVariant\n * @method\n * @memberof ReactionProduct\n * @param {String} variantId - set current variantId\n * @return {undefined}\n */\nReactionProduct.setCurrentVariant = (variantId) => {\n  if (variantId === null) {\n    ReactionProduct.set(\"variantId\", null);\n    ReactionProduct.set(\"variantId\", ReactionProduct.selectedVariantId());\n  }\n  if (!variantId) {\n    return;\n  }\n  const currentId = ReactionProduct.selectedVariantId();\n  if (currentId === variantId) {\n    return;\n  }\n  ReactionProduct.set(\"variantId\", variantId);\n};\n\n/**\n * @name setProduct\n * @todo this will be deprecated in favor of template.instance data.\n * @method\n * @memberof ReactionProduct\n * @summary method to set default/parameterized product variant\n * @param {String} currentProductId - set current productId\n * @param {String} currentVariantId - set current variantId\n * @return {Object} product object\n */\nReactionProduct.setProduct = (currentProductId, currentVariantId) => {\n  let productId = currentProductId || Router.getParam(\"handle\");\n  let variantId = currentVariantId || Router.getParam(\"variantId\");\n\n  // Find the current product\n  const product = Products.findOne({\n    $or: [\n      { handle: productId.toLowerCase() }, // Try the handle (slug) lowercased\n      { handle: productId }, // Otherwise try the handle (slug) untouched\n      { _id: productId }, // try the product id\n      { changedHandleWas: productId } // Last attempt: the permalink may have changed.\n    ]\n  });\n\n  productId = product && product._id;\n\n  if (product) {\n    if (Router.getParam(\"handle\") !== product.handle && product.changedHandleWas && product.changedHandleWas !== product.handle) {\n      const newUrl = Router.pathFor(\"product\", {\n        hash: {\n          handle: product.handle\n        }\n      });\n      Router.go(newUrl);\n    }\n\n    // Check if selected variant id really belongs to the product.\n    // This has been working previously rather accidentally, because variantIsSelected(variantId) below returned always false,\n    // because the Product subscription ensured, that the correct Product is in Mini-Mongo. This is not guaranteed, though.\n    // If Products collection would have other products, it would fail.\n    let isVariantValidChild = true;\n    const variants = Products.find({\n      ancestors: { $in: [productId] }\n    }).map((variant) => variant._id);\n    if (variantId && !variants.includes(variantId)) {\n      isVariantValidChild = false;\n    }\n\n    // set the default variant\n    // as the default.\n    if (!isVariantValidChild || !variantId || !variantIsSelected(variantId)) {\n      const topVariants = ReactionProduct.getTopVariants(productId);\n      variantId = (Array.isArray(topVariants) && topVariants.length && topVariants[0]._id) || null;\n    }\n    // set in our reactive dictionary\n    ReactionProduct.set(\"productId\", productId);\n    ReactionProduct.set(\"variantId\", variantId);\n  }\n\n  // Update the meta data when a product is selected\n  MetaData.init(Router.current());\n\n  return applyProductRevision(product);\n};\n\n/**\n * @name selectedProductId\n * @method\n * @memberof ReactionProduct\n * @summary get the currently active/requested product\n * @return {String} currently selected product id\n */\nReactionProduct.selectedProductId = () => ReactionProduct.get(\"productId\");\n\n/**\n * @name selectedVariantId\n * @method\n * @memberof ReactionProduct\n * @summary get the currently active/requested variant\n * @return {String} currently selected variant id\n */\nReactionProduct.selectedVariantId = () => {\n  let id = ReactionProduct.get(\"variantId\");\n  if (id !== null) {\n    return id;\n  }\n  const variants = ReactionProduct.getVariants();\n\n  if (!(variants.length > 0)) {\n    return [];\n  }\n\n  id = variants[0]._id;\n  // ReactionProduct.set(\"variantId\", id);\n  return id;\n};\n\n/**\n * @name selectedVariant\n * @method\n * @memberof ReactionProduct\n * @summary get the currently active/requested variant object\n * @return {Object} currently selected variant object\n */\nReactionProduct.selectedVariant = function () {\n  const id = ReactionProduct.selectedVariantId();\n  if (typeof id === \"string\") {\n    return applyProductRevision(Products.findOne(id));\n  }\n  return [];\n};\n\n/**\n * @name selectedTopVariant\n * @method\n * @memberof ReactionProduct\n * @summary get the currently active TOP variant object\n * @return {Object} currently selected TOP variant object\n */\nReactionProduct.selectedTopVariant = function () {\n  const topVariants = ReactionProduct.getTopVariants();\n  const topVariant = topVariants.find((variant) => variantIsSelected(variant._id));\n\n  return topVariant;\n};\n\n/**\n * @name selectedProduct\n * @method\n * @memberof ReactionProduct\n * @summary get the currently active/requested product object\n * @return {Object|undefined} currently selected product cursor\n */\nReactionProduct.selectedProduct = function () {\n  const id = ReactionProduct.selectedProductId();\n  if (typeof id === \"string\") {\n    return applyProductRevision(Products.findOne(id));\n  }\n  return undefined;\n};\n\n/**\n * @name checkChildVariants\n * @method\n * @memberof ReactionProduct\n * @summary return number of child variants for a parent\n * @param {String} parentVariantId - parentVariantId\n * @return {Number} count of childVariants for this parentVariantId\n */\nReactionProduct.checkChildVariants = function (parentVariantId) {\n  const childVariants = ReactionProduct.getVariants(parentVariantId);\n  return childVariants.length ? childVariants.length : 0;\n};\n\n/**\n * @name checkInventoryVariants\n * @method\n * @memberof ReactionProduct\n * @summary return number of inventory variants for a parent\n * @param {String} parentVariantId - parentVariantId\n * @todo could be combined with checkChildVariants in one method\n * @todo inventoryVariants are deprecated. remove this.\n * @return {Number} count of inventory variants for this parentVariantId\n */\nReactionProduct.checkInventoryVariants = function (parentVariantId) {\n  const inventoryVariants = ReactionProduct.getVariants(parentVariantId, \"inventory\");\n  return inventoryVariants.length ? inventoryVariants.length : 0;\n};\n\n/**\n * @name getVariantPriceRange\n * @method\n * @memberof ReactionProduct\n * @summary get price range of a variant if it has child options.\n * if no child options, return main price value\n * @todo remove string return and replace with object\n * @param {String} [id] - current variant _Id\n * @return {String} formatted price or price range\n */\n\nReactionProduct.getVariantPriceRange = (id) => Catalog\n  .getVariantPriceRange(id || ReactionProduct.selectedVariant()._id);\n\n/**\n * @name getProductPriceRange\n * @method\n * @memberof ReactionProduct\n * @summary get price range of a product\n * if no only one price available, return it\n * otherwise return a string range\n * @todo remove string return and replace with object\n * @param {String} [id] - current product _id\n * @return {String} formatted price or price range\n */\n\nReactionProduct.getProductPriceRange = (id) => Catalog\n  .getProductPriceRange(id || ReactionProduct.selectedProductId());\n\n/**\n * @name getVariantQuantity\n * @method\n * @memberof ReactionProduct\n * @summary middleware method which calls the same named common method.\n * @todo maybe we could remove this after 1.3. But for now I like how it looks.\n * @param {Object} doc - variant object\n * @return {Number} summary of options quantity or top-level variant\n * inventoryQuantity\n */\nReactionProduct.getVariantQuantity = (doc) => Catalog.getVariantQuantity(doc);\n\n/**\n * @method getProduct\n * @method\n * @memberof ReactionProduct\n * @summary Get product object. Could be useful for products and for top level variants\n * @param {String} [id] - product _id\n * @return {Object} Product data\n */\nReactionProduct.getProduct = (id) => Catalog.getProduct(id);\n\n/**\n * @method getVariants\n * @method\n * @memberof ReactionProduct\n * @summary Get all parent variants. Could be useful for products and for top level variants\n * @param {String} [id] - product _id\n * @param {String} [type] - type of variant\n * @return {Array} Parent variants or empty array\n */\nReactionProduct.getVariants = (id, type) => Catalog.getVariants(id || ReactionProduct.selectedProductId(), type);\n\n/**\n * @method getSiblings\n * @method\n * @memberof ReactionProduct\n * @summary Get all sibling variants - variants with the same ancestor tree\n * could be useful for child variants relationships with top-level variants\n * @param {Object} [variant] - product / variant object\n * @param {String} [type] - type of variant\n * @param {Boolean} [includeSelf] - include current variant in results\n * @return {Array} Sibling variants or empty array\n */\nReactionProduct.getSiblings = (variant, type) => Catalog.getSiblings(variant, type);\n\n/**\n * @method getVariantParent\n * @method\n * @memberof ReactionProduct\n * @summary Get direct parent variant - could be useful for lower level variants to get direct parents\n * @param {Object} [variant] - product / variant object\n * @return {Array} Parent variant or empty\n */\nReactionProduct.getVariantParent = (variant) => Catalog.getVariantParent(variant);\n\n/**\n * @method getTopVariants\n * @summary Get only product top level variants\n * @param {String} [id] - product _id\n * @return {Array} Product top level variants or empty array\n */\nReactionProduct.getTopVariants = (id) => Catalog.getTopVariants(id || ReactionProduct.selectedProductId());\n\n/**\n * @name getTag\n * @method\n * @memberof ReactionProduct\n * @summary This needed for naming `positions` object. Method could return `tag`\n * route name or shop name as default name.\n * @return {String} tag name or shop name\n */\nReactionProduct.getTag = () => getCurrentTag() || getShopName().toLowerCase();\n\n/**\n * @name getProductsByTag\n * @method\n * @memberof ReactionProduct\n * @summary method to return tag specific product\n * @param {String} tag - tag string\n * @return {Object} - return products collection cursor filtered by tag\n */\nReactionProduct.getProductsByTag = function (tag) {\n  let hashtags;\n  let newRelatedTags;\n  let relatedTag;\n  let relatedTags;\n  const selector = {};\n\n  if (tag) {\n    hashtags = [];\n    relatedTags = [tag];\n    while (relatedTags.length) {\n      newRelatedTags = [];\n      for (relatedTag of relatedTags) {\n        if (hashtags.indexOf(relatedTag._id) === -1) {\n          hashtags.push(relatedTag._id);\n        }\n      }\n      relatedTags = newRelatedTags;\n    }\n    selector.hashtags = {\n      $in: hashtags\n    };\n  }\n  const cursor = Products.find(selector);\n  return cursor;\n};\n\n/**\n * @name publishProduct\n * @method\n * @memberof ReactionProduct\n * @summary product publishing and alert\n * @todo review process for publishing arrays of product\n * @param {Object} productOrArray - product Object\n * @returns {undefined} - returns nothing, and alerts, happen here\n */\nReactionProduct.publishProduct = function (productOrArray) {\n  const products = !_.isArray(productOrArray) ? [productOrArray] : productOrArray;\n  /* eslint no-loop-func: 1 */\n  for (const product of products) {\n    Meteor.call(\"products/publishProduct\", product._id, (error, result) => { // eslint-disable-line no-loop-func\n      if (error) {\n        Alerts.add(error, \"danger\", {\n          placement: \"productGridItem\",\n          id: product._id\n        });\n        throw new Meteor.Error(\"error-occurred\", error);\n      }\n      const alertSettings = {\n        placement: \"productGridItem\",\n        id: product._id,\n        autoHide: true,\n        dismissable: false\n      };\n      if (result) {\n        Alerts.add(i18next.t(\"productDetail.publishProductVisible\", { product: product.title }), \"success\", alertSettings);\n      } else {\n        Alerts.add(i18next.t(\"productDetail.publishProductHidden\", { product: product.title }), \"warning\", alertSettings);\n      }\n    });\n  }\n};\n\n/**\n * @name toggleVisibility\n * @method\n * @memberof ReactionProduct\n * @summary product publishing and alert\n * @param {Object} productOrArray - product Object\n * @returns {undefined} - returns nothing, and alerts, happen here\n */\nReactionProduct.toggleVisibility = function (productOrArray) {\n  const products = !_.isArray(productOrArray) ? [productOrArray] : productOrArray;\n  for (const product of products) {\n    Meteor.call(\"products/toggleVisibility\", product._id, (error, result) => { // eslint-disable-line no-loop-func\n      if (error) {\n        Alerts.add(error, \"danger\", {\n          placement: \"productGridItem\",\n          id: product._id\n        });\n        throw new Meteor.Error(\"error-occurred\", error);\n      }\n      const alertSettings = {\n        placement: \"productGridItem\",\n        id: product._id,\n        autoHide: true,\n        dismissable: false\n      };\n      if (result) {\n        Alerts.add(i18next.t(\"productDetail.publishProductVisible\", { product: product.title }), \"success\", alertSettings);\n      } else {\n        Alerts.add(i18next.t(\"productDetail.publishProductHidden\", { product: product.title }), \"warning\", alertSettings);\n      }\n    });\n  }\n};\n\n/**\n * A reactive data source that tells any dependents that they should resubscribe their\n * active publication.\n * @type {ReactiveVar}\n */\nexport const resubscribeAfterCloning = new ReactiveVar(false);\n\n\n/**\n * @name cloneProduct\n * @method\n * @memberof ReactionProduct\n * @summary product cloning and alert\n * @param {Object|Array} productOrArray - if this method calls from productGrid\n * it receives and array with product _id or _ids, but if it calls from PDP, when\n * it receive a `Object` with _id. It needed to determine the source of call.\n * @returns {undefined} - returns nothing, and alerts, happen here\n */\nReactionProduct.cloneProduct = function (productOrArray) {\n  const products = !Array.isArray(productOrArray) ? [productOrArray] : productOrArray;\n\n  return Meteor.call(\"products/cloneProduct\", products, (error, result) => {\n    if (error) {\n      Alerts.add(error, \"danger\", { placement: \"productGridItem\" });\n      throw new Meteor.Error(\"error-occurred\", error);\n    }\n    if (result) {\n      if (products.length === 1) {\n        Alerts.add(i18next.t(\"productDetail.clonedAlert\", { product: products[0].title }), \"success\", {\n          placement: \"productGridItem\",\n          id: products[0]._id,\n          autoHide: true,\n          dismissable: false\n        });\n      } else {\n        Alerts.add(\n          i18next.t(\"productDetail.clonedAlert_plural\", { product: i18next.t(\"productDetail.theSelectedProducts\"), count: 0 }),\n          \"success\", {\n            placement: \"productGridItem\",\n            id: products[0]._id,\n            autoHide: true,\n            dismissable: false\n          }\n        );\n      }\n    }\n    // this statement allow us to redirect to a new clone PDP if clone action\n    // was fired within PDP, not within productGrid.\n    if (!Array.isArray(productOrArray)) {\n      Router.go(\"product\", {\n        handle: result[0]\n      });\n    } else {\n      resubscribeAfterCloning.set(true);\n    }\n  });\n};\n\n/**\n * @name archiveProduct\n * @method\n * @memberof ReactionProduct\n * @summary confirm to archive product\n * @param {Object} productOrArray - product Object\n * @returns {undefined} - returns nothing, and alerts, happen here\n */\nReactionProduct.archiveProduct = function (productOrArray) {\n  const products = !Array.isArray(productOrArray) ? [productOrArray] : productOrArray;\n  const productIds = products.map((product) => (typeof product === \"string\" ? product : product._id));\n  let confirmTitle;\n  // we have to use so difficult logic with `length` check because of some\n  // languages, which have different phrase forms for each of cases.\n  // we are using i18next `plural` functionality here.\n  // @see: http://i18next.com/translate/pluralSimple\n  if (products.length === 1) {\n    confirmTitle = i18next.t(\"productDetailEdit.archiveThisProduct\");\n  } else {\n    confirmTitle = i18next.t(\"productDetailEdit.archiveSelectedProducts\");\n  }\n\n  Alerts.alert({\n    title: confirmTitle,\n    type: \"warning\",\n    showCancelButton: true,\n    confirmButtonText: \"Archive\"\n  }, (isConfirm) => {\n    if (isConfirm) {\n      Meteor.call(\"products/archiveProduct\", productIds, (error, result) => {\n        let title;\n        if (error) {\n          title = products.length === 1 ?\n            products[0].title || i18next.t(\"productDetail.archiveErrorTheProduct\") :\n            i18next.t(\"productDetail.theSelectedProducts\");\n          Alerts.toast(i18next.t(\"productDetail.productArchiveError\", { product: title }), \"error\");\n          throw new Meteor.Error(`error-occurred${title}`, error);\n        }\n        if (result) {\n          Router.go(\"/\");\n          if (products.length === 1) {\n            title = products[0].title || i18next.t(\"productDetail.theProduct\");\n            Alerts.toast(i18next.t(\"productDetail.archivedAlert\", { product: title }), \"info\");\n          } else {\n            title = i18next.t(\"productDetail.theSelectedProducts\");\n            Alerts.toast(i18next.t(\"productDetail.archivedAlert_plural\", { product: title, count: 0 }), \"info\");\n          }\n        }\n      });\n    }\n  });\n};\n\n/**\n * @name isAncestorDeleted\n * @method\n * @memberof ReactionProduct\n * @summary Verify there are no deleted ancestors\n * Variants cannot be restored if their parent product / variant is deleted\n * @param  {Object} product     product Object\n * @param  {Boolean} includeSelf include product\n * @return {Boolean}             True or false\n */\nReactionProduct.isAncestorDeleted = function (product, includeSelf) {\n  const productIds = [\n    ...product.ancestors // Avoid mutations\n  ];\n\n  if (includeSelf) {\n    productIds.push(product._id);\n  }\n\n  // Verify there are no deleted ancestors,\n  // Variants cannot be restored if their parent product / variant is deleted\n  const archivedCount = Revisions.find({\n    \"documentId\": { $in: productIds },\n    \"documentData.isDeleted\": true,\n    \"workflow.status\": {\n      $nin: [\n        \"revision/published\"\n      ]\n    }\n  }).count();\n\n  if (archivedCount > 0) {\n    return true;\n  }\n\n  return false;\n};\n\nexport default ReactionProduct;\n","import _ from \"lodash\";\nimport { check } from \"meteor/check\";\nimport * as Schemas from \"/lib/collections/schemas\";\n\n/**\n * @file **PropTypes** - React Component PropTypes methods for validating Tags\n *\n * @namespace PropTypes\n */\n\nconst TagSchema = Schemas.Tag.newContext();\n\nexport const PropTypes = {};\n\n/**\n * @name Tag\n * @summary React Component PropTypes validator for a single Tag\n * @method\n * @memberof PropTypes\n * @param  {Object} props An object containing all props passed into the component\n * @param  {String} propName Name of prop to validate\n * @return {Error|undefined} returns an error if validation us unseccessful\n */\nPropTypes.Tag = (props, propName) => {\n  check(props, Object);\n  check(propName, String);\n\n  if (_.isEmpty(props[propName]) === false) {\n    if (TagSchema.validate(props[propName]) === false) {\n      return new Error(\"Tag must be of type: Schemas.Tag\");\n    }\n  }\n};\n\n/**\n * @name arrayOfTags\n * @summary React Component PropTypes validator for an array of Tags\n * @method\n * @memberof PropTypes\n * @param  {Object} props An object containing all props passed into the component\n * @param  {String} propName Name of prop to validate\n * @return {Error|undefined} returns an error if validation us unseccessful\n */\nPropTypes.arrayOfTags = (props, propName) => {\n  check(props, Object);\n  check(propName, String);\n\n  if (_.isEmpty(props[propName]) === false && _.isArray(props[propName])) {\n    const valid = _.every(props[propName], (tag) => TagSchema.validate(tag));\n\n    if (valid === false) {\n      return new Error(\"Objects in array must be of type: Schemas.Tag\");\n    }\n  }\n};\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, shopIdAutoValue, updatedAtAutoValue } from \"./helpers\";\nimport { Address } from \"./address\";\nimport { Metafield } from \"./metafield\";\n\n/**\n * @typedef {SimpleSchema} SimpleSchema\n * @summary SimpleSchema for Collections - Reaction uses {@link https://github.com/aldeed/meteor-simple-schema SimpleSchema} to apply basic content and structure validation to Collections. See {@link https://docs.reactioncommerce.com/reaction-docs/master/simple-schema full documentation}.\n */\n\n/**\n * @file Reaction Core schemas\n * Reaction uses {@link https://github.com/aldeed/meteor-simple-schema SimpleSchema} to apply basic content and structure validation to Collections.\n * See {@link https://docs.reactioncommerce.com/reaction-docs/master/simple-schema full documentation}.\n * @namespace schemas\n */\n\n/**\n * @name TaxSettings\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} exemptionNo optional\n * @property {String} customerUsageType optional\n */\nconst TaxSettings = new SimpleSchema({\n  exemptionNo: {\n    type: String,\n    optional: true\n  },\n  customerUsageType: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"TaxSettings\", TaxSettings);\n\n/**\n * @name Profile\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {Address[]} addressBook optional, array of Addresses\n * @property {Boolean} invited optional\n * @property {String} name optional\n * @property {String} picture optional\n * @property {String} bio optional\n * @property {String} username optional\n * @property {String} currency User currency\n */\nexport const Profile = new SimpleSchema({\n  \"addressBook\": {\n    type: Array,\n    optional: true\n  },\n  \"addressBook.$\": {\n    type: Address\n  },\n  \"invited\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"name\": {\n    type: String,\n    optional: true\n  },\n  \"picture\": {\n    type: String,\n    optional: true\n  },\n  \"bio\": {\n    type: String,\n    optional: true\n  },\n  \"username\": {\n    type: String,\n    optional: true\n  },\n  \"currency\": {\n    label: \"User Currency\",\n    type: String,\n    optional: true\n  },\n  \"preferences\": {\n    label: \"User preferences\",\n    type: Object,\n    blackbox: true,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Profile\", Profile);\n\n/**\n * @name Email\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} provides optional\n * @property {String} address required\n * @property {Boolean} verified optional\n */\nexport const Email = new SimpleSchema({\n  provides: {\n    type: String,\n    defaultValue: \"default\",\n    optional: true\n  },\n  address: {\n    type: String,\n    regEx: SimpleSchema.RegEx.Email\n  },\n  verified: {\n    type: Boolean,\n    defaultValue: false,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Email\", Email);\n\n/**\n * @name Accounts\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} userId required\n * @property {String[]} sessions optional, Array of strings\n * @property {String} shopId required\n * @property {String} name optional\n * @property {String} username optional\n * @property {Email[]} emails optional, Array of strings\n * @property {Boolean} acceptsMarketing optional\n * @property {String} state optional\n * @property {TaxSettings} taxSettings optional\n * @property {String} note optional\n * @property {Profile} profile optional\n * @property {String[]} groups optional, Array of groupIds of the groups the user belongs to\n * @property {Metafield[]} metafields optional\n * @property {Date} createdAt required\n * @property {Date} updatedAt optional\n */\nexport const Accounts = new SimpleSchema({\n  \"userId\": {\n    type: String,\n    regEx: SimpleSchema.RegEx.Id,\n    index: 1,\n    label: \"Accounts ShopId\"\n  },\n  \"sessions\": {\n    type: Array,\n    optional: true,\n    index: 1\n  },\n  \"sessions.$\": {\n    type: String\n  },\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValue,\n    regEx: SimpleSchema.RegEx.Id,\n    index: 1\n  },\n  \"name\": {\n    type: String,\n    optional: true\n  },\n  \"username\": {\n    type: String,\n    optional: true\n  },\n  \"emails\": {\n    type: Array,\n    optional: true\n  },\n  \"emails.$\": {\n    type: Email\n  },\n  \"acceptsMarketing\": {\n    type: Boolean,\n    defaultValue: false,\n    optional: true\n  },\n  \"state\": {\n    type: String,\n    defaultValue: \"new\",\n    optional: true\n  },\n  \"taxSettings\": {\n    type: TaxSettings,\n    optional: true\n  },\n  \"note\": {\n    type: String,\n    optional: true\n  },\n  \"profile\": {\n    type: Profile,\n    optional: true\n  },\n  \"groups\": {\n    type: Array, // groupIds that user belongs to\n    optional: true,\n    defaultValue: []\n  },\n  \"groups.$\": {\n    type: String\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Accounts\", Accounts);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { Metafield } from \"./metafield\";\n\nconst withoutCodeCountries = [\"AO\", \"AG\", \"AW\", \"BS\", \"BZ\", \"BJ\", \"BW\",\n  \"BF\", \"BI\", \"CM\", \"CF\", \"KM\", \"CG\", \"CD\", \"CK\", \"CI\", \"DJ\",\n  \"DM\", \"GQ\", \"ER\", \"FJ\", \"TF\", \"GM\", \"GH\", \"GD\", \"GN\", \"GY\",\n  \"HK\", \"IE\", \"JM\", \"KE\", \"KI\", \"MO\", \"MW\", \"ML\", \"MR\", \"MU\",\n  \"MS\", \"NR\", \"AN\", \"NU\", \"KP\", \"PA\", \"QA\", \"RW\", \"KN\", \"LC\",\n  \"ST\", \"SA\", \"SC\", \"SL\", \"SB\", \"SO\", \"SR\", \"SY\", \"TZ\", \"TL\",\n  \"TK\", \"TO\", \"TT\", \"TV\", \"UG\", \"AE\", \"VU\", \"YE\", \"ZW\"];\n\n/**\n * @name Address\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id\n * @property {String} fullName required\n * @property {String} address1 required\n * @property {String} address2\n * @property {String} city required\n * @property {String} company\n * @property {String} phone required\n * @property {String} region required, State/Province/Region\n * @property {String} postal required\n * @property {String} country required\n * @property {Boolean} isCommercial required\n * @property {Boolean} isBillingDefault required\n * @property {Boolean} isShippingDefault required\n * @property {Boolean} failedValidation\n * @property {Metafield[]} metafields\n */\nexport const Address = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    defaultValue: Random.id(),\n    optional: true\n  },\n  \"fullName\": {\n    type: String,\n    label: \"Full name\"\n  },\n  \"address1\": {\n    label: \"Address 1\",\n    type: String\n  },\n  \"address2\": {\n    label: \"Address 2\",\n    type: String,\n    optional: true\n  },\n  \"city\": {\n    type: String,\n    label: \"City\"\n  },\n  \"company\": {\n    type: String,\n    label: \"Company\",\n    optional: true\n  },\n  \"phone\": {\n    type: String,\n    label: \"Phone\"\n  },\n  \"region\": {\n    label: \"State/Province/Region\",\n    type: String\n  },\n  \"postal\": {\n    label: \"ZIP/Postal Code\",\n    type: String,\n    optional: true,\n    custom() {\n      const country = this.field(\"country\");\n      if (country && country.value) {\n        if (!withoutCodeCountries.includes(country.value) && !this.value) {\n          return \"required\";\n        }\n      }\n      return true;\n    }\n  },\n  \"country\": {\n    type: String,\n    label: \"Country\"\n  },\n  \"isCommercial\": {\n    label: \"This is a commercial address.\",\n    type: Boolean\n  },\n  \"isBillingDefault\": {\n    label: \"Make this your default billing address?\",\n    type: Boolean\n  },\n  \"isShippingDefault\": {\n    label: \"Make this your default shipping address?\",\n    type: Boolean\n  },\n  \"failedValidation\": {\n    label: \"Failed validation\",\n    type: Boolean,\n    defaultValue: false,\n    optional: true\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Address\", Address);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Assets\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} type required\n * @property {String} name optional\n * @property {String} ns optional, namespace for i18n. Allows to load translation for custom plugins.\n * @property {String} path optional\n * @property {String} content optional\n */\nexport const Assets = new SimpleSchema({\n  type: {\n    type: String\n  },\n  name: {\n    type: String,\n    optional: true\n  },\n  ns: {\n    type: String,\n    optional: true\n  },\n  path: {\n    type: String,\n    optional: true\n  },\n  content: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Assets\", Assets);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, shopIdAutoValueForCart, updatedAtAutoValue } from \"./helpers\";\nimport { Payment } from \"./payments\";\nimport { Product, ProductVariant } from \"./products\";\nimport { Shipment, ShippingParcel } from \"./shipping\";\nimport { Workflow } from \"./workflow\";\nimport { Metafield } from \"./metafield\";\n\n/**\n * @name CartItem\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id required\n * @property {String} productId required\n * @property {String} shopId, Cart Item shopId\n * @property {Number} quantity required\n * @property {Product} product required\n * @property {ProductVariant} variants required\n * @property {Metafield[]} metafields\n * @property {String} title Cart Item title\n * @property {String} type, Product type\n * @property {ShippingParcel} parcel Currently, parcel is in simple product schema. Need to include it here as well.\n * @property {String} cartItemId Seems strange here but has to be here since we share schemas between Cart and Order\n * @property {Object} transaction Transaction associated with this item\n * @property {Object} taxData optional blackbox\n * @property {Number} taxRate optional\n * @property {Object} shippingMethod Shipping Method associated with this item\n */\nexport const CartItem = new SimpleSchema({\n  \"_id\": {\n    type: String\n  },\n  \"productId\": {\n    type: String,\n    index: 1\n  },\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValueForCart,\n    index: 1,\n    label: \"Cart Item shopId\",\n    optional: true\n  },\n  \"quantity\": {\n    label: \"Quantity\",\n    type: SimpleSchema.Integer,\n    min: 0\n  },\n  \"product\": {\n    type: Product\n  },\n  \"variants\": {\n    type: ProductVariant\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"title\": {\n    type: String,\n    label: \"CartItem Title\"\n  },\n  \"type\": {\n    label: \"Product Type\",\n    type: String,\n    optional: true\n  },\n  \"parcel\": {\n    type: ShippingParcel,\n    optional: true\n  },\n  \"cartItemId\": {\n    type: String,\n    optional: true\n  },\n  \"transaction\": {\n    type: Object,\n    optional: true,\n    blackbox: true\n  },\n  \"taxData\": {\n    type: Object,\n    optional: true,\n    blackbox: true\n  },\n  \"taxRate\": {\n    type: Number,\n    optional: true\n  },\n  \"shippingMethod\": {\n    type: Object,\n    optional: true,\n    blackbox: true // @todo Revert this to schema at some point\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"CartItem\", CartItem);\n\n/**\n * @name CartItems\n * @memberof schemas\n * @summary Used in check by inventory/addReserve method\n * @type {SimpleSchema}\n * @property {CartItem[]} items an Array of CartItem optional\n */\nexport const CartItems = new SimpleSchema({\n  \"items\": {\n    type: Array,\n    optional: true\n  },\n  \"items.$\": {\n    type: CartItem\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"CartItems\", CartItems);\n\n/**\n * @name Cart\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id required for check of users' carts\n * @property {String} shopId required, Cart ShopId\n * @property {String} userId required\n * @property {String} sessionId required\n * @property {String} email optional\n * @property {CartItem[]} items Array of CartItem optional\n * @property {Shipment[]} shipping Array of Shipment optional, blackbox\n * @property {Payment[]} billing Array of Payment optional, blackbox\n * @property {Number} tax tax rate\n * @property {Object[]} taxes Array of objects optional\n * @property {Object} taxRatesByShop optional\n * @property {Number} discount optional\n * @property {Workflow} workflow optional\n * @property {Date} createdAt required\n * @property {Date} updatedAt optional\n */\nexport const Cart = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    optional: true\n  },\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValueForCart,\n    index: 1,\n    label: \"Cart ShopId\"\n  },\n  \"userId\": {\n    type: String,\n    unique: true,\n    autoValue() {\n      if (this.isInsert || this.isUpdate) {\n        if (!this.isFromTrustedCode) {\n          return this.userId;\n        }\n      } else {\n        this.unset();\n      }\n    }\n  },\n  \"sessionId\": {\n    type: String,\n    index: 1\n  },\n  \"email\": {\n    type: String,\n    optional: true,\n    index: 1,\n    regEx: SimpleSchema.RegEx.Email\n  },\n  \"items\": {\n    type: Array,\n    optional: true\n  },\n  \"items.$\": {\n    type: CartItem\n  },\n  \"shipping\": {\n    type: Array,\n    optional: true\n  },\n  \"shipping.$\": {\n    type: Shipment\n  },\n  \"billing\": {\n    type: Array,\n    optional: true\n  },\n  \"billing.$\": {\n    type: Payment\n  },\n  \"tax\": {\n    type: Number,\n    optional: true\n  },\n  \"taxes\": {\n    type: Array,\n    optional: true\n  },\n  \"taxes.$\": {\n    type: Object,\n    blackbox: true\n  },\n  \"taxRatesByShop\": {\n    type: Object,\n    optional: true,\n    blackbox: true\n  },\n  \"taxCalculationFailed\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"bypassAddressValidation\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"discount\": {\n    type: Number,\n    optional: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Cart\", Cart);\n","import SimpleSchema from \"simpl-schema\";\n\nexport const Catalog = new SimpleSchema({\n  contentType: {\n    type: String\n  },\n  media: {\n    type: Object,\n    blackbox: true\n  },\n  variants: {\n    type: Object,\n    blackbox: true\n  }\n});\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, updatedAtAutoValue } from \"./helpers\";\n\n/**\n * @name Emails\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} to required\n * @property {String} from required\n * @property {String} subject required\n * @property {String} text optional\n * @property {String} html optional\n * @property {String} userId optional\n * @property {String} jobId required\n * @property {String} type optional\n * @property {String} status optional\n * @property {Date} createdAt required\n * @property {Date} updatedAt required\n */\nexport const Emails = new SimpleSchema({\n  to: String,\n  from: String,\n  subject: String,\n  text: {\n    type: String,\n    optional: true\n  },\n  html: {\n    type: String,\n    optional: true\n  },\n  userId: {\n    type: String,\n    optional: true\n  },\n  jobId: {\n    type: String,\n    index: true\n  },\n  type: {\n    type: String,\n    optional: true\n  },\n  status: String,\n  createdAt: {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  updatedAt: {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Emails\", Emails);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Event for EventLog\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} title Event title required\n * @property {String} type Event type required\n * @property {String} description Event description optional\n * @property {String} userId User who triggered event optional\n * @property {String} trigger Action that triggered event optional\n * @property {Date} createdAt required\n */\nexport const Event = new SimpleSchema({\n  title: {\n    type: String,\n    label: \"Event Title\"\n  },\n  type: {\n    type: String,\n    label: \"Event Type\"\n  },\n  description: {\n    type: String,\n    label: \"Event Description\",\n    optional: true\n  },\n  userId: {\n    type: String,\n    label: \"User who triggered event\",\n    optional: true\n  },\n  trigger: {\n    type: String,\n    label: \"What triggered the event\",\n    optional: true\n  },\n  createdAt: {\n    type: Date,\n    label: \"Created At\"\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Event\", Event);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, updatedAtAutoValue } from \"./helpers\";\n\n/**\n * @name Group\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} name required\n * @property {String} description optional\n * @property {String} slug required\n * @property {String[]} permissions optional\n * @property {String} shopId required\n * @property {String} createdBy optional\n * @property {Date} createdAt required\n * @property {Date} updatedAt required\n */\nexport const Groups = new SimpleSchema({\n  \"name\": {\n    type: String\n  },\n  \"description\": {\n    type: String,\n    optional: true\n  },\n  \"slug\": {\n    type: String\n  },\n  \"permissions\": {\n    type: Array,\n    optional: true\n  },\n  \"permissions.$\": {\n    type: String\n  },\n  \"shopId\": {\n    type: String,\n    regEx: SimpleSchema.RegEx.Id\n  },\n  \"createdBy\": {\n    type: String,\n    optional: true,\n    regEx: SimpleSchema.RegEx.Id,\n    autoValue() {\n      return this.userId || this.value;\n    }\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Groups\", Groups);\n","import { Meteor } from \"meteor/meteor\";\nimport { Random } from \"meteor/random\";\nimport { Reaction } from \"/lib/api\";\nimport { Shops } from \"/lib/collections\";\n\n/**\n * @name createdAtAutoValue\n * @memberof schemas\n * @method\n * @summary Helper method used for schema injection autoValue\n * @example autoValue: createdAtAutoValue\n * @return {Date} Date representing now if it's an insert\n */\nexport function createdAtAutoValue() {\n  // We don't want to unset or overwrite a createdAt in a nested\n  // document, for example, in a product being added to cart items\n  if (this.closestSubschemaFieldName) return;\n\n  if (this.isInsert) return new Date();\n  if (this.isUpsert) return { $setOnInsert: new Date() };\n  this.unset();\n}\n\n/**\n * @name updatedAtAutoValue\n * @memberof schemas\n * @method\n * @summary Helper method used for schema injection autoValue\n * @example autoValue: updatedAtAutoValue\n * @return {Date} Date representing now\n */\nexport function updatedAtAutoValue() {\n  // We don't want to overwrite an updatedAt in a nested\n  // document, for example, in a product being added to cart items\n  if (this.closestSubschemaFieldName) return;\n\n  return new Date();\n}\n\n/**\n * @name shopIdAutoValue\n * @memberof schemas\n * @method\n * @summary Helper method used for schema injection autoValue\n * @example autoValue: shopIdAutoValue\n * @return {String} current shopId\n */\nexport function shopIdAutoValue() {\n  // we should always have a shopId\n  if (this.isSet && Meteor.isServer) {\n    return this.value;\n  } else if ((Meteor.isServer && !this.isUpdate) || (Meteor.isClient && this.isInsert)) {\n    return Reaction.getShopId();\n  }\n  return this.unset();\n}\n\n/**\n * @name shopIdAutoValueForCart\n * @memberof schemas\n * @method\n * @summary Helper method copy of shopIdAutoValue with modification for Cart\n * @example autoValue: shopIdAutoValue\n * @return {String} shopId\n */\nexport function shopIdAutoValueForCart() {\n  // we should always have a shopId\n  if (this.isSet && Meteor.isServer) {\n    return this.value;\n  } else if ((Meteor.isServer && !this.isUpdate) || (Meteor.isClient && this.isInsert)) {\n    let shopId = Reaction.getPrimaryShopId();\n    const marketplaceSettings = Reaction.getMarketplaceSettings();\n\n    if (marketplaceSettings && marketplaceSettings.public && marketplaceSettings.public.merchantCart === true) {\n      shopId = Reaction.getShopId();\n    }\n    return shopId;\n  }\n  return this.unset();\n}\n\n/**\n * @name schemaIdAutoValue\n * @memberof schemas\n * @method\n * @summary Helper method used for schema injection autoValue\n * @example autoValue: schemaIdAutoValue\n * @return {String} randomId\n */\nexport function schemaIdAutoValue() {\n  if (this.isSet && Meteor.isServer) {\n    return this.value;\n  } else if ((Meteor.isServer && this.operator !== \"$pull\") ||\n    (Meteor.isClient && this.isInsert)) {\n    return Random.id();\n  }\n  return this.unset();\n}\n\n/**\n * @name shopDefaultCountry\n * @memberof schemas\n * @method\n * @summary Helper method used for schema injection autoValue\n * @example autoValue: shopDefaultCountry\n * @return {String} country value from default shop\n */\nexport function shopDefaultCountry() {\n  try {\n    // Check to see if this is client or server, and the type of update being performed\n    if (this.isSet && Meteor.isServer) {\n      return this.value;\n    } else if ((Meteor.isServer && !this.isUpdate) || (Meteor.isClient && this.isInsert)) {\n      // Find the current shop\n      const shop = Shops.findOne({\n        _id: Reaction.getShopId()\n      });\n\n      // Find the current shops primary shipping address\n      if (shop && shop.addressBook) {\n        const defaultShippingAddress = shop.addressBook.find((address) => address.isShippingDefault === true);\n\n        // return the shops country to auto-populate the Country of Origin field in the scheme\n        return defaultShippingAddress.country;\n      }\n\n      return this.value;\n    }\n    return this.unset();\n  } catch (e) {\n    return this.value;\n  }\n}\n","export * from \"./accounts\";\nexport * from \"./address\";\nexport * from \"./assets\";\nexport * from \"./catalog\";\nexport * from \"./cart\";\nexport * from \"./emails\";\nexport * from \"./inventory\";\nexport * from \"./layouts\";\nexport * from \"./logs\";\nexport * from \"./metafield\";\nexport * from \"./notifications\";\nexport * from \"./orders\";\nexport * from \"./payments\";\nexport * from \"./products\";\nexport * from \"./registry\";\nexport * from \"./revisions\";\nexport * from \"./shipping\";\nexport * from \"./shops\";\nexport * from \"./groups\";\nexport * from \"./sms\";\nexport * from \"./social\";\nexport * from \"./tags\";\nexport * from \"./templates\";\nexport * from \"./translations\";\nexport * from \"./workflow\";\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, shopIdAutoValue, updatedAtAutoValue } from \"./helpers\";\nimport { Document, Notes } from \"./orders\";\nimport { Metafield } from \"./metafield\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name Inventory\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id optional, inserted by Mongo, we need it for schema validation\n * @property {String} shopId required, Inventory shopId\n * @property {String} productId required\n * @property {String} variantId required\n * @property {String} orderItemId optional\n * @property {Workflow} workflow optional\n * @property {String} sku optional\n * @property {Metafield[]} metafields optional\n * @property {Document[]} documents optional\n * @property {Notes[]} notes optional\n * @property {Date} createdAt optional, but consider it temporary: schema validation failing in method with required\n * @property {Date} updatedAt optional\n */\nexport const Inventory = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    optional: true\n  },\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValue,\n    index: 1,\n    label: \"Inventory ShopId\"\n  },\n  \"productId\": {\n    type: String,\n    index: true\n  },\n  \"variantId\": {\n    type: String,\n    index: true\n  },\n  \"orderItemId\": {\n    type: String,\n    index: true,\n    optional: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  },\n  \"sku\": {\n    label: \"sku\",\n    type: String,\n    optional: true\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"documents\": {\n    type: Array,\n    optional: true\n  },\n  \"documents.$\": {\n    type: Document\n  },\n  \"notes\": {\n    type: Array,\n    optional: true\n  },\n  \"notes.$\": {\n    type: Notes\n  },\n  \"createdAt\": {\n    type: Date,\n    optional: true,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Inventory\", Inventory);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name LayoutStructure\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary Layout are used by the Shops and Packages schemas.\n * Layouts are used to in two ways: 1) Define the template layout on the site\n * 2) Define workflow components used in each layout block\n * @description Read more about Layouts in {@link https://docs.reactioncommerce.com/reaction-docs/master/layout documentation}\n * @property {String} template optional\n * @property {String} layoutHeader optional\n * @property {String} layoutFooter optional\n * @property {String} notFound optional\n * @property {String} dashboardHeader optional\n * @property {String} dashboardControls optional\n * @property {String} dashboardHeaderControls optional\n * @property {String} adminControlsFooter optional\n */\nexport const LayoutStructure = new SimpleSchema({\n  template: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  layoutHeader: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  layoutFooter: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  notFound: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  dashboardHeader: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  dashboardControls: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  dashboardHeaderControls: {\n    type: String,\n    optional: true,\n    index: true\n  },\n  adminControlsFooter: {\n    type: String,\n    optional: true,\n    index: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"LayoutStructure\", LayoutStructure);\n\n/**\n * @name Layout\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary Layout are used by the Shops and Packages schemas.\n * Read more about Layouts in {@link https://docs.reactioncommerce.com/reaction-docs/master/layout documentation}\n * @property {String} layout optional\n * @property {String} workflow optional\n * @property {String} template optional\n * @property {String} collection optional\n * @property {String} theme optional\n * @property {Boolean} enabled default value: `true`\n * @property {String} status optional\n * @property {String} label optional\n * @property {String} container optional\n * @property {String[]} audience optional\n * @property {LayoutStructure} structure optional\n * @property {Number} priority optional default value: `999` - Layouts are prioritized with lower numbers first.\n * @property {Number} position optional default value: `1`\n */\nexport const Layout = new SimpleSchema({\n  \"layout\": {\n    type: String,\n    optional: true,\n    index: true\n  },\n  \"workflow\": {\n    type: String,\n    optional: true\n  },\n  \"template\": {\n    type: String,\n    optional: true\n  },\n  \"collection\": {\n    type: String,\n    optional: true\n  },\n  \"theme\": {\n    type: String,\n    optional: true\n  },\n  \"enabled\": {\n    type: Boolean,\n    defaultValue: true\n  },\n  \"status\": {\n    type: String,\n    optional: true\n  },\n  \"label\": {\n    type: String,\n    optional: true\n  },\n  \"container\": {\n    type: String,\n    optional: true\n  },\n  \"audience\": {\n    type: Array,\n    optional: true\n  },\n  \"audience.$\": {\n    type: String\n  },\n  \"structure\": {\n    type: LayoutStructure,\n    optional: true\n  },\n  \"priority\": {\n    type: SimpleSchema.Integer,\n    optional: true,\n    defaultValue: 999\n  },\n  \"position\": {\n    type: SimpleSchema.Integer,\n    optional: true,\n    defaultValue: 1\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Layout\", Layout);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Logs\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} logType required\n * @property {String} shopId required\n * @property {String} level default: `\"info\"`, allowed: `\"trace\"`, `\"debug\"`, `\"info\"`, `\"warn\"`, `\"error\"`, `\"fatal\"`\n * @property {String} source default: `\"server\"`, allowed: `\"client\"`, `\"server\"`\n * @property {Boolean} handled required, default: false\n * @property {Object} data, blackbox\n * @property {Date} date required\n */\nexport const Logs = new SimpleSchema({\n  logType: {\n    type: String\n  },\n  shopId: {\n    type: String\n  },\n  level: {\n    type: String,\n    defaultValue: \"info\",\n    allowedValues: [\"trace\", \"debug\", \"info\", \"warn\", \"error\", \"fatal\"]\n  },\n  source: {\n    type: String,\n    defaultValue: \"server\",\n    allowedValues: [\"client\", \"server\"]\n  },\n  handled: {\n    type: Boolean,\n    defaultValue: false\n  },\n  data: {\n    type: Object,\n    blackbox: true,\n    label: \"Data\"\n  },\n  date: {\n    type: Date,\n    autoValue() { return new Date(); },\n    label: \"Date\"\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Logs\", Logs);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Metafield\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} key optional\n * @property {String} namespace optional\n * @property {String} scope optional\n * @property {String} value optional\n * @property {String} valueType optional\n * @property {String} description optional\n */\nexport const Metafield = new SimpleSchema({\n  key: {\n    type: String,\n    max: 30,\n    optional: true\n  },\n  namespace: {\n    type: String,\n    max: 20,\n    optional: true\n  },\n  scope: {\n    type: String,\n    optional: true\n  },\n  value: {\n    type: String,\n    optional: true\n  },\n  valueType: {\n    type: String,\n    optional: true\n  },\n  description: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Metafield\", Metafield);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Notification\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary Notification sends messages corresponding to the type:\n * - `orderCanceled`  : \"Your order was canceled.\"\n * - `forAdmin`       : \"You have a new order.\"\n * - `newOrder`       : \"You just made an order.\"\n * - `orderDelivered` : \"Your order has been delivered.\"\n * - `orderProcessing`: \"Your order is being processed.\"\n * - `orderShipped`   : \"Your order has been shipped.\"\n * @property {String} message required\n * @property {String} type required, types: `orderCanceled`, `forAdmin`, `newOrder`, `orderDelivered`, `orderProcessing`, `orderShipped`\n * @property {String} url required\n * @property {String} to required\n * @property {Boolean} hasDetails required\n * @property {String} details required\n * @property {String} status required, default: `unread`\n * @property {Date} timeSent required\n */\nexport const Notification = new SimpleSchema({\n  message: {\n    type: String,\n    optional: false\n  },\n  type: {\n    type: String,\n    optional: false\n  },\n  url: {\n    type: String,\n    optional: false\n  },\n  to: {\n    type: String,\n    optional: false\n  },\n  hasDetails: {\n    type: Boolean,\n    optional: false\n  },\n  details: {\n    type: String,\n    optional: true\n  },\n  status: {\n    type: String,\n    optional: false,\n    defaultValue: \"unread\"\n  },\n  timeSent: {\n    type: Date,\n    optional: false,\n    autoValue() {\n      if (this.isInsert) {\n        return new Date();\n      } else if (this.isUpsert) {\n        return { $setOnInsert: new Date() };\n      }\n      this.unset();\n    }\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Notification\", Notification);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue } from \"./helpers\";\nimport { Cart, CartItem } from \"./cart\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name Document\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} docId required\n * @property {String} docType optional\n */\nexport const Document = new SimpleSchema({\n  docId: {\n    type: String\n  },\n  docType: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Document\", Document);\n\n/**\n * @name History\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} event required\n * @property {String} value required\n * @property {String} userId required\n * @property {String} updatedAt required\n */\nexport const History = new SimpleSchema({\n  event: {\n    type: String\n  },\n  value: {\n    type: String\n  },\n  userId: {\n    type: String\n  },\n  updatedAt: {\n    type: Date\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"History\", History);\n\n/**\n * @name ExportHistory\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} required Whether the export attempt succeeded or failed\n * @property {Date} required Date the export was attempted\n * @property {String} required Name of the export method (e.g. CSV, Shopify)\n * @property {String} optional The identifier for this order on the remote system\n */\nexport const ExportHistory = new SimpleSchema({\n  status: {\n    type: String,\n    allowedValues: [\"success\", \"failure\"]\n  },\n  dateAttempted: {\n    type: Date\n  },\n  exportMethod: {\n    type: String\n  },\n  destinationIdentifier: {\n    type: String,\n    optional: true\n  },\n  shopId: {\n    type: String\n  }\n});\n\nregisterSchema(\"ExportHistory\", ExportHistory);\n\n/**\n * @name Notes\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} content required\n * @property {String} userId required\n * @property {Date} updatedAt required\n */\nexport const Notes = new SimpleSchema({\n  content: {\n    type: String\n  },\n  userId: {\n    type: String\n  },\n  updatedAt: {\n    type: Date\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Notes\", Notes);\n\n/**\n * @name OrderItem\n * @memberof schemas\n * @summary CartItem + some additional properties\n * @type {SimpleSchema}\n * @property {String} additionalField optional\n * @property {Workflow} workflow optional\n * @property {History[]} history optional\n * @property {Document[]} documents optional\n*/\nexport const OrderItem = new SimpleSchema({\n  \"additionalField\": {\n    type: String,\n    optional: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  },\n  \"history\": {\n    type: Array,\n    optional: true\n  },\n  \"history.$\": {\n    type: History\n  },\n  \"documents\": {\n    type: Array,\n    optional: true\n  },\n  \"documents.$\": {\n    type: Document\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"OrderItem\", OrderItem);\n\n/**\n * @name OrderTransaction Schema\n * @memberof schemas\n * @summary Order transactions tie Shipping, Payment, and Inventory transactions\n * @type {SimpleSchema}\n * @property {String} itemId optional\n * @property {String} paymentId optional\n * @property {String} shipmentId optional\n * @property {String} inventoryId optional\n * @property {Date} createdAt required\n */\nexport const OrderTransaction = new SimpleSchema({\n  itemId: {\n    type: String,\n    optional: true\n  },\n  paymentId: {\n    type: String,\n    optional: true\n  },\n  shipmentId: {\n    type: String,\n    optional: true\n  },\n  inventoryId: {\n    type: String,\n    optional: true\n  },\n  createdAt: {\n    type: Date,\n    autoValue: createdAtAutoValue\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"OrderTransaction\", OrderTransaction);\n\n/**\n * @name Order Schema\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary Order ties a User to a Cart and an array of History, Documents, Notes, Items and OrderTransactions.\n * @property {String} userId required\n * @property {String} cartId optional\n * @property {History[]} history optional\n * @property {Document[]} documents optional\n * @property {Notes[]} notes optional\n * @property {OrderItem[]} items optional\n * @property {OrderTransaction[]} transactions optional\n */\nexport const Order = new SimpleSchema({\n  \"userId\": {\n    type: String,\n    unique: false\n  },\n  \"cartId\": {\n    type: String,\n    optional: true\n  },\n  \"history\": {\n    type: Array,\n    optional: true\n  },\n  \"history.$\": {\n    type: History\n  },\n  \"documents\": {\n    type: Array,\n    optional: true\n  },\n  \"documents.$\": {\n    type: Document\n  },\n  \"notes\": {\n    type: Array,\n    optional: true\n  },\n  \"notes.$\": Notes,\n  \"taxCalculationFailed\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"bypassAddressValidation\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"items\": {\n    type: Array,\n    optional: true\n  },\n  \"items.$\": CartItem.clone().extend(OrderItem),\n  \"transactions\": {\n    type: Array,\n    optional: true\n  },\n  \"transactions.$\": OrderTransaction,\n  \"exportHistory\": {\n    type: Array,\n    optional: true\n  },\n  \"exportHistory.$\": ExportHistory\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Order\", Order);\n\nexport const OrderDocument = Cart.clone().extend(Order).extend(OrderItem);\nregisterSchema(\"OrderDocument\", OrderDocument);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, schemaIdAutoValue } from \"./helpers\";\nimport { Address } from \"./address\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name PaymentItem\n * @summary Schema for items we're inserting into our Payments\n * To keep track of what items were paid for with a given paymentMethod\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} _id optional, Shipment Line Item\n * @property {String} productId required\n * @property {String} shopId optional, Shipment Item ShopId\n * @property {Number} quantity required\n * @property {String} variantId required\n */\nexport const PaymentItem = new SimpleSchema({\n  _id: {\n    type: String,\n    label: \"Shipment Line Item\",\n    optional: true,\n    autoValue: schemaIdAutoValue\n  },\n  productId: {\n    type: String,\n    index: 1\n  },\n  shopId: {\n    type: String,\n    index: 1,\n    label: \"Shipment Item ShopId\",\n    optional: true\n  },\n  quantity: {\n    label: \"Quantity\",\n    type: SimpleSchema.Integer,\n    min: 0\n  },\n  variantId: {\n    type: String\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"PaymentItem\", PaymentItem);\n\n/**\n * @name PaymentMethod\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} processor required\n * @property {String} paymentPackageId required\n * @property {String} paymentSettingsKey required\n * @property {String} storedCard optional\n * @property {String} method, allowed values: `\"credit\"`, `\"debit\"`, `\"shipping-credit\"`\n * @property {String} transactionId required\n * @property {Object} metadata optional, blackbox\n * @property {Workflow} workflow optional\n * @property {String} status required\n * @property {String} mode, allowed values: `\"authorize\"`, `\"capture\"`, `\"refund\"`, `\"cancel\"`, `\"void\"`\n * @property {String} riskLevel, allowed values: `\"normal\"`, `\"elevated\"`, `\"high\"`\n * @property {Date} createdAt required\n * @property {Date} updatedAt optional\n * @property {String} authorization optional\n * @property {Number} amount optional\n * @property {String} currency required\n * @property {Object[]} transactions optional, blackbox\n * @property {PaymentItem[]} items optional\n * @property {String} shopId optional\n */\nexport const PaymentMethod = new SimpleSchema({\n  \"processor\": {\n    type: String\n  },\n  \"paymentPackageId\": {\n    type: String\n  },\n  \"paymentSettingsKey\": {\n    type: String\n  },\n  \"storedCard\": {\n    type: String,\n    optional: true\n  },\n  \"method\": {\n    type: String,\n    allowedValues: [\"credit\", \"debit\", \"shipping-credit\"],\n    optional: true\n  },\n  \"transactionId\": {\n    type: String\n  },\n  \"metadata\": {\n    type: Object,\n    optional: true,\n    blackbox: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  },\n  \"status\": {\n    type: String\n  },\n  \"mode\": {\n    type: String,\n    allowedValues: [\"authorize\", \"capture\", \"refund\", \"cancel\", \"void\"]\n  },\n  \"riskLevel\": {\n    type: String,\n    allowedValues: [\"normal\", \"elevated\", \"high\"],\n    optional: true\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    optional: true\n  },\n  \"authorization\": {\n    type: String,\n    optional: true\n  },\n  \"amount\": {\n    type: Number,\n    optional: true\n  },\n  \"currency\": {\n    type: String,\n    optional: true\n  },\n  \"transactions\": {\n    type: Array,\n    optional: true\n  },\n  \"transactions.$\": {\n    type: Object,\n    blackbox: true\n  },\n  \"items\": {\n    type: Array,\n    optional: true\n  },\n  \"items.$\": {\n    type: PaymentItem\n  },\n  \"shopId\": {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"PaymentMethod\", PaymentMethod);\n\n// When checking paymentMethod passed as a method arg, props like createdAt\n// should be optional\nexport const PaymentMethodArgument = PaymentMethod.clone().extend({\n  createdAt: {\n    type: Date,\n    optional: true,\n    autoValue: null\n  }\n});\n\n/**\n * @name Invoice\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} transaction optional\n * @property {Number} shipping optional\n * @property {Number} taxes optional\n * @property {Number} subtotal required\n * @property {Number} discounts optional\n * @property {Number} total required\n */\nexport const Invoice = new SimpleSchema({\n  transaction: {\n    type: String,\n    optional: true\n  },\n  shipping: {\n    type: Number,\n    optional: true\n  },\n  taxes: {\n    type: Number,\n    optional: true\n  },\n  subtotal: {\n    type: Number\n  },\n  discounts: {\n    type: Number,\n    optional: true\n  },\n  total: {\n    type: Number\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Invoice\", Invoice);\n\n/**\n * @name CurrencyExchangeRate\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} userCurrency, default value: `\"USD\"`\n * @property {Number} exchangeRate optional\n */\nexport const CurrencyExchangeRate = new SimpleSchema({\n  userCurrency: {\n    type: String,\n    optional: true,\n    defaultValue: \"USD\"\n  },\n  exchangeRate: {\n    type: Number,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"CurrencyExchangeRate\", CurrencyExchangeRate);\n\n/**\n * @name Payment\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} _id required, Payment Id\n * @property {Address} address optional\n * @property {PaymentMethod} paymentMethod optional\n * @property {Invoice} invoice optional\n * @property {CurrencyExchangeRate} currency optional\n * @property {String} shopId optional\n */\nexport const Payment = new SimpleSchema({\n  _id: {\n    type: String,\n    label: \"Payment Id\",\n    autoValue: schemaIdAutoValue\n  },\n  address: {\n    type: Address,\n    optional: true\n  },\n  paymentMethod: {\n    type: PaymentMethod,\n    optional: true,\n    blackbox: true\n  },\n  invoice: {\n    type: Invoice,\n    optional: true\n  },\n  currency: {\n    type: CurrencyExchangeRate,\n    optional: true,\n    defaultValue: {}\n  },\n  shopId: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Payment\", Payment);\n\n/**\n * @name Payment\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} type required\n * @property {Number} amount required\n * @property {Number} created required\n * @property {String} currency required\n * @property {Object} raw optional, blackbox\n */\nexport const Refund = new SimpleSchema({\n  type: {\n    type: String\n  },\n  amount: {\n    type: Number\n  },\n  created: {\n    type: SimpleSchema.Integer\n  },\n  currency: {\n    type: String\n  },\n  raw: {\n    type: Object,\n    optional: true,\n    blackbox: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Refund\", Refund);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Random } from \"meteor/random\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { ReactionProduct, getSlug } from \"/lib/api\";\nimport { createdAtAutoValue, shopIdAutoValue, shopDefaultCountry, updatedAtAutoValue } from \"./helpers\";\nimport { Event } from \"./event\";\nimport { Metafield } from \"./metafield\";\nimport { ShippingParcel } from \"./shipping\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name VariantMedia\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} mediaId optional\n * @property {Number} priority optional\n * @property {Metafield[]} metafields optional\n * @property {Date} updatedAt optional\n * @property {Date} createdAt required\n */\nexport const VariantMedia = new SimpleSchema({\n  \"mediaId\": {\n    type: String,\n    optional: true\n  },\n  \"priority\": {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"updatedAt\": {\n    type: Date,\n    optional: true\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"VariantMedia\", VariantMedia);\n\n/**\n * @name ProductPosition\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} tag optional\n * @property {Number} position optional\n * @property {Boolean} pinned optional\n * @property {Number} weight optional, default value: `0`\n * @property {Date} updatedAt required\n */\nexport const ProductPosition = new SimpleSchema({\n  tag: {\n    type: String,\n    optional: true\n  },\n  position: {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  pinned: {\n    type: Boolean,\n    optional: true\n  },\n  weight: {\n    type: SimpleSchema.Integer,\n    optional: true,\n    defaultValue: 0,\n    min: 0,\n    max: 3\n  },\n  updatedAt: {\n    type: Date\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ProductPosition\", ProductPosition);\n\n/**\n * @name ProductVariant\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id required, Variant ID\n * @property {String[]} ancestors, default value: `[]`\n * @property {Number} index optional, Variant position number in list. Keep array index for moving variants in a list.\n * @property {Boolean} isVisible, default value: `false`\n * @property {Boolean} isDeleted, default value: `false`\n * @property {String} barcode optional\n * @property {Number} compareAtPrice optional, Compare at price\n * @property {String} fulfillmentService optional, Fullfillment service\n * @property {Number} weight, default value: `0`\n * @property {Number} length optional, default value: `0`\n * @property {Number} width optional, default value: `0`\n * @property {Number} height optional, default value: `0`\n * @property {Boolean} inventoryManagement, default value: `true`\n * @property {Boolean} inventoryPolicy, default value: `false`, If disabled, item can be sold even if it not in stock.\n * @property {Number} lowInventoryWarningThreshold, default value: `0`, Warn of low inventory at this number\n * @property {Number} inventoryQuantity, default value: `0`\n * @property {Number} minOrderQuantity optional\n * @property {Boolean} isLowQuantity optional, true when at least 1 variant is below `lowInventoryWarningThreshold`\n * @property {Boolean} isSoldOut optional, denormalized field, indicates when all variants `inventoryQuantity` is 0\n * @property {Number} price, default value: `0.00`\n * @property {String} shopId required, Variant ShopId\n * @property {String} sku optional\n * @property {String} type, default value: `\"variant\"`\n * @property {Boolean} taxable, default value: `true`\n * @property {String} taxCode, default value: `\"0000\"`\n * @property {String} taxDescription optional\n * @property {String} title, Label for customers, default value: `\"\"`\n * @property {String} optionTitle, Option internal name, default value: `\"Untitled option\"`\n * @property {Metafield[]} metafields optional\n * @property {Date} createdAt optional\n * @property {Date} updatedAt optional\n * @property {Event[]} eventLog optional, Variant Event Log\n * @property {Workflow} workflow optional\n * @property {String} originCountry optional\n */\nexport const ProductVariant = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    label: \"Variant ID\"\n  },\n  \"ancestors\": {\n    type: Array,\n    defaultValue: []\n  },\n  \"ancestors.$\": {\n    type: String\n  },\n  \"index\": {\n    label: \"Variant position number in list\",\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  \"isVisible\": {\n    type: Boolean,\n    index: 1,\n    defaultValue: false\n  },\n  \"isDeleted\": {\n    type: Boolean,\n    index: 1,\n    defaultValue: false\n  },\n  \"barcode\": {\n    label: \"Barcode\",\n    type: String,\n    optional: true,\n    custom() {\n      if (Meteor.isClient) {\n        if (this.siblingField(\"type\").value === \"inventory\" && !this.value) {\n          return SimpleSchema.ErrorTypes.REQUIRED;\n        }\n      }\n    }\n  },\n  \"compareAtPrice\": {\n    label: \"Compare At Price\",\n    type: Number,\n    optional: true,\n    min: 0,\n    defaultValue: 0.00\n  },\n  \"weight\": {\n    label: \"Weight\",\n    type: Number,\n    min: 0,\n    optional: true,\n    defaultValue: 0,\n    custom() {\n      if (Meteor.isClient) {\n        if (!(this.siblingField(\"type\").value === \"inventory\" || this.value ||\n          this.value === 0)) {\n          return SimpleSchema.ErrorTypes.REQUIRED;\n        }\n      }\n    }\n  },\n  \"length\": {\n    label: \"Length\",\n    type: Number,\n    min: 0,\n    optional: true,\n    defaultValue: 0\n  },\n  \"width\": {\n    label: \"Width\",\n    type: Number,\n    min: 0,\n    optional: true,\n    defaultValue: 0\n  },\n  \"height\": {\n    label: \"Height\",\n    type: Number,\n    min: 0,\n    optional: true,\n    defaultValue: 0\n  },\n  \"inventoryManagement\": {\n    type: Boolean,\n    label: \"Inventory Tracking\",\n    optional: true,\n    defaultValue: true,\n    custom() {\n      if (Meteor.isClient) {\n        if (!(this.siblingField(\"type\").value === \"inventory\" || this.value ||\n          this.value === false)) {\n          return SimpleSchema.ErrorTypes.REQUIRED;\n        }\n      }\n    }\n  },\n  \"inventoryPolicy\": {\n    type: Boolean,\n    label: \"Deny when out of stock\",\n    optional: true,\n    defaultValue: false,\n    custom() {\n      if (Meteor.isClient) {\n        if (!(this.siblingField(\"type\").value === \"inventory\" || this.value ||\n          this.value === false)) {\n          return SimpleSchema.ErrorTypes.REQUIRED;\n        }\n      }\n    }\n  },\n  \"lowInventoryWarningThreshold\": {\n    type: SimpleSchema.Integer,\n    label: \"Warn at\",\n    min: 0,\n    optional: true,\n    defaultValue: 0\n  },\n  \"inventoryQuantity\": {\n    type: SimpleSchema.Integer,\n    label: \"Quantity\",\n    optional: true,\n    defaultValue: 0,\n    custom() {\n      if (Meteor.isClient) {\n        if (this.siblingField(\"type\").value !== \"inventory\") {\n          if (ReactionProduct.checkChildVariants(this.docId) === 0 && !this.value) {\n            return SimpleSchema.ErrorTypes.REQUIRED;\n          }\n        }\n      }\n    }\n  },\n  \"minOrderQuantity\": {\n    label: \"Minimum order quantity\",\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  \"isLowQuantity\": {\n    label: \"Indicates that the product quantity is too low\",\n    type: Boolean,\n    optional: true\n  },\n  \"isSoldOut\": {\n    label: \"Indicates when the product quantity is zero\",\n    type: Boolean,\n    optional: true\n  },\n  \"price\": {\n    label: \"Price\",\n    type: Number,\n    defaultValue: 0.00,\n    min: 0,\n    optional: true\n  },\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValue,\n    index: 1,\n    label: \"Variant ShopId\"\n  },\n  \"sku\": {\n    label: \"SKU\",\n    type: String,\n    optional: true\n  },\n  \"type\": {\n    label: \"Type\",\n    type: String,\n    defaultValue: \"variant\"\n  },\n  \"taxable\": {\n    label: \"Taxable\",\n    type: Boolean,\n    defaultValue: true,\n    optional: true\n  },\n  \"taxCode\": {\n    label: \"Tax Code\",\n    type: String,\n    defaultValue: \"0000\",\n    optional: true\n  },\n  \"taxDescription\": {\n    type: String,\n    optional: true,\n    label: \"Tax Description\"\n  },\n  \"title\": {\n    label: \"Label\",\n    type: String,\n    defaultValue: \"\"\n  },\n  \"optionTitle\": {\n    label: \"Option\",\n    type: String,\n    optional: true,\n    defaultValue: \"Untitled Option\"\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"createdAt\": {\n    label: \"Created at\",\n    type: Date,\n    optional: true\n  },\n  \"updatedAt\": {\n    label: \"Updated at\",\n    type: Date,\n    optional: true\n  },\n  // TODO: REVIEW - Does this need to exist? Should we use workflow instead?\n  // Should it be called 'history' or something else instead?\n  // Should this go into the Logger instead? Is the logger robust enough for this?\n  \"eventLog\": {\n    label: \"Variant Event Log\",\n    type: Array,\n    optional: true\n  },\n  \"eventLog.$\": {\n    type: Event\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  },\n  \"originCountry\": {\n    type: String,\n    optional: true,\n    autoValue: shopDefaultCountry\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ProductVariant\", ProductVariant);\n\n/**\n * @name PriceRange\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} range, default value: `\"0.00\"`\n * @property {Number} min optional, default value: `0`\n * @property {Number} max optional, default value: `0`\n */\nexport const PriceRange = new SimpleSchema({\n  range: {\n    type: String,\n    defaultValue: \"0.00\"\n  },\n  min: {\n    type: Number,\n    defaultValue: 0,\n    optional: true\n  },\n  max: {\n    type: Number,\n    defaultValue: 0,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"PriceRange\", PriceRange);\n\n/**\n * @name Product\n * @type {SimpleSchema}\n * @memberof schemas\n * @property {String} _id Product ID\n * @property {String[]} ancestors default value: `[]`\n * @property {String} shopId Product ShopID\n * @property {String} title Product Title\n * @property {String} pageTitle optional\n * @property {String} description optional\n * @property {String} productType optional\n * @property {String} originCountry optional\n * @property {String} type default value: `\"simple\"`\n * @property {String} vendor optional\n * @property {Metafield[]} metafields optional\n * @property {Object} positions ProductPosition\n * @property {PriceRange} price denormalized, object with range string, min and max\n * @property {Boolean} isLowQuantity denormalized, true when at least 1 variant is below `lowInventoryWarningThreshold`\n * @property {Boolean} isSoldOut denormalized, Indicates when all variants `inventoryQuantity` is zero\n * @property {Boolean} isBackorder denormalized, `true` if product not in stock, but customers anyway could order it\n * @property {Boolean} requiresShipping default value: `true`, Require a shipping address\n * @property {ShippingParcel} parcel optional\n * @property {String[]} hashtags optional\n * @property {String} twitterMsg optional\n * @property {String} facebookMsg optional\n * @property {String} googleplusMsg optional\n * @property {String} pinterestMsg optional\n * @property {String} metaDescription optional\n * @property {String} handle optional, slug\n * @property {Boolean} isDeleted, default value: `false`\n * @property {Boolean} isVisible, default value: `false`\n * @property {String} template, default value: `\"productDetailSimple\"`\n * @property {Date} createdAt required\n * @property {Date} updatedAt optional\n * @property {Date} publishedAt optional\n * @property {String} publishedScope optional\n * @property {Workflow} workflow optional\n */\nexport const Product = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    label: \"Product Id\"\n  },\n  \"ancestors\": {\n    type: Array,\n    defaultValue: []\n  },\n  \"ancestors.$\": {\n    type: String\n  },\n  \"shopId\": {\n    type: String,\n    autoValue: shopIdAutoValue,\n    index: 1,\n    label: \"Product ShopId\"\n  },\n  \"title\": {\n    type: String,\n    defaultValue: \"\",\n    label: \"Product Title\"\n  },\n  \"pageTitle\": {\n    type: String,\n    optional: true\n  },\n  \"description\": {\n    type: String,\n    optional: true\n  },\n  \"productType\": {\n    type: String,\n    optional: true\n  },\n  \"originCountry\": {\n    type: String,\n    optional: true,\n    autoValue: shopDefaultCountry\n  },\n  \"type\": {\n    label: \"Type\",\n    type: String,\n    defaultValue: \"simple\"\n  },\n  \"vendor\": {\n    type: String,\n    optional: true\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"positions\": {\n    type: Object, // ProductPosition\n    blackbox: true,\n    optional: true\n  },\n  \"price\": {\n    label: \"Price\",\n    type: PriceRange\n  },\n  \"isLowQuantity\": {\n    label: \"Indicates that the product quantity is too low\",\n    type: Boolean,\n    optional: true\n  },\n  \"isSoldOut\": {\n    label: \"Indicates when the product quantity is zero\",\n    type: Boolean,\n    optional: true\n  },\n  \"isBackorder\": {\n    label: \"Indicates when the seller has allowed the sale of product which\" +\n    \" is not in stock\",\n    type: Boolean,\n    optional: true\n  },\n  \"requiresShipping\": {\n    label: \"Require a shipping address\",\n    type: Boolean,\n    defaultValue: true,\n    optional: true\n  },\n  \"parcel\": {\n    type: ShippingParcel,\n    optional: true\n  },\n  \"hashtags\": {\n    type: Array,\n    optional: true,\n    index: 1\n  },\n  \"hashtags.$\": {\n    type: String\n  },\n  \"twitterMsg\": {\n    type: String,\n    optional: true,\n    max: 140\n  },\n  \"facebookMsg\": {\n    type: String,\n    optional: true,\n    max: 255\n  },\n  \"googleplusMsg\": {\n    type: String,\n    optional: true,\n    max: 255\n  },\n  \"pinterestMsg\": {\n    type: String,\n    optional: true,\n    max: 255\n  },\n  \"metaDescription\": {\n    type: String,\n    optional: true\n  },\n  \"handle\": {\n    type: String,\n    optional: true,\n    index: 1,\n    autoValue() {\n      let slug = getSlug(this.value);\n\n      if (!slug && this.siblingField(\"title\").value) {\n        slug = getSlug(this.siblingField(\"title\").value);\n      } else if (!slug) {\n        slug = this.siblingField(\"_id\").value || Random.id();\n      }\n      if (this.isInsert) {\n        return slug;\n      } else if (this.isUpsert) {\n        return {\n          $setOnInsert: slug\n        };\n      }\n    }\n  },\n  \"changedHandleWas\": {\n    type: String,\n    optional: true\n  },\n  \"isDeleted\": {\n    type: Boolean,\n    index: 1,\n    defaultValue: false\n  },\n  \"isVisible\": {\n    type: Boolean,\n    index: 1,\n    defaultValue: false\n  },\n  \"template\": {\n    label: \"Template\",\n    type: String,\n    defaultValue: \"productDetailSimple\"\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  },\n  \"publishedAt\": {\n    type: Date,\n    optional: true\n  },\n  \"publishedScope\": {\n    type: String,\n    optional: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Product\", Product);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { Layout } from \"./layouts\";\n\n/**\n * @name Permissions\n * @memberof schemas\n * @summary The Permissions schema is part of the Registry. The Registry Schema allows package settings to be defined.\n * For more, read the in-depth {@link https://blog.reactioncommerce.com/an-intro-to-architecture-the-registry/ Intro to Architecture: The Registry}.\n * @type {SimpleSchema}\n * @property {String} permission\n * @property {String} label\n */\nexport const Permissions = new SimpleSchema({\n  permission: {\n    type: String\n  },\n  label: {\n    type: String\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Permissions\", Permissions);\n\n/**\n * @name Registry\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary The Registry Schema allows package settings to be defined. For more, read the in-depth {@link https://blog.reactioncommerce.com/an-intro-to-architecture-the-registry/ Intro to Architecture: The Registry}.\n * @property {String[]} provides Legacy `provides` apps use a String rather than an array. These are transformed in loadPackages.\n * @property {String} route optional\n * @property {String} name optional, Registry name must be unique. Namespace your plugin (e.g. `yourorg-plugin-name`) to avoid conflicts.\n * @property {String} template optional, Assign to a Blaze template\n * @property {String} workflow optional, A layout for a template in the package\n * @property {String} layout optional, Force the app to render a specific layout\n * @property {String[]} triggersEnter optional, Trigger on Enter\n * @property {String[]} triggersExit optional, Trigger on Exit\n * @property {Object} options optional, Routing Options\n * @property {String} description optional, deprecated\n * @property {String} icon optional, A set of CSS classes, often Font Awesome classes, used to define the package in the sidebar.\n * @property {String} label optional, Human-readable name for a Registry entry\n * @property {String} container optional, Used to group plugins\n * @property {Number} priority optional, Plugin load order. Lower values loaded first.\n * @property {Boolean} enabled optional, Enable or not\n * @property {Permissions[]} permissions optional, Define a new user permission\n * @property {String[]} audience optional, Define what permissions are required to view a step in a workflow\n * @property {Object} meta optional, Set `dashboardSize` for the `actionView`\n * @property {String[]} showForShopTypes optional, Shop Types this plugin should show for\n * @property {String[]} hideForShopTypes optional, Shop Types this plugin should not show for\n */\nexport const Registry = new SimpleSchema({\n  // TODO: This should _not_ be optional in the future, but we need to organize our packages better\n  \"provides\": {\n    // Legacy `provides` apps use a String rather than an array. These are transformed in loadPackages\n    type: Array,\n    index: true,\n    optional: true\n  },\n  \"provides.$\": {\n    type: String\n  },\n  \"route\": {\n    type: String,\n    optional: true,\n    index: true\n  },\n  // TODO: This should _not_ be optional in the future, but we need to organize our packages better\n  \"name\": {\n    type: String,\n    label: \"Registry Name\",\n    index: true,\n    optional: true\n  },\n  \"template\": {\n    type: String,\n    optional: true\n  },\n  \"workflow\": {\n    type: String,\n    optional: true\n  },\n  \"layout\": {\n    type: String,\n    optional: true\n  },\n  \"triggersEnter\": {\n    type: Array,\n    label: \"Trigger on Entry\",\n    optional: true\n  },\n  \"triggersEnter.$\": {\n    type: String\n  },\n  \"triggersExit\": {\n    type: Array,\n    label: \"Trigger on Exit\",\n    optional: true\n  },\n  \"triggersExit.$\": {\n    type: String\n  },\n  \"options\": {\n    label: \"Routing Options\",\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"description\": {\n    type: String,\n    optional: true\n  },\n  \"icon\": {\n    type: String,\n    optional: true\n  },\n  \"label\": {\n    type: String,\n    optional: true\n  },\n  \"container\": {\n    type: String,\n    optional: true\n  },\n  \"priority\": {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  \"enabled\": {\n    type: Boolean,\n    optional: true\n  },\n  \"permissions\": {\n    type: Array,\n    optional: true\n  },\n  \"permissions.$\": {\n    type: Permissions\n  },\n  \"audience\": {\n    type: Array,\n    label: \"Audience\",\n    optional: true\n  },\n  \"audience.$\": {\n    type: String\n  },\n  \"meta\": {\n    label: \"Meta\",\n    type: Object,\n    optional: true,\n    blackbox: true\n  },\n  \"showForShopTypes\": {\n    label: \"Shop Types this plugin should show for\",\n    type: Array,\n    optional: true\n  },\n  \"showForShopTypes.$\": {\n    type: String\n  },\n  \"hideForShopTypes\": {\n    type: Array,\n    label: \"Shop Types this plugin should not show for\",\n    optional: true\n  },\n  \"hideForShopTypes.$\": {\n    type: String\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Registry\", Registry);\n\n/**\n * @name PackageConfig\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary The PackageConfig is part of the configuration settings required for packages in the Registry.\n * The Registry Schema allows package settings to be defined. For more, read the in-depth {@link https://blog.reactioncommerce.com/an-intro-to-architecture-the-registry/ Intro to Architecture: The Registry}.\n * @property {String} shopId Autovalue removed {@link https://github.com/reactioncommerce/reaction/issues/646#issuecomment-169351842 here}\n * @property {String} name required\n * @property {Boolean} enabled defalut value: true\n * @property {String} icon optional\n * @property {Object} settings optional\n * @property {Registry[]} registry optional\n * @property {Layout[]} layout optional\n */\nexport const PackageConfig = new SimpleSchema({\n  \"shopId\": {\n    type: String,\n    index: 1,\n    // see: https://github.com/reactioncommerce/reaction/issues/646#issuecomment-169351842\n    // autoValue: shopIdAutoValue,\n    label: \"PackageConfig ShopId\",\n    optional: true\n  },\n  \"name\": {\n    type: String,\n    index: 1\n  },\n  \"enabled\": {\n    type: Boolean,\n    defaultValue: true\n  },\n  \"icon\": {\n    type: String,\n    optional: true\n  },\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: true,\n    defaultValue: {}\n  },\n  \"registry\": {\n    type: Array,\n    optional: true\n  },\n  \"registry.$\": {\n    type: Registry\n  },\n  \"layout\": {\n    type: Array,\n    optional: true\n  },\n  \"layout.$\": {\n    type: Layout\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"PackageConfig\", PackageConfig);\n\n/**\n * @name CorePackageConfig\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary The Core Package Config is part of the Registry.\n * The Registry Schema allows package settings to be defined. For more, read the in-depth {@link https://blog.reactioncommerce.com/an-intro-to-architecture-the-registry/ Intro to Architecture: The Registry}.\n * @extends {PackageConfig}\n * @property {Object} settings.mail optional, Mail settings\n * @property {String} settings.mail.user Mail user\n * @property {String} settings.mail.password Mail password\n * @property {String} settings.mail.host Mail host\n * @property {String} settings.mail.port Mail port\n * @property {String} settings.openexchangerates.appId OpenExchangeRates Id\n * @property {String} settings.openexchangerates.refreshPeriod default value: `\"every 1 hour\"`\n * @property {String} settings.google.clientId default value: `null`\n * @property {String} settings.google.apiKey default value: `null`\n * @property {Object} settings.public optional Settings in `public` are published to the client.\n * @property {Boolean} settings.public.allowGuestCheckout allows guest checkout\n * @property {String} settings.cart.cleanupDurationDays default value: `\"older than 3 days\"`\n */\nexport const CorePackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.mail\": {\n    type: Object,\n    optional: true,\n    label: \"Mail Settings\"\n  },\n  \"settings.mail.user\": {\n    type: String,\n    label: \"Username\"\n  },\n  \"settings.mail.password\": {\n    type: String,\n    label: \"Password\"\n  },\n  \"settings.mail.host\": {\n    type: String,\n    label: \"Host\"\n  },\n  \"settings.mail.port\": {\n    type: String,\n    label: \"Port\"\n  },\n  \"settings.openexchangerates\": {\n    type: Object,\n    optional: true\n  },\n  \"settings.openexchangerates.appId\": {\n    type: String,\n    label: \"Open Exchange Rates App Id\"\n  },\n  \"settings.openexchangerates.refreshPeriod\": {\n    type: String,\n    label: \"Open Exchange Rates refresh period\",\n    defaultValue: \"every 1 hour\"\n  },\n  \"settings.google\": {\n    type: Object,\n    optional: true\n  },\n  \"settings.google.clientId\": {\n    type: String,\n    label: \"Google Client Id\"\n  },\n  \"settings.google.apiKey\": {\n    type: String,\n    label: \"Google Api Key\"\n  },\n  \"settings.public\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.public.allowGuestCheckout\": {\n    type: Boolean,\n    label: \"Allow Guest Checkout\",\n    defaultValue: true\n  },\n  \"settings.cart\": {\n    type: Object,\n    defaultValue: {}\n  },\n  \"settings.cart.cleanupDurationDays\": {\n    type: String,\n    label: \"Cleanup Schedule\",\n    defaultValue: \"older than 3 days\"\n  }\n});\n\nregisterSchema(\"CorePackageConfig\", CorePackageConfig);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, updatedAtAutoValue } from \"./helpers\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name Revisions\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id Revision Id\n * @property {Workflow} workflow required\n * @property {String} documentId Reference Document Id\n * @property {String} documentType Document Type, default value: `product`, allowed values: `product`, `image`, `tag`\n * @property {String} parentDocument optional\n * @property {\"object\"} documentData blackbox object\n * @property {String} changeType optional, allowed values: `insert`, `update`, `remove`\n * @property {Object[]} diff optional, blackbox\n * @property {Date} createdAt required\n * @property {Date} updatedAt optional\n * @property {Date} publishAt optional\n */\nexport const Revisions = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    label: \"Revision Id\"\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: false,\n    defaultValue: {}\n  },\n  \"documentId\": {\n    type: String,\n    label: \"Reference Document Id\"\n  },\n  \"documentType\": {\n    type: String,\n    label: \"Document Type\",\n    defaultValue: \"product\",\n    allowedValues: [\"product\", \"image\", \"tag\"]\n  },\n  \"parentDocument\": {\n    type: String,\n    optional: true\n  },\n  \"documentData\": {\n    type: \"object\",\n    blackbox: true\n  },\n  \"changeType\": {\n    type: String,\n    optional: true,\n    allowedValues: [\"insert\", \"update\", \"remove\"]\n  },\n  \"diff\": {\n    type: Array,\n    optional: true\n  },\n  \"diff.$\": {\n    type: Object,\n    blackbox: true\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  },\n  \"publishAt\": {\n    type: Date,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Revisions\", Revisions);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { shopIdAutoValue, schemaIdAutoValue } from \"./helpers\";\nimport { Address } from \"./address\";\nimport { Invoice } from \"./payments\";\nimport { PackageConfig } from \"./registry\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name ShippoShippingMethod\n * @memberof schemas\n * @type {SimpleSchema}\n * @todo Move Shippo-related schema to Shippo module\n * @summary This will only exist in ShippingMethods Inside Cart/Order.\n * This does not exist in DB Shipping Collection as Shippo Methods are Dynamic.\n * @property {String} serviceLevelToken optional\n * @property {String} rateId optional\n */\nexport const ShippoShippingMethod = new SimpleSchema({\n  serviceLevelToken: {\n    type: String,\n    optional: true\n  },\n  rateId: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShippoShippingMethod\", ShippoShippingMethod);\n\n/**\n * @name ShippingMethod\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id Shipment method Id\n * @property {String} name Method name\n * @property {String} label Public label\n * @property {String} group Group, allowed values: `Ground`, `Priority`, `One Day`, `Free`\n * @property {Number} cost optional\n * @property {Number} handling optional, default value: `0`\n * @property {Number} rate Rate\n * @property {Boolean} enabled default value: `false`\n * @property {Array} validRanges optional, Matching cart ranges\n * @property {Object} validRanges.$ optional\n * @property {Number} validRanges.begin optional\n * @property {Number} validRanges.end optional\n * @property {Array} validLocales optional\n * @property {Object} validLocales.$ optional\n * @property {String} validLocales.$.origination optional\n * @property {String} validLocales.$.destination optional\n * @property {Number} validLocales.$.deliveryBegin optional\n * @property {Number} validLocales.$.deliveryEnd optional\n * @property {String} carrier optional\n * @property {ShippoShippingMethod} settings optional\n */\nexport const ShippingMethod = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    label: \"Shipment Method Id\",\n    autoValue: schemaIdAutoValue\n  },\n  \"name\": {\n    type: String,\n    label: \"Method Name\",\n    optional: true\n  },\n  \"label\": {\n    type: String,\n    label: \"Public Label\"\n  },\n  \"group\": {\n    type: String,\n    label: \"Group\",\n    allowedValues: [\"Ground\", \"Priority\", \"One Day\", \"Free\"],\n    optional: true\n  },\n  \"cost\": {\n    type: Number,\n    label: \"Cost\",\n    optional: true\n  },\n  \"handling\": {\n    type: Number,\n    label: \"Handling\",\n    optional: true,\n    defaultValue: 0,\n    min: 0\n  },\n  \"rate\": {\n    type: Number,\n    label: \"Rate\",\n    min: 0\n  },\n  \"enabled\": {\n    type: Boolean,\n    label: \"Enabled\",\n    defaultValue: false\n  },\n  \"validRanges\": {\n    type: Array,\n    optional: true,\n    label: \"Matching Cart Ranges\"\n  },\n  \"validRanges.$\": {\n    type: Object,\n    optional: true\n  },\n  \"validRanges.$.begin\": {\n    type: Number,\n    label: \"Begin\",\n    optional: true\n  },\n  \"validRanges.$.end\": {\n    type: Number,\n    label: \"End\",\n    optional: true\n  },\n  \"validLocales\": {\n    type: Array,\n    optional: true,\n    label: \"Matching Locales\"\n  },\n  \"validLocales.$\": {\n    type: Object,\n    optional: true\n  },\n  \"validLocales.$.origination\": {\n    type: String,\n    label: \"From\",\n    optional: true\n  },\n  \"validLocales.$.destination\": {\n    type: String,\n    label: \"To\",\n    optional: true\n  },\n  \"validLocales.$.deliveryBegin\": {\n    type: SimpleSchema.Integer,\n    label: \"Shipping Est.\",\n    optional: true\n  },\n  \"validLocales.$.deliveryEnd\": {\n    type: SimpleSchema.Integer,\n    label: \"Delivery Est.\",\n    optional: true\n  },\n  \"carrier\": { // kind of denormalizing, useful for having it in shipmentMethod( cart & order)\n    type: String, // Alternatively we can make an extra Schema:ShipmentMethod, that inherits\n    optional: true // ShippingMethod and add the optional carrier field\n  },\n  \"settings\": {\n    type: ShippoShippingMethod,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShippingMethod\", ShippingMethod);\n\n/**\n * @name ShipmentQuote\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} carrier Name of carrier\n * @property {ShippingMethod} method ShippingMethod\n * @property {Number} rate default value: `0.00`\n */\nexport const ShipmentQuote = new SimpleSchema({\n  carrier: {\n    type: String\n  },\n  method: {\n    type: ShippingMethod\n  },\n  rate: {\n    type: Number,\n    defaultValue: 0.00\n  },\n  shopId: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShipmentQuote\", ShipmentQuote);\n\n/**\n * @name ShipmentItem\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary Populate with order.items that are added to a shipment\n * @property {String} _id Shipment Line Item optional\n * @property {String} productId required\n * @property {String} shopId Shipment Item ShopId optional\n * @property {Number} quantity required\n * @property {String} variantId required\n */\nexport const ShipmentItem = new SimpleSchema({\n  _id: {\n    type: String,\n    label: \"Shipment Line Item\",\n    optional: true,\n    autoValue: schemaIdAutoValue\n  },\n  productId: {\n    type: String,\n    index: 1\n  },\n  shopId: {\n    type: String,\n    index: 1,\n    label: \"Shipment Item ShopId\",\n    optional: true\n  },\n  quantity: {\n    label: \"Quantity\",\n    type: SimpleSchema.Integer,\n    min: 0\n  },\n  variantId: {\n    type: String\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShipmentItem\", ShipmentItem);\n\n/**\n * @name ShippingParcel\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} containers optional\n * @property {Number} length optional\n * @property {Number} width optional\n * @property {Number} height optional\n * @property {Number} weight optional\n */\nexport const ShippingParcel = new SimpleSchema({\n  containers: {\n    type: String,\n    optional: true\n  },\n  length: {\n    type: Number,\n    optional: true\n  },\n  width: {\n    type: Number,\n    optional: true\n  },\n  height: {\n    type: Number,\n    optional: true\n  },\n  weight: {\n    type: Number,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShippingParcel\", ShippingParcel);\n\n/**\n * @name ShippoShipment\n * @summary Specific properties of Shipment for use with Shippo. We don't use\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} transactionId optional\n * @property {String} trackingStatusStatus optional Tracking Status's status\n * @property {String} trackingStatusDate optional\n */\nexport const ShippoShipment = new SimpleSchema({\n  transactionId: {\n    type: String,\n    optional: true\n  },\n  trackingStatusStatus: { // cause tracking_status.status\n    type: String,\n    optional: true\n  },\n  trackingStatusDate: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShippoShipment\", ShippoShipment);\n\n/**\n * @name ShipmentQuotesQueryStatusUsed\n * @todo Should requestStatus be required or not?\n * @memberof schemas\n * @type {SimpleSchema}\n * @summary Status of a query/consumption of a shipping provider's API (e.g Shippo) for shipping quotations.\n * @description Shipping quotations are the costs from different shipping methods like Fedex, DHL etc of\n * shipping one or more items to a particular place in a given amount of time.)\n * @property {String} requestStatus optional, default value: `noRequestsYet`\n * @property {String} shippingProvider optional\n * @property {Number} numOfShippingMethodsFound optional\n * @property {String} message optional\n */\nexport const ShipmentQuotesQueryStatus = new SimpleSchema({\n  requestStatus: {\n    type: String,\n    optional: true,\n    defaultValue: \"noRequestsYet\"\n  },\n  shippingProvider: {\n    type: String,\n    optional: true\n  },\n  numOfShippingMethodsFound: {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  message: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShipmentQuotesQueryStatus\", ShipmentQuotesQueryStatus);\n\n/**\n * @name Shipment\n * @summary Used for cart/order shipment tracking\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id Shipment ID\n * @property {String} shopId required\n * @property {String} paymentId Payment ID\n * @property {Address} address optional\n * @property {ShippingMethod} shipmentMethod optional\n * @property {ShipmentQuote[]} shipmentQuotes optional\n * @property {ShipmentQuotesQueryStatus} shipmentQuotesQueryStatus optional\n * @property {String} tracking optional\n * @property {ShippingParcel} parcel optional\n * @property {ShipmentItem[]} items optional\n * @property {Workflow} workflow optional\n * @property {Invoice} invoice optional\n * @property {Object[]} transactions optional\n * @property {String} shippingLabelUrl For printable Shipping label\n * @property {String} customsLabelUrl For customs printable label\n * @property {ShippoShipment} shippo For Shippo specific properties\n */\nexport const Shipment = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    label: \"Shipment Id\",\n    autoValue: schemaIdAutoValue\n  },\n  \"shopId\": {\n    type: String\n  },\n  \"paymentId\": {\n    type: String,\n    label: \"Payment Id\",\n    optional: true\n  },\n  \"address\": {\n    type: Address,\n    optional: true\n  },\n  \"shipmentMethod\": {\n    type: ShippingMethod,\n    optional: true\n  },\n  \"shipmentQuotes\": {\n    type: Array,\n    optional: true\n  },\n  \"shipmentQuotes.$\": {\n    type: ShipmentQuote,\n    optional: true\n  },\n  \"shipmentQuotesQueryStatus\": {\n    type: ShipmentQuotesQueryStatus,\n    optional: true,\n    defaultValue: {}\n  },\n  \"tracking\": {\n    type: String,\n    optional: true\n  },\n  \"parcel\": {\n    type: ShippingParcel,\n    optional: true\n  },\n  \"items\": {\n    type: Array,\n    optional: true\n  },\n  \"items.$\": {\n    type: ShipmentItem,\n    optional: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  },\n  \"invoice\": {\n    type: Invoice,\n    optional: true\n  },\n  \"transactions\": {\n    type: Array,\n    optional: true\n  },\n  \"transactions.$\": {\n    type: Object,\n    optional: true,\n    blackbox: true\n  },\n  \"shippingLabelUrl\": {\n    type: String,\n    optional: true\n  },\n  \"customsLabelUrl\": {\n    type: String,\n    optional: true\n  },\n  \"shippo\": {\n    type: ShippoShipment,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Shipment\", Shipment);\n\n/**\n * @name ShippoShippingProvider Schema\n * @summary Specific properties for use with Shippo.\n * @description We don't use ShippingProvider service* fields because\n * Shippo is on level higher service than simple carrier's ,e.g Fedex api.\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} carrierAccountId optional\n */\nexport const ShippoShippingProvider = new SimpleSchema({\n  carrierAccountId: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShippoShippingProvider\", ShippoShippingProvider);\n\n/**\n * @name ShippingProvider\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id optional\n * @property {String} name optional\n * @property {String} label optional\n * @property {Boolean} enabled optional, default value: `true`\n * @property {String} serviceAuth optional\n * @property {String} serviceSecret optional\n * @property {String} serviceUrl optional\n * @property {ShippoShippingProvider} shippoProvider optional\n */\nexport const ShippingProvider = new SimpleSchema({\n  _id: {\n    type: String,\n    label: \"Provider Id\",\n    optional: true,\n    autoValue: schemaIdAutoValue\n  },\n  name: {\n    type: String,\n    label: \"Service Code\",\n    optional: true\n  },\n  label: {\n    type: String,\n    label: \"Public Label\"\n  },\n  enabled: {\n    type: Boolean,\n    defaultValue: true\n  },\n  serviceAuth: {\n    type: String,\n    label: \"Auth\",\n    optional: true\n  },\n  serviceSecret: {\n    type: String,\n    label: \"Secret\",\n    optional: true\n  },\n  serviceUrl: {\n    type: String,\n    label: \"Service URL\",\n    optional: true\n  },\n  shippoProvider: {\n    type: ShippoShippingProvider,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShippingProvider\", ShippingProvider);\n\n/**\n * @name Shipping\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id optional\n * @property {String} shopId required\n * @property {String} name optional\n * @property {ShippingProvider} provider optional\n * @property {ShippingMethod[]} methods optional\n * @property {ShipmentQuote[]} shipmentQuotes optional\n */\nexport const Shipping = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    label: \"Service Id\",\n    optional: true\n  },\n  \"shopId\": {\n    type: String,\n    index: 1,\n    autoValue: shopIdAutoValue,\n    label: \"Shipping ShopId\"\n  },\n  \"name\": {\n    type: String,\n    label: \"Service Name\",\n    optional: true,\n    index: 1\n  },\n  \"provider\": {\n    type: ShippingProvider,\n    label: \"Shipping Provider\"\n  },\n  \"methods\": {\n    type: Array,\n    optional: true,\n    label: \"Shipping Methods\"\n  },\n  \"methods.$\": {\n    type: ShippingMethod\n  },\n  \"shipmentQuotes\": {\n    type: Array,\n    optional: true,\n    label: \"Quoted Methods\"\n  },\n  \"shipmentQuotes.$\": {\n    type: ShipmentQuote\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Shipping\", Shipping);\n\n/**\n * @name ShippingPackage\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} settings.name default value: `Flat Rate Service`\n */\nexport const ShippingPackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.name\": {\n    type: String,\n    defaultValue: \"Flat Rate Service\"\n  }\n});\n\nregisterSchema(\"ShippingPackageConfig\", ShippingPackageConfig);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { getSlug } from \"/lib/api\";\nimport { Email } from \"./accounts\";\nimport { Address } from \"./address\";\nimport { createdAtAutoValue, updatedAtAutoValue } from \"./helpers\";\nimport { Layout } from \"./layouts\";\nimport { Metafield } from \"./metafield\";\nimport { Workflow } from \"./workflow\";\n\n/**\n * @name CustomEmailSettings\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} service optional\n * @property {String} username optional\n * @property {String} password optional\n * @property {String} host optional\n * @property {Number} port optional\n */\nexport const CustomEmailSettings = new SimpleSchema({\n  service: {\n    type: String,\n    optional: true\n  },\n  username: {\n    type: String,\n    optional: true\n  },\n  password: {\n    type: String,\n    optional: true\n  },\n  host: {\n    type: String,\n    optional: true\n  },\n  port: {\n    type: SimpleSchema.Integer,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"CustomEmailSettings\", CustomEmailSettings);\n\n/**\n * @name Currency\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} symbol default value: `$`\n * @property {String} format default value: `%s%v`\n * @property {Number} scale optional, default value: `2`\n * @property {String} decimal optional, default value: `.`\n * @property {String} thousand optional, default value: `,`\n * @property {Number} rate optional\n */\nexport const Currency = new SimpleSchema({\n  symbol: {\n    type: String,\n    defaultValue: \"$\"\n  },\n  format: {\n    type: String,\n    defaultValue: \"%s%v\"\n  },\n  scale: {\n    type: SimpleSchema.Integer,\n    defaultValue: 2,\n    optional: true\n  },\n  decimal: {\n    type: String,\n    defaultValue: \".\",\n    optional: true\n  },\n  thousand: {\n    type: String,\n    defaultValue: \",\",\n    optional: true\n  },\n  rate: {\n    type: Number,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Currency\", Currency);\n\n/**\n * @name Locale\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {Object} continents blackbox\n * @property {Object} countries blackbox\n */\nexport const Locale = new SimpleSchema({\n  continents: {\n    type: Object,\n    blackbox: true\n  },\n  countries: {\n    type: Object,\n    blackbox: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Locale\", Locale);\n\n/**\n * @name Languages\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} label required\n * @property {String} i18n required\n * @property {Boolean} enabled, default value: `true`\n */\nexport const Languages = new SimpleSchema({\n  label: {\n    type: String\n  },\n  i18n: {\n    type: String\n  },\n  enabled: {\n    type: Boolean,\n    defaultValue: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Languages\", Languages);\n\n/**\n * @name ShopTheme\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} themeId required\n * @property {String} styles optional\n */\nexport const ShopTheme = new SimpleSchema({\n  themeId: {\n    type: String\n  },\n  styles: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ShopTheme\", ShopTheme);\n\n/**\n * @name BrandAsset\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} mediaId optional\n * @property {String} type optional\n */\nexport const BrandAsset = new SimpleSchema({\n  mediaId: {\n    type: String,\n    optional: true\n  },\n  type: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"BrandAsset\", BrandAsset);\n\n/**\n * @name MerchantShop\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id Shop label\n * @property {String} slug Shop slug\n * @property {String} name Shop name\n */\nconst MerchantShop = new SimpleSchema({\n  _id: {\n    type: String,\n    label: \"Shop Label\"\n  },\n  slug: {\n    type: String,\n    label: \"Shop Slug\"\n  },\n  name: {\n    type: String,\n    label: \"Shop Name\"\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"MerchantShop\", MerchantShop);\n\n/**\n * @name Shop\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id optional\n * @property {String} slug optional, auto-generated\n * @property {MerchantShop[]} merchantShops optional\n * @property {String} shopType required, default value: `merchant`, accepted values: `primary`, `merchant`, `affiliate`\n * @property {Boolean} active required, default value: ` true`\n * @property {String} status default value: `active`\n * @property {String} name\n * @property {String} description optional\n * @property {String} keywords optional\n * @property {Address[]} addressBook optional\n * @property {String[]} domains default value: `[localhost]`\n * @property {Email[]} emails optional\n * @property {String} defaultPaymentMethod required, default value: `none`\n * @property {String} currency default value: `USD`\n * @property {Object} currencies optional, blackbox, `Currency` schema\n * @property {Locale} locales required\n * @property {String} language default value: `en`\n * @property {Languages[]} languages optional\n * @property {String} public optional\n * @property {String} timezone default value: `US/Pacific`\n * @property {String} baseUOL Base UOL (Unit of Length), default value: `in`, lowercased by default per style\n * @property {Object[]} unitsOfLength optional, default value: `in`\n * @property {String} unitsOfLength.$.uol  default value: `in`\n * @property {String} unitsOfLength.$.label default value: `Inches`\n * @property {Boolean} unitsOfLength.$.default default value: `false`\n * @property {String} baseUOM Base UOM (Unit of Measure), default value: `oz`, lowercased by default per style\n * @property {Object[]} unitsOfMeasure optional\n * @property {String} unitsOfMeasure.$.uom default value: `oz`\n * @property {String} unitsOfMeasure.$.label default value: `Ounces`\n * @property {Boolean} unitsOfMeasure.$.default default value: `false`\n * @property {Metafield[]} metafields optional\n * @property {String[]} defaultSellerRoles default values: `[\"owner\", \"admin\", \"seller\", \"guest\", \"manage-users\", \"orders\", \"account/profile\", \"product\", \"createProduct\", \"tag\", \"index\", \"cart/checkout\", \"cart/completed\"]`\n * @property {Layout[]} layout optional\n * @property {ShopTheme} theme optional\n * @property {BrandAsset[]} brandAssets optional\n * @property {String} appVersion optional\n * @property {Date} createdAt optional\n * @property {Date} updatedAt optional\n * @property {Object[]} paymentMethods blackbox, default value: `[]`\n * @property {Workflow} workflow optional\n */\nexport const Shop = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    optional: true\n  },\n  \"slug\": {\n    type: String,\n    optional: true,\n    unique: true,\n    autoValue() {\n      let slug = getSlug(this.value);\n\n      if (!slug && this.siblingField(\"name\").value) {\n        slug = getSlug(this.siblingField(\"name\").value);\n      }\n      if (this.isInsert) {\n        return slug;\n      } else if (this.isUpsert) {\n        return {\n          $setOnInsert: slug\n        };\n      }\n    }\n  },\n  \"merchantShops\": {\n    type: Array,\n    optional: true\n  },\n  \"merchantShops.$\": {\n    type: MerchantShop\n  },\n  \"shopType\": {\n    type: String,\n    // Default value is merchant because we seed the first created shop with \"primary\"\n    // In a marketplace, there should only be one \"primary\" shop\n    defaultValue: \"merchant\", // \"primary\", \"merchant\", \"affiliate\",\n    index: true\n  },\n  \"active\": {\n    type: Boolean,\n    defaultValue: true,\n    index: true\n  },\n  // not sure what this is used for. Prefer the boolean above for indexing\n  \"status\": {\n    type: String,\n    defaultValue: \"active\"\n  },\n  \"name\": {\n    type: String,\n    index: 1\n  },\n  \"description\": {\n    type: String,\n    optional: true\n  },\n  \"keywords\": {\n    type: String,\n    optional: true\n  },\n  \"addressBook\": {\n    type: Array,\n    optional: true\n  },\n  \"addressBook.$\": {\n    type: Address\n  },\n  \"domains\": {\n    type: Array,\n    defaultValue: [\"localhost\"],\n    index: 1\n  },\n  \"domains.$\": String,\n  \"emails\": {\n    type: Array,\n    optional: true\n  },\n  \"emails.$\": {\n    type: Email\n  },\n  \"defaultPaymentMethod\": {\n    label: \"Default Payment Method\",\n    type: String,\n    defaultValue: \"none\"\n  },\n  \"currency\": {\n    label: \"Base Currency\",\n    type: String,\n    defaultValue: \"USD\"\n  },\n  \"currencies\": {\n    type: Object, // Schemas.Currency\n    blackbox: true,\n    optional: true\n  },\n  \"locales\": {\n    type: Locale\n  },\n  \"language\": {\n    label: \"Base Language\",\n    type: String,\n    defaultValue: \"en\"\n  },\n  \"languages\": {\n    type: Array,\n    optional: true\n  },\n  \"languages.$\": {\n    type: Languages\n  },\n  \"public\": {\n    type: String,\n    optional: true\n  },\n  \"timezone\": {\n    label: \"Timezone\",\n    type: String,\n    defaultValue: \"US/Pacific\"\n  },\n  \"baseUOL\": {\n    type: String,\n    optional: true,\n    defaultValue: \"in\",\n    label: \"Base Unit of Length\"\n  },\n  \"unitsOfLength\": {\n    type: Array,\n    optional: true\n  },\n  \"unitsOfLength.$\": Object,\n  \"unitsOfLength.$.uol\": {\n    type: String,\n    optional: true,\n    defaultValue: \"in\"\n  },\n  \"unitsOfLength.$.label\": {\n    type: String,\n    optional: true,\n    defaultValue: \"Inches\"\n  },\n  \"unitsOfLength.$.default\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"baseUOM\": {\n    type: String,\n    optional: true,\n    defaultValue: \"oz\",\n    label: \"Base Unit of Measure\"\n  },\n  \"unitsOfMeasure\": {\n    type: Array,\n    optional: true\n  },\n  \"unitsOfMeasure.$\": Object,\n  \"unitsOfMeasure.$.uom\": {\n    type: String,\n    optional: true,\n    defaultValue: \"oz\"\n  },\n  \"unitsOfMeasure.$.label\": {\n    type: String,\n    optional: true,\n    defaultValue: \"Ounces\"\n  },\n  \"unitsOfMeasure.$.default\": {\n    type: Boolean,\n    optional: true,\n    defaultValue: false\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": {\n    type: Metafield\n  },\n  \"defaultSellerRoles\": {\n    type: Array,\n    defaultValue: [\n      \"owner\",\n      \"admin\",\n      \"seller\",\n      \"guest\",\n      \"manage-users\",\n      \"orders\",\n      \"account/profile\",\n      \"product\",\n      \"createProduct\",\n      \"tag\",\n      \"index\",\n      \"cart/checkout\",\n      \"cart/completed\"\n    ]\n  },\n  \"defaultSellerRoles.$\": {\n    type: String\n  },\n  \"layout\": {\n    type: Array,\n    optional: true\n  },\n  \"layout.$\": {\n    type: Layout\n  },\n  \"theme\": {\n    type: ShopTheme,\n    optional: true\n  },\n  \"brandAssets\": {\n    type: Array,\n    optional: true\n  },\n  \"brandAssets.$\": {\n    type: BrandAsset\n  },\n  \"appVersion\": {\n    type: String,\n    optional: true\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue,\n    optional: true\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue: updatedAtAutoValue,\n    optional: true\n  },\n  \"paymentMethods\": {\n    type: Array,\n    defaultValue: []\n  },\n  \"paymentMethods.$\": {\n    type: Object,\n    blackbox: true\n  },\n  \"workflow\": {\n    type: Workflow,\n    optional: true,\n    defaultValue: {}\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Shop\", Shop);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Sms\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} apiKey optional\n * @property {String} apiToken optional\n * @property {String} shopId optional\n * @property {String} smsPhone optional\n * @property {String} smsProvider optional\n */\nexport const Sms = new SimpleSchema({\n  apiKey: {\n    type: String,\n    optional: true\n  },\n  apiToken: {\n    type: String,\n    optional: true\n  },\n  shopId: {\n    type: String,\n    optional: true\n  },\n  smsPhone: {\n    type: String,\n    optional: true\n  },\n  smsProvider: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Sms\", Sms);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { PackageConfig } from \"./registry\";\n\n/**\n * @name SocialProvider\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} profilePage optional, Profile Page\n * @property {Boolean} enabled optional, default value: `false`\n */\nexport const SocialProvider = new SimpleSchema({\n  profilePage: {\n    type: String,\n    regEx: SimpleSchema.RegEx.Url,\n    label: \"Profile Page\",\n    optional: true\n  },\n  enabled: {\n    type: Boolean,\n    label: \"Enabled\",\n    defaultValue: false,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"SocialProvider\", SocialProvider);\n\n/**\n * @name SocialPackageConfig\n * @memberof schemas\n * @type {SimpleSchema}\n * @extends {PackageConfig}\n * @property {Object} settings.public optional\n * @property {Object} settings.public.apps optional\n * @property {SocialProvider} settings.public.apps.facebook  optional, Facebook\n * @property {String} settings.public.apps.facebook.appId optional, Facebook App ID\n * @property {String} settings.public.apps.facebook.appSecret optional, Facebook App Secret\n * @property {SocialProvider} settings.public.apps.twitter optional, Twitter\n * @property {String} settings.public.apps.twitter.username optional, Twitter username\n * @property {SocialProvider} settings.public.apps.pinterest optional, Pinterest\n * @property {SocialProvider} settings.public.apps.googleplus optional, Google+\n */\nexport const SocialPackageConfig = PackageConfig.clone().extend({\n  // Remove blackbox: true from settings obj\n  \"settings\": {\n    type: Object,\n    optional: true,\n    blackbox: false,\n    defaultValue: {}\n  },\n  \"settings.public\": {\n    type: Object,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.public.apps\": {\n    type: Object,\n    label: \"Social Settings\",\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.public.apps.facebook\": {\n    type: SocialProvider,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.public.apps.facebook.appId\": {\n    type: String,\n    regEx: /\\d+/,\n    label: \"App Id\",\n    optional: true\n  },\n  \"settings.public.apps.facebook.appSecret\": {\n    type: String,\n    regEx: /[\\da-z]+/,\n    label: \"App Secret\",\n    optional: true\n  },\n  \"settings.public.apps.twitter\": {\n    type: SocialProvider,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.public.apps.twitter.username\": {\n    type: String,\n    label: \"Username\",\n    optional: true\n  },\n  \"settings.public.apps.pinterest\": {\n    type: SocialProvider,\n    optional: true,\n    defaultValue: {}\n  },\n  \"settings.public.apps.googleplus\": {\n    type: SocialProvider,\n    label: \"Google+\",\n    optional: true,\n    defaultValue: {}\n  }\n});\n\nregisterSchema(\"SocialPackageConfig\", SocialPackageConfig);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { createdAtAutoValue, shopIdAutoValue } from \"./helpers\";\nimport { Metafield } from \"./metafield\";\n\n/**\n * @name Tag\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} _id optional\n * @property {String} name required\n * @property {String} slug required\n * @property {String} type optional\n * @property {Metafield[]} metafields optional\n * @property {Number} position optional\n * @property {String[]} relatedTagIds optional\n * @property {Boolean} isDeleted default value: `false`\n * @property {Boolean} isTopLevel required\n * @property {Boolean} isVisible defalut value: `true`\n * @property {String[]} groups optional, default value: `[],` groupIds that this tag belongs to\n * @property {String} shopId Tag shopId\n * @property {Date} createdAt required\n * @property {Date} updatedAt required\n */\nexport const Tag = new SimpleSchema({\n  \"_id\": {\n    type: String,\n    optional: true\n  },\n  \"name\": {\n    type: String,\n    index: 1\n  },\n  \"slug\": String,\n  \"type\": {\n    type: String,\n    optional: true\n  },\n  \"metafields\": {\n    type: Array,\n    optional: true\n  },\n  \"metafields.$\": Metafield,\n  \"position\": {\n    type: SimpleSchema.Integer,\n    optional: true\n  },\n  \"relatedTagIds\": {\n    type: Array,\n    optional: true,\n    index: 1\n  },\n  \"relatedTagIds.$\": String,\n  \"isDeleted\": {\n    type: Boolean,\n    defaultValue: false\n  },\n  \"isTopLevel\": Boolean,\n  \"isVisible\": {\n    type: Boolean,\n    defaultValue: true\n  },\n  \"groups\": {\n    type: Array, // groupIds that this tag belongs to\n    optional: true,\n    defaultValue: []\n  },\n  \"groups.$\": String,\n  \"shopId\": {\n    type: String,\n    index: 1,\n    autoValue: shopIdAutoValue,\n    label: \"Tag shopId\"\n  },\n  \"createdAt\": {\n    type: Date,\n    autoValue: createdAtAutoValue\n  },\n  \"updatedAt\": {\n    type: Date,\n    autoValue() {\n      return new Date();\n    }\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Tag\", Tag);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { shopIdAutoValue } from \"./helpers\";\n\n/**\n * @name sharedFields\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} shopId Template ShopId\n * @property {String} name required\n * @property {String} title optional\n * @property {Number} priority optional, default value: 1\n * @property {Boolean} enabled default value: true\n * @property {String} route optional\n * @property {String} type default value: `template`\n * @property {String} provides default value: `template`\n * @property {String} block optional\n * @property {Object} defaultData optional, blackbox\n * @property {String} parser required\n * @property {String} language optional, default value: `en`\n * @property {String} source optional\n */\nconst sharedFields = {\n  shopId: {\n    type: String,\n    index: 1,\n    autoValue: shopIdAutoValue,\n    label: \"Template ShopId\"\n  },\n  name: {\n    type: String\n  },\n  title: {\n    type: String,\n    optional: true\n  },\n  priority: {\n    type: SimpleSchema.Integer,\n    optional: true,\n    defaultValue: 1\n  },\n  enabled: {\n    type: Boolean,\n    defaultValue: true\n  },\n  route: {\n    type: String,\n    optional: true\n  },\n  type: {\n    type: String,\n    defaultValue: \"template\"\n  },\n  provides: {\n    type: String,\n    defaultValue: \"template\"\n  },\n  block: {\n    type: String,\n    optional: true\n  },\n  defaultData: {\n    type: Object,\n    blackbox: true,\n    optional: true\n  },\n  parser: {\n    type: String\n  },\n  language: {\n    type: String,\n    optional: true,\n    defaultValue: \"en\"\n  },\n  source: {\n    type: String,\n    optional: true\n  }\n};\n\n/**\n * @name ReactLayout\n * @memberof schemas\n * @summary Extends fields from sharedFields\n * @type {SimpleSchema}\n * @extends {sharedFields}\n * @property {String[]} templateFor optional\n * @property {Object[]} template optional, blackbox\n */\nexport const ReactLayout = new SimpleSchema({\n  ...sharedFields,\n  \"templateFor\": {\n    type: Array,\n    optional: true\n  },\n  \"templateFor.$\": String,\n  \"template\": {\n    type: Array,\n    optional: true\n  },\n  \"template.$\": {\n    type: Object,\n    blackbox: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"ReactLayout\", ReactLayout);\n\n/**\n * @name Template\n * @memberof schemas\n * @summary Extends fields from sharedFields\n * @type {SimpleSchema}\n * @extends {sharedFields}\n * @property {Object[]} template optional, blackbox\n */\nexport const Template = new SimpleSchema({\n  ...sharedFields,\n  template: {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Template\", Template);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { shopIdAutoValue } from \"./helpers\";\n\n/**\n * @name Translation\n * @memberof schemas\n * @type {SimpleSchema}\n * @todo Mostly just a blackbox for now. Someday we'll validate the entire schema\n * @property {String} shopId, Translation ShopId\n * @property {String} language, language\n * @property {String} i18n, translation\n * @property {String} ns, namespace\n * @property {Object} translation, blackbox\n */\nexport const Translation = new SimpleSchema({\n  shopId: {\n    type: String,\n    index: 1,\n    autoValue: shopIdAutoValue,\n    label: \"Translation ShopId\"\n  },\n  language: {\n    type: String\n  },\n  i18n: {\n    type: String,\n    index: 1\n  },\n  ns: {\n    type: String,\n    label: \"Namespace\"\n  },\n  translation: {\n    type: Object,\n    blackbox: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Translation\", Translation);\n","import SimpleSchema from \"simpl-schema\";\nimport { check } from \"meteor/check\";\nimport { Tracker } from \"meteor/tracker\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\n\n/**\n * @name Workflow\n * @summary Control view flow by attaching layout to a collection.\n * Shop defaultWorkflow is defined in Shop.\n * @memberof schemas\n * @type {SimpleSchema}\n * @property {String} status, default value: `new`\n * @property {String[]} workflow optional\n */\nexport const Workflow = new SimpleSchema({\n  \"status\": {\n    type: String,\n    defaultValue: \"new\",\n    index: 1\n  },\n  \"workflow\": {\n    type: Array,\n    optional: true\n  },\n  \"workflow.$\": String\n}, { check, tracker: Tracker });\n\nregisterSchema(\"Workflow\", Workflow);\n","import accounting from \"accounting-js\";\nimport _ from \"lodash\";\nimport { Shops } from \"/lib/collections\";\n\n/**\n * getSummary\n * @private\n * @summary iterates over cart items with computations\n * @param {Array} items - cart.items array\n * @param {Array} prop - path to item property represented by array\n * @param {Array} [prop2] - path to another item property represented by array\n * @param {String} [shopId] - shopId\n * @return {Number} - computations result\n */\nfunction getSummary(items, prop, prop2, shopId) {\n  try {\n    if (Array.isArray(items)) {\n      return items.reduce((sum, item) => {\n        if (prop2) {\n          if (shopId) {\n            if (shopId === item.shopId) {\n              // if we're looking for a specific shop's items and this item does match\n              // if prop2 is an empty array\n              if (!prop2.length) {\n                return sum + (prop.length === 1 ? item[prop[0]] :\n                  item[prop[0]][prop[1]]);\n              }\n              return sum + item[prop[0]] * (prop2.length === 1 ? item[prop2[0]] :\n                item[prop2[0]][prop2[1]]);\n            }\n            // If we're looking for a specific shop's items and this item doesn't match\n            return sum;\n          }\n          // No shopId param\n          // S + a * b, where b could be b1 or b2\n          return sum + item[prop[0]] * (prop2.length === 1 ? item[prop2[0]] :\n            item[prop2[0]][prop2[1]]);\n        }\n        // No prop2 param\n        // S + b, where b could be b1 or b2\n        return sum + (prop.length === 1 ? item[prop[0]] :\n          item[prop[0]][prop[1]]);\n      }, 0);\n    }\n  } catch (e) {\n    // If data not prepared we should send a number to avoid exception with\n    // `toFixed`. This could happens if user stuck on `completed` checkout stage\n    // by some reason.\n    return 0;\n  }\n  return 0;\n}\n\n/**\n * Reaction transform methods on Collections\n * @file Use transform methods to return Cart and Order calculated values: count, subTotal, shipping, taxes, total.\n * Use these methods on Cart and Orders in templates, `{{cart.getCount}}` and in code, `Cart.findOne().getTotal()`.\n * These use Meteor Collection {@link http://docs.meteor.com/api/collections.html#Mongo-Collection transforms}.\n * @module cartOrderTransform\n */\n\nexport const cartOrderTransform = {\n  /**\n   * @summary Return the total quantity on the order\n   * @method getCount\n   * @example {cart ? cart.getCount() : 0}\n   * @returns {Number}  Total quantity of items on the order\n   */\n  getCount() {\n    return getSummary(this.items, [\"quantity\"]);\n  },\n  /**\n   * @summary Return the total price of shipping/handling on the order\n   * @method getShippingTotal\n   * @returns {Number} Total price of shipping/handling on the order\n   */\n  getShippingTotal() {\n    // loop through the cart.shipping, sum shipments.\n    const rate = getSummary(this.shipping, [\"shipmentMethod\", \"rate\"]);\n    const handling = getSummary(this.shipping, [\"shipmentMethod\", \"handling\"]);\n    const shipping = handling + rate || 0;\n    return accounting.toFixed(shipping, 2);\n  },\n  /**\n   * @summary Get the total price of shipping, broken down by shop\n   * @method getShippingTotalByShop\n   * @returns {{Object}} - Total price of shipping, broken down by shop\n   */\n  getShippingTotalByShop() {\n    return this.shipping.reduce((uniqueShopShippingTotals, shippingRec) => {\n      if (!uniqueShopShippingTotals[shippingRec.shopId]) {\n        const rate = getSummary(this.shipping, [\"shipmentMethod\", \"rate\"], [], shippingRec.shopId);\n        const handling = getSummary(this.shipping, [\"shipmentMethod\", \"handling\"], [], shippingRec.shopId);\n        const shipping = handling + rate || 0;\n        uniqueShopShippingTotals[shippingRec.shopId] = accounting.toFixed(shipping, 2);\n        return uniqueShopShippingTotals;\n      }\n      return uniqueShopShippingTotals;\n    }, {});\n  },\n  /**\n   * @summary Return the total price of goods on an order\n   * @method getSubTotal\n   * @returns {Number} Total price of goods for the order\n   */\n  getSubTotal() {\n    const subTotal = getSummary(this.items, [\"quantity\"], [\"variants\", \"price\"]);\n    return accounting.toFixed(subTotal, 2);\n  },\n  /**\n   * @summary Aggregates the subtotals by shopId\n   * @method getSubtotalByShop\n   * @return {object} Object with a key for each shopId in the cart/order where the value is the subtotal for that shop\n   */\n  getSubtotalByShop() {\n    return this.items.reduce((uniqueShopSubTotals, item) => {\n      if (!uniqueShopSubTotals[item.shopId]) {\n        const subTotal = getSummary(this.items, [\"quantity\"], [\"variants\", \"price\"], item.shopId);\n        uniqueShopSubTotals[item.shopId] = accounting.toFixed(subTotal, 2);\n        return uniqueShopSubTotals;\n      }\n      return uniqueShopSubTotals;\n    }, {});\n  },\n  /**\n   * @summary Total taxes for order\n   * @method getTaxTotal\n   * @returns {Number} Total price of taxes for an order\n   */\n  getTaxTotal() {\n    // taxes are calculated in a Cart.after.update hooks\n    // the tax value stored with the cart/order is the effective tax rate\n    // calculated by line items\n    // in the imports/core/taxes plugin\n    const tax = this.tax || 0;\n    const subTotal = parseFloat(this.getSubTotal());\n    const taxTotal = subTotal * tax;\n    return accounting.toFixed(taxTotal, 2);\n  },\n  /**\n   * @summary Aggregates the taxes by shopId\n   * @method getTaxesByShop\n   * @return {Object} Object with a key for each shopId in cart/order where the value is the tax total for that shop\n   */\n  getTaxesByShop() {\n    const subtotals = this.getSubtotalByShop();\n    const taxRates = this.taxRatesByShop;\n\n    return Object.keys(subtotals).reduce((shopTaxTotals, shopId) => {\n      if (!shopTaxTotals[shopId]) {\n        const shopSubtotal = parseFloat(subtotals[shopId]);\n        // In case of taxAPI's tax rate is stored in tax.\n        const shopTaxRate = (taxRates && taxRates[shopId]) || this.tax || 0;\n        const shopTaxTotal = shopSubtotal * shopTaxRate;\n        shopTaxTotals[shopId] = accounting.toFixed(shopTaxTotal, 2);\n      }\n      return shopTaxTotals;\n    }, {});\n  },\n  /**\n   * @summary Discount for cart/order.\n   * @description Grabs discounts from the invoice records if they exist, otherwise from this.discounts\n   * @example const cartTaxesByShop = cart.getTaxesByShop();\n   * @method getDiscounts\n   * @return {Number} Total value of discounts\n   */\n  getDiscounts() {\n    let orderDiscounts = 0;\n    orderDiscounts = this.billing.reduce((acc, item) => {\n      if (item.invoice) {\n        return acc + parseFloat(item.invoice.discounts);\n      }\n      return acc;\n    }, 0);\n    const cartDiscount = parseFloat(this.discount) || 0;\n    const discount = orderDiscounts || cartDiscount || 0;\n    return accounting.toFixed(discount, 2);\n  },\n  /**\n   * @summary Discounts by Shop\n   * @method getDiscountsByShop\n   * @returns {object} - An object where the key is a shopId and the value is the discount for that shop\n   */\n  getDiscountsByShop() {\n    const discountsByShop = {};\n    if (this.billing && this.billing[0].invoice) { // check if we have the invoice object on the billing records\n      for (const billingRecord of this.billing) {\n        discountsByShop[billingRecord.shopId] = accounting.toFixed(billingRecord.invoice.discounts);\n      }\n    }\n    return discountsByShop;\n  },\n  /**\n   * @summary Total for Order\n   * @method getTotal\n   * @return {Number} Total for order\n   */\n  getTotal() {\n    const subTotal = parseFloat(this.getSubTotal());\n    const shipping = parseFloat(this.getShippingTotal());\n    const taxes = parseFloat(this.getTaxTotal());\n    const discount = parseFloat(this.getDiscounts());\n    const discountTotal = Math.max(0, subTotal - discount);\n    const total = discountTotal + shipping + taxes;\n    return accounting.toFixed(total, 2);\n  },\n  /**\n   * @summary Aggregates the cart/order total by shopId\n   * @method getTotalByShop\n   * @return {object} An object with a key for each shopId in the cart/order where the value is the total for that shop\n   */\n  getTotalByShop() {\n    const subtotals = this.getSubtotalByShop();\n    const taxes = this.getTaxesByShop();\n    const shippingTotalByShop = this.getShippingTotalByShop();\n\n    // no discounts right now because that will need to support multi-shop\n    // TODO: Build out shop-by-shop discounts and permit discounts to reduce application fee\n    const shopsInCart = Object.keys(subtotals);\n    return Object.keys(subtotals).reduce((shopTotals, shopId) => {\n      if (!shopTotals[shopId]) {\n        let shopSubtotal = parseFloat(subtotals[shopId]);\n        // pending the implementation of shop-by-shop discounts, we allow discounts to apply only on single shop carts\n        if (shopsInCart.length === 1) {\n          const discount = parseFloat(this.getDiscounts());\n          shopSubtotal = parseFloat(subtotals[shopId]) - discount;\n        }\n\n        const shopTaxes = parseFloat(taxes[shopId]);\n        const shipping = parseFloat(shippingTotalByShop[shopId]);\n        const shopTotal = shopSubtotal + shopTaxes + shipping;\n        shopTotals[shopId] = accounting.toFixed(shopTotal, 2);\n      }\n      return shopTotals;\n    }, {});\n  },\n  /**\n   * @summary Cart items organized by shopId\n   * @method getItemsByShop\n   * @example const cartTotals = cart.getTotalByShop();\n   * @return {Object} Dict of shopIds with an array of items from that shop that are present in the cart/order\n   */\n  getItemsByShop() {\n    if (this.items) {\n      return this.items.reduce((itemsByShop, item) => {\n        if (!itemsByShop[item.shopId]) {\n          itemsByShop[item.shopId] = [item];\n        } else {\n          itemsByShop[item.shopId].push(item);\n        }\n        return itemsByShop;\n      }, {});\n    }\n    return {};\n  },\n  /**\n   * @summary Returns an array of payment methods, normalized\n   * @method getPaymentMethods\n   * @returns {Array} Array of Payment Method objects\n   */\n  getPaymentMethods() {\n    const billingMethods = this.billing.map((method) => method.paymentMethod);\n    const methodObjects = billingMethods.map((method) => {\n      const paymentMethodObject = {\n        storedCard: method.storedCard,\n        processor: method.processor,\n        mode: method.mode,\n        transactionId: method.transactionId,\n        amount: method.amount,\n        method: method.method\n      };\n      return paymentMethodObject;\n    });\n    return methodObjects;\n  },\n  /**\n   * @summary Return an array of payment methods for display removing duplicates\n   * @method getUniquePaymentMethods\n   * @returns {object} - An object containing the payment methods used on this order excluding duplicates\n   */\n  getUniquePaymentMethods() {\n    const billingMethods = this.billing.map((method) => method.paymentMethod);\n    const uniqueMethods = {};\n    for (const billingMethod of billingMethods) {\n      const key = `${billingMethod.storedCard}${billingMethod.processor}${billingMethod.method}`;\n      if (!uniqueMethods[key]) {\n        uniqueMethods[key] = {\n          storedCard: billingMethod.storedCard,\n          processor: billingMethod.processor,\n          method: billingMethod.method,\n          key\n        };\n      }\n    }\n    const uniqueValueArray = _.values(uniqueMethods);\n    return uniqueValueArray;\n  },\n  /**\n   * @summary Create an object that contains a summary for each shop\n   * @method getShopSummary\n   * @return {Object}  An object with a key for each shopId, and name + summary data for each\n   */\n  getShopSummary() {\n    // massage items into an object by Shop\n    const taxesByShop = this.getTaxesByShop();\n    const subTotalsByShop = this.getSubtotalByShop();\n    const shippingByShop = this.getShippingTotalByShop();\n    const { shipping } = this;\n    const itemsByShop = this.items.reduce((shopItems, item) => {\n      if (!shopItems[item.shopId]) {\n        shopItems[item.shopId] = [item];\n      } else {\n        shopItems[item.shopId].push(item);\n      }\n      return shopItems;\n    }, {});\n\n    const shopObjects = Object.keys(itemsByShop).map((shop) => ({\n      [shop]: {\n        name: Shops.findOne(shop).name,\n        subTotal: subTotalsByShop[shop],\n        taxes: taxesByShop[shop],\n        items: itemsByShop[shop],\n        quantityTotal: itemsByShop[shop].reduce((qty, item) => qty + item.quantity, 0),\n        shipping: shippingByShop[shop],\n        shippingMethod: shipping[0].shipmentMethod\n      }\n    }));\n    // TODO we just assume now that every shop uses the same carrier, thus the hard-coded zero index\n    // because shipping records are not stored by shop\n    const sortedShopObjects = _.sortBy(shopObjects, (shopObject) => shopObject.name);\n    return sortedShopObjects;\n  }\n};\n","import _ from \"lodash\";\nimport { Mongo } from \"meteor/mongo\";\nimport { Meteor } from \"meteor/meteor\";\nimport * as Schemas from \"./schemas\";\nimport { cartOrderTransform } from \"./transform/cartOrder\";\n\n/**\n * @name mediaRecordsIndex\n * @private\n * @param {RawMongoCollection} rawMedia\n *\n * Sets up necessary indexes on the Media FileCollection\n */\nasync function mediaRecordsIndex(rawMedia) {\n  try {\n    await rawMedia.createIndex({ \"metadata.productId\": 1 }, { background: true });\n    await rawMedia.createIndex({ \"metadata.variantId\": 1 }, { background: true });\n    await rawMedia.createIndex({ \"metadata.priority\": 1 }, { background: true });\n\n    // These queries are used by the workers in file-collections package\n    await rawMedia.createIndex({ \"original.remoteURL\": 1 }, { background: true });\n    await rawMedia.createIndex({ \"original.tempStoreId\": 1 }, { background: true });\n  } catch (error) {\n    console.error(error); // eslint-disable-line no-console\n  }\n}\n\n/**\n *\n * Reaction Core Collections\n * @ignore\n */\n\n/**\n * Accounts Collection\n * @ignore\n */\nexport const Accounts = new Mongo.Collection(\"Accounts\");\n\nAccounts.attachSchema(Schemas.Accounts);\n\n\n/**\n * Assets Collection\n * Store file asset paths or contents in a Collection\n * @ignore\n */\nexport const Assets = new Mongo.Collection(\"Assets\");\n\nAssets.attachSchema(Schemas.Assets);\n\n\n/**\n * Cart Collection\n * @ignore\n */\nexport const Cart = new Mongo.Collection(\"Cart\", {\n  transform(cart) {\n    const newInstance = Object.create(cartOrderTransform);\n    return _.extend(newInstance, cart);\n  }\n});\n\nCart.attachSchema(Schemas.Cart);\n\n\n/**\n * Emails Collection\n * @ignore\n */\nexport const Emails = new Mongo.Collection(\"Emails\");\n\nEmails.attachSchema(Schemas.Emails);\n\n\n/**\n * Inventory Collection\n * @ignore\n */\nexport const Inventory = new Mongo.Collection(\"Inventory\");\n\nInventory.attachSchema(Schemas.Inventory);\n\n\n/**\n * Orders Collection\n * @ignore\n */\nexport const Orders = new Mongo.Collection(\"Orders\", {\n  transform(order) {\n    const newInstance = Object.create(cartOrderTransform);\n    return _.extend(newInstance, order);\n  }\n});\n\nOrders.attachSchema(Schemas.OrderDocument);\n\n/**\n * Packages Collection\n * @ignore\n */\nexport const Packages = new Mongo.Collection(\"Packages\");\n\nPackages.attachSchema(Schemas.PackageConfig);\n\n/**\n * Catalog Collection\n * @todo: Attach a schema to the Catalog collection\n * @ignore\n */\nexport const Catalog = new Mongo.Collection(\"Catalog\");\n\n/**\n * Products Collection\n * @ignore\n */\nexport const Products = new Mongo.Collection(\"Products\");\n\nProducts.attachSchema(Schemas.Product, { selector: { type: \"simple\" } });\nProducts.attachSchema(Schemas.ProductVariant, { selector: { type: \"variant\" } });\n\n/**\n * Revisions Collection\n * @ignore\n */\nexport const Revisions = new Mongo.Collection(\"Revisions\");\n\nRevisions.attachSchema(Schemas.Revisions);\n\n/**\n * Shipping Collection\n * @ignore\n */\nexport const Shipping = new Mongo.Collection(\"Shipping\");\n\nShipping.attachSchema(Schemas.Shipping);\n\n/**\n* Shops Collection\n* @ignore\n*/\nexport const Shops = new Mongo.Collection(\"Shops\");\n\nShops.attachSchema(Schemas.Shop);\n\n/**\n * Groups Collection\n * @ignore\n */\nexport const Groups = new Mongo.Collection(\"Groups\");\n\nGroups.attachSchema(Schemas.Groups);\n\n/**\n * SellerShops Collection (client-only)\n * @ignore\n */\nlet sellerShops;\nif (Meteor.isClient) {\n  sellerShops = new Mongo.Collection(\"SellerShops\");\n\n  sellerShops.attachSchema(Schemas.Shop);\n}\nexport const SellerShops = sellerShops;\n\n/**\n * Tags Collection\n * @ignore\n */\nexport const Tags = new Mongo.Collection(\"Tags\");\n\nTags.attachSchema(Schemas.Tag);\n\n/**\n * Templates Collection\n * @ignore\n */\nexport const Templates = new Mongo.Collection(\"Templates\");\n\nTemplates.attachSchema(Schemas.Templates, { selector: { type: \"template\" } });\nTemplates.attachSchema(Schemas.ReactLayout, { selector: { type: \"react\" } });\n\n\n/**\n * Translations Collection\n * @ignore\n */\nexport const Translations = new Mongo.Collection(\"Translations\");\n\nTranslations.attachSchema(Schemas.Translation);\n\n/**\n * Notifications Collection\n * @ignore\n */\nexport const Notifications = new Mongo.Collection(\"Notifications\");\n\nNotifications.attachSchema(Schemas.Notification);\n\n\n/**\n * Sms Collection\n * @ignore\n */\nexport const Sms = new Mongo.Collection(\"Sms\");\n\nSms.attachSchema(Schemas.Sms);\n\n\n/**\n * Logs Collection\n * @ignore\n */\nexport const Logs = new Mongo.Collection(\"Logs\");\n\nLogs.attachSchema(Schemas.Logs);\n\n/**\n * MediaRecords Collection\n * @ignore\n */\nexport const MediaRecords = new Mongo.Collection(\"cfs.Media.filerecord\");\n\n// Index on the props we search on\nif (Meteor.isServer) {\n  mediaRecordsIndex(MediaRecords.rawCollection());\n}\n\n// Might want to do this at some point.\n// MediaRecords.attachSchema();\n","export * from \"./collections\";\nexport * from \"./search\";\nexport { Jobs } from \"./jobs\";\n","import { JobCollection } from \"/imports/plugins/core/job-collection/lib\";\n\n/**\n * Jobs Collection\n * @ignore\n */\nexport const Jobs = new JobCollection(\"Jobs\", {\n  noCollectionSuffix: true\n});\n","import { Mongo } from \"meteor/mongo\";\n\nexport const ProductSearch = new Mongo.Collection(\"ProductSearch\");\nexport const OrderSearch = new Mongo.Collection(\"OrderSearch\");\nexport const AccountSearch = new Mongo.Collection(\"AccountSearch\");\n","/**\n * @name html\n * @method\n * @memberof Core\n * @summary Template literal for HTML strings.\n * @param  {Object} strings Object of strings\n * @return {String} string\n */\nexport function html(strings) {\n  return strings.raw[0];\n}\n","/**\n * @method getTagIds\n * @memberof Core\n * @summary Get an array of IDs of tags\n * @example getTagIds({ tags: subTagGroups })\n * @param  {Object} state object\n * @param  {Array}  state.tags Array of tags\n * @return {Array}  Array of tag IDs\n */\nexport const getTagIds = (state) => {\n  if (Array.isArray(state.tags)) {\n    return state.tags.map((tag) => tag._id);\n  }\n\n  return [];\n};\n","/**\n * @method getVariantIds\n * @memberof Core\n * @summary Get array of IDs of variants\n * @example getVariantIds(newVariantOrder)\n * @param  {Array} variants Array of variant objects\n * @return {Array}          Array of variant object IDs\n */\nexport const getVariantIds = (variants) => Array.isArray(variants) && variants.map((variant) => variant._id);\n","export * from \"./password\";\n","import _ from \"lodash\";\nimport { Random } from \"meteor/random\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Accounts } from \"meteor/accounts-base\";\nimport { SSR } from \"meteor/meteorhacks:ssr\";\nimport { Shops } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\n\n/**\n * @method sendResetPasswordEmail\n * @memberof Core\n * @summary Send an email with a link that the user can use to reset their password.\n * @param {String} userId - The id of the user to send email to.\n * @param {String} [optionalEmail] Address to send the email to.\n *                 This address must be in the user's `emails` list.\n *                 Defaults to the first email in the list.\n * @return {Job} - returns a sendEmail Job instance\n */\nexport async function sendResetPasswordEmail(userId, optionalEmail) {\n  // Make sure the user exists, and email is one of their addresses.\n  const user = Meteor.users.findOne(userId);\n\n  if (!user) {\n    Logger.error(\"sendResetPasswordEmail - User not found\");\n    throw new Meteor.Error(\"not-found\", \"User not found\");\n  }\n\n  let email = optionalEmail;\n\n  // pick the first email if we weren't passed an email.\n  if (!optionalEmail && user.emails && user.emails[0]) {\n    email = user.emails[0].address;\n  }\n\n  // make sure we have a valid email\n  if (!email || !user.emails || !user.emails.map((mailInfo) => mailInfo.address).includes(email)) {\n    Logger.error(\"sendResetPasswordEmail - Email not found\");\n    throw new Meteor.Error(\"not-found\", \"Email not found\");\n  }\n\n  // Create token for password reset\n  const token = Random.secret();\n  const when = new Date();\n  const tokenObj = { token, email, when };\n\n  Meteor.users.update(userId, {\n    $set: {\n      \"services.password.reset\": tokenObj\n    }\n  });\n\n  Meteor._ensure(user, \"services\", \"password\").reset = tokenObj;\n\n  // Get shop data for email display\n  const shop = Shops.findOne(Reaction.getShopId());\n  const emailLogo = Reaction.Email.getShopLogo(shop);\n  const copyrightDate = new Date().getFullYear();\n\n  const dataForEmail = {\n    // Shop Data\n    shop,\n    contactEmail: shop.emails[0].address,\n    homepage: Meteor.absoluteUrl(),\n    emailLogo,\n    copyrightDate,\n    legalName: _.get(shop, \"addressBook[0].company\"),\n    physicalAddress: {\n      address: `${_.get(shop, \"addressBook[0].address1\")} ${_.get(shop, \"addressBook[0].address2\")}`,\n      city: _.get(shop, \"addressBook[0].city\"),\n      region: _.get(shop, \"addressBook[0].region\"),\n      postal: _.get(shop, \"addressBook[0].postal\")\n    },\n    shopName: shop.name,\n    socialLinks: {\n      display: true,\n      facebook: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/facebook-icon.png`,\n        link: \"https://www.facebook.com\"\n      },\n      googlePlus: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/google-plus-icon.png`,\n        link: \"https://plus.google.com\"\n      },\n      twitter: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/twitter-icon.png`,\n        link: \"https://www.twitter.com\"\n      }\n    },\n    // Account Data\n    passwordResetUrl: Accounts.urls.resetPassword(token),\n    user\n  };\n\n  // Compile Email with SSR\n  const tpl = \"accounts/resetPassword\";\n  const subject = \"accounts/resetPassword/subject\";\n  SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n  SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n  return Reaction.Email.send({\n    to: email,\n    from: Reaction.getShopEmail(),\n    subject: SSR.render(subject, dataForEmail),\n    html: SSR.render(tpl, dataForEmail)\n  });\n}\n\n\n/**\n * @method sendVerificationEmail\n * @memberof Core\n * @summary Send an email with a link the user can use verify their email address.\n * @param {String} userId - The id of the user to send email to.\n * @param {String} [email] Optional. Address to send the email to.\n *                 This address must be in the user's emails list.\n *                 Defaults to the first unverified email in the list.\n * @return {Job} - returns a sendEmail Job instance\n */\nexport async function sendVerificationEmail(userId, email) {\n  // Make sure the user exists, and email is one of their addresses.\n  const user = Meteor.users.findOne(userId);\n\n  if (!user) {\n    Logger.error(\"sendVerificationEmail - User not found\");\n    throw new Meteor.Error(\"not-found\", \"User not found\");\n  }\n\n  let address = email;\n\n  // pick the first unverified address if no address provided.\n  if (!email) {\n    const unverifiedEmail = _.find(user.emails || [], (e) => !e.verified) || {};\n\n    ({ address } = unverifiedEmail);\n\n    if (!address) {\n      const msg = \"No unverified email addresses found.\";\n      Logger.error(msg);\n      throw new Meteor.Error(\"not-found\", msg);\n    }\n  }\n\n  // make sure we have a valid address\n  if (!address || !user.emails || !(user.emails.map((mailInfo) => mailInfo.address).includes(address))) {\n    const msg = \"Email not found for user\";\n    Logger.error(msg);\n    throw new Meteor.Error(\"not-found\", msg);\n  }\n\n  const token = Random.secret();\n  const when = new Date();\n  const tokenObj = { token, address, when };\n\n  Meteor.users.update({ _id: userId }, {\n    $push: {\n      \"services.email.verificationTokens\": tokenObj\n    }\n  });\n\n  const shopName = Reaction.getShopName();\n  const url = Accounts.urls.verifyEmail(token);\n  const copyrightDate = new Date().getFullYear();\n\n  const dataForEmail = {\n    // Reaction Information\n    contactEmail: \"hello@reactioncommerce.com\",\n    homepage: Meteor.absoluteUrl(),\n    emailLogo: `${Meteor.absoluteUrl()}resources/placeholder.gif`,\n    copyrightDate,\n    legalName: \"Reaction Commerce\",\n    physicalAddress: {\n      address: \"2110 Main Street, Suite 207\",\n      city: \"Santa Monica\",\n      region: \"CA\",\n      postal: \"90405\"\n    },\n    shopName,\n    socialLinks: {\n      facebook: {\n        link: \"https://www.facebook.com/reactioncommerce\"\n      },\n      github: {\n        link: \"https://github.com/reactioncommerce/reaction\"\n      },\n      instagram: {\n        link: \"https://instagram.com/reactioncommerce\"\n      },\n      twitter: {\n        link: \"https://www.twitter.com/getreaction\"\n      }\n    },\n    confirmationUrl: url,\n    userEmailAddress: address\n  };\n\n  if (!Reaction.Email.getMailUrl()) {\n    Logger.warn(`\n\n  ***************************************************\n          IMPORTANT! EMAIL VERIFICATION LINK\n\n           Email sending is not configured.\n\n  Go to the following URL to verify email: ${address}\n\n  ${url}\n  ***************************************************\n\n    `);\n  }\n\n  const tpl = \"accounts/verifyEmail\";\n  const subject = \"accounts/verifyEmail/subject\";\n\n  SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n  SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n  return Reaction.Email.send({\n    to: address,\n    from: Reaction.getShopEmail(),\n    subject: SSR.render(subject, dataForEmail),\n    html: SSR.render(tpl, dataForEmail)\n  });\n}\n\n\n/**\n * @method sendUpdatedVerificationEmail\n * @memberof Core\n * @summary Send an email with a link the user can use to verify their updated email address.\n * @param {String} userId - The id of the user to send email to.\n * @param {String} [email] Optional. Address to send the email to.\n *                 This address must be in the user's emails list.\n *                 Defaults to the first unverified email in the list.\n * @return {Job} - returns a sendEmail Job instance\n */\nexport async function sendUpdatedVerificationEmail(userId, email) {\n  // Make sure the user exists, and email is one of their addresses.\n  const user = Meteor.users.findOne(userId);\n\n  if (!user) {\n    Logger.error(\"sendVerificationEmail - User not found\");\n    throw new Meteor.Error(\"not-found\", \"User not found\");\n  }\n\n  let address = email;\n\n  // pick the first unverified address if no address provided.\n  if (!email) {\n    const unverifiedEmail = _.find(user.emails || [], (e) => !e.verified) || {};\n\n    ({ address } = unverifiedEmail);\n\n    if (!address) {\n      const msg = \"No unverified email addresses found.\";\n      Logger.error(msg);\n      throw new Meteor.Error(\"not-found\", msg);\n    }\n  }\n\n  // make sure we have a valid address\n  if (!address || !user.emails || !(user.emails.map((mailInfo) => mailInfo.address).includes(address))) {\n    const msg = \"Email not found for user\";\n    Logger.error(msg);\n    throw new Meteor.Error(\"not-found\", msg);\n  }\n\n  const token = Random.secret();\n  const when = new Date();\n  const tokenObj = { token, address, when };\n\n  Meteor.users.update({ _id: userId }, {\n    $push: {\n      \"services.email.verificationTokens\": tokenObj\n    }\n  });\n\n  const shopName = Reaction.getShopName();\n  const url = Accounts.urls.verifyEmail(token);\n  const copyrightDate = new Date().getFullYear();\n\n  const dataForEmail = {\n    // Reaction Information\n    contactEmail: \"hello@reactioncommerce.com\",\n    homepage: Meteor.absoluteUrl(),\n    emailLogo: `${Meteor.absoluteUrl()}resources/placeholder.gif`,\n    copyrightDate,\n    legalName: \"Reaction Commerce\",\n    physicalAddress: {\n      address: \"2110 Main Street, Suite 207\",\n      city: \"Santa Monica\",\n      region: \"CA\",\n      postal: \"90405\"\n    },\n    shopName,\n    socialLinks: {\n      facebook: {\n        link: \"https://www.facebook.com/reactioncommerce\"\n      },\n      github: {\n        link: \"https://github.com/reactioncommerce/reaction\"\n      },\n      instagram: {\n        link: \"https://instagram.com/reactioncommerce\"\n      },\n      twitter: {\n        link: \"https://www.twitter.com/getreaction\"\n      }\n    },\n    confirmationUrl: url,\n    userEmailAddress: address\n  };\n\n  if (!Reaction.Email.getMailUrl()) {\n    Logger.warn(`\n\n  ***************************************************\n          IMPORTANT! EMAIL VERIFICATION LINK\n\n           Email sending is not configured.\n\n  Go to the following URL to verify email: ${address}\n\n  ${url}\n  ***************************************************\n\n    `);\n  }\n\n  const tpl = \"accounts/verifyUpdatedEmail\";\n  const subject = \"accounts/verifyUpdatedEmail/subject\";\n\n  SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n  SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n  return Reaction.Email.send({\n    to: address,\n    from: Reaction.getShopEmail(),\n    subject: SSR.render(subject, dataForEmail),\n    html: SSR.render(tpl, dataForEmail)\n  });\n}\n","import nodemailer from \"@reactioncommerce/nodemailer\";\nimport getServiceConfig from \"nodemailer-wellknown\";\nimport url from \"url\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Reaction, Logger } from \"/server/api\";\n\n\n/**\n * @method getMailUrl\n * @summary get the smtp URL for sending emails\n * There are 3 possible ways to set the email configuration and\n * the first value found will be used.\n * The priority order is:\n *   1. MAIL_URL environment variable\n *   2. Meteor settings (MAIL_URL key)\n *   3. Core shop settings from the database\n * @memberof Email\n * @example Reaction.Email.getMailUrl()\n * @return {String} returns an SMTP url if one of the settings have been set\n */\nexport function getMailUrl() {\n  const shopSettings = Reaction.getShopSettings();\n\n  let shopMail;\n\n  if (shopSettings) {\n    shopMail = shopSettings.mail || {};\n  }\n\n  // get all possible mail settings\n  const processUrl = process.env.MAIL_URL;\n  const settingsUrl = Meteor.settings.MAIL_URL;\n  const { service, user, password, host, port } = shopMail;\n\n  let mailString;\n\n  // create a mail url from well-known provider settings (if they exist)\n  // https://github.com/nodemailer/nodemailer-wellknown\n  if (service && service !== \"custom\") {\n    const conf = getServiceConfig(service);\n\n    if (conf) {\n      // account for local test providers like Maildev\n      if (!conf.host) {\n        mailString = `smtp://localhost:${conf.port}`;\n      } else if (user && password) {\n        mailString = `smtp://${encodeURIComponent(user)}:${password}@${conf.host}:${conf.port}`;\n      }\n    }\n  }\n\n  // create a mail url from custom provider settings (if they exist)\n  if ((!service || service === \"custom\") && user && password && host && port) {\n    mailString = `smtp://${encodeURIComponent(user)}:${password}@${host}:${port}`;\n  }\n\n  // create the final url from the available options\n  const mailUrl = processUrl || settingsUrl || mailString;\n\n  if (!mailUrl) {\n    Logger.warn(\"Reaction.Email.getMailUrl() - no email provider configured\");\n    return null;\n  }\n\n  return mailUrl;\n}\n\n\n/**\n * @method getMailConfig\n * @summary get the email sending config for Nodemailer\n * @memberof Email\n * @example Reaction.Email.getMailConfig()\n * @return {{host: String, port: Number, secure: Boolean, auth: Object, logger: Boolean}} returns a config object\n */\nexport function getMailConfig() {\n  const processUrl = process.env.MAIL_URL;\n  const settingsUrl = Meteor.settings.MAIL_URL;\n\n  const mailString = processUrl || settingsUrl;\n\n  // if MAIL_URL or Meteor settings have been used,\n  // parse the URL and create a config object\n  if (mailString) {\n    // parse the url\n    const parsedUrl = url.parse(mailString);\n    const creds = !!parsedUrl.auth && parsedUrl.auth.split(\":\");\n    parsedUrl.port = Number(parsedUrl.port);\n\n    Logger.debug(`Using ${parsedUrl.hostname} to send email`);\n\n    // create a nodemailer config from the SMTP url string\n    const config = {\n      host: parsedUrl.hostname,\n      port: parsedUrl.port,\n      // since the port is casted to number above\n      secure: parsedUrl.port === 465,\n      logger: process.env.EMAIL_DEBUG === \"true\"\n    };\n\n    // add user/pass to the config object if they were found\n    if (creds) {\n      config.auth = {\n        user: creds[0],\n        pass: creds[1]\n      };\n    }\n\n    // don't enforce checking TLS on localhost\n    if (parsedUrl.hostname === \"localhost\") {\n      config.ignoreTLS = true;\n    }\n\n    return config;\n  }\n\n  // check for mail settings in the database\n  const shopSettings = Reaction.getShopSettings();\n\n  let shopMail;\n\n  if (shopSettings) {\n    shopMail = shopSettings.mail || {};\n  }\n\n  const { service, user, password, host, port } = shopMail;\n\n  // if a service provider preset was chosen, return a Nodemailer config for it\n  // https://github.com/nodemailer/nodemailer-wellknown\n  if (service && service !== \"custom\") {\n    Logger.debug(`Using ${service} to send email`);\n\n    // get the config from nodemailer-wellknown\n    const conf = getServiceConfig(service);\n\n    // account for local test providers like Maildev with no auth\n    if (!conf.host) {\n      return conf;\n    }\n\n    // add any credentials to the config\n    if (user && password) {\n      conf.auth = { user, pass: password };\n    }\n\n    return conf;\n  }\n\n  // if a custom config was chosen and all necessary fields exist in the database,\n  // return the custom Nodemailer config\n  if ((!service || service === \"custom\") && host && port) {\n    const conf = {\n      host,\n      port,\n      secure: port === 465,\n      logger: process.env.EMAIL_DEBUG === \"true\"\n    };\n\n    // don't enforce checking TLS on localhost\n    if (conf.host === \"localhost\") {\n      conf.ignoreTLS = true;\n    }\n\n    // add any credentials to the config\n    if (user && password) {\n      conf.auth = { user, pass: password };\n    }\n\n    Logger.debug(`Using ${host} to send email`);\n\n    return conf;\n  }\n\n  // else, return the direct mail config and a warning\n  Logger.warn(`\n    Mail service not configured. Attempting to use direct sending option.\n    The mail may send, but messages are far more likely go to the user's spam folder.\n    Please configure an SMTP mail sending provider.\n  `);\n\n  return {\n    direct: true,\n    logger: process.env.EMAIL_DEBUG === \"true\"\n  };\n}\n\n\n/**\n * @method verifyConfig\n * @summary Verify a transporter configuration works\n * @see https://github.com/nodemailer/nodemailer#verify-smtp-connection-configuration\n * @memberof Email\n * @param {Object} config - a Nodemailer transporter config object\n * @param {Function} callback - optional callback with standard error/result args\n * @return {Promise} returns a Promise if no callback is provided\n */\nexport function verifyConfig(config, callback) {\n  const transporter = nodemailer.createTransport(config);\n  return transporter.verify(callback);\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { Jobs, Templates } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Media } from \"/imports/plugins/core/files/server\";\n\n/**\n * @file `Reaction.Email` methods for creating e-mail jobs, fetching e-mail templates and e-mail subject lines\n *\n * @see https://github.com/reactioncommerce/reaction/pull/1282\n * @namespace Email\n */\n\n/**\n * @method send\n * @memberof Email\n * @summary Add send e-mail job to job queue.\n * The worker will then process it immediately (in batches of up to 10) and will retry failures up to 5 times\n * (waiting 3 mins between each try) before failing completely.\n * All email sending attempts are logged in the job collection.\n * @see (Job API doc) https://github.com/vsivsi/meteor-job-collection/#user-content-job-api\n * @example Reaction.Email.send({\n    from: 'me@example.com',\n    to: 'you@example.com',\n    subject: 'RE: new email API',\n    html: SSR.render('some-name', { shopUrl: Meteor.absoluteUrl() })\n  });\n * @param  {Object} options - object containing to/from/subject/html String keys\n * @return {Boolean} returns job object\n */\nexport function send(options) {\n  return new Job(Jobs, \"sendEmail\", options)\n    .retry({\n      retries: 5,\n      wait: 3 * 60000\n    }).save();\n}\n\n/**\n * @method getSubject\n * @memberof Email\n * @summary Returns a subject source for SSR consumption\n * layout must be defined + template\n * @example SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n * @param {String} template name of the template in either Layouts or fs\n * @returns {Object} returns source\n */\nexport function getSubject(template) {\n  if (typeof template !== \"string\") {\n    const msg = \"Reaction.Email.getSubject() requires a template name\";\n    Logger.error(msg);\n    throw new Meteor.Error(\"invalid-parameter\", msg);\n  }\n\n  // set default\n  const language = Reaction.getShopLanguage();\n\n  // check database for a matching template\n  const tmpl = Templates.findOne({\n    name: template,\n    language\n  });\n\n  // use that template if found\n  if (tmpl && tmpl.template) {\n    return tmpl.subject;\n  }\n  return \"A message from {{shop.name}}\";\n}\n\n/**\n * @method getTemplate\n * @memberof Email\n * @summary Returns a template source for SSR consumption. layout must be defined + template\n * @example Reaction.Email.getTemplate('path/of/template');\n * @param {String} template name of the template in either Layouts or fs\n * @returns {Object} returns source\n */\nexport function getTemplate(template) {\n  if (typeof template !== \"string\") {\n    const msg = \"Reaction.Email.getTemplate() requires a template name\";\n    Logger.error(msg);\n    throw new Meteor.Error(\"invalid-parameter\", msg);\n  }\n\n  // set default\n  const language = Reaction.getShopLanguage();\n\n  // check database for a matching template\n  const tmpl = Templates.findOne({\n    name: template,\n    language\n  });\n\n  // use that template if found\n  if (tmpl && tmpl.template) {\n    return tmpl.template;\n  }\n\n  // otherwise, use the default template from the filesystem\n  return getTemplateFile(template);\n}\n\n/**\n * @method getTemplateFile\n * @memberof Email\n * @param  {String} file name of the template on file system\n * @return {String} returns source\n */\nexport function getTemplateFile(file) {\n  if (typeof file !== \"string\") {\n    const msg = \"Reaction.Email.getTemplateFile() requires a template name\";\n    Logger.error(msg);\n    throw new Meteor.Error(\"invalid-parameter\", msg);\n  }\n\n  try {\n    return Assets.getText(`email/templates/${file}.html`);\n  } catch (e) {\n    Logger.warn(`Template not found: ${file}. Falling back to coreDefault.html`);\n    return Assets.getText(\"email/templates/coreDefault.html\");\n  }\n}\n\n\n/**\n * @method getShopLogo\n * @summary Get absolute URL for shop logo, if available. If not, use default logo URL.\n * @memberof Email\n * @param  {Object} shop - shop\n * @return {String} Absolute image URL\n */\nexport function getShopLogo(shop) {\n  let emailLogo;\n  if (Array.isArray(shop.brandAssets)) {\n    const brandAsset = shop.brandAssets.find((asset) => asset.type === \"navbarBrandImage\");\n    const fileRecord = brandAsset && Promise.await(Media.findOne(brandAsset.mediaId));\n    emailLogo = fileRecord && fileRecord.url({ absolute: true, store: \"medium\" });\n  }\n  return emailLogo || `${Meteor.absoluteUrl()}resources/email-templates/shop-logo.png`;\n}\n","export * from \"./config\";\nexport * from \"./email\";\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Accounts, Groups, Shops } from \"/lib/collections\";\nimport { Logger } from \"/server/api\";\n\n/**\n * Private method which should only be called by addRolesToGroups to keep users in sync with updated groups\n * @private\n * @method addRolesToUsersInGroups\n * @param  {object} options object that contains the query selector for groups and roles to add to users\n * @returns {void}\n */\nfunction addRolesToUsersInGroups(options) {\n  const { query, roles } = { ...options };\n\n  if (!query.shopId) {\n    const shops = Shops.find({}).fetch();\n    const shopIds = shops.map((shop) => shop._id);\n    query.shopId = {\n      $in: shopIds\n    };\n  }\n\n  const groupsToUpdate = Groups.find(query, { fields: { _id: 1, shopId: 1 } }).fetch();\n  // We need a list of groups => shops to determine which users get which updates\n  const groupAndShopIds = groupsToUpdate.map((group) => ({\n    id: group._id,\n    shopId: group.shopId\n  }));\n\n  // We perform one update for each groupId and return a count of the number of updates performed\n  groupAndShopIds.forEach((group) => {\n    // Find all accounts with this group\n    const accounts = Accounts.find({ groups: group.id }, { fields: { _id: 1 } }).fetch();\n    // Get a list of all userIds in those accounts\n    const userIds = accounts.map((account) => account._id);\n    // We're going to update all users with an _id that matched\n    const selector = { _id: { $in: userIds } };\n\n    // Build our update operation - add new roles to set for the shop associated with this group.\n    const operation = {\n      $addToSet: {\n        [`roles.${group.shopId}`]: {\n          $each: roles\n        }\n      }\n    };\n\n    // Update users\n    Meteor.users.update(selector, operation, { multi: true });\n  });\n}\n\n/**\n * @name addRolesToGroups\n * @method\n * @memberof Core\n * @summary Add roles to the default groups for shops and updates any users that are in\n * those permission groups\n * Options:\n * allShops: add supplied roles to all shops, defaults to false\n * roles: Array of roles to add to default roles set\n * shops: Array of shopIds that should be added to set\n * groups: Groups to add roles to, Options: [\"guest\", \"customer\", \"owner\"]\n * @param {Object} options - See above for details\n * @returns {Number} result of Groups.update method (number of documents updated)\n */\nexport function addRolesToGroups(options = { allShops: false, roles: [], shops: [], groups: [\"guest\"] }) {\n  check(options.roles, [String]);\n  check(options.allShops, Match.Maybe(Boolean));\n  check(options.shops, Match.Maybe([String]));\n  check(options.groups, Match.Maybe([String]));\n\n  const { allShops, roles, shops, groups } = options;\n  const query = {\n    slug: {\n      $in: groups\n    }\n  };\n  const multi = { multi: true };\n\n  if (!allShops) {\n    // if we're not updating for all shops, we should only update for the shops passed in.\n    query.shopId = { $in: shops || [] };\n    Logger.debug(`Adding Roles: ${roles} to Groups: ${groups} for shops: ${shops}`);\n  } else {\n    Logger.debug(`Adding Roles: ${roles} to Groups: ${groups} for all shops`);\n  }\n\n  addRolesToUsersInGroups({ query, roles });\n\n  return Groups.update(query, { $addToSet: { permissions: { $each: roles } } }, multi);\n}\n","import _ from \"lodash\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Logger } from \"/server/api\";\n\n/**\n * @name getRouteName\n * @method\n * @memberof Core\n * @private\n * @summary assemble route name to be standard\n * this is duplicate that exists in Reaction.Router\n * however this is to avoid a dependency in core\n * on the router\n * prefix/package name + registry name or route\n * @param  {string} packageName  [package name]\n * @param  {object} registryItem [registry object]\n * @return {String}              [route name]\n */\nfunction getRouteName(packageName, registryItem) {\n  let routeName;\n  if (packageName && registryItem) {\n    if (registryItem.name) {\n      routeName = registryItem.name;\n    } else if (registryItem.template) {\n      routeName = `${packageName}/${registryItem.template}`;\n    } else {\n      routeName = `${packageName}`;\n    }\n    // dont include params in the name\n    [routeName] = routeName.split(\":\");\n    return routeName;\n  }\n  return null;\n}\n\n\n/**\n * @name assignOwnerRoles\n * @method\n * @memberof Core\n * @summary populate roles with all the packages and their permissions\n * this is the main way that roles are inserted and created for\n * admin user.\n * we assign all package roles to each owner account for each shopId\n * we assign only basic GLOBAL_GROUP rights\n *\n * @param  {String} shopId - shopId\n * @param  {String} pkgName - Package name\n * @param  {String} registry - registry object\n * @return {undefined}\n */\nexport function assignOwnerRoles(shopId, pkgName, registry) {\n  const defaultRoles = [\"owner\", \"admin\", \"createProduct\", \"guest\", pkgName];\n  const globalRoles = defaultRoles;\n\n  if (registry) {\n    // for each registry item define and push roles\n    for (const registryItem of registry) {\n      // packages don't need to define specific permission routes.,\n      // the routeName will be used as default roleName for each route.\n      // todo: check dependency on this.\n      const roleName = getRouteName(pkgName, registryItem);\n      if (roleName) {\n        defaultRoles.push(roleName);\n      }\n\n      // Get all defined permissions, add them to an array\n      // define permissions if you need to check custom permission\n      if (registryItem.permissions) {\n        for (const permission of registryItem.permissions) {\n          // A wrong value in permissions (ie. [String] instead of [Object] in any plugin register.js\n          // results in an undefined element in defaultRoles Array\n          // an undefined value would make Roles.getUsersInRole(defaultRoles) return ALL users\n          if (permission && typeof permission.permission === \"string\" && permission.permission.length) {\n            defaultRoles.push(permission.permission);\n          }\n        }\n      }\n    }\n  } else {\n    Logger.debug(`No routes loaded for ${pkgName}`);\n  }\n  // only unique roles\n  const defaultOwnerRoles = _.uniq(defaultRoles);\n  // get existing shop owners to add new roles to\n  const owners = [];\n  const shopOwners = Roles.getUsersInRole(defaultOwnerRoles).fetch();\n  // just a nice warning. something is misconfigured.\n  if (!shopOwners) {\n    Logger.warn(\"Cannot assign roles without existing owner users.\");\n    return;\n  }\n  // assign this package permission to each existing owner.\n  for (const account of shopOwners) {\n    owners.push(account._id);\n  }\n  // we don't use accounts/addUserPermissions here because we may not yet have permissions\n  Roles.addUsersToRoles(owners, defaultOwnerRoles, shopId);\n\n  // the reaction owner has permissions to all sites by default\n  Roles.addUsersToRoles(owners, globalRoles, Roles.GLOBAL_GROUP);\n\n  Logger.debug(`Owner permissions added for ${pkgName}`);\n}\n","import { DDP } from \"meteor/ddp-client\";\n\nconst inMemoryCache = {};\nconst connectionKey = \"connection-data\";\n\nfunction connectionData() {\n  // similar to Meteor.userId()\n  const invocation =\n    DDP._CurrentMethodInvocation.get() ||\n    DDP._CurrentPublicationInvocation.get();\n\n  if (!invocation) {\n    // operating outside of a connection\n    return inMemoryCache;\n  }\n\n  const { connection } = invocation;\n\n  if (!connection) {\n    return inMemoryCache;\n  }\n\n  const hasDataKey = connectionKey in connection;\n\n  if (!hasDataKey) {\n    connection[connectionKey] = {};\n  }\n\n  return connection[connectionKey];\n}\n\nexport default {\n  get(key) {\n    return connectionData()[key];\n  },\n\n  set(key, val) {\n    connectionData()[key] = val;\n  },\n\n  clear(key) {\n    delete connectionData()[key];\n  }\n};\n","import url from \"url\";\nimport packageJson from \"/package.json\";\nimport _, { merge, uniqWith } from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport { Accounts } from \"meteor/accounts-base\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { EJSON } from \"meteor/ejson\";\nimport * as Collections from \"/lib/collections\";\nimport { Hooks, Logger } from \"/server/api\";\nimport ProcessJobs from \"/server/jobs\";\nimport { registerTemplate } from \"./templates\";\nimport { sendVerificationEmail } from \"./accounts\";\nimport { getMailUrl } from \"./email/config\";\nimport { createGroups } from \"./groups\";\nimport ConnectionDataStore from \"./connectionDataStore\";\n\n/**\n * @file Server core methods\n *\n * @namespace Core\n */\n\n// Unpack the named Collections we use.\nconst { Jobs, Packages, Shops, Accounts: AccountsCollection } = Collections;\n\nexport default {\n  init() {\n    // run beforeCoreInit hooks\n    Hooks.Events.run(\"beforeCoreInit\");\n\n    // make sure the default shop has been created before going further\n    while (!this.getShopId()) {\n      Logger.warn(\"No shopId, waiting one second...\");\n      Meteor._sleepForMs(1000);\n    }\n\n    // run onCoreInit hooks\n    Hooks.Events.run(\"onCoreInit\");\n\n    // start job server\n    Jobs.startJobServer(() => {\n      Logger.info(\"JobServer started\");\n      ProcessJobs();\n      Hooks.Events.run(\"onJobServerStart\");\n    });\n    if (process.env.VERBOSE_JOBS) {\n      Jobs.setLogStream(process.stdout);\n    }\n\n    this.loadPackages();\n    // process imports from packages and any hooked imports\n    this.Importer.flush();\n    this.createGroups();\n    // timing is important, packages are rqd for initial permissions configuration.\n    if (!Meteor.isAppTest) {\n      this.createDefaultAdminUser();\n    }\n    this.setAppVersion();\n    // hook after init finished\n    Hooks.Events.run(\"afterCoreInit\");\n\n    Logger.debug(\"Reaction.init() has run\");\n\n    return true;\n  },\n\n  Packages: {},\n\n  registerPackage(packageInfo) {\n    this.Packages[packageInfo.name] = packageInfo;\n    const registeredPackage = this.Packages[packageInfo.name];\n    return registeredPackage;\n  },\n  defaultCustomerRoles: [\"guest\", \"account/profile\", \"product\", \"tag\", \"index\", \"cart/checkout\", \"cart/completed\"],\n  defaultVisitorRoles: [\"anonymous\", \"guest\", \"product\", \"tag\", \"index\", \"cart/checkout\", \"cart/completed\"],\n  createGroups,\n\n  /**\n   * @name canInviteToGroup\n   * @method\n   * @memberof Core\n   * @summary checks if the user making the request is allowed to make invitation to that group\n   * @param {Object} options -\n   * @param {Object} options.group - group to invite to\n   * @param {Object} options.user - user object  making the invite (Meteor.user())\n   * @return {Boolean} -\n   */\n  canInviteToGroup(options) {\n    const { group } = options;\n    let { user } = options;\n    if (!user) {\n      user = Meteor.user();\n    }\n    const userPermissions = user.roles[group.shopId];\n    const groupPermissions = group.permissions;\n\n    // granting invitation right for user with `owner` role in a shop\n    if (this.hasPermission([\"owner\"], Meteor.userId(), group.shopId)) {\n      return true;\n    }\n\n    // checks that userPermissions includes all elements from groupPermissions\n    // we are not using Reaction.hasPermission here because it returns true if the user has at least one\n    return _.difference(groupPermissions, userPermissions).length === 0;\n  },\n\n  /**\n   * @name registerTemplate\n   * @method\n   * @memberof Core\n   * @summary Registers Templates into the Templates Collection\n   * @return {function} Registers template\n   */\n  registerTemplate,\n\n  /**\n   * @name hasPermission\n   * @method\n   * @memberof Core\n   * @summary server permissions checks hasPermission exists on both the server and the client.\n   * @param {String | Array} checkPermissions -String or Array of permissions if empty, defaults to \"admin, owner\"\n   * @param {String} userId - userId, defaults to Meteor.userId()\n   * @param {String} checkGroup group - default to shopId\n   * @return {Boolean} Boolean - true if has permission\n   */\n  hasPermission(checkPermissions, userId = Meteor.userId(), checkGroup = this.getShopId()) {\n    // check(checkPermissions, Match.OneOf(String, Array)); check(userId, String); check(checkGroup,\n    // Match.Optional(String));\n    let permissions;\n    // default group to the shop or global if shop isn't defined for some reason.\n    let group;\n    if (checkGroup !== undefined && typeof checkGroup === \"string\") {\n      group = checkGroup;\n    } else {\n      group = this.getShopId() || Roles.GLOBAL_GROUP;\n    }\n\n    // permissions can be either a string or an array we'll force it into an array and use that\n    if (checkPermissions === undefined) {\n      permissions = [\"owner\"];\n    } else if (typeof checkPermissions === \"string\") {\n      permissions = [checkPermissions];\n    } else {\n      permissions = checkPermissions;\n    }\n\n    // if the user has admin, owner permissions we'll always check if those roles are enough\n    permissions.push(\"owner\");\n    permissions = _.uniq(permissions);\n\n    // return if user has permissions in the group\n    return Roles.userIsInRole(userId, permissions, group);\n  },\n\n  /**\n   * @name hasOwnerAccess\n   * @method\n   * @memberof Core\n   * @return {Boolean} Boolean - true if has permission\n   */\n  hasOwnerAccess() {\n    return this.hasPermission([\"owner\"]);\n  },\n\n  /**\n   * @name hasAdminAccess\n   * @method\n   * @memberof Core\n   * @return {Boolean} Boolean - true if has permission\n   */\n  hasAdminAccess() {\n    return this.hasPermission([\"owner\", \"admin\"]);\n  },\n\n  /**\n   * @name hasDashboardAccess\n   * @method\n   * @memberof Core\n   * @return {Boolean} Boolean - true if has permission\n   */\n  hasDashboardAccess() {\n    return this.hasPermission([\"owner\", \"admin\", \"dashboard\"]);\n  },\n\n  /**\n   * @summary Finds all shops that a user has a given set of roles for\n   * @name getShopsWithRoles\n   * @method\n   * @memberof Core\n   * @param  {array} roles an array of roles to check. Will return a shopId if the user has _any_ of the roles\n   * @param  {string} [userId=Meteor.userId()] Optional userId, defaults to Meteor.userId()\n   *                                           Must pass this.userId from publications to avoid error!\n   * @return {array} Array of shopIds that the user has at least one of the given set of roles for\n   */\n  getShopsWithRoles(roles, userId = Meteor.userId()) {\n    // Owner permission for a shop superceeds grantable permissions, so we always check for owner permissions as well\n    roles.push(\"owner\");\n\n    // Reducer that returns a unique list of shopIds that results from calling getGroupsForUser for each role\n    return roles.reduce((shopIds, role) => {\n      // getGroupsForUser will return a list of shops for which this user has the supplied role for\n      const shopIdsUserHasRoleFor = Roles.getGroupsForUser(userId, role);\n\n      // If we have new shopIds found, add them to the list\n      if (Array.isArray(shopIdsUserHasRoleFor) && shopIdsUserHasRoleFor.length > 0) {\n        // Create unique array from existing shopIds array and the shops\n        return [...new Set([...shopIds, ...shopIdsUserHasRoleFor])];\n      }\n\n      // IF we don't have any shopIds returned, keep our existing list\n      return shopIds;\n    }, []);\n  },\n\n  /**\n   * @name getSellerShopId\n   * @method\n   * @memberof Core\n   * @return {String} Shop ID\n   */\n  getSellerShopId() {\n    return Roles.getGroupsForUser(this.userId, \"admin\");\n  },\n\n  /**\n   * @name configureMailUrl\n   * @method\n   * @memberof Core\n   * @summary Reaction.configureMailUrl() is deprecated. Please use Reaction.Email.getMailUrl() instead\n   * @return {String} URL\n   * @deprecated\n   */\n  configureMailUrl() {\n    // maintained for legacy support\n    Logger.warn(\"Reaction.configureMailUrl() is deprecated. Please use Reaction.Email.getMailUrl() instead\");\n    return getMailUrl();\n  },\n\n  /**\n   * @name getPrimaryShop\n   * @summary Get the first created shop. In marketplace, the Primary Shop is the shop that controls the marketplace\n   * and can see all other shops\n   * @method\n   * @memberof Core\n   * @return {Object} Shop\n   */\n  getPrimaryShop() {\n    const primaryShop = Shops.findOne({\n      shopType: \"primary\"\n    });\n\n    return primaryShop;\n  },\n\n  /**\n   * @name getPrimaryShopId\n   * @summary Get the first created shop ID. In marketplace, the Primary Shop is the shop that controls the marketplace\n   * and can see all other shops\n   * @method\n   * @memberof Core\n   * @return {String} ID\n   */\n  getPrimaryShopId() {\n    const primaryShop = this.getPrimaryShop();\n    if (primaryShop) {\n      return primaryShop._id;\n    }\n  },\n\n  /**\n   * @name getPrimaryShopName\n   * @method\n   * @summary Get primary shop name or empty string\n   * @memberof Core\n   * @return {String} Return shop name or empty string\n   */\n  getPrimaryShopName() {\n    const primaryShop = this.getPrimaryShop();\n    if (primaryShop) {\n      return primaryShop.name;\n    }\n    return \"\";\n  },\n\n  /**\n   * @name getPrimaryShopPrefix\n   * @summary Get primary shop prefix for URL\n   * @memberof Core\n   * @method\n   * @todo Primary Shop should probably not have a prefix (or should it be /shop?)\n   * @return {String} Prefix in the format of \"/<slug>\"\n   */\n  getPrimaryShopPrefix() {\n    return `/${this.getSlug(this.getPrimaryShopName().toLowerCase())}`;\n  },\n\n  /**\n   * @name getPrimaryShopSettings\n   * @method\n   * @memberof Core\n   * @summary Get primary shop settings object\n   * @return {Object} Get settings object or empty object\n   */\n  getPrimaryShopSettings() {\n    const settings = Packages.findOne({\n      name: \"core\",\n      shopId: this.getPrimaryShopId()\n    }) || {};\n    return settings.settings || {};\n  },\n\n  /**\n   * @name getPrimaryShopCurrency\n   * @method\n   * @memberof Core\n   * @summary Get primary shop currency string\n   * @return {String} Get shop currency or \"USD\"\n   */\n  getPrimaryShopCurrency() {\n    const primaryShop = this.getPrimaryShop();\n\n    if (primaryShop && primaryShop.currency) {\n      return primaryShop.currency;\n    }\n\n    return \"USD\";\n  },\n\n  /**\n   * @summary **DEPRECATED** This method has been deprecated in favor of using getShopId\n   * and getPrimaryShopId. To be removed.\n   * @deprecated\n   * @memberof Core\n   * @method getCurrentShopCursor\n   * @return {Cursor} cursor of shops that match the current domain\n   */\n  getCurrentShopCursor() {\n    const domain = this.getDomain();\n    const cursor = Shops.find({\n      domains: domain\n    });\n    if (!cursor.count()) {\n      Logger.debug(domain, \"Add a domain entry to shops for \");\n    }\n    return cursor;\n  },\n\n  /**\n   * @summary **DEPRECATED** This method has been deprecated in favor of using getShopId\n   * and getPrimaryShopId. To be removed.\n   * @deprecated\n   * @memberof Core\n   * @method getCurrentShop\n   * @return {Object} returns the first shop object from the shop cursor\n   */\n  getCurrentShop() {\n    const currentShopCursor = this.getCurrentShopCursor();\n    // also, we could check in such a way: `currentShopCursor instanceof Object` but not instanceof something.Cursor\n    if (typeof currentShopCursor === \"object\") {\n      return currentShopCursor.fetch()[0];\n    }\n    return null;\n  },\n\n  /**\n   * @name getShopId\n   * @method\n   * @memberof Core\n   * @summary Get shop ID, first by checking the current user's preferences\n   * then by getting the shop by the current domain.\n   * @todo should we return the Primary Shop if none found?\n   * @return {String} active shop ID\n   */\n  getShopId() {\n    // is there a stored value?\n    let shopId = ConnectionDataStore.get(\"shopId\");\n\n    // if so, return it\n    if (shopId) {\n      return shopId;\n    }\n\n    try {\n      // otherwise, find the shop by user settings\n      shopId = this.getUserShopId(Meteor.userId());\n    } catch (e) {\n      // `Meteor.userId` will raise an error when invoked outside of a method\n      // call or publication, i.e., at startup. That's ok here.\n    }\n\n    // if still not found, look up the shop by domain\n    if (!shopId) {\n      shopId = this.getShopIdByDomain();\n    }\n\n    // store the value for faster responses\n    ConnectionDataStore.set(\"shopId\", shopId);\n\n    return shopId;\n  },\n\n  /**\n   * @name clearCache\n   * @method\n   * @memberof Core\n   * @summary allows the client to trigger an uncached lookup of the shopId.\n   *          this is useful when a user switches shops.\n   */\n  resetShopId() {\n    ConnectionDataStore.clear(\"shopId\");\n  },\n\n  /**\n   * @name getShopIdByDomain\n   * @method\n   * @memberof Core\n   * @summary returns the shop which should be used given the current domain\n   */\n  getShopIdByDomain() {\n    const domain = this.getDomain();\n    const shop = Shops.find({\n      domains: domain\n    }, {\n      limit: 1,\n      fields: {\n        _id: 1\n      }\n    }).fetch()[0];\n\n    return shop && shop._id;\n  },\n\n  /**\n   * @name getUserShopId\n   * @method\n   * @memberof Core\n   * @summary Get a user's shop ID, as stored in preferences\n   * @todo This should intelligently find the correct default shop Probably whatever the main shop is or marketplace\n   * @return {StringId}        active shop ID\n   */\n  getUserShopId(userId) {\n    check(userId, String);\n\n    return this.getUserPreferences({\n      userId,\n      packageName: \"reaction\",\n      preference: \"activeShopId\"\n    });\n  },\n\n  /**\n   * @name getDomain\n   * @method\n   * @memberof Core\n   * @summary Get shop domain for URL\n   * @return {String} Shop domain\n   */\n  getDomain() {\n    return url.parse(Meteor.absoluteUrl()).hostname;\n  },\n\n  /**\n   * @name getShopName\n   * @method\n   * @memberof Core\n   * @summary If we can't find the shop or shop name return an empty string\n   * @return {String} Shop name or empty string \"\"\n   */\n  getShopName() {\n    const shopId = this.getShopId();\n    let shop;\n    if (shopId) {\n      shop = Shops.findOne({\n        _id: shopId\n      }, {\n        fields: {\n          name: 1\n        }\n      });\n    } else {\n      const domain = this.getDomain();\n      shop = Shops.findOne({\n        domains: domain\n      }, {\n        fields: {\n          name: 1\n        }\n      });\n    }\n    if (shop && shop.name) {\n      return shop.name;\n    }\n    return \"\";\n  },\n\n  /**\n   * @name getShopPrefix\n   * @method\n   * @memberof Core\n   * @summary Get shop prefix for URL\n   * @return {String} String in the format of \"/shop/slug\"\n   */\n  getShopPrefix() {\n    const shopName = this.getShopName();\n    const lowerCaseShopName = shopName.toLowerCase();\n    const slug = this.getSlug(lowerCaseShopName);\n    const marketplace = Packages.findOne({\n      name: \"reaction-marketplace\",\n      shopId: this.getPrimaryShopId()\n    });\n\n    if (marketplace && marketplace.settings && marketplace.settings.public) {\n      return `${marketplace.settings.public.shopPrefix}/${slug}`;\n    }\n    return `/${slug}`;\n  },\n\n  /**\n   * @name getShopEmail\n   * @method\n   * @memberof Core\n   * @summary Get shop email\n   * @return {String} String with the first store email\n   */\n  getShopEmail() {\n    const shop = Shops.find({\n      _id: this.getShopId()\n    }, {\n      limit: 1,\n      fields: {\n        emails: 1\n      }\n    }).fetch()[0];\n    return shop && shop.emails && shop.emails[0].address;\n  },\n\n  /**\n   * @name getShopSettings\n   * @method\n   * @memberof Core\n   * @summary Get shop settings object\n   * @param  {String} [name=\"core\"] Package name\n   * @return {Object}               Shop settings object or empty object\n   */\n  getShopSettings(name = \"core\") {\n    const settings = Packages.findOne({ name, shopId: this.getShopId() }) || {};\n    return settings.settings || {};\n  },\n\n  /**\n   * @name getShopCurrency\n   * @method\n   * @memberof Core\n   * @summary Get shop currency\n   * @return {String} Shop currency or \"USD\"\n   */\n  getShopCurrency() {\n    const shop = Shops.findOne({\n      _id: this.getShopId()\n    });\n\n    return (shop && shop.currency) || \"USD\";\n  },\n\n  /**\n   * @name getShopCurrencies\n   * @method\n   * @memberof Core\n   * @summary Get all currencies available to a shop\n   * @return {Object} Shop currency or \"USD\"\n   */\n  getShopCurrencies() {\n    const shop = Shops.findOne({\n      _id: this.getShopId()\n    });\n\n    return shop && shop.currencies;\n  },\n\n  /**\n   * @name getShopLanguage\n   * @method\n   * @memberof Core\n   * @todo TODO: Marketplace - should each shop set their own default language or\n   * should the Marketplace set a language that's picked up by all shops?\n   * @return {String} language\n   */\n  getShopLanguage() {\n    const { language } = Shops.findOne({\n      _id: this.getShopId()\n    }, {\n      fields: {\n        language: 1\n      }\n    });\n    return language;\n  },\n\n  /**\n   * @name getPackageSettings\n   * @method\n   * @memberof Core\n   * @summary Get package settings\n   * @param  {String} name Package name\n   * @return {Object|null}      Package setting object or null\n   */\n  getPackageSettings(name) {\n    return Packages.findOne({ name, shopId: this.getShopId() }) || null;\n  },\n\n  /**\n   * @summary Takes options in the form of a query object. Returns a package that matches.\n   * @method\n   * @memberof Core\n   * @name getPackageSettingsWithOptions\n   * @param  {object} options Options object, forms the query for Packages.findOne\n   * @return {object} Returns the first package found with the provided options\n   */\n  getPackageSettingsWithOptions(options) {\n    const query = options;\n    return Packages.findOne(query);\n  },\n\n  /**\n   * @name getMarketplaceSettings\n   * @method\n   * @memberof Core\n   * @summary finds the enabled `reaction-marketplace` package for\n   * the primary shop and returns the settings\n   * @return {Object} The marketplace settings from the primary shop or undefined\n   */\n  getMarketplaceSettings() {\n    const marketplace = Packages.findOne({\n      name: \"reaction-marketplace\",\n      shopId: this.getPrimaryShopId(),\n      enabled: true\n    });\n\n    if (marketplace && marketplace.settings) {\n      return marketplace.settings;\n    }\n    return {};\n  },\n\n  /**\n   * @name getUserPreferences\n   * @method\n   * @memberof Core\n   * @param  {Object} options {packageName, preference, defaultValue}\n   * @return {String|undefined} User's package preference or undefined\n   */\n  getUserPreferences(options) {\n    const { userId, packageName, preference, defaultValue } = options;\n\n    if (!userId) {\n      return undefined;\n    }\n\n    const user = AccountsCollection.findOne({ _id: userId });\n\n    if (user) {\n      const { profile } = user;\n      if (profile && profile.preferences && profile.preferences[packageName] && profile.preferences[packageName][preference]) {\n        return profile.preferences[packageName][preference];\n      }\n    }\n    return defaultValue || undefined;\n  },\n\n  /**\n   * @name setUserPreferences\n   * @method\n   * @summary save user preferences in the Accounts collection\n   * @param {String} packageName\n   * @param {String} preference\n   * @param {String} value\n   * @param {String} userId\n   * @return {Number} setPreferenceResult\n   */\n  setUserPreferences(packageName, preference, value, userId) {\n    const setPreferenceResult = AccountsCollection.update(userId, {\n      $set: {\n        [`profile.preferences.${packageName}.${preference}`]: value\n      }\n    });\n    return setPreferenceResult;\n  },\n  /**\n   *  @name insertPackagesForShop\n   *  @method\n   *  @memberof Core\n   *  @summary insert Reaction packages into Packages collection registry for a new shop\n   *  Assigns owner roles for new packages\n   *  Imports layouts from packages\n   *  @param {String} shopId - the shopId to create packages for\n   *  @return {String} returns insert result\n   */\n  insertPackagesForShop(shopId) {\n    const layouts = [];\n    if (!shopId) {\n      return [];\n    }\n\n    // Check to see what packages should be enabled\n    const shop = Shops.findOne({ _id: shopId });\n    const marketplaceSettings = this.getMarketplaceSettings();\n    let enabledPackages;\n\n    // Unless we have marketplace settings and an enabledPackagesByShopTypes Array\n    // we will skip this\n    if (marketplaceSettings &&\n        marketplaceSettings.shops &&\n        Array.isArray(marketplaceSettings.shops.enabledPackagesByShopTypes)) {\n      // Find the correct packages list for this shopType\n      const matchingShopType = marketplaceSettings.shops.enabledPackagesByShopTypes.find((EnabledPackagesByShopType) => EnabledPackagesByShopType.shopType === shop.shopType); // eslint-disable-line max-len\n      if (matchingShopType) {\n        ({ enabledPackages } = matchingShopType);\n      }\n    }\n\n    const packages = this.Packages;\n    // for each shop, we're loading packages in a unique registry\n    // Object.keys(pkgConfigs).forEach((pkgName) => {\n    for (const packageName in packages) {\n      // Guard to prvent unexpected `for in` behavior\n      if ({}.hasOwnProperty.call(packages, packageName)) {\n        const config = packages[packageName];\n        this.assignOwnerRoles(shopId, packageName, config.registry);\n\n        const pkg = Object.assign({}, config, {\n          shopId\n        });\n\n        // populate array of layouts that don't already exist (?!)\n        if (pkg.layout) {\n          // filter out layout templates\n          for (const template of pkg.layout) {\n            if (template && template.layout) {\n              layouts.push(template);\n            }\n          }\n        }\n\n        if (enabledPackages && Array.isArray(enabledPackages)) {\n          if (enabledPackages.indexOf(pkg.name) === -1) {\n            pkg.enabled = false;\n          } else if (pkg.settings && pkg.settings[packageName]) { // Enable \"soft switch\" for package.\n            pkg.settings[packageName].enabled = true;\n          }\n        }\n        Packages.insert(pkg);\n        Logger.debug(`Initializing ${shopId} ${packageName}`);\n      }\n    }\n\n    // helper for removing layout duplicates\n    const uniqLayouts = uniqWith(layouts, _.isEqual);\n    Shops.update({ _id: shopId }, { $set: { layout: uniqLayouts } });\n  },\n\n  /**\n   * @name getAppVersion\n   * @method\n   * @memberof Core\n   * @return {String} App version\n   */\n  getAppVersion() {\n    return Shops.findOne().appVersion;\n  },\n\n  /**\n   * @name createDefaultAdminUser\n   * @method\n   * @memberof Core\n   * @summary Method that creates default admin user\n   * Settings load precendence:\n   *  1. environment variables\n   *  2. settings in meteor.settings\n   * @returns {String} return userId\n   */\n  createDefaultAdminUser() {\n    const shopId = this.getPrimaryShopId();\n    if (!shopId) {\n      throw new Error(`createDefaultAdminUser: getPrimaryShopId returned ${shopId}`);\n    }\n\n    // if an admin user has already been created, we'll exit\n    if (Roles.getUsersInRole(\"owner\", shopId).count() !== 0) {\n      Logger.debug(\"Not creating default admin user, already exists\");\n      return \"\"; // this default admin has already been created for this shop.\n    }\n\n    // run hooks on options object before creating user (the options object must be returned from all callbacks)\n    let options = {};\n    options = Hooks.Events.run(\"beforeCreateDefaultAdminUser\", options);\n\n    // If $REACTION_SECURE_DEFAULT_ADMIN is set to \"true\" on first run,\n    // a random email/password will be generated instead of using the\n    // default email and password (email: admin@localhost pw: r3@cti0n)\n    // and the new admin user will need to verify their email to log in.\n    // If a random email and password are generated, the console will be\n    // the only place to retrieve them.\n    // If the admin email/password is provided via environment or Meteor settings,\n    // the $REACTION_SECURE_DEFAULT_ADMIN will only enforce the email validation part.\n    const isSecureSetup = process.env.REACTION_SECURE_DEFAULT_ADMIN === \"true\";\n\n    // generate default values to use if none are supplied\n    const defaultEmail = isSecureSetup ? `${Random.id(8).toLowerCase()}@localhost` : \"admin@localhost\";\n    const defaultPassword = isSecureSetup ? Random.secret(8) : \"r3@cti0n\";\n    const defaultUsername = \"admin\";\n    const defaultName = \"Admin\";\n\n    // Process environment variables and Meteor settings for initial user config.\n    // If ENV variables are set, they always override Meteor settings (settings.json).\n    // This is to allow for testing environments where we don't want to use users configured in a settings file.\n    const { env } = process;\n    let configureEnv = false;\n\n    if (env.REACTION_EMAIL && env.REACTION_AUTH) {\n      configureEnv = true;\n      Logger.info(\"Using environment variables to create admin user\");\n    }\n\n    // defaults use either env or generated values\n    options.email = env.REACTION_EMAIL || defaultEmail;\n    options.password = env.REACTION_AUTH || defaultPassword;\n    options.username = env.REACTION_USER_NAME || defaultUsername;\n    options.name = env.REACTION_USER || defaultName;\n\n    // or use `meteor --settings`\n    if (Meteor.settings && !configureEnv) {\n      if (Meteor.settings.reaction) {\n        options.email = Meteor.settings.reaction.REACTION_EMAIL || defaultEmail;\n        options.password = Meteor.settings.reaction.REACTION_AUTH || defaultPassword;\n        options.username = Meteor.settings.reaction.REACTION_USER || defaultUsername;\n        options.name = Meteor.settings.reaction.REACTION_USER_NAME || defaultName;\n        Logger.info(\"Using meteor --settings to create admin user\");\n      }\n    }\n\n    // set the default shop email to the default admin email\n    Shops.update(shopId, {\n      $addToSet: {\n        emails: {\n          address: options.email,\n          verified: true\n        }\n      }\n    });\n\n    // get the current shop\n    const shop = Shops.findOne(shopId);\n\n    // add the current domain to the shop if it doesn't already exist\n    if (!shop.domains.includes(this.getDomain())) {\n      // set the default shop email to the default admin email\n      Shops.update(shopId, {\n        $addToSet: {\n          domains: this.getDomain()\n        }\n      });\n    }\n\n    //\n    // create the new admin user\n    //\n    let accountId;\n    // we're checking again to see if this user was created but not specifically for this shop.\n    if (Meteor.users.find({ \"emails.address\": options.email }).count() === 0) {\n      accountId = Accounts.createUser(options);\n    } else {\n      // this should only occur when existing admin creates a new shop\n      accountId = Meteor.users.findOne({ \"emails.address\": options.email })._id;\n    }\n\n    // update the user's name if it was provided\n    // (since Accounts.createUser() doesn't allow that field and strips it out)\n    Meteor.users.update(accountId, {\n      $set: {\n        name: options.name\n      }\n    });\n\n    // unless strict security is enabled, mark the admin's email as validated\n    if (!isSecureSetup) {\n      Meteor.users.update({\n        \"_id\": accountId,\n        \"emails.address\": options.email\n      }, {\n        $set: {\n          \"emails.$.verified\": true\n        }\n      });\n      Collections.Accounts.update({\n        \"_id\": accountId,\n        \"emails.address\": options.email\n      }, {\n        $set: {\n          \"emails.$.verified\": true\n        }\n      });\n    } else {\n      // send verification email to admin\n      sendVerificationEmail(accountId);\n    }\n\n    // Set default owner roles\n    const defaultAdminRoles = [\"owner\", \"admin\", \"guest\", \"account/profile\"];\n    // Join other roles with defaultAdminRoles for owner.\n    // this is needed as owner should not just have \"owner\" but all other defined roles\n    let ownerRoles = defaultAdminRoles.concat(this.defaultCustomerRoles);\n    ownerRoles = _.uniq(ownerRoles);\n\n    // we don't use accounts/addUserPermissions here because we may not yet have permissions\n    Roles.setUserRoles(accountId, ownerRoles, shopId);\n    // // the reaction owner has permissions to all sites by default\n    Roles.setUserRoles(accountId, ownerRoles, Roles.GLOBAL_GROUP);\n    // initialize package permissions we don't need to do any further permission configuration it is taken care of in the\n    // assignOwnerRoles\n    const packages = Packages.find().fetch();\n    for (const pkg of packages) {\n      this.assignOwnerRoles(shopId, pkg.name, pkg.registry);\n    }\n\n    // notify user that the default admin was created by\n    // printing the account info to the console\n    Logger.warn(`\\n *********************************\n        \\n  IMPORTANT! DEFAULT ADMIN INFO\n        \\n  EMAIL/LOGIN: ${options.email}\n        \\n  PASSWORD: ${options.password}\n        \\n ********************************* \\n\\n`);\n\n    // run hooks on new user object\n    const user = Meteor.users.findOne(accountId);\n    Hooks.Events.run(\"afterCreateDefaultAdminUser\", user);\n\n    return accountId;\n  },\n\n  /**\n   *  @name loadPackages\n   *  @method\n   *  @memberof Core\n   *  @summary Insert Reaction packages into registry\n   *  we check to see if the number of packages have changed against current data\n   *  if there is a change, we'll either insert or upsert package registry\n   *  into the Packages collection\n   *  import is processed on hook in init()\n   *  @return {String} returns insert result\n   */\n  loadPackages() {\n    const packages = Packages.find().fetch();\n\n    let registryFixtureData;\n\n    if (process.env.REACTION_REGISTRY) {\n      // check the environment for the registry fixture data first\n      registryFixtureData = process.env.REACTION_REGISTRY;\n      Logger.info(\"Loaded REACTION_REGISTRY environment variable for registry fixture import\");\n    } else {\n      // or attempt to load reaction.json fixture data\n      try {\n        registryFixtureData = Assets.getText(\"settings/reaction.json\");\n        Logger.info(\"Loaded \\\"/private/settings/reaction.json\\\" for registry fixture import\");\n      } catch (error) {\n        Logger.warn(\"Skipped loading settings from reaction.json.\");\n        Logger.debug(error, \"loadSettings reaction.json not loaded.\");\n      }\n    }\n\n    if (registryFixtureData) {\n      const validatedJson = EJSON.parse(registryFixtureData);\n\n      if (!Array.isArray(validatedJson[0])) {\n        Logger.warn(\"Registry fixture data is not an array. Failed to load.\");\n      } else {\n        registryFixtureData = validatedJson;\n      }\n    }\n\n    const layouts = [];\n    // for each shop, we're loading packages in a unique registry\n    _.each(this.Packages, (config, pkgName) =>\n      Shops.find().forEach((shop) => {\n        const shopId = shop._id;\n        if (!shopId) return [];\n\n        // existing registry will be upserted with changes, perhaps we should add:\n        this.assignOwnerRoles(shopId, pkgName, config.registry);\n\n        // Settings from the package registry.js\n        const settingsFromPackage = {\n          name: pkgName,\n          icon: config.icon,\n          enabled: !!config.autoEnable,\n          settings: config.settings,\n          registry: config.registry,\n          layout: config.layout\n        };\n\n        // Setting from a fixture file, most likely reaction.json\n        let settingsFromFixture;\n        if (registryFixtureData) {\n          settingsFromFixture = registryFixtureData[0].find((packageSetting) => config.name === packageSetting.name);\n        }\n\n        // Setting already imported into the packages collection\n        const settingsFromDB = packages.find((ps) => (config.name === ps.name && shopId === ps.shopId));\n\n        const combinedSettings = merge({}, settingsFromPackage, settingsFromFixture || {}, settingsFromDB || {});\n\n        if (combinedSettings.registry) {\n          combinedSettings.registry = combinedSettings.registry.map((entry) => {\n            if (entry.provides && !Array.isArray(entry.provides)) {\n              entry.provides = [entry.provides];\n              Logger.warn(`Plugin ${combinedSettings.name} is using a deprecated version of the provides property for` +\n                          ` the ${entry.name || entry.route} registry entry. Since v1.5.0 registry provides accepts` +\n                          \" an array of strings.\");\n            }\n            return entry;\n          });\n        }\n\n        // populate array of layouts that don't already exist in Shops\n        if (combinedSettings.layout) {\n          // filter out layout Templates\n          for (const pkg of combinedSettings.layout) {\n            if (pkg.layout) {\n              layouts.push(pkg);\n            }\n          }\n        }\n        // Import package data\n        this.Importer.package(combinedSettings, shopId);\n        return Logger.debug(`Initializing ${shop.name} ${pkgName}`);\n      }));\n\n    // helper for removing layout duplicates\n    const uniqLayouts = uniqWith(layouts, _.isEqual);\n    // import layouts into Shops\n    Shops.find().forEach((shop) => {\n      this.Importer.layout(uniqLayouts, shop._id);\n    });\n\n    //\n    // package cleanup\n    //\n    Shops.find().forEach((shop) => Packages.find().forEach((pkg) => {\n      // delete registry entries for packages that have been removed\n      if (!_.has(this.Packages, pkg.name)) {\n        Logger.debug(`Removing ${pkg.name}`);\n        return Packages.remove({ shopId: shop._id, name: pkg.name });\n      }\n      return false;\n    }));\n  },\n\n  /**\n   * @name setAppVersion\n   * @method\n   * @memberof Core\n   * @return {undefined} no return value\n   */\n  setAppVersion() {\n    const { version } = packageJson;\n    Logger.info(`Reaction Version: ${version}`);\n    Shops.update({}, { $set: { appVersion: version } }, { multi: true });\n  },\n\n  /**\n   * @summary Method for getting all schemas attached to a given collection\n   * @deprecated by simpl-schema\n   * @private\n   * @name collectionSchema\n   * @param  {string} collection The mongo collection to get schemas for\n   * @param  {Object} [selector] Optional selector for multi schema collections\n   * @return {Object} Returns a simpleSchema that is a combination of all schemas\n   *                  that have been attached to the collection or false if\n   *                  the collection or schema could not be found\n   */\n  collectionSchema(collection, selector) {\n    Logger.warn(\"Reaction.collectionSchema is deprecated and will be removed\" +\n      \" in a future release. Use collection.simpleSchema(selector).\");\n\n    const selectorErrMsg = selector ? `and selector ${selector}` : \"\";\n    const errMsg = `Reaction.collectionSchema could not find schemas for ${collection} collection ${selectorErrMsg}`;\n\n    const col = Collections[collection];\n    if (!col) {\n      Logger.warn(errMsg);\n      // Return false so we don't pass a check that uses a non-existant schema\n      return false;\n    }\n\n    const schema = col.simpleSchema(selector);\n    if (!schema) {\n      Logger.warn(errMsg);\n      // Return false so we don't pass a check that uses a non-existant schema\n      return false;\n    }\n\n    return schema;\n  }\n};\n","import _ from \"lodash\";\nimport Fiber from \"fibers\";\nimport connect from \"connect\";\nimport bodyParser from \"body-parser\";\nimport connectRoute from \"connect-route\";\n\nimport { Meteor } from \"meteor/meteor\";\nimport { WebApp } from \"meteor/webapp\";\n\n/**\n * @file Reaction Endpoints - This becomes Reaction.Endpoints and can be used in any server side code that\n * `imports { Reaction } from \"/server/api\"`\n * Adapted from https://github.com/stubailo/meteor-rest/tree/master/packages/json-routes\n * @todo Add a rate limiter to our HTTP endpoint module\n * @namespace Endpoints\n */\n\nconst Endpoints = {};\n\nWebApp.connectHandlers.use(bodyParser.json({\n  limit: \"200kb\", // Override default request size\n  // Attach the raw body which is necessary for doing verifications for some webhooks\n  verify(req, res, buf) {\n    req.rawBody = buf;\n  },\n  extended: true\n}));\n\n// Handler for adding middleware before an endpoint (Endpoints.middleWare\n// is just for legacy reasons). Also serves as a namespace for middleware\n// packages to declare their middleware functions.\nEndpoints.middleWare = connect();\nEndpoints.Middleware = Endpoints.middleWare;\nWebApp.connectHandlers.use(Endpoints.Middleware);\n\n// List of all defined JSON API Endpoints\nEndpoints.routes = [];\n\n// Save reference to router for later\nlet connectRouter;\n\n// Register as a middleware\nWebApp.connectHandlers.use(Meteor.bindEnvironment(connectRoute((router) => {\n  connectRouter = router;\n})));\n\n/**\n * @method writeJsonToBody\n * @summary Stringifies and writes JSON to body of response\n * @private\n * @param  {Object} res response object\n * @param  {Object} json JSON\n * @return {void}\n */\nfunction writeJsonToBody(res, json) {\n  if (json !== undefined) {\n    const shouldPrettyPrint = (process.env.NODE_ENV === \"development\");\n    const spacer = shouldPrettyPrint ? 2 : null;\n    res.setHeader(\"Content-type\", \"application/json\");\n    res.write(JSON.stringify(json, null, spacer));\n  }\n}\n\n// Error middleware must be added last, to catch errors from prior middleware.\n// That's why we cache them and then add after startup.\nlet errorMiddlewares = [];\nEndpoints.ErrorMiddleware = {\n  use(...args) {\n    errorMiddlewares.push(args);\n  }\n};\n\nMeteor.startup(() => {\n  errorMiddlewares.forEach((errorMiddleware) => {\n    const errorMiddlewareFn = errorMiddleware.map((maybeFn) => {\n      if (_.isFunction(maybeFn)) {\n        // A connect error middleware needs exactly 4 arguments because they use fn.length === 4 to\n        // decide if something is an error middleware.\n        return function (a, b, c, d) {\n          Meteor.bindEnvironment(maybeFn)(a, b, c, d);\n        };\n      }\n      return maybeFn;\n    });\n    WebApp.connectHandlers.use.apply(WebApp.connectHandlers, ...errorMiddlewareFn);\n  });\n\n  errorMiddlewares = [];\n});\n\nlet responseHeaders = {\n  \"Cache-Control\": \"no-store\",\n  \"Pragma\": \"no-cache\"\n};\n\n/**\n * @method add\n * @memberof Endpoints\n * @param  {String} method  HTTP method\n * @param  {String} path    HTTP path - Make sure path starts with a slash\n * @param  {Function} handler Callback handler\n * @example Reaction.Endpoints.add(\"post\", \"/webhooks/shopify/orders-create\", function (req, res){})\n * @return {undefined}\n */\nEndpoints.add = function (method, path, handler) {\n  // Make sure path starts with a slash\n  let slashedPath = path;\n  if (path[0] !== \"/\") {\n    slashedPath = `/${path}`;\n  }\n\n  // Add to list of known Endpoints\n  Endpoints.routes.push({\n    method,\n    path: slashedPath\n  });\n\n  connectRouter[method.toLowerCase()](path, (req, res, next) => {\n    // Set headers on response\n    const headerKeys = Object.keys(responseHeaders);\n    headerKeys.forEach((key) => {\n      res.setHeader(key, responseHeaders[key]);\n    });\n\n    Fiber(() => {\n      try {\n        handler(req, res, next);\n      } catch (error) {\n        next(error);\n      }\n    }).run();\n  });\n};\n\n/**\n * @method setResponseHeaders\n * @memberof Endpoints\n * @param  {Object} headers HTTP headers\n * @return {undefined}\n */\nEndpoints.setResponseHeaders = function (headers) {\n  responseHeaders = headers;\n};\n\n/**\n * @method sendResponse\n * @summary Sets the response headers, status code, and body, and ends it.\n * The JSON response will be pretty printed if NODE_ENV is `development`.\n * @memberof Endpoints\n * @example Reaction.Endpoints.sendResponse(res)\n * @param {Object} res Response object\n * @param {Object} [options] Options object\n * @param {Number} [options.code] HTTP status code. Default is 200.\n * @param {Object} [options.headers] Dictionary of headers.\n * @param {Object|Array|null|undefined} [options.data] The object to\n *   stringify as the response. If `null`, the response will be \"null\".\n *   If `undefined`, there will be no response body.\n * @return {void}\n */\nEndpoints.sendResponse = function (res, options = {}) {\n  // We've already set global headers on response, but if they\n  // pass in more here, we set those.\n  if (options.headers) {\n    const headerKeys = Object.keys(options.headers);\n    headerKeys.forEach((key) => {\n      res.setHeader(key, options.headers[key]);\n    });\n  }\n\n  // Set status code on response\n  res.statusCode = options.code || 200;\n\n  // Set response body\n  writeJsonToBody(res, options.data);\n\n  // Send the response\n  res.end();\n};\n\nexport default Endpoints;\n","import _ from \"lodash\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Logger, Reaction } from \"/server/api\";\nimport { Shops, Groups } from \"/lib/collections\";\n\n/**\n * @name createGroups\n * @method\n * @memberof Core\n * @summary creates groups for shops\n * @param {object} options -\n * @param {string} options.shopId - the id of shop to create the group for. Not passing a shopId creates\n * the group(s) for all available shops\n * @param {object} options.roles - key-value pair representing the group slug (key) and\n * array of roles for the group (value)\n * @return {null}\n */\nexport function createGroups(options = {}) {\n  const { shopId } = options;\n  let { roles } = options;\n  const allGroups = Groups.find({}).fetch();\n  const query = {};\n\n  if (!roles) {\n    roles = getDefaultGroupRoles();\n  }\n\n  if (shopId) {\n    query._id = shopId;\n  }\n\n  const shops = Shops.find(query).fetch();\n\n  if (shops && shops.length) {\n    shops.forEach((shop) => createGroupsForShop(shop));\n  }\n  function createGroupsForShop(shop) {\n    Object.keys(roles).forEach((groupKey) => {\n      const groupExists = allGroups.find((grp) => grp.slug === groupKey && grp.shopId === shop._id);\n      if (!groupExists) { // create group only if it doesn't exist before\n        // get roles from the default groups of the primary shop; we try to use this first before using default roles\n        const primaryShopGroup = allGroups.find((grp) => grp.slug === groupKey && grp.shopId === Reaction.getPrimaryShopId());\n        Logger.debug(`creating group ${groupKey} for shop ${shop.name}`);\n        Groups.insert({\n          name: groupKey,\n          slug: groupKey,\n          permissions: (primaryShopGroup && primaryShopGroup.permissions) || roles[groupKey],\n          shopId: shop._id\n        });\n      }\n    });\n  }\n}\n\n/**\n * @method getDefaultGroupRoles\n * @private\n * @method\n * @memberof Core\n * @summary Generates default groups: Get all defined roles from the DB except \"anonymous\"\n * because that gets removed from a user on register if it's not removed,\n * it causes mismatch between roles in user (i.e Meteor.user().roles[shopId]) vs that in\n * the user's group (Group.find(usergroup).permissions)\n * @return {object} roles - object key-value pair containing the default groups and roles for the groups\n */\nfunction getDefaultGroupRoles() {\n  let ownerRoles = Roles\n    .getAllRoles().fetch()\n    .map((role) => role.name)\n    .filter((role) => role !== \"anonymous\"); // see comment above\n\n  // Join all other roles with package roles for owner. Owner should have all roles\n  // this is needed because of default roles defined in the app that are not in Roles.getAllRoles\n  ownerRoles = ownerRoles.concat(Reaction.defaultCustomerRoles);\n  ownerRoles = _.uniq(ownerRoles);\n\n  // we're making a Shop Manager default group that have all roles except the owner role\n  const shopManagerRoles = ownerRoles.filter((role) => role !== \"owner\" && role !== \"admin\");\n  shopManagerRoles.push(\"shopSettings\");\n\n  const roles = {\n    \"shop manager\": shopManagerRoles,\n    \"customer\": Reaction.defaultCustomerRoles,\n    \"guest\": Reaction.defaultVisitorRoles,\n    \"owner\": ownerRoles\n  };\n\n  return roles;\n}\n","import Hooks from \"@reactioncommerce/hooks\";\nimport Logger from \"@reactioncommerce/logger\";\nimport { Mongo, MongoInternals } from \"meteor/mongo\";\nimport { EJSON } from \"meteor/ejson\";\nimport { check, Match } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport * as Collections from \"/lib/collections\";\n\n/**\n * @file Exposes the Importer object implementing methods for bulk imports.\n * @author Tom De CaluwÃ©\n * @namespace Importer\n */\n\nexport const Importer = {};\n\nImporter._buffers = {};\nImporter._contexts = {};\nImporter._count = {};\nImporter._indications = {};\nImporter._limit = 1000;\n\nImporter._name = function (collection) {\n  return collection._name;\n};\n\nImporter._upsert = function () {\n  return true;\n};\n\n//\n// TODO Verify if Importer.startup is deprecated\n//\nImporter.startup = function () {\n  return true;\n};\n\nImporter.load = function (key, object) {\n  check(object, Object);\n\n  this.object(this.identify(object), key, object);\n};\n\nImporter.indication = function (field, collection, probability) {\n  check(field, String);\n  check(collection, Mongo.Collection);\n  check(probability, Number);\n\n  this._indications[field] = { collection, probability };\n};\n\n/**\n * Importer.identify\n * @name identify\n * @method\n * @memberof Importer\n * @summary Tries to identify the schema associated with a document.\n * @param {Object} document - A document with unknown schema\n * @returns {Mongo.Collection} Returns a MongoDB collection in which the\n * document can be inserted.\n * @throws {Error} Throws an error if the schema couldn't be determined.\n *\n * The algorithm initially assumes the document can be anything. It associates\n * with each field in the document a probability that it isn't following some\n * schema other than the one the field is associated with.\n *\n * Afterwards the schema with the maximal probability is selected. An error is\n * thrown if the schema cannot be determined.\n */\nImporter.identify = function (document) {\n  check(document, Object);\n\n  const probabilities = {};\n\n  for (const key of Object.keys(document)) {\n    if (this._indications[key]) {\n      const collection = this._name(this._indications[key].collection);\n      probabilities[collection] = probabilities[collection] || 1.0 * this._indications[\n        key].probability;\n    }\n  }\n\n  let total = 1.0;\n  for (const key of Object.keys(probabilities)) {\n    total *= probabilities[key];\n  }\n\n  let max = 0.0;\n  let name;\n  for (const key of Object.keys(probabilities)) {\n    const probability = total / probabilities[key];\n    if (probability > max) {\n      max = probability;\n      name = key;\n    } else if (probability === max) {\n      name = undefined;\n    }\n  }\n\n  if (name && max > 0.3) {\n    return Collections[name];\n  }\n  throw new Error(\"Couldn't determine the schema associated with this document\");\n};\n\n/**\n * @name commit\n * @method\n * @memberof Importer\n * @summary Commit the buffer for a given collection to the database.\n * @param {Mongo.Collection} collection The target collection to be flushed to disk\n * @returns {undefined}\n */\nImporter.commit = function (collection) {\n  check(collection, Mongo.Collection);\n  // Construct a collection identifier.\n  const name = this._name(collection);\n\n  // Only commit if the buffer isn't empty (otherwise it'll throw).\n  if (this._count[name]) {\n    this.buffer(collection).execute((error, result) => {\n      // Inserted document counts don't affect the modified document count, so we\n      // throw everything together.\n      const nImported = result.nModified + result.nInserted + result.nUpserted;\n      const nTouched = result.nMatched + result.nInserted + result.nUpserted;\n      const { nRemoved } = result;\n      // Log some information about the Importer.\n      if (nTouched) {\n        let message = `Modified ${nImported}${nImported === 1 ? \" document\" : \" documents\"}`;\n        message += ` while importing ${nTouched} to ${name}`;\n        Logger.debug(message);\n      }\n      if (nRemoved) {\n        let message = `Removed ${nRemoved}${nRemoved === 1 ? \" document\" : \" documents\"}`;\n        message += ` from ${name}`;\n        Logger.debug(message);\n      }\n      // Log any errors returned.\n      const message = `Error while importing to ${name}`;\n      const writeErrors = result.getWriteErrors();\n\n      for (let i = 0; i < writeErrors.length; i += 1) {\n        Logger.warn(`${message}: ${writeErrors[i].errmsg}`);\n      }\n      const writeConcernError = result.getWriteConcernError();\n      if (writeConcernError) {\n        Logger.warn(`${message}: ${writeConcernError.errmsg}`);\n      }\n    });\n    // Reset the buffer.\n    delete this._buffers[name];\n    this._count[name] = 0;\n  }\n};\n\n/**\n * @name flush\n * @method\n * @memberof Importer\n * @summary Process the buffer for a given collection and commit the database.\n * @param {Mongo.Collection} collection optional - supply a Mongo collection, or leave empty to commit all buffer entries\n * @returns {undefined}\n */\nImporter.flush = function (collection) {\n  if (!collection) {\n    for (const name of Object.keys(this._buffers)) {\n      this.commit(Collections[name]);\n    }\n    return;\n  }\n  this.commit(collection);\n};\n\n/**\n * @name context\n * @method\n * @memberof Importer\n * @summary Get a validation context for a given collection.\n * @param {Mongo.Collection} collection The target collection\n * @param {Object} [selector] A selector object to retrieve the correct schema.\n * @returns {SimpleSchema.ValidationContext} A validation context.\n *\n * The validation context is requested from the schema associated with the\n * collection.\n */\nImporter.context = function (collection, selector) {\n  check(collection, Mongo.Collection);\n  check(selector, Match.Optional(Object));\n\n  // Construct a context identifier.\n  let name = this._name(collection);\n  if (selector && selector.type) {\n    name = `${name}_${selector.type}`;\n  }\n  return collection.simpleSchema(selector).namedContext(name);\n};\n\n/**\n * @name buffer\n * @method\n * @memberof Importer\n * @summary Get an import buffer for a given collection.\n * @param {Object} collection The target collection\n * @returns {Object} return buffer\n * If no buffer is presented, a new one will be constructed.\n */\nImporter.buffer = function (collection) {\n  check(collection, Mongo.Collection);\n\n  if (!MongoInternals.NpmModule.Collection.prototype.initializeUnorderedBulkOp) {\n    throw Error(\"Couldn't detect the MongoDB bulk API, are you using MongoDB 2.6 or above?\");\n  }\n\n  // Construct a buffer identifier.\n  const name = this._name(collection);\n\n  // Construct a new buffer if necessary.\n  if (this._buffers[name]) {\n    return this._buffers[name];\n  }\n  this._count[name] = 0;\n  this._buffers[name] = collection.rawCollection().initializeUnorderedBulkOp();\n  return this._buffers[name];\n};\n\n/**\n * @name product\n * @method\n * @memberof Importer\n * @summary Store a product in the import buffer.\n * @param {Object} key A key to look up the product\n * @param {Object} product The product data to be updated\n * @returns {Object}\n * Importing a variant currently consists of the following steps:\n *\n * * Pull the variant from non-matching parent products.\n * * Push the variant if it doesn't exist.\n * * Update the variant.\n */\nImporter.product = function (key, product) {\n  // If product has an _id, we use it to look up the product before\n  // updating the product so as to avoid trying to change the _id\n  // which is immutable.\n  if (product._id && !key._id) {\n    key._id = product._id;\n  }\n  return this.object(Collections.Products, key, product);\n};\n\n/**\n * @name package\n * @method\n * @memberof Importer\n * @summary Store a package in the import buffer.\n * @param {Object} pkg The package data to be updated\n * @param {String} shopId The package data to be updated\n * @returns {undefined}\n */\nImporter.package = function (pkg, shopId) {\n  check(pkg, Object);\n  check(shopId, String);\n  const key = {\n    name: pkg.name,\n    shopId\n  };\n  return this.object(Collections.Packages, key, pkg);\n};\n\n//\n// Importer.translation\n// server/startup/i18n.js\n//\n\n/**\n * @name template\n * @method\n * @memberof Importer\n * @summary Store a template in the import buffer.\n * @param {Object} templateInfo The template data to be updated\n * @returns {undefined}\n */\nImporter.template = function (templateInfo) {\n  check(templateInfo, Object);\n\n  const key = {\n    name: templateInfo.name,\n    type: templateInfo.type || \"template\"\n  };\n\n  return this.object(Collections.Templates, key, templateInfo);\n};\n\n/**\n * @name translation\n * @method\n * @memberof Importer\n * @summary Store a translation in the import buffer.\n * @param {Object} key A key to look up the translation\n * @param {Object} translation The translation data to be updated\n * @returns {Object} updated translation buffer\n */\nImporter.translation = function (key, translation) {\n  const modifiedKey = Object.assign(key, { ns: translation.ns });\n  return this.object(Collections.Translations, modifiedKey, translation);\n};\n\n/**\n * @name shop\n * @method\n * @memberof Importer\n * @summary Store a shop in the import buffer.\n * @param {Object} key A key to look up the shop\n * @param {Object} shop The shop data to be updated\n * @returns {Object} this shop\n */\nImporter.shop = function (key, shop) {\n  return this.object(Collections.Shops, key, shop);\n};\n\n/**\n * @name layout\n * @method\n * @memberof Importer\n * @summary store a shop layout in the import buffer\n * @param {Array} layout - an array of layouts to be added to shop\n * @param {String} shopId shopId\n * @returns {Object} this shop\n */\nImporter.layout = function (layout, shopId) {\n  const key = {\n    _id: shopId\n  };\n  return this.object(Collections.Shops, key, {\n    _id: shopId,\n    layout\n  });\n};\n\n/**\n * @name shipping\n * @method\n * @memberof Importer\n * @summary Store shipping in the import buffer.\n * @param {Object} key A shipping service key used in combination with provider\n * @param {Object} shipping The shipping data to be updated\n * @returns {Object} this shipping\n */\nImporter.shipping = function (key, shipping) {\n  let importKey = {};\n  //\n  // we have a bit of a strange structure in Shipping\n  // and don't really have a key that is good for\n  // determining if we imported this before\n  // so we're just saying that if this service\n  // already exists then we're not going to import\n  //\n  const result = Collections.Shipping.findOne(key);\n  if (result) {\n    importKey = {\n      _id: result._id,\n      shopId: result.shopId\n    };\n    delete shipping.methods;\n  }\n  const modifiedKey = Object.assign({}, key, importKey);\n  return this.object(Collections.Shipping, modifiedKey, shipping);\n};\n\n/**\n * @name tag\n * @method\n * @memberof Importer\n * @summary Store a tag in the import buffer.\n * @param {Object} key A key to look up the tag\n * @param {Object} tag The tag data to be updated\n * @returns {Object} this tag\n */\nImporter.tag = function (key, tag) {\n  return this.object(Collections.Tags, key, tag);\n};\n\n/**\n * @name object\n * @method\n * @memberof Importer\n * @summary Push a new upsert document to the import buffer.\n * @param {Mongo.Collection} collection The target collection\n * @param {Object} key A key to look up the object\n * @param {Object} object The object data to be updated\n * @returns {undefined}\n */\nImporter.object = function (collection, key, object) {\n  check(collection, Mongo.Collection);\n  check(key, Object);\n  check(object, Object);\n\n  // enforce strings instead of Mongo.ObjectId\n  if (!collection.findOne(key) && !object._id) {\n    key._id = Random.id();\n  }\n\n  // hooks for additional import manipulation.\n  const importObject = Hooks.Events.run(`onImport${this._name(collection)}`, object);\n\n  // Cleaning the object adds default values from schema, if value doesn't exist\n  const cleanedModifier = collection.simpleSchema(importObject).clean({\n    $set: importObject\n  }, {\n    isModifier: true,\n    extendAutoValueContext: { isUpsert: true }\n  });\n\n  // And validate the object against the schema\n  this.context(collection, importObject).validate(cleanedModifier, {\n    modifier: true,\n    upsert: true\n  });\n\n  // Upsert the object.\n  // With the upsert option set to true, if no matching documents exist for the Bulk.find() condition,\n  // then the update or the replacement operation performs an insert.\n  // https://docs.mongodb.com/manual/reference/method/Bulk.find.upsert/\n  this.buffer(collection).find(key).upsert().update(cleanedModifier);\n\n  this._count[this._name(collection)] += 1;\n  if (this._count[this._name(collection)] >= this._limit) {\n    this.flush(collection);\n  }\n};\n\n/**\n * @name process\n * @method\n * @memberof Importer\n * @summary Process a json array of import documents using a callback.\n * @param {Object[]} json An array containing the import documents\n * @param {string[]} keys Fields that should be used as the import key.\n * @param {Function} callback A callback accepting two parameters.\n * The callback should accept a key document to consult the database as a first\n * parameter and an update document as the second parameter.\n * @returns {undefined}\n */\nImporter.process = function (json, keys, callback) {\n  check(json, String);\n  check(keys, Array);\n  check(callback, Function);\n\n  const array = EJSON.parse(json);\n\n  for (let i = 0; i < array.length; i += 1) {\n    const key = {};\n    for (let j = 0; j < keys.length; j += 1) {\n      key[keys[j]] = array[i][keys[j]];\n    }\n    callback.call(this, key, array[i]);\n  }\n};\n\nImporter.indication(\"i18n\", Collections.Translations, 0.2);\nImporter.indication(\"hashtags\", Collections.Products, 0.5);\nImporter.indication(\"barcode\", Collections.Products, 0.5);\nImporter.indication(\"price\", Collections.Products, 0.5);\nImporter.indication(\"ancestors\", Collections.Products, 0.5);\nImporter.indication(\"languages\", Collections.Shops, 0.5);\nImporter.indication(\"currencies\", Collections.Shops, 0.5);\nImporter.indication(\"timezone\", Collections.Shops, 0.5);\nImporter.indication(\"isTopLevel\", Collections.Tags, 0.4);\nImporter.indication(\"slug\", Collections.Tags, 0.5);\nImporter.indication(\"provider\", Collections.Shipping, 0.2);\n\n//\n// exporting Fixture\n// use this instead of Import if you want\n// Bulk.find.upsert() to equal false\n//\nexport const Fixture = Object.assign({}, Importer, {\n  _upsert: () => false\n});\n","import Log from \"@reactioncommerce/logger\";\nimport Core from \"./core\";\nimport * as Accounts from \"./accounts\";\nimport * as AddDefaultRoles from \"./addDefaultRoles\";\nimport * as AssignRoles from \"./assignRoles\";\nimport * as Email from \"./email\";\nimport Endpoints from \"./endpoints\";\nimport * as Importer from \"./importer\";\nimport * as LoadSettings from \"./loadSettings\";\nimport Router from \"../router\";\nimport * as SetDomain from \"./setDomain\";\nimport * as ShopName from \"./shopName\";\nimport * as Utils from \"./utils\";\n\nimport * as Collections from \"/lib/collections\";\nimport * as Schemas from \"/lib/collections/schemas\";\n\n// Reaction methods (server)\n\nconst Reaction = Object.assign(\n  {},\n  Core,\n  { Accounts },\n  AddDefaultRoles,\n  AssignRoles,\n  { Collections },\n  { Email },\n  { Endpoints },\n  Importer,\n  LoadSettings,\n  { Log },\n  { Router },\n  { Schemas },\n  SetDomain,\n  ShopName,\n  Utils\n);\n\nexport default Reaction;\n","import _ from \"lodash\";\nimport { check } from \"meteor/check\";\nimport { ServiceConfiguration } from \"meteor/service-configuration\";\nimport { Packages } from \"/lib/collections\";\nimport { Logger } from \"/server/api\";\nimport { EJSON } from \"meteor/ejson\";\n\n/**\n * @method loadSettings\n * @summary\n * This basically allows you to \"hardcode\" all the settings. You can change them\n * via admin etc for the session, but when the server restarts they'll\n * be restored back to the supplied json\n *\n * All settings are private unless added to `settings.public`\n *\n * Meteor account services can be added in `settings.services`\n * @memberof Core\n * @param {Object} json - json object to insert\n * @return {Boolean} boolean -  returns true on insert\n * @example\n *  ReactionRegistry.loadSettings Assets.getText(\"settings/reaction.json\")\n */\nexport function loadSettings(json) {\n  check(json, String);\n  let exists;\n  let service;\n  let services;\n  let settings;\n  const validatedJson = EJSON.parse(json);\n\n  // validate json and error out if not an array\n  if (!_.isArray(validatedJson[0])) {\n    Logger.warn(\"Load Settings is not an array. Failed to load settings.\");\n    return false;\n  }\n\n  let result;\n  // loop settings and upsert packages.\n  for (const pkg of validatedJson) {\n    for (const item of pkg) {\n      exists = Packages.findOne({\n        name: item.name\n      });\n      //\n      // TODO migrate functionality to Reaction.Importer\n      // Reaction.Importer.package(item, shopId);\n      //\n      // insert into the Packages collection\n      if (exists) {\n        result = Packages.upsert({\n          name: item.name\n        }, {\n          $set: {\n            settings: item.settings,\n            enabled: item.enabled\n          }\n        }, {\n          multi: true,\n          upsert: true,\n          validate: false\n        });\n      }\n      // sets the private settings of various\n      // accounts authentication services\n      if (item.settings.services) {\n        for (services of item.settings.services) {\n          for (service in services) {\n            // actual settings for the service\n            if ({}.hasOwnProperty.call(services, service)) {\n              settings = services[service];\n              ServiceConfiguration.configurations.upsert({\n                service\n              }, {\n                $set: settings\n              });\n              Logger.debug(`service configuration loaded: ${item.name} | ${service}`);\n            }\n          }\n        }\n      }\n      Logger.debug(`loaded local package data: ${item.name}`);\n    }\n  }\n  return result;\n}\n","/**\n * @summary Returns an disjoint object as right join. For a visualization, see:\n *          http://www.codeproject.com/KB/database/Visual_SQL_Joins/Visual_SQL_JOINS_orig.jpg\n *          Additionally, the join is done recursively on properties of\n *          nested objects as well. Nested arrays are handled like\n *          primitive values.\n * @author Tom De CaluwÃ©\n * @memberof Core\n * @param {Object} leftSet An object that can contain nested sub-objects\n * @param {Object} rightSet An object that can contain nested sub-objects\n * @returns {Object} The disjoint object that does only contain properties\n *                   from the rightSet. But only those, that were not present\n *                   in the leftSet.\n */\nconst doRightJoinNoIntersection = (leftSet, rightSet) => {\n  if (rightSet === null) return null;\n\n  let rightJoin;\n  if (Array.isArray(rightSet)) {\n    rightJoin = [];\n  } else {\n    rightJoin = {};\n  }\n  const findRightOnlyProperties = () => Object.keys(rightSet).filter((key) => {\n    if (typeof (rightSet[key]) === \"object\" &&\n        !Array.isArray(rightSet[key])) {\n      // Nested objects are always considered\n      return true;\n    }\n    // Array or primitive value\n    return !{}.hasOwnProperty.call(leftSet, key);\n  });\n\n  for (const key of findRightOnlyProperties()) {\n    if (typeof (rightSet[key]) === \"object\") {\n      // subobject or array\n      if ({}.hasOwnProperty.call(leftSet, key) && (typeof (leftSet[key]) !== \"object\" ||\n           Array.isArray(leftSet[key]) !== Array.isArray(rightSet[key]))) {\n        // This is not expected!\n        throw new Error(`${\"Left object and right object's internal structure must be congruent! Offending key: \"}${key}`);\n      }\n      const rightSubJoin = doRightJoinNoIntersection(\n        {}.hasOwnProperty.call(leftSet, key) ? leftSet[key] : {},\n        rightSet[key]\n      );\n\n      const obj = {};\n      if (rightSubJoin === null) {\n        obj[key] = null;\n      } else if (Object.keys(rightSubJoin).length !== 0 ||\n                 Array.isArray(rightSubJoin)) {\n        // object or (empty) array\n        obj[key] = rightSubJoin;\n      }\n      rightJoin = Object.assign(rightJoin, obj);\n    } else if (Array.isArray(rightSet)) { // primitive value (or array)\n      rightJoin.push(rightSet[key]);\n    } else {\n      const obj = {};\n      obj[key] = rightSet[key];\n      rightJoin = Object.assign(rightJoin, obj);\n    }\n  }\n  return rightJoin;\n};\n\nexport default doRightJoinNoIntersection;\n","import { Shops } from \"/lib/collections\";\nimport { Logger } from \"/server/api\";\n\n/**\n * @method getRegistryDomain\n * @memberof Core\n * @summary local helper for creating admin users\n * @param {String} requestUrl - url\n * @return {String} domain name stripped from requestUrl\n */\nexport function getRegistryDomain(requestUrl) {\n  const url = requestUrl || process.env.ROOT_URL;\n  const domain = url.match(/^https?:\\/\\/([^/:?#]+)(?:[/:?#]|$)/i)[1];\n  return domain;\n}\n\n\n/**\n * @method setDomain\n * @memberof Core\n * @summary update the default shop url if ROOT_URL supplied is different from current\n * @return {String} returns insert result\n */\nexport function setDomain() {\n  let currentDomain;\n  // we automatically update the shop domain when ROOT_URL changes\n  try {\n    [currentDomain] = Shops.findOne().domains;\n  } catch (_error) {\n    Logger.error(_error, \"Failed to determine default shop.\");\n  }\n  // if the server domain changes, update shop\n  const domain = getRegistryDomain();\n  if (currentDomain && currentDomain !== domain) {\n    Logger.debug(`Updating domain to ${domain}`);\n    Shops.update({\n      domains: currentDomain\n    }, {\n      $set: {\n        \"domains.$\": domain\n      }\n    });\n  }\n}\n","import { Shops } from \"/lib/collections\";\nimport { Logger } from \"/server/api\";\n\n/**\n *  @method setShopName\n *  @memberof Core\n *  @example Reaction.setShopName(shop)\n *  @param {Object} shop - Shops document with `_id` property\n *  @summary when new shop is created, set shop name if REACTION_SHOP_NAME env var exists\n *  @returns {undefined} undefined\n */\nexport function setShopName(shop) {\n  const name = process.env.REACTION_SHOP_NAME;\n  if (!name) return;\n\n  // if this shop name has already been used, don't use it again\n  const existingShopWithName = Shops.findOne({ name });\n  if (existingShopWithName) {\n    Logger.info(`Default shop name ${name} already used`);\n    return;\n  }\n\n  // update the shop name with the REACTION_SHOP_NAME env var\n  const { _id } = shop;\n  try {\n    Shops.update({ _id }, { $set: { name } });\n  } catch (err) {\n    Logger.error(\"Failed to update shop name\", err);\n  }\n}\n","import React from \"react\";\nimport ReactDOMServer from \"react-dom/server\";\nimport Handlebars from \"handlebars\";\nimport Immutable from \"immutable\";\nimport { Assets, Templates } from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\n\nlet registeredTemplates = Immutable.OrderedMap();\nlet templateCache = Immutable.Map();\nlet templateParsers = Immutable.Map();\n\nexport const TEMPLATE_PARSER_REACT = \"react\";\nexport const TEMPLATE_PARSER_HANDLEBARS = \"handlebars\";\n\n/**\n * @name registerTemplate\n * @method\n * @memberof Core\n * @param  {String}  templateInfo              [description]\n * @param  {String}  shopId                    [description]\n * @param  {Boolean} [insertImmediately=false] [description]\n * @return {Object}                            Returns `templateLiteral` and `templateReference`\n */\nexport function registerTemplate(templateInfo, shopId, insertImmediately = false) {\n  const literal = registerTemplateForMemoryCache(templateInfo, shopId);\n  const reference = registerTemplateForDatabase(templateInfo, shopId, insertImmediately);\n\n  return {\n    templateLiteral: literal,\n    templateReference: reference\n  };\n}\n\n/**\n * @name registerTemplateForMemoryCache\n * @method\n * @memberof Core\n * @summary Process template info and cache in memory.\n * This allows us to have function and class references for the templates for\n * React and other custom parsers\n * @param  {Object} templateInfo Template info with parser info\n * @param  {String} shopId       Shop ID\n * @return {Object}              Template from cache\n */\nexport function registerTemplateForMemoryCache(templateInfo, shopId) {\n  const templateInfoForMemoryCache = processTemplateInfoForMemoryCache(templateInfo);\n  let shopTemplates = registeredTemplates.get(shopId);\n\n  if (!shopTemplates) {\n    shopTemplates = {};\n  }\n\n  shopTemplates[templateInfo.name] = templateInfoForMemoryCache;\n  registeredTemplates = registeredTemplates.set(shopId, shopTemplates);\n\n  return templateInfoForMemoryCache;\n}\n\n/**\n * @name registerTemplateForDatabase\n * @method\n * @memberof Core\n * @summary Process template info for use in a database\n * Namely, any literals like functions are stripped as they cannot be safely,\n * and should not stored in the database\n * @param  {Object} templateInfo Template info with parser info\n * @return {Object}              Return template data crafted for entry into a database\n */\nexport function registerTemplateForDatabase(templateInfo) {\n  const templateInfoForDatabase = processTemplateInfoForDatabase(templateInfo);\n\n  // Import template into the Assets collecton.\n  Assets.update({\n    type: \"template\",\n    name: templateInfoForDatabase.name\n  }, {\n    $set: {\n      content: JSON.stringify(templateInfoForDatabase)\n    }\n  }, {\n    upsert: true\n  });\n\n  return templateInfoForDatabase;\n}\n\n/**\n * @name getTemplateByName\n * @method\n * @memberof Core\n * @param  {String} templateName Template name\n * @param  {String} shopId       Shop ID\n * @return {Object}              Template object\n */\nexport function getTemplateByName(templateName, shopId) {\n  const registeredTemplate = registeredTemplates.get(shopId)[templateName];\n\n  if (registeredTemplate) {\n    return registeredTemplate;\n  }\n\n  const templateInfo = Templates.findOne({\n    name: templateName,\n    $or: [\n      // Attempt to find user editable / edited template first\n      {\n        isOriginalTemplate: false\n      },\n      // Fallback to the original templates\n      {\n        isOriginalTemplate: true\n      }\n    ],\n    shopId\n  });\n\n  return registerTemplateForMemoryCache(templateInfo);\n}\n\n/**\n * @name processTemplateInfoForMemoryCache\n * @method\n * @memberof Core\n * @summary Sets parser to Handlebars for string-based templates and\n * React for functions, objects\n * @param  {Object} templateInfo\n * @param  {String} templateInfo.template Accepted values: `string`, `function`, `object`\n * @return {Boolean|null}              True on success or null\n */\nexport function processTemplateInfoForMemoryCache(templateInfo) {\n  // Avoid mutating the original passed in param\n  const info = Immutable.Map(templateInfo);\n\n  if (typeof templateInfo.template === \"string\") {\n    return info.set(\"parser\", TEMPLATE_PARSER_HANDLEBARS).toObject();\n  } else if (typeof templateInfo.template === \"function\") {\n    return info.set(\"parser\", TEMPLATE_PARSER_REACT).toObject();\n  } else if (typeof templateInfo.template === \"object\") {\n    return info.set(\"parser\", TEMPLATE_PARSER_REACT).toObject();\n  }\n\n  return null;\n}\n\n/**\n * @name processTemplateInfoForDatabase\n * @method\n * @memberof Core\n * @summary Return `templateData` with `name`, `title`, `type`, `subject`, `templateFor`\n * @param  {Object} templateInfo Object with `templateInfo`\n * @param  {String} templateInfo.template template\n * @param  {String} templateInfo.parser `React` or `Handlebars`\n * @return {Object} templateData\n * @return {String} templateData.name\n * @return {String} templateData.title\n * @return {String} templateData.type\n * @return {String} templateData.subject\n * @return {String} templateData.templateFor\n */\nexport function processTemplateInfoForDatabase(templateInfo) {\n  const templateData = {\n    name: templateInfo.name,\n    title: templateInfo.title,\n    type: templateInfo.type,\n    subject: templateInfo.subject,\n    templateFor: templateInfo.templateFor\n  };\n\n\n  if (typeof templateInfo.template === \"string\") {\n    templateData.template = templateInfo.template;\n    templateData.parser = TEMPLATE_PARSER_HANDLEBARS;\n  } else if (typeof templateInfo.template === \"object\") {\n    templateData.template = templateInfo.template;\n    templateData.parser = TEMPLATE_PARSER_REACT;\n  } else if (typeof templateInfo.template === \"function\") {\n    templateData.parser = TEMPLATE_PARSER_REACT;\n  }\n\n  return templateData;\n}\n\n/**\n * @name registerTemplateParser\n * @method\n * @memberof Core\n * @param  {String} name Name of a parser, like React or Handlebars\n * @param  {Function} renderFunction Function\n * @return {null}\n */\nexport function registerTemplateParser(name, renderFunction) {\n  templateParsers = templateParsers.set(name, renderFunction);\n}\n\n/**\n * @name renderTemplate\n * @method\n * @memberof Core\n * @param  {Object} templateInfo React or Handlebars\n * @param  {Object} [data={}]    Template data\n * @return {Object|false}        Returns React, Handlebars template or false\n */\nexport function renderTemplate(templateInfo, data = {}) {\n  if (templateInfo.parser === TEMPLATE_PARSER_REACT) {\n    return null;\n  } else if (templateInfo.parser === TEMPLATE_PARSER_HANDLEBARS) {\n    return renderHandlebarsTemplate(templateInfo, data);\n  }\n\n  if (typeof templateParsers.get(name) === \"function\") {\n    return templateParsers.get(name)(templateInfo, data);\n  }\n\n  return false;\n}\n\n/**\n * @name compileHandlebarsTemplate\n * @method\n * @memberof Core\n * @summary Compile and cache Handlebars template\n * @param {String} name Name of template to register amd save to cache\n * @param {String} template markup\n * @return {Function} Compiled handlebars template.\n */\nexport function compileHandlebarsTemplate(name, template) {\n  const compiledTemplate = Handlebars.compile(template);\n  templateCache = templateCache.set(name, compiledTemplate);\n  return compiledTemplate;\n}\n\n/**\n * @name renderHandlebarsTemplate\n * @method\n * @memberof Core\n * @summary Render Handlebars template\n * @param  {String} templateInfo Template info\n * @param  {Object} data         Data\n * @return {Object}              Handlebars template\n */\nexport function renderHandlebarsTemplate(templateInfo, data) {\n  if (templateCache[templateInfo.name] === undefined) {\n    compileHandlebarsTemplate(templateInfo.name, templateInfo.template);\n  }\n\n  const compiledTemplate = templateCache.get(templateInfo.name);\n  return compiledTemplate(data);\n}\n\n/**\n * @name renderTemplateToStaticMarkup\n * @method\n * @memberof Core\n * @param  {Object} template React template name\n * @param  {Object} props    React props\n * @return {Object}          Static markup\n */\nexport function renderTemplateToStaticMarkup(template, props) {\n  return ReactDOMServer.renderToStaticMarkup(React.createElement(template, props));\n}\n\n/**\n * @name resetRegisteredTemplates\n * @method\n * @memberof Core\n * @summary Reset regestered templates. This is mostly useful for aiding in unit testing\n * @return {Immutable.OrderedMap} immultable.js OrderedMap\n */\nexport function resetRegisteredTemplates() {\n  registeredTemplates = Immutable.OrderedMap();\n}\n\n/**\n * @name initTemplates\n * @method\n * @memberof Core\n * @summary Hook to setup core Templates imports during Reaction init\n * @return {null}\n */\nexport function initTemplates() {\n  Hooks.Events.add(\"afterCoreInit\", () => {\n    Assets.find({ type: \"template\" }).forEach((t) => {\n      Logger.debug(`Importing ${t.name} template`);\n      if (t.content) {\n        Reaction.Importer.template(JSON.parse(t.content));\n      } else {\n        Logger.debug(`No template content found for ${t.name} asset`);\n      }\n    });\n    Reaction.Importer.flush();\n  });\n}\n\nexport default {\n  get registeredTemplates() {\n    return registeredTemplates;\n  },\n  get templateCache() {\n    return templateCache;\n  },\n  get templateParsers() {\n    return templateParsers;\n  },\n  registerTemplate,\n  getTemplateByName,\n  processTemplateInfoForDatabase,\n  processTemplateInfoForMemoryCache,\n  compileHandlebarsTemplate,\n  renderHandlebarsTemplate,\n  renderTemplateToStaticMarkup\n};\n","import { latinLangs, getShopLang } from \"/lib/api/helpers\";\n\n// dynamic import of slugiy/transliteration.slugify\nlet slugify;\nasync function lazyLoadSlugify() {\n  let mod;\n  // getting the shops base language\n  const lang = getShopLang();\n  // if slugify has been loaded but the language has changed\n  // to be a non latin based language then load transliteration\n  if (slugify && slugify.name === \"replace\" && latinLangs.indexOf(lang) === -1) {\n    mod = await import(\"transliteration\");\n  } else if (slugify) {\n    // if slugify/transliteration is loaded and no lang change\n    return;\n  } else if (latinLangs.indexOf(lang) >= 0) {\n    // if the shops language use latin based chars load slugify else load transliterations's slugify\n    mod = await import(\"slugify\");\n  } else {\n    mod = await import(\"transliteration\");\n  }\n  // slugify is exported to modules.default while transliteration is exported to modules.slugify\n  slugify = mod.default || mod.slugify;\n}\n\n/**\n * @name getSlug\n * @summary Return a slugified string using \"slugify\" from transliteration\n * @see https://www.npmjs.com/package/transliteration\n * @method\n * @memberof Helpers\n * @locus Server\n * @param  {String} slugString - string to slugify\n * @return {String} slugified string\n */\nexport function getSlug(slugString) {\n  let slug;\n  Promise.await(lazyLoadSlugify());\n  if (slugString && slugify) {\n    slug = slugify(slugString.toLowerCase());\n  } else {\n    slug = \"\";\n  }\n  return slug;\n}\n","import _ from \"lodash\";\nimport { HTTP } from \"meteor/http\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Packages } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\n\n/**\n * meteor-geocoder\n * modifed for reaction core.\n *\n * https://github.com/aldeed/meteor-geocoder\n * The MIT License (MIT)\n * Copyright (c) 2014 Eric Dobbertin\n */\n\n//\n// init geocoder\nfunction GeoCoder(options) {\n  let extra;\n  const self = this;\n  // fetch shop settings for api auth credentials\n  const shopSettings = Packages.findOne({\n    shopId: Reaction.getShopId(),\n    name: \"core\"\n  }, {\n    fields: {\n      settings: 1\n    }\n  });\n\n  if (shopSettings) {\n    if (shopSettings.settings.google) {\n      extra = {\n        clientId: shopSettings.settings.google.clientId,\n        apiKey: shopSettings.settings.google.apiKey\n      };\n    }\n  }\n\n  self.options = _.extend({\n    geocoderProvider: \"google\",\n    httpAdapter: \"https\",\n    extra\n  }, options || {});\n}\n\nfunction gc(address, options, callback) {\n  const g = require(\"node-geocoder\")(\n    options.geocoderProvider, options.httpAdapter,\n    options.extra\n  );\n  g.geocode(address, callback);\n}\n\nGeoCoder.prototype.geocode = function geoCoderGeocode(address, callback) {\n  let geoCallback = callback;\n  let geoAddress = address;\n  if (geoCallback) {\n    geoCallback = Meteor.bindEnvironment(geoCallback, (error) => {\n      if (error) throw error;\n    });\n    gc(geoAddress, this.options, geoCallback);\n  } else {\n    geoAddress = Meteor.wrapAsync(gc)(geoAddress, this.options);\n    return geoAddress[0];\n  }\n};\n\nfunction rv(lat, lng, options, callback) {\n  const g = require(\"node-geocoder\")(\n    options.geocoderProvider, options.httpAdapter,\n    options.extra\n  );\n  g.reverse({\n    lat,\n    lon: lng\n  }, callback);\n}\n\nGeoCoder.prototype.reverse = function geoCoderReverse(lat, lng, callback) {\n  let geoCallback = callback;\n  if (geoCallback) {\n    geoCallback = Meteor.bindEnvironment(geoCallback, (error) => {\n      if (error) throw error;\n    });\n    rv(lat, lng, this.options, geoCallback);\n  } else {\n    try {\n      const address = Meteor.wrapAsync(rv)(lat, lng, this.options);\n      return address[0];\n    } catch (_error) {\n      return {\n        latitude: null,\n        longitude: null,\n        country: \"United States\",\n        city: null,\n        state: null,\n        stateCode: null,\n        zipcode: null,\n        streetName: null,\n        streetNumber: null,\n        countryCode: \"US\"\n      };\n    }\n  }\n};\n\nfunction gi(address, callback) {\n  let lookupAddress = address;\n  // short term solution to an haproxy ssl cert installation issue\n  process.env.NODE_TLS_REJECT_UNAUTHORIZED = 0;\n  // if we're local, let's let freegeoip guess.\n  if (lookupAddress === \"127.0.0.1\" || lookupAddress === null) {\n    lookupAddress = \"\";\n  }\n  // calls a private reaction hosted version of freegeoip\n  HTTP.call(\"GET\", `https://geo.getreaction.io/json/${lookupAddress}`, callback);\n}\n\nGeoCoder.prototype.geoip = function geoCoderGeocode(address, callback) {\n  let geoCallback = callback;\n  let geoAddress = address;\n  if (geoCallback) {\n    geoCallback = Meteor.bindEnvironment(geoCallback, (error) => {\n      if (error) throw error;\n    });\n    gi(geoAddress, this.options, geoCallback);\n  } else {\n    try {\n      geoAddress = Meteor.wrapAsync(gi)(geoAddress);\n      return geoAddress.data;\n    } catch (error) {\n      Logger.warn(\"shop/getLocale geoip lookup failure\", error);\n      return {};\n    }\n  }\n};\n\nexport default GeoCoder;\n","import Logger from \"@reactioncommerce/logger\";\nimport Hooks from \"@reactioncommerce/hooks\";\nimport Reaction from \"./core\";\nimport * as Accounts from \"./core/accounts\";\nimport Router from \"./router\";\nimport GeoCoder from \"./geocoder\";\nimport { MethodHooks } from \"./method-hooks\";\n\nexport {\n  Reaction,\n  Accounts,\n  Router,\n  GeoCoder,\n  Hooks,\n  Logger,\n  MethodHooks\n};\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\n\n/**\n * @file **Method Hooks for Meteor** - Use a hook to run something before or after a method on the server\n * Reused Meteor method hooks from [hitchcott/meteor-method-hooks](https://github.com/hitchcott/meteor-method-hooks) and [Workpop/meteor-method-hooks](https://github.com/Workpop/meteor-method-hooks)\n * Read more on how to use [Method Hooks](https://docs.reactioncommerce.com/reaction-docs/master/method-hooks).\n * @example MethodHooks.after('orders/orderCompleted', callback)\n * @namespace MethodHooks\n */\nexport const MethodHooks = {};\n\n/**\n * @method afterHooks\n * @summary A collection of after hooks\n * @type {Object}\n * @summary <String, [Hook]> A mapping from method names to arrays of hooks\n * @private\n */\nMethodHooks._afterHooks = {};\n\n/**\n * @summary A collection of before hooks\n * @type {Object}\n * @summary <String, [Hook]> A mapping from method names to arrays of hooks\n * @private\n */\nMethodHooks._beforeHooks = {};\n\n/**\n * @method handlers\n * @summary The method handler definitions appropriate to the environment\n */\nMethodHooks._handlers = Meteor.isClient ? Meteor.connection._methodHandlers :\n  Meteor.server.method_handlers;\n\n/**\n * @method _originalMethodHandlers\n * @summary The original method handlers\n * @type {Object}\n * @returns <String, Function> Method handler mapping\n * @private\n */\nMethodHooks._originalMethodHandlers = {};\n\n/**\n * @method Wrappers\n * @type {Object}\n * @summary <String, Function> A mapping from method names to method functions\n * @private\n */\nMethodHooks._wrappers = {};\n\n/**\n * @method initializeHook\n * @summary Initializes a new hook\n * @param {String} mapping - map hook: a is  place to store the mapping\n * @param {String} methodName - The name of the method\n * @param {Function} hookFunction - The hook function\n * @private\n * @return {String} - returns transformed data\n */\nMethodHooks._initializeHook = function (mapping, methodName, hookFunction) {\n  mapping[methodName] = mapping[methodName] || [];\n  mapping[methodName].push(hookFunction);\n\n  // Initialize a wrapper for the given method name. Idempotent, it will not erase existing handlers.\n  const method = MethodHooks._handlers[methodName];\n  // If no method is found, or a wrapper already exists, return\n  if (!method || MethodHooks._wrappers[methodName]) {\n    return;\n  }\n\n  // Get a reference to the original handler\n  MethodHooks._originalMethodHandlers[methodName] = method;\n\n  MethodHooks._wrappers[methodName] = function (...inputArgs) {\n    // Get arguments you can mutate\n    const args = _.toArray(inputArgs);\n    let beforeResult;\n    // Call the before hooks\n\n    const beforeHooks = MethodHooks._beforeHooks[methodName];\n    _.each(beforeHooks, (beforeHook, hooksProcessed) => {\n      beforeResult = beforeHook.call(this, {\n        result: undefined,\n        error: undefined,\n        arguments: args,\n        hooksProcessed\n      });\n\n      if (beforeResult === false) {\n        return false;\n      }\n    });\n\n    if (beforeResult === false) {\n      return false;\n    }\n    let methodResult;\n    let methodError;\n\n    // Call the main method body\n    // check(args, Match.Any);\n    try {\n      methodResult = MethodHooks._originalMethodHandlers[methodName].apply(this, args);\n    } catch (error) {\n      methodError = error;\n    }\n\n    // Call after hooks, providing the result and the original arguments\n    const afterHooks = MethodHooks._afterHooks[methodName];\n    _.each(afterHooks, (afterHook, hooksProcessed) => {\n      const hookResult = afterHook.call(this, {\n        result: methodResult,\n        error: methodError,\n        arguments: args,\n        hooksProcessed\n      });\n      // If the after hook did not return a value and the methodResult is not undefined, warn and fix\n      if (_.isUndefined(hookResult) && !_.isUndefined(methodResult)) {\n        Meteor._debug(\"Expected the after hook to return a value.\");\n      } else {\n        methodResult = hookResult;\n      }\n    });\n\n    // If an error was thrown, throw it after the after hooks. Ought to include the correct stack information\n    if (methodError) {\n      throw methodError;\n    }\n\n    // Return the method result, possibly modified by the after hook\n    return methodResult;\n  };\n\n  // Assign to a new handler\n  MethodHooks._handlers[methodName] = MethodHooks._wrappers[\n    methodName];\n};\n\n/**\n * @method before\n * @memberof MethodHooks\n * @summary Add a function to call before the specified method\n * @param {String} methodName - methodName\n * @param {String} beforeFunction - beforeFunction\n * @return {String} - returns transformed data, Ignored for before hooks\n */\nMethodHooks.before = function (methodName, beforeFunction) {\n  MethodHooks._initializeHook(\n    MethodHooks._beforeHooks,\n    methodName, beforeFunction\n  );\n};\n\n/**\n * @method after\n * @memberof MethodHooks\n * @summary Add a function to call after the specified method\n * After hooks can change the result values. Use `hooksProcessed` to keep track of how many modifications have been made. You can mutate the return value in after hooks.\n * @param {String} methodName - methodName\n * @param {String} afterFunction - afterFunction\n * @return {String} - returns transformed data, Passed as the methodResult to subsequent method hooks.\n */\nMethodHooks.after = function (methodName, afterFunction) {\n  MethodHooks._initializeHook(\n    MethodHooks._afterHooks,\n    methodName, afterFunction\n  );\n};\n\n/**\n * @method beforeMethods\n * @memberof MethodHooks\n * @summary Call the provided hook in values for the key'd method names\n * @param {Object} dict - <string, Hook> dict\n * @return {String} - returns transformed data, Ignored for before hooks\n */\nMethodHooks.beforeMethods = function (dict) {\n  _.each(dict, (v, k) => {\n    MethodHooks.before(k, v);\n  });\n};\n\n/**\n * @method afterMethods\n * @memberof MethodHooks\n * @summary Call the provided hook in values for the key'd method names\n * @param {Object} dict - <string, Hook> dict\n * @return {String} - returns transformed data, Passed as the methodResult to subsequent method hooks.\n */\nMethodHooks.afterMethods = function (dict) {\n  _.each(dict, (v, k) => {\n    MethodHooks.after(k, v);\n  });\n};\n","// server can defer loading\nconst Router = {};\nexport default Router;\n","import { Meteor } from \"meteor/meteor\";\nimport { Cart } from \"/lib/collections\";\nimport { Logger, MethodHooks } from \"/server/api\";\n// this needed to keep correct loading order. Methods should be loaded before hooks\nimport \"../cart\";\n\n// // Meteor.after to call after\nMethodHooks.after(\"cart/submitPayment\", (options) => {\n  // TODO: REVIEW WITH AARON - this is too late to fail. We need to copy cart to order either way at this point\n  // if cart/submit had an error we won't copy cart to Order\n  // and we'll throw an error.\n  Logger.debug(\"MethodHooks after cart/submitPayment\", options);\n  // Default return value is the return value of previous call in method chain\n  // or an empty object if there's no result yet.\n  const result = options.result || {};\n  if (typeof options.error === \"undefined\") {\n    const cart = Cart.findOne({\n      userId: Meteor.userId()\n    });\n\n    // update workflow\n    Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"paymentSubmitted\");\n\n    // create order\n    if (cart) {\n      if (!cart.billing) {\n        Logger.debug(\"MethodHooks after cart/submitPayment. No billing address after payment! userId:\", Meteor.userId(), \"options:\", options);\n      }\n\n      if (cart.items && cart.billing && cart.billing[0].paymentMethod) {\n        const orderId = Meteor.call(\"cart/copyCartToOrder\", cart._id);\n        // Return orderId as result from this after hook call.\n        // This is done by extending the existing result.\n        result.orderId = orderId;\n      } else {\n        throw new Meteor.Error(\n          \"server-error\",\n          \"An error occurred verifing payment method. Failed to save order.\"\n        );\n      }\n    }\n  } else {\n    throw new Meteor.Error(\"Error after submitting payment\", options.error);\n  }\n  return result;\n});\n","import { Logger, MethodHooks } from \"/server/api\";\n// this needed to keep correct loading order. Methods should be loaded before hooks\nimport \"../shop\";\n\nMethodHooks.after(\"shop/createTag\", (options) => {\n  if (options.error) {\n    Logger.warn(\"Failed to add new tag:\", options.error.reason);\n    return options.error;\n  }\n  if (typeof options.result === \"string\") {\n    Logger.debug(`Created tag with _id: ${options.result}`);\n  }\n\n  return options.result;\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\n\nMeteor.methods({\n  /**\n   * @name coreOrderWorkflow/coreOrderProcessing\n   * @method\n   * @memberof Methods/Workflow\n   * @summary Checks permissions for a given user to allow them to move an order into the processing phase.\n   * @description Step 4 of the \"workflow/pushOrderWorkflow\" flow - called from Orders.before.update hook.\n   * @param  {Object} options An object containing arbitary data\n   * @return {Boolean} true to allow action, false to cancel execution of hook\n   * @see packages/reaction-schema/common/hooks/orders.js\n   * @see packages/reaction-core/common/methods/workflow.js\n   */\n  \"workflow/coreOrderWorkflow/coreOrderProcessing\"(options) {\n    check(options, Match.OrderHookOptions());\n    const { userId } = options;\n\n    return Reaction.hasPermission([\"dashboard/orders\"], userId);\n  },\n\n  /**\n   * @name coreOrderWorkflow/coreOrderCompleted\n   * @method\n   * @memberof Methods/Workflow\n   * @summary Performs various checks to determine if an order may be moved into the completed phase.\n   * @description Step 4 of the \"workflow/pushOrderWorkflow\" flow - called from Orders.before.update hook.\n   * @param  {Object} options An object containing arbitary data\n   * @return {Boolean} true to allow action, false to cancel execution of hook\n   * @see packages/reaction-schema/common/hooks/orders.js\n   * @see packages/reaction-core/common/methods/workflow.js\n   */\n  \"workflow/coreOrderWorkflow/coreOrderCompleted\"(options) {\n    check(options, Match.OrderHookOptions());\n\n    const { order } = options;\n\n    const result = _.every(order.items, (item) => _.includes(item.workflow.workflow, \"coreOrderItemWorkflow/completed\"));\n\n    return result;\n  }\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Random } from \"meteor/random\";\nimport * as Collections from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\n\n/**\n * @method quantityProcessing\n * @private\n * @summary Perform calculations admissibility of adding product to cart\n * @param {Object} product - product to add to Cart\n * @param {Object} variant - product variant\n * @param {Number} itemQty - qty to add to cart, defaults to 1, deducts\n *  from inventory\n * @since 1.10.1\n * @return {Number} quantity - revised quantity to be added to cart\n */\nfunction quantityProcessing(product, variant, itemQty = 1) {\n  let quantity = itemQty;\n  const MIN = variant.minOrderQuantity || 1;\n  const MAX = variant.inventoryQuantity || Infinity;\n\n  if (variant.inventoryPolicy && MIN > MAX) {\n    Logger.debug(`productId: ${product._id}, variantId ${variant._id\n    }: inventoryQuantity lower then minimum order`);\n    throw new Meteor.Error(\"invalid-parameter\", `productId: ${product._id}, variantId ${variant._id\n    }: inventoryQuantity lower then minimum order`);\n  }\n\n  // TODO: think about #152 implementation here\n  switch (product.type) {\n    case \"not-in-stock\":\n      break;\n    default: // type: `simple` // todo: maybe it should be \"variant\"\n      if (quantity < MIN) {\n        quantity = MIN;\n      } else if (variant.inventoryPolicy && quantity > MAX) {\n        quantity = MAX;\n      }\n  }\n\n  return quantity;\n}\n\n/**\n * @method getSessionCarts\n * @private\n * @summary Get Cart cursor with all session carts\n * @param {String} userId - current user _id\n * @param {String} sessionId - current user session id\n * @param {String} shopId - shop id\n * @since 0.10.2\n * @return {Mongo.Cursor} with array of session carts\n */\nfunction getSessionCarts(userId, sessionId, shopId) {\n  const carts = Collections.Cart.find({\n    $and: [{\n      userId: {\n        $ne: userId\n      }\n    }, {\n      sessionId: {\n        $eq: sessionId\n      }\n    }, {\n      shopId: {\n        $eq: shopId\n      }\n    }]\n  });\n\n  // we can't use Array.map here, because we need to reduce the number of array\n  // elements if element belongs to registered user, we should throw it.\n  const allowedCarts = [];\n\n  // only anonymous user carts allowed\n  carts.forEach((cart) => {\n    if (Roles.userIsInRole(cart.userId, \"anonymous\", shopId)) {\n      allowedCarts.push(cart);\n    }\n  });\n\n  return allowedCarts;\n}\n\n/**\n * @method removeShippingAddresses\n * @private\n * @summary Remove shipping address from cart\n * @param {String} cart - current cart\n * @return null\n */\nfunction removeShippingAddresses(cart) {\n  const cartShipping = cart.shipping;\n  cartShipping.map((sRecord) => delete sRecord.address);\n  Collections.Cart.update({\n    _id: cart._id\n  }, {\n    $set: { shipping: cartShipping }\n  });\n\n  // Calculate discounts\n  Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n\n  // Calculate taxes\n  Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cart._id);\n}\n\n/**\n * @file Methods for Cart - Use these methods by running `Meteor.call()`\n * @example Meteor.call(\"cart/createCart\", this.userId, sessionId)\n * @namespace Methods/Cart\n */\n\nMeteor.methods({\n  /**\n   * @method cart/mergeCart\n   * @summary Merge matching sessionId cart into specified userId cart\n   * There should be one cart for each independent, non-logged-in user session.\n   * When a user logs in that cart now belongs to that user and we use the a single user cart.\n   * If they are logged in on more than one devices, regardless of session,the user cart will be used\n   * If they had more than one cart, on more than one device,logged in at separate times then merge the carts\n   * @memberof Methods/Cart\n   * @param {String} cartId - cartId of the cart to merge matching session carts into.\n   * @param {String} [currentSessionId] - current client session id\n   * @todo I think this method should be moved out from methods to a Function Declaration to keep it more secure\n   * @return {Object|Boolean} cartId - cartId on success or false\n   */\n  \"cart/mergeCart\"(cartId, currentSessionId) {\n    check(cartId, String);\n    // TODO: Review this. currentSessionId sometimes come in as false. e.g from Accounts.onLogin\n    check(currentSessionId, Match.Optional(String));\n\n    // we don't process current cart, but merge into it.\n    const currentCart = Collections.Cart.findOne(cartId);\n    if (!currentCart) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    // just used to filter out the current cart\n    // we do additional check of cart exists here and if it not exist, next\n    // check supposed to throw 403 error\n    const userId = currentCart && currentCart.userId;\n    // user should have an access to operate with only one - his - cart\n    if (this.userId !== null && userId !== this.userId) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    // persistent sessions, see: publications/sessions.js\n    // this is the last place where we still need `Reaction.sessionId`.\n    // The use case is: on user log in. I don't know how pass `sessionId` down\n    // at that moment.\n    const sessionId = currentSessionId || Reaction.sessionId;\n    const shopId = Reaction.getShopId();\n\n    // no need to merge anonymous carts\n    if (Roles.userIsInRole(userId, \"anonymous\", shopId)) {\n      return false;\n    }\n    Logger.debug(\"merge cart: matching sessionId\");\n    Logger.debug(\"current userId:\", userId);\n    Logger.debug(\"sessionId:\", sessionId);\n    // get session carts without current user cart cursor\n    const sessionCarts = getSessionCarts(userId, sessionId, shopId);\n\n    Logger.debug(`merge cart: begin merge processing of session ${\n      sessionId} into: ${currentCart._id}`);\n    // loop through session carts and merge into user cart\n    sessionCarts.forEach((sessionCart) => {\n      Logger.debug(`merge cart: merge user userId: ${userId}, sessionCart.userId: ${\n        sessionCart.userId}, sessionCart id: ${sessionCart._id}`);\n      // really if we have no items, there's nothing to merge\n      if (sessionCart.items) {\n        // if currentCart already have a cartWorkflow, we don't need to clean it\n        // up completely, just to `coreCheckoutShipping` stage. Also, we will\n        // need to recalculate shipping rates\n        if (typeof currentCart.workflow === \"object\" &&\n        typeof currentCart.workflow.workflow === \"object\") {\n          if (currentCart.workflow.workflow.length > 2) {\n            Meteor.call(\"workflow/revertCartWorkflow\", \"coreCheckoutShipping\");\n            // refresh shipping quotes\n            Meteor.call(\"shipping/updateShipmentQuotes\", cartId);\n          }\n        } else {\n          // if user logged in he doesn't need to show `checkoutLogin` step\n          Meteor.call(\"workflow/revertCartWorkflow\", \"checkoutAddressBook\");\n        }\n\n        const cartSum = sessionCart.items.concat(currentCart.items);\n        const mergedItems = cartSum.reduce((newItems, item) => {\n          if (item) {\n            const existingItem = newItems.find((cartItem) => cartItem.variants._id === item.variants._id);\n            if (existingItem) {\n              existingItem.quantity += item.quantity;\n            } else {\n              newItems.push(item);\n            }\n          }\n          return newItems;\n        }, []);\n        Collections.Cart.update(currentCart._id, {\n          $push: {\n            items: { $each: mergedItems, $slice: -(mergedItems.length) }\n          }\n        });\n\n        // Calculate discounts\n        Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", currentCart._id);\n      }\n\n      // cleanup session Carts after merge.\n      if (sessionCart.userId !== this.userId) {\n        // clear the cart that was used for a session\n        // and we're also going to do some garbage Collection\n        Collections.Cart.remove(sessionCart._id);\n        // cleanup user/accounts\n        Collections.Accounts.remove({\n          userId: sessionCart.userId\n        });\n        Hooks.Events.run(\"afterAccountsRemove\", this.userId, sessionCart.userId);\n        Meteor.users.remove(sessionCart.userId);\n        Logger.debug(`merge cart: delete cart ${\n          sessionCart._id} and user: ${sessionCart.userId}`);\n      }\n      Logger.debug(`merge cart: processed merge for cartId ${sessionCart._id}`);\n    });\n\n    // `checkoutLogin` should be used for anonymous only. Registered users\n    // no need see this.\n    if (currentCart.workflow && currentCart.workflow.status === \"new\") {\n      // to call `workflow/pushCartWorkflow` two times is the only way to move\n      // from status \"new\" to \"checkoutAddressBook\" which I found without\n      // refactoring of `workflow/pushCartWorkflow`\n      // We send `cartId` as arguments because this method could be called from\n      // publication method and in half cases it could be so, that\n      // Meteor.userId() will be null.\n      Meteor.call(\n        \"workflow/pushCartWorkflow\", \"coreCartWorkflow\",\n        \"checkoutLogin\", cartId\n      );\n      Meteor.call(\n        \"workflow/pushCartWorkflow\", \"coreCartWorkflow\",\n        \"checkoutAddressBook\", cartId\n      );\n    }\n\n    return currentCart._id;\n  },\n\n  /**\n   * @method cart/createCart\n   * @summary create new cart for user,\n   * but all checks for current cart's existence should go before this method will be called, to keep it clean\n   * @memberof Methods/Cart\n   * @param {String} userId - userId to create cart for\n   * @param {String} sessionId - current client session id\n   * @todo I think this method should be moved out from methods to a Function Declaration to keep it more secure\n   * @returns {String} cartId - users cartId\n   */\n  \"cart/createCart\"(userId, sessionId) {\n    check(userId, String);\n    check(sessionId, String);\n\n    const marketplaceSettings = Reaction.getMarketplaceSettings();\n    let shopId;\n    if (marketplaceSettings && marketplaceSettings.public && marketplaceSettings.public.merchantCart) {\n      shopId = Reaction.getShopId();\n    } else {\n      shopId = Reaction.getPrimaryShopId();\n    }\n\n    // check if user has `anonymous` role.( this is a visitor)\n    const anonymousUser = Roles.userIsInRole(userId, \"anonymous\", shopId);\n    const sessionCartCount = getSessionCarts(userId, sessionId, shopId).length;\n\n    Logger.debug(\"create cart: shopId\", shopId);\n    Logger.debug(\"create cart: userId\", userId);\n    Logger.debug(\"create cart: sessionId\", sessionId);\n    Logger.debug(\"create cart: sessionCarts.count\", sessionCartCount);\n    Logger.debug(\"create cart: anonymousUser\", anonymousUser);\n\n    // we need to create a user cart for the new authenticated user or\n    // anonymous.\n    const currentCartId = Collections.Cart.insert({\n      sessionId,\n      userId\n    });\n    Logger.debug(`create cart: into new user cart. created: ${currentCartId} for user ${userId}`);\n\n    // merge session carts into the current cart\n    if (sessionCartCount > 0 && !anonymousUser) {\n      Logger.debug(`create cart: found existing cart. merge into ${currentCartId} for user ${userId}`);\n      Meteor.call(\"cart/mergeCart\", currentCartId, sessionId);\n    }\n\n    // we should check for an default billing/shipping address in user account.\n    // this needed after submitting order, when user receives new cart\n    const account = Collections.Accounts.findOne(userId);\n    if (account && account.profile && account.profile.addressBook) {\n      account.profile.addressBook.forEach((address) => {\n        if (address.isBillingDefault) {\n          Meteor.call(\"cart/setPaymentAddress\", currentCartId, address);\n        }\n        if (address.isShippingDefault) {\n          Meteor.call(\"cart/setShipmentAddress\", currentCartId, address);\n        }\n      });\n    }\n\n    // attach current user currency to cart\n    const currentUser = Meteor.user();\n    let userCurrency = Reaction.getShopCurrency();\n\n    // Check to see if the user has a custom currency saved to their profile\n    // Use it if they do\n    if (currentUser && currentUser.profile && currentUser.profile.currency) {\n      userCurrency = currentUser.profile.currency;\n    }\n    Meteor.call(\"cart/setUserCurrency\", currentCartId, userCurrency);\n\n    return currentCartId;\n  },\n\n  /**\n   *  @method cart/addToCart\n   *  @summary Add items to a user cart. When we add an item to the cart,\n   *  we want to break all relationships with the existing item.\n   *  We want to fix price, qty, etc into history.\n   *  However, we could check reactively for price /qty etc, adjustments on the original and notify them.\n   *  @memberof Methods/Cart\n   *  @param {String} productId - productId to add to Cart\n   *  @param {String} variantId - product variant _id\n   *  @param {Number} [itemQty] - qty to add to cart\n   *  @param {Object} [additionalOptions] - object containing additional options and fields for cart item\n   *  @return {Number|Object} Mongo insert response\n   */\n  \"cart/addToCart\"(productId, variantId, itemQty, additionalOptions) {\n    check(productId, String);\n    check(variantId, String);\n    check(itemQty, Match.Optional(Number));\n    check(additionalOptions, Match.Optional(Object));\n\n    // Copy additionalOptions into an options object to use througout the method\n    const options = {\n      overwriteExistingMetafields: false, // Allows updating of metafields on quantity change\n      metafields: undefined, // Array of MetaFields to set on the CartItem\n      ...additionalOptions || {}\n    };\n\n    const cart = Collections.Cart.findOne({ userId: this.userId });\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\n        \"invalid-parameter\",\n        \"Cart not found for user with such id\"\n      );\n    }\n    // With the flattened model we no longer need to work directly with the\n    // products. But product still could be necessary for a `quantityProcessing`\n    // TODO: need to understand: do we really need product inside\n    // `quantityProcessing`?\n    let product;\n    let variant;\n    Collections.Products.find({\n      _id: {\n        $in: [\n          productId,\n          variantId\n        ]\n      }\n    }).forEach((doc) => {\n      if (doc.type === \"simple\") {\n        product = doc;\n      } else {\n        variant = doc;\n      }\n    });\n\n    // TODO: this lines still needed. We could uncomment them in future if\n    // decide to not completely remove product data from this method\n    // const product = Collections.Products.findOne(productId);\n    // const variant = Collections.Products.findOne(variantId);\n    if (!product) {\n      Logger.warn(`Product: ${productId} was not found in database`);\n      throw new Meteor.Error(\n        \"not-found\",\n        \"Product with such id was not found\"\n      );\n    }\n    if (!variant) {\n      Logger.warn(`Product variant: ${variantId} was not found in database`);\n      throw new Meteor.Error(\n        \"not-found\",\n        \"ProductVariant with such id was not found\"\n      );\n    }\n    // performs calculations admissibility of adding product to cart\n    const quantity = quantityProcessing(product, variant, itemQty);\n    // performs search of variant inside cart\n    const cartVariantExists = cart.items && cart.items\n      .some((item) => item.variants._id === variantId);\n\n    if (cartVariantExists) {\n      let modifier = {};\n\n      // Allows for updating metafields on an existing item when the quantity also changes\n      if (options.overwriteExistingMetafields) {\n        modifier = {\n          $set: {\n            \"items.$.metafields\": options.metafields\n          }\n        };\n      }\n\n      let updateResult;\n\n      try {\n        updateResult = Collections.Cart.update({\n          \"_id\": cart._id,\n          \"items.product._id\": productId,\n          \"items.variants._id\": variantId\n        }, {\n          $inc: {\n            \"items.$.quantity\": quantity\n          },\n          ...modifier\n        });\n      } catch (error) {\n        Logger.error(\"Error adding to cart.\", error);\n        Logger.error(\n          \"Error adding to cart. Invalid keys:\",\n          Collections.Cart.simpleSchema().namedContext().validationErrors()\n        );\n        throw error;\n      }\n\n      // Update inventory\n      Hooks.Events.run(\"afterModifyQuantityInCart\", cart._id, { productId, variantId });\n      // Calculate discounts\n      Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n      // refresh shipping quotes\n      Meteor.call(\"shipping/updateShipmentQuotes\", cart._id);\n      // revert workflow to checkout shipping step.\n      Meteor.call(\"workflow/revertCartWorkflow\", \"coreCheckoutShipping\");\n      // reset selected shipment method\n      Meteor.call(\"cart/resetShipmentMethod\", cart._id);\n      // Calculate taxes\n      Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cart._id);\n\n      Logger.debug(`cart: increment variant ${variantId} quantity by ${quantity}`);\n\n      return updateResult;\n    }\n\n    // TODO: Handle more than 2 levels of variant hierarchy for determining parcel dimensions\n    // we need to get the parent of the option to check if parcel info is stored there\n    const immediateAncestors = variant.ancestors.filter((ancestor) => ancestor !== product._id);\n    const immediateAncestor = Collections.Products.findOne({ _id: immediateAncestors[0] });\n    let parcel = null;\n    if (immediateAncestor) {\n      if (immediateAncestor.weight || immediateAncestor.height || immediateAncestor.width || immediateAncestor.length) {\n        parcel = { weight: immediateAncestor.weight, height: immediateAncestor.height, width: immediateAncestor.width, length: immediateAncestor.length };\n      }\n    }\n    // if it's set at the option level then that overrides\n    if (variant.weight || variant.height || variant.width || variant.length) {\n      parcel = { weight: variant.weight, height: variant.height, width: variant.width, length: variant.length };\n    }\n    // cart variant doesn't exist\n    let updateResult;\n    const newItemId = Random.id();\n\n    try {\n      updateResult = Collections.Cart.update({\n        _id: cart._id\n      }, {\n        $addToSet: {\n          items: {\n            _id: newItemId,\n            shopId: product.shopId,\n            productId,\n            quantity,\n            product,\n            variants: variant,\n            metafields: options.metafields,\n            title: product.title,\n            type: product.type,\n            parcel\n          }\n        }\n      });\n    } catch (error) {\n      Logger.error(\"Error adding to cart.\", error);\n      Logger.error(\n        \"Error adding to cart. Invalid keys:\",\n        Collections.Cart.simpleSchema().namedContext().validationErrors()\n      );\n      throw error;\n    }\n\n    // Update add inventory reserve\n    Hooks.Events.run(\"afterAddItemsToCart\", cart._id, { newItemId });\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n    // refresh shipping quotes\n    Meteor.call(\"shipping/updateShipmentQuotes\", cart._id);\n    // revert workflow to checkout shipping step.\n    Meteor.call(\"workflow/revertCartWorkflow\", \"coreCheckoutShipping\");\n    // reset selected shipment method\n    Meteor.call(\"cart/resetShipmentMethod\", cart._id);\n    // Calculate taxes\n    Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cart._id);\n\n    Logger.debug(`cart: add variant ${variantId} to cartId ${cart._id}`);\n\n    return updateResult;\n  },\n\n  /**\n   * @method cart/removeFromCart\n   * @memberof Methods/Cart\n   * @summary Removes or adjust quantity of a variant from the cart\n   * @param {String} itemId - cart item _id\n   * @param {Number} [quantity] - if provided will adjust increment by quantity\n   * @returns {Number} returns Mongo update result\n   */\n  \"cart/removeFromCart\"(itemId, quantity) {\n    check(itemId, String);\n    check(quantity, Match.Optional(Number));\n\n    const userId = Meteor.userId();\n    const cart = Collections.Cart.findOne({ userId });\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\"not-found\", \"Cart not found for user with such id\");\n    }\n\n    let cartItem;\n\n    if (cart.items) {\n      cartItem = _.find(cart.items, (item) => item._id === itemId);\n    }\n\n    // extra check of item exists\n    if (typeof cartItem !== \"object\") {\n      Logger.error(`Unable to find an item: ${itemId} within the cart: ${cart._id}`);\n      throw new Meteor.Error(\"not-found\", \"Unable to find an item with such id in cart.\");\n    }\n\n    if (!quantity || quantity >= cartItem.quantity) {\n      let cartResult;\n      try {\n        cartResult = Collections.Cart.update({\n          _id: cart._id\n        }, {\n          $pull: {\n            items: {\n              _id: itemId\n            }\n          }\n        }, {\n          getAutoValues: false // See https://github.com/aldeed/meteor-collection2/issues/245\n        });\n      } catch (error) {\n        Logger.error(\"Error removing from cart.\", error);\n        Logger.error(\n          \"Error removing from cart. Invalid keys:\",\n          Collections.Cart.simpleSchema().namedContext().validationErrors()\n        );\n        throw error;\n      }\n\n      Logger.debug(`cart: deleted cart item variant id ${cartItem.variants._id}`);\n\n      // Clear inventory reservation\n      Meteor.call(\"inventory/clearReserve\", [cartItem]);\n      // Calculate discounts\n      Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n      // TODO: HACK: When calling update shipping the changes to the cart have not taken place yet\n      // TODO: But calling this findOne seems to force this record to update. Extra weird since we aren't\n      // TODO: passing the Cart but just the cartId and regrabbing it so you would think that would work but it does not\n      Collections.Cart.findOne(cart._id);\n      // refresh shipping quotes\n      Meteor.call(\"shipping/updateShipmentQuotes\", cart._id);\n      // revert workflow\n      Meteor.call(\"workflow/revertCartWorkflow\", \"coreCheckoutShipping\");\n      // reset selected shipment method\n      Meteor.call(\"cart/resetShipmentMethod\", cart._id);\n      // Calculate taxes\n      Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cart._id);\n      return cartResult;\n    }\n\n    // if quantity lets convert to negative and increment\n    const removeQuantity = Math.abs(quantity) * -1;\n\n    let cartResult;\n    try {\n      cartResult = Collections.Cart.update({\n        \"_id\": cart._id,\n        \"items._id\": cartItem._id\n      }, {\n        $inc: {\n          \"items.$.quantity\": removeQuantity\n        }\n      });\n    } catch (error) {\n      Logger.error(\"Error removing from cart.\", error);\n      Logger.error(\n        \"Error removing from cart. Invalid keys:\",\n        Collections.Cart.simpleSchema().namedContext().validationErrors()\n      );\n      throw error;\n    }\n\n    // Clear inventory status for multiple instances of this item\n    // If quantity is provided, then set cartItem to it, so that quantity\n    // provided will be cleared in the inventory.\n    cartItem.quantity = quantity;\n    Meteor.call(\"inventory/clearReserve\", [cartItem]);\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n    Logger.debug(`cart: removed variant ${cartItem._id} quantity of ${quantity}`);\n    // refresh shipping quotes\n    Meteor.call(\"shipping/updateShipmentQuotes\", cart._id);\n    // revert workflow\n    Meteor.call(\"workflow/revertCartWorkflow\", \"coreCheckoutShipping\");\n    // reset selected shipment method\n    Meteor.call(\"cart/resetShipmentMethod\", cart._id);\n    // Calculate taxes\n    Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cart._id);\n\n    return cartResult;\n  },\n\n  /**\n   * @method cart/setShipmentMethod\n   * @memberof Methods/Cart\n   * @summary Saves method as order default\n   * @param {String} cartId - cartId to apply shipmentMethod\n   * @param {Object} method - shipmentMethod object\n   * @return {Number} return Mongo update result\n   */\n  \"cart/setShipmentMethod\"(cartId, method) {\n    check(cartId, String);\n    Reaction.Schemas.ShippingMethod.validate(method);\n\n    // get current cart\n    const cart = Collections.Cart.findOne({\n      _id: cartId,\n      userId: Meteor.userId()\n    });\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\n        \"not-found\",\n        \"Cart not found for user with such id\"\n      );\n    }\n\n    // Sets all shipping methods to the one selected\n    // TODO: Accept an object of shopId to method map to ship via different methods per shop\n    let update;\n    // if we have an existing item update it, otherwise add to set.\n    if (cart.shipping) {\n      const shipping = cart.shipping.map((shipRecord) => ({\n        ...shipRecord,\n        shipmentMethod: method\n      }));\n      update = { $set: { shipping } };\n    } else {\n      update = {\n        $addToSet: {\n          shipping: {\n            shipmentMethod: method,\n            shopId: cart.shopId\n          }\n        }\n      };\n    }\n\n    // update or insert method\n    try {\n      Collections.Cart.update({ _id: cartId }, update);\n    } catch (e) {\n      Logger.error(e, `Error adding rates to cart ${cartId}`);\n      throw new Meteor.Error(\"server-error\", \"An error occurred saving the order\", e);\n    }\n\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n\n    // this will transition to review\n    return Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"coreCheckoutShipping\");\n  },\n\n  /**\n   * @method cart/setUserCurrency\n   * @memberof Methods/Cart\n   * @summary Saves user currency in cart, to be paired with order/setCurrencyExhange\n   * @param {String} cartId - cartId to apply setUserCurrency\n   * @param {String} userCurrency - userCurrency to set to cart\n   * @return {Number} update result\n   */\n  \"cart/setUserCurrency\"(cartId, userCurrency) {\n    check(cartId, String);\n    check(userCurrency, String);\n    const cart = Collections.Cart.findOne({ _id: cartId });\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\"not-found\", \"Cart not found for user with such id\");\n    }\n\n    const userCurrencyString = {\n      userCurrency\n    };\n\n    let selector;\n    let update;\n\n    if (cart.billing) {\n      selector = {\n        \"_id\": cartId,\n        \"billing._id\": cart.billing[0]._id\n      };\n      update = {\n        $set: {\n          \"billing.$.currency\": userCurrencyString\n        }\n      };\n    } else {\n      selector = {\n        _id: cartId\n      };\n      update = {\n        $addToSet: {\n          billing: {\n            currency: userCurrencyString\n          }\n        }\n      };\n    }\n\n    // add / or set the shipping address\n    try {\n      Collections.Cart.update(selector, update);\n    } catch (e) {\n      Logger.error(e);\n      throw new Meteor.Error(\"server-error\", \"An error occurred adding the currency\");\n    }\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n\n    return true;\n  },\n\n  /**\n   * @method cart/resetShipmentMethod\n   * @memberof Methods/Cart\n   * @summary Removes `shipmentMethod` object from cart\n   * @param {String} cartId - cart _id\n   * @return {Number} update result\n   */\n  \"cart/resetShipmentMethod\"(cartId) {\n    check(cartId, String);\n\n    const cart = Collections.Cart.findOne({\n      _id: cartId,\n      userId: this.userId\n    });\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\n        \"not-found\",\n        `Cart: ${cartId} not found for user: ${this.userId}`\n      );\n    }\n\n    return Collections.Cart.update({ _id: cartId }, {\n      $unset: { \"shipping.0.shipmentMethod\": \"\" }\n    });\n  },\n\n  /**\n   * @method cart/setShipmentAddress\n   * @memberof Methods/Cart\n   * @summary Adds address book to cart shipping\n   * @param {String} cartId - cartId to apply shipmentMethod\n   * @param {Object} address - addressBook object\n   * @return {Number} update result\n   */\n  \"cart/setShipmentAddress\"(cartId, address) {\n    check(cartId, String);\n    Reaction.Schemas.Address.validate(address);\n\n    const cart = Collections.Cart.findOne({\n      _id: cartId,\n      userId: this.userId\n    });\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\n        \"not-found\",\n        \"Cart not found for user with such id\"\n      );\n    }\n    // TODO: When we have a front end for doing more than one address\n    // TODO: we need to not use the same address for every record\n    // TODO: this is a temporary workaround so that we have a valid address\n    // TODO: for every shipping record\n    let selector;\n    let update;\n    let updated = false; // if we update inline set to true, otherwise fault to update at the end\n    // We have two behaviors depending on if we have existing shipping records and if we\n    // have items in the cart.\n    if (cart.shipping && cart.shipping.length > 0 && cart.items) {\n      // if we have shipping records and cart.items, update each one by shop\n      const shopIds = Object.keys(cart.getItemsByShop());\n      shopIds.forEach((shopId) => {\n        selector = {\n          \"_id\": cartId,\n          \"shipping.shopId\": shopId\n        };\n\n        update = {\n          $set: {\n            \"shipping.$.address\": address\n          }\n        };\n        try {\n          Collections.Cart.update(selector, update);\n          updated = true;\n        } catch (error) {\n          Logger.error(error, \"An error occurred adding the address\");\n          throw new Meteor.Error(error, \"An error occurred adding the address\");\n        }\n      });\n    } else if (!cart.items) { // if no items in cart just add or modify one record for the carts shop\n      // add a shipping record if it doesn't exist\n      if (!cart.shipping) {\n        selector = {\n          _id: cartId\n        };\n        update = {\n          $push: {\n            shipping: {\n              address,\n              shopId: cart.shopId\n            }\n          }\n        };\n\n        try {\n          Collections.Cart.update(selector, update);\n          updated = true;\n        } catch (error) {\n          Logger.error(error);\n          throw new Meteor.Error(\"server-error\", \"An error occurred adding the address\");\n        }\n      } else {\n        // modify an existing record if we have one already\n        selector = {\n          \"_id\": cartId,\n          \"shipping.shopId\": cart.shopId\n        };\n\n        update = {\n          $set: {\n            \"shipping.$.address\": address\n          }\n        };\n      }\n    } else {\n      // if we have items in the cart but we didn't have existing shipping records\n      // add a record for each shop that's represented in the items\n      const shopIds = Object.keys(cart.getItemsByShop());\n      shopIds.forEach((shopId) => {\n        selector = {\n          _id: cartId\n        };\n        update = {\n          $addToSet: {\n            shipping: {\n              address,\n              shopId\n            }\n          }\n        };\n      });\n    }\n    if (!updated) {\n      // if we didn't do one of the inline updates, then run the update here\n      try {\n        Collections.Cart.update(selector, update);\n      } catch (error) {\n        Logger.error(error);\n        throw new Meteor.Error(\"server-error\", \"An error occurred adding the address\");\n      }\n    }\n    // refresh shipping quotes\n    Meteor.call(\"shipping/updateShipmentQuotes\", cartId);\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n\n    // Calculate taxes\n    Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cartId);\n\n    if (typeof cart.workflow !== \"object\") {\n      throw new Meteor.Error(\n        \"server-error\",\n        \"Cart workflow object not detected.\"\n      );\n    }\n\n    // ~~it's ok for this to be called multiple times~~\n    // call it only once when we at the `checkoutAddressBook` step\n    if (typeof cart.workflow.workflow === \"object\" &&\n      cart.workflow.workflow.length < 2) {\n      Meteor.call(\n        \"workflow/pushCartWorkflow\", \"coreCartWorkflow\",\n        \"coreCheckoutShipping\"\n      );\n    }\n\n    // if we change default address during further steps, we need to revert\n    // workflow back to `coreCheckoutShipping` step\n    if (typeof cart.workflow.workflow === \"object\" &&\n      cart.workflow.workflow.length > 2) { // \"2\" index of\n      // `coreCheckoutShipping`\n      Meteor.call(\"workflow/revertCartWorkflow\", \"coreCheckoutShipping\");\n    }\n\n    return true;\n  },\n\n  /**\n   * @method cart/setPaymentAddress\n   * @memberof Methods/Cart\n   * @summary Adds addressbook to cart payments\n   * @param {String} cartId - cartId to apply payment address\n   * @param {Object} address - addressBook object\n   * @todo maybe we need to rename this method to `cart/setBillingAddress`?\n   * @return {Number} return Mongo update result\n   */\n  \"cart/setPaymentAddress\"(cartId, address) {\n    check(cartId, String);\n    Reaction.Schemas.Address.validate(address);\n\n    const cart = Collections.Cart.findOne({\n      _id: cartId,\n      userId: this.userId\n    });\n\n    if (!cart) {\n      Logger.error(`Cart not found for user: ${this.userId}`);\n      throw new Meteor.Error(\n        \"not-found\",\n        \"Cart not found for user with such id\"\n      );\n    }\n\n    let selector;\n    let update;\n    // temp hack until we build out multiple billing handlers\n    // if we have an existing item update it, otherwise add to set.\n    if (Array.isArray(cart.billing) && cart.billing.length > 0) {\n      selector = {\n        \"_id\": cartId,\n        \"billing._id\": cart.billing[0]._id\n      };\n      update = {\n        $set: {\n          \"billing.$.address\": address\n        }\n      };\n    } else {\n      selector = {\n        _id: cartId\n      };\n      update = {\n        $addToSet: {\n          billing: {\n            address\n          }\n        }\n      };\n    }\n\n    const result = Collections.Cart.update(selector, update);\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n\n    // Calculate taxes\n    Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cartId);\n\n    return result;\n  },\n\n  /**\n   * @method cart/unsetAddresses\n   * @summary Removes address from cart.\n   * @memberof Methods/Cart\n   * @param {String} addressId - address._id\n   * @param {String} userId - cart owner _id\n   * @param {String} [type] - billing default or shipping default\n   * @since 0.10.1\n   * @todo Check if no more address in cart as shipping, we should reset `cartWorkflow` to second step\n   * @return {Number|Object|Boolean} The number of removed documents or\n   * error object or `false` if we don't need to update cart\n   */\n  \"cart/unsetAddresses\"(addressId, userId, type) {\n    check(addressId, String);\n    check(userId, String);\n    check(type, Match.Optional(String));\n\n    // do we actually need to change anything?\n    let needToUpdate = false;\n    // we need to revert the workflow after a \"shipping\" address was removed\n    let isShippingDeleting = false;\n    const cart = Collections.Cart.findOne({\n      userId\n    });\n    const selector = {\n      _id: cart._id\n    };\n    const update = { $unset: {} };\n    // user could turn off the checkbox in address to not to be default, then we\n    // receive `type` arg\n    if (typeof type === \"string\") {\n      // we assume that the billing/shipping arrays can hold only one element [0]\n      if (cart[type] && typeof cart[type][0].address === \"object\" &&\n        cart[type][0].address._id === addressId) {\n        update.$unset[`${type}.0.address`] = \"\";\n        needToUpdate = true;\n        isShippingDeleting = type === \"shipping\";\n      }\n    } else { // or if we remove address itself, when we run this part we assume\n      // that the billing/shipping arrays can hold only one element [0]\n      if (cart.billing && typeof cart.billing[0].address === \"object\" &&\n        cart.billing[0].address._id === addressId) {\n        update.$unset[\"billing.0.address\"] = \"\";\n        needToUpdate = true;\n      }\n      if (cart.shipping && typeof cart.shipping[0].address === \"object\" && cart.shipping[0].address._id === addressId) {\n        removeShippingAddresses(cart);\n        isShippingDeleting = true;\n      }\n    }\n\n    if (needToUpdate) {\n      try {\n        Collections.Cart.update(selector, update);\n      } catch (e) {\n        Logger.error(e);\n        throw new Meteor.Error(\"server-error\", \"Error updating cart\");\n      }\n\n      // Calculate discounts\n      Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cart._id);\n\n      if (isShippingDeleting) {\n        // if we remove shipping address from cart, we need to revert\n        // `cartWorkflow` to the `checkoutAddressBook` step.\n        Meteor.call(\"workflow/revertCartWorkflow\", \"checkoutAddressBook\");\n      }\n    }\n    return true;\n  },\n\n  /**\n   * @method cart/submitPayment\n   * @memberof Methods/Cart\n   * @summary Saves a submitted payment to cart, triggers workflow and adds \"paymentSubmitted\" to cart workflow\n   * Note: this method also has a client stub, that forwards to cartCompleted\n   * @param {Object|Array} paymentMethods - an array of paymentMethods or (deprecated) a single paymentMethod object\n   * @return {String} returns update result\n   */\n  \"cart/submitPayment\"(paymentMethods) {\n    PaymentMethodArgument.validate(paymentMethods);\n\n    const cart = Collections.Cart.findOne({\n      userId: Meteor.userId()\n    });\n\n    const cartId = cart._id;\n\n    const cartShipping = cart.getShippingTotal();\n    const cartShippingByShop = cart.getShippingTotalByShop();\n    const cartSubTotal = cart.getSubTotal();\n    const cartSubtotalByShop = cart.getSubtotalByShop();\n    const cartTaxes = cart.getTaxTotal();\n    const cartTaxesByShop = cart.getTaxesByShop();\n    const cartDiscounts = cart.getDiscounts();\n    const cartTotal = cart.getTotal();\n    const cartTotalByShop = cart.getTotalByShop();\n\n    // we won't actually close the order at this stage.\n    // we'll just update the workflow and billing data where\n    // method-hooks can process the workflow update.\n\n    // Find the payment address associated that the user input during the\n    // checkout process\n    let paymentAddress;\n    if (Array.isArray(cart.billing) && cart.billing[0]) {\n      paymentAddress = cart.billing[0].address;\n    }\n\n    const payments = [];\n\n    // Payment plugins which have been updated for marketplace are passing an array as paymentMethods\n    if (Array.isArray(paymentMethods)) {\n      paymentMethods.forEach((paymentMethod) => {\n        const { shopId } = paymentMethod;\n        const invoice = {\n          shipping: parseFloat(cartShippingByShop[shopId]),\n          subtotal: parseFloat(cartSubtotalByShop[shopId]),\n          taxes: parseFloat(cartTaxesByShop[shopId]),\n          discounts: parseFloat(cartDiscounts),\n          total: parseFloat(cartTotalByShop[shopId])\n        };\n\n        payments.push({\n          paymentMethod,\n          invoice,\n          address: paymentAddress,\n          shopId\n        });\n      });\n    } else {\n      // Legacy payment integration - transactions are not split by shop\n      // Create an invoice based on cart totals.\n      const invoice = {\n        shipping: cartShipping,\n        subtotal: cartSubTotal,\n        taxes: cartTaxes,\n        discounts: cartDiscounts,\n        total: cartTotal\n      };\n\n      // Legacy payment plugins are passing in a single paymentMethod object\n      payments.push({\n        paymentMethod: paymentMethods,\n        invoice,\n        address: paymentAddress,\n        shopId: Reaction.getPrimaryShopId()\n      });\n    }\n\n    // e.g. discount records would be already present on the billing array. Add to the end of the array.\n    const discountRecords = cart.billing.filter((billingInfo) => billingInfo.paymentMethod);\n    payments.push(...discountRecords);\n\n    const selector = {\n      _id: cartId\n    };\n\n    const update = {\n      $set: {\n        billing: payments\n      }\n    };\n\n    try {\n      Collections.Cart.update(selector, update);\n    } catch (e) {\n      Logger.error(e);\n      throw new Meteor.Error(\"server-error\", \"An error occurred saving the order\");\n    }\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n\n    // Calculate taxes\n    Hooks.Events.run(\"afterCartUpdateCalculateTaxes\", cartId);\n\n    return Collections.Cart.findOne(selector);\n  },\n\n  /**\n   * @method cart/setAnonymousUserEmail\n   * @memberof Methods/Cart\n   * @summary Assigns email to anonymous user's cart instance\n   * @param {Object} userId - current user's Id\n   * @param {String} email - email to set for anonymous user's cart instance\n   * @return {Number} returns update result\n   */\n  \"cart/setAnonymousUserEmail\"(userId, email) {\n    check(userId, String);\n    check(email, String);\n\n    const currentUserCart = Collections.Cart.findOne({ userId });\n    const cartId = currentUserCart._id;\n    let newEmail = \"\";\n\n    if (!currentUserCart.email) {\n      newEmail = email;\n    }\n\n    return Collections.Cart.update({ _id: cartId }, { $set: { email: newEmail } });\n  }\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport * as Collections from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\n\n\n/**\n * @name cart/copyCartToOrder\n * @method\n * @memberof Methods/Cart\n * @summary Transform Cart to Order when a payment is processed.\n * We want to copy the cart over to an order object, and give the user a new empty\n * cart. Reusing the cart schema makes sense, but integrity of the order,\n * we don't want to just make another cart item\n * @todo  Partial order processing, shopId processing\n * @todo  Review Security on this method\n * @param {String} cartId - cartId to transform to order\n * @return {String} returns orderId\n */\nexport function copyCartToOrder(cartId) {\n  check(cartId, String);\n  const cart = Collections.Cart.findOne(cartId);\n\n  // security check - method can only be called on own cart\n  if (cart.userId !== Meteor.userId()) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  // Init new order object from existing cart\n  const order = Object.assign({}, cart);\n\n  // get sessionId from cart while cart is fresh\n  const { sessionId } = cart;\n\n  // If there are no order items, throw an error. We won't create an empty order\n  if (!order.items || order.items.length === 0) {\n    const msg = \"An error occurred saving the order. Missing cart items.\";\n    Logger.error(msg);\n    throw new Meteor.Error(\"error-occurred\", msg);\n  }\n\n  // Debug only message to identify the current cartId\n  Logger.debug(\"cart/copyCartToOrder\", cartId);\n\n  // Set our new order's cartId to existing cart._id\n  // We'll get a new _id for our order\n  order.cartId = cart._id;\n\n  // This block assigns an existing user's email associated with their account to this order\n  // We copied order from cart, so this userId and email are coming from the existing cart\n  if (order.userId && !order.email) {\n    // If we have a userId, but do _not_ have an email associated with this order\n    // we need to go find the account associated with this userId\n    const account = Collections.Accounts.findOne(order.userId);\n\n    // Check to make sure that the account exists and has an emails field\n    if (typeof account === \"object\" && account.emails) {\n      for (const email of account.emails) {\n        // If a user has specified an alternate \"order\" email address, use that\n        if (email.provides === \"orders\") {\n          order.email = email.address;\n          // Otherwise, check to see if the user has a \"default\" email address\n        } else if (email.provides === \"default\") {\n          order.email = email.address;\n        }\n        // If we can't find any relevant email addresses for the user, we'll\n        // let them assign an email address to this order after the checkout\n      }\n    }\n  }\n\n  // The schema will provide default values for these fields in our new order\n  // so we'll delete the values copied from the cart\n  delete order.createdAt; // autovalues from cart\n  delete order.updatedAt;\n  delete order.getCount;\n  delete order.getShippingTotal;\n  delete order.getSubTotal;\n  delete order.getTaxTotal;\n  delete order.getDiscounts;\n  delete order.getTotal;\n  delete order._id;\n\n\n  // Create a shipping record for each shop on the order\n  if (Array.isArray(order.shipping)) {\n    if (order.shipping.length > 0) {\n      const shippingRecords = [];\n      order.shipping.map((shippingRecord) => {\n        const billingRecord = order.billing.find((billing) => billing.shopId === shippingRecord.shopId);\n        shippingRecord.paymentId = billingRecord._id;\n        shippingRecord.items = [];\n        shippingRecord.items.packed = false;\n        shippingRecord.items.shipped = false;\n        shippingRecord.items.delivered = false;\n        shippingRecord.workflow = { status: \"new\", workflow: [\"coreOrderWorkflow/notStarted\"] };\n        shippingRecords.push(shippingRecord);\n        return shippingRecords;\n      });\n      order.shipping = shippingRecords;\n    }\n  } else { // if not - create it\n    order.shipping = [];\n  }\n\n  // Add current exchange rate into order.billing.currency\n  // If user currency === shop currency, exchange rate = 1.0\n  const currentUser = Meteor.user();\n  let userCurrency = Reaction.getShopCurrency();\n  let exchangeRate = \"1.00\";\n\n  if (currentUser && currentUser.profile && currentUser.profile.currency) {\n    userCurrency = Meteor.user().profile.currency;\n  }\n\n  if (userCurrency !== Reaction.getShopCurrency()) {\n    const userExchangeRate = Meteor.call(\"shop/getCurrencyRates\", userCurrency);\n\n    if (typeof userExchangeRate === \"number\") {\n      exchangeRate = userExchangeRate;\n    } else {\n      Logger.warn(\"Failed to get currency exchange rates. Setting exchange rate to null.\");\n      exchangeRate = null;\n    }\n  }\n\n  if (!order.billing[0].currency) {\n    order.billing[0].currency = {\n      // userCurrency is shopCurrency unless user has selected a different currency than the shop\n      userCurrency\n    };\n  }\n\n  order.items = order.items.map((item) => {\n    item.shippingMethod = order.shipping[order.shipping.length - 1];\n    item.workflow = {\n      status: \"new\",\n      workflow: [\"coreOrderWorkflow/created\"]\n    };\n\n    return item;\n  });\n\n  // Assign items to each shipping record based on the shopId of the item\n  _.each(order.items, (item) => {\n    const shippingRecord = order.shipping.find((sRecord) => sRecord.shopId === item.shopId);\n    const shipmentItem = {\n      _id: item._id,\n      productId: item.productId,\n      quantity: item.quantity,\n      shopId: item.shopId,\n      variantId: item.variants._id\n    };\n    // If the shipment exists\n    if (shippingRecord.items) {\n      shippingRecord.items.push(shipmentItem);\n    } else {\n      shippingRecord.items = [shipmentItem];\n    }\n  });\n\n  order.billing[0].currency.exchangeRate = exchangeRate;\n  order.workflow.status = \"new\";\n  order.workflow.workflow = [\"coreOrderWorkflow/created\"];\n\n  // insert new reaction order\n  const orderId = Collections.Orders.insert(order);\n  Hooks.Events.run(\"afterOrderInsert\", order);\n\n  if (orderId) {\n    Collections.Cart.remove({\n      _id: order.cartId\n    });\n    // create a new cart for the user\n    // even though this should be caught by\n    // subscription handler, it's not always working\n    const newCartExists = Collections.Cart.find({ userId: order.userId });\n    if (newCartExists.count() === 0) {\n      Meteor.call(\"cart/createCart\", this.userId, sessionId);\n\n      // reset the checkout workflow to the beginning for an anonymous user.\n      // Using `Roles.userIsInRole` here because currently `Reaction.hasPermission(\"anonymous\")`\n      // will not return the correct result for actual anonymous users\n      if (Roles.userIsInRole(currentUser, \"anonymous\", Reaction.getShopId())) {\n        Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"checkoutLogin\");\n      } else {\n        // after recreate new cart we need to make it looks like previous by\n        // updating `cart/workflow/status` to \"coreCheckoutShipping\"\n        // by calling `workflow/pushCartWorkflow` three times. This is the only\n        // way to do that without refactoring of `workflow/pushCartWorkflow`\n        Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"checkoutLogin\");\n        Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"checkoutAddressBook\");\n        Meteor.call(\"workflow/pushCartWorkflow\", \"coreCartWorkflow\", \"coreCheckoutShipping\");\n      }\n    }\n\n    Logger.info(`Transitioned cart ${cartId} to order ${orderId}`);\n    // catch send notification, we don't want\n    // to block because of notification errors\n\n    if (order.email) {\n      Meteor.call(\"orders/sendNotification\", Collections.Orders.findOne(orderId), (err) => {\n        if (err) {\n          Logger.error(err, `Error in orders/sendNotification for order ${orderId}`);\n        }\n      });\n    }\n\n    // order success\n    return orderId;\n  }\n  // we should not have made it here, throw error\n  throw new Meteor.Error(\"bad-request\", \"cart/copyCartToOrder: Invalid request\");\n}\n\nMeteor.methods({\n  \"cart/copyCartToOrder\": copyCartToOrder\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport _ from \"lodash\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Reaction, Logger, Hooks } from \"/server/api\";\nimport { Accounts, Groups } from \"/lib/collections\";\nimport { getSlug } from \"/lib/api\";\n\n/**\n * @file Methods for creating and managing admin user permission groups.\n * Run these methods using `Meteor.call()`.\n * @example Meteor.call(\"group/createGroup\", sampleCustomerGroup, shop._id)\n * @namespace Methods/Group\n*/\nMeteor.methods({\n  /**\n   * @name group/createGroup\n   * @method\n   * @memberof Methods/Group\n   * @summary Creates a new permission group for a shop\n   * It creates permission group for a given shop with passed in roles\n   * @param {Object} groupData - info about group to create\n   * @param {String} groupData.name - name of the group to be created\n   * @param {String} groupData.description - Optional description of the group to be created\n   * @param {Array} groupData.permissions - permissions to assign to the group being created\n   * @param {String} shopId - id of the shop the group belongs to\n   * @return {Object} - `object.status` of 200 on success or Error object on failure\n   */\n  \"group/createGroup\"(groupData, shopId) {\n    check(groupData, Object);\n    check(groupData.name, String);\n    check(groupData.description, Match.Optional(String));\n    check(groupData.permissions, Match.Optional([String]));\n    check(shopId, String);\n    let _id;\n\n    // we are limiting group method actions to only users with admin roles\n    // this also include shop owners, since they have the `admin` role in their Roles.GLOBAL_GROUP\n    if (!Reaction.hasPermission(\"admin\", Meteor.userId(), shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const defaultCustomerGroupForShop = Groups.findOne({ slug: \"customer\", shopId }) || {};\n    const defaultAdminPermissions = (defaultCustomerGroupForShop.permissions || []).concat(\"dashboard\");\n    const newGroupData = Object.assign({}, groupData, {\n      slug: getSlug(groupData.name), shopId\n    });\n\n    if (!newGroupData.permissions) {\n      newGroupData.permissions = [];\n    }\n\n    newGroupData.permissions = _.uniq([...newGroupData.permissions, ...defaultAdminPermissions]);\n\n    // ensure one group type per shop\n    const groupExists = Groups.findOne({ slug: newGroupData.slug, shopId });\n    if (groupExists) {\n      throw new Meteor.Error(\"conflict\", \"Group already exist for this shop\");\n    }\n    try {\n      _id = Groups.insert(newGroupData);\n    } catch (error) {\n      Logger.error(error);\n      throw new Meteor.Error(\"invalid-parameter\", \"Bad request\");\n    }\n\n    return { status: 200, group: Groups.findOne({ _id }) };\n  },\n\n  /**\n   * @name group/updateGroup\n   * @method\n   * @memberof Methods/Group\n   * @summary Updates a permission group for a shop.\n   * Change the details of a group (name, desc, permissions etc) to the values passed in.\n   * It also goes into affected user data to modify both the groupName (using Accounts schema)\n   * and group permissions (using \"accounts/removeUserPermissions\")\n   * @param {Object} groupId - group to be updated\n   * @param {Object} newGroupData - updated group info (similar to current group data)\n   * slug remains untouched; used as key in querying\n   * @param {String} shopId - id of the shop the group belongs to\n   * @return {Object} - `object.status` of 200 on success or Error object on failure\n   */\n  \"group/updateGroup\"(groupId, newGroupData, shopId) {\n    check(groupId, String);\n    check(newGroupData, Object);\n    check(shopId, String);\n\n    // we are limiting group method actions to only users with admin roles\n    // this also include shop owners, since they have the `admin` role in their Roles.GLOBAL_GROUP\n    if (!Reaction.hasPermission(\"admin\", Meteor.userId(), shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // 1. Update the group data\n    const update = newGroupData;\n    delete update.slug; // slug remains constant because it's used as key in querying. So we remove it if it was passed\n\n    const group = Groups.findOne({ _id: groupId }) || {};\n\n    // prevent edits on owner. Owner groups is the default containing all roles, and as such should be untouched\n    if (group.slug === \"owner\") {\n      throw new Meteor.Error(\"invalid-parameter\", \"Bad request\");\n    }\n\n    Groups.update({ _id: groupId, shopId }, { $set: update });\n\n    // 2. Check & Modify users in the group that changed\n    const users = Accounts.find({ groups: { $in: [groupId] } }).fetch();\n    let error;\n\n    if (newGroupData.permissions && newGroupData.permissions.length) {\n      error = setUserPermissions(users, newGroupData.permissions, shopId);\n    }\n\n    // 3. Return response\n    if (!error) {\n      return { status: 200, group: Groups.findOne({ _id: groupId }) };\n    }\n    Logger.error(error);\n    throw new Meteor.Error(\"server-error\", \"Update not successful\");\n  },\n\n  /**\n   * @name group/addUser\n   * @method\n   * @memberof Methods/Group\n   * @summary Adds a user to a permission group\n   * Updates the user's list of permissions/roles with the defined the list defined for the group\n   * (NB: At this time, a user only belongs to only one group per shop)\n   * @param {String} userId - The account ID to add to the group\n   * @param {String} groupId - ID of the group\n   * @return {Object} - The modified group object\n   */\n  \"group/addUser\"(userId, groupId) {\n    check(userId, String);\n    check(groupId, String);\n    const group = Groups.findOne({ _id: groupId }) || {};\n    const { permissions, shopId, slug } = group;\n    const loggedInUserId = Meteor.userId();\n    const canInvite = Reaction.canInviteToGroup({ group });\n\n    // we are limiting group method actions to only users with admin roles\n    // this also include shop owners, since they have the `admin` role in their Roles.GLOBAL_GROUP\n    if (!Reaction.hasPermission(\"admin\", loggedInUserId, shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Users with `owner` and/or `admin` roles can invite to any group\n    // Also a user with `admin` can invite to only groups they have permissions that are a superset of\n    // See details of canInvite method in core (i.e Reaction.canInviteToGroup)\n    if (!canInvite) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    if (slug === \"owner\") {\n      // if adding a user to the owner group, check that the request is done by current owner\n      if (!Reaction.hasPermission(\"owner\", Meteor.userId(), shopId)) {\n        throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n      }\n    }\n\n    // make sure user only belongs to one group per shop\n    const allGroupsInShop = Groups.find({ shopId }).fetch().map((grp) => grp._id);\n    const user = Accounts.findOne({ _id: userId }) || {};\n    const currentUserGroups = user.groups || [];\n    let newGroups = [];\n    let currentUserGrpInShop;\n    currentUserGroups.forEach((grp) => {\n      if (allGroupsInShop.indexOf(grp) < 0) {\n        newGroups.push(grp);\n      } else {\n        currentUserGrpInShop = grp;\n      }\n    });\n    newGroups = newGroups.concat(groupId);\n\n    try {\n      setUserPermissions({ _id: userId }, permissions, shopId);\n      Accounts.update({ _id: userId }, { $set: { groups: newGroups } });\n      Hooks.Events.run(\"afterAccountsUpdate\", loggedInUserId, {\n        accountId: userId,\n        updatedFields: [\"groups\"]\n      });\n      if (slug === \"owner\") {\n        if (shopId === Reaction.getPrimaryShopId()) {\n          changeMarketplaceOwner({ userId, permissions });\n        }\n        // remove current shop owner after setting another admin as the new owner\n        Meteor.call(\"group/addUser\", Meteor.userId(), currentUserGrpInShop);\n      }\n\n      // Return the group the account as added to\n      return Groups.findOne({ _id: groupId });\n    } catch (error) {\n      Logger.error(error);\n      throw new Meteor.Error(\"server-error\", \"Could not add user\");\n    }\n  },\n\n  /**\n   * @name group/removeUser\n   * @method\n   * @memberof Methods/Group\n   * @summary Removes a user from a group for a shop, and adds them to the default customer group.\n   * Updates the user's permission list to reflect.\n   * (NB: At this time, a user only belongs to only one group per shop)\n   * @param {String} userId - The account ID to remove from the group\n   * @param {String} groupId - ID of the group\n   * @return {Object} - The modified group object\n   */\n  \"group/removeUser\"(userId, groupId) {\n    check(userId, String);\n    check(groupId, String);\n\n    const user = Accounts.findOne({ _id: userId });\n    const { shopId } = Groups.findOne({ _id: groupId }) || {};\n    const defaultCustomerGroupForShop = Groups.findOne({ slug: \"customer\", shopId }) || {};\n\n    // we are limiting group method actions to only users with admin roles\n    // this also include shop owners, since they have the `admin` role in their Roles.GLOBAL_GROUP\n    if (!Reaction.hasPermission(\"admin\", Meteor.userId(), shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    if (!user) {\n      throw new Meteor.Error(\"invalid-parameter\", \"Could not find user\");\n    }\n\n    try {\n      setUserPermissions(user, defaultCustomerGroupForShop.permissions, shopId);\n      Accounts.update({ _id: userId, groups: groupId }, { $set: { \"groups.$\": defaultCustomerGroupForShop._id } }); // replace the old id with new id\n      Hooks.Events.run(\"afterAccountsUpdate\", Meteor.userId(), {\n        accountId: userId,\n        updatedFields: [\"groups\"]\n      });\n      return defaultCustomerGroupForShop;\n    } catch (error) {\n      Logger.error(error);\n      throw new Meteor.Error(\"server-error\", \"Could not add user\");\n    }\n  }\n});\n\n/**\n * changeMarketplaceOwner\n * @private\n * @summary Checks if the user making the request is allowed to make invitation to that group\n * @param {Object} options -\n * @param {String} options.userId - userID\n * @param {String} options.permissions - permissions\n * @return {null} -\n */\nfunction changeMarketplaceOwner({ userId, permissions }) {\n  // give global marketplace role to new owner\n  Roles.setUserRoles(userId, permissions, Roles.GLOBAL_GROUP);\n  // remove global from previous owner\n  Meteor.users.update({ _id: Meteor.userId() }, { $unset: { [`roles.${Roles.GLOBAL_GROUP}`]: \"\" } });\n}\n\n/**\n * setUserPermissions\n * @private\n * @summary Set user permissions\n * @param {Object} users -\n * @param {String} permissions -\n * @param {String} shopId -\n * @return {null} -\n */\nfunction setUserPermissions(users, permissions, shopId) {\n  let affectedUsers = users;\n  if (!Array.isArray(users)) {\n    affectedUsers = [users];\n  }\n\n  return affectedUsers.forEach((user) => Roles.setUserRoles(user._id, permissions, shopId));\n}\n\n// set default admin user's account as \"owner\"\nHooks.Events.add(\"afterCreateDefaultAdminUser\", (user) => {\n  const group = Groups.findOne({ slug: \"owner\", shopId: Reaction.getShopId() });\n  Accounts.update({ _id: user._id }, { $set: { groups: [group._id] } });\n  Hooks.Events.run(\"afterAccountsUpdate\", null, {\n    accountId: user._id,\n    updatedFields: [\"groups\"]\n  });\n});\n","import _ from \"lodash\";\nimport accounting from \"accounting-js\";\nimport Future from \"fibers/future\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { SSR } from \"meteor/meteorhacks:ssr\";\nimport { Orders, Products, Shops, Packages } from \"/lib/collections\";\nimport { PaymentMethodArgument } from \"/lib/collections/schemas\";\nimport { Logger, Hooks, Reaction } from \"/server/api\";\nimport { Media } from \"/imports/plugins/core/files/server\";\nimport { publishProductInventoryAdjustments } from \"/imports/plugins/core/catalog/server/methods/catalog\";\n\n/**\n * @name getPrimaryMediaForItem\n * @summary Gets the FileRecord for the primary media item associated with the variant or product\n *   for the given item. This is similar to a function in /lib/api/helpers, but that one uses\n *   Media.findOneLocal, which is only for browser code.\n * @param {Object} item Must have `productId` and/or `variantId` set to get back a result.\n * @return {FileRecord|null}\n */\nasync function getPrimaryMediaForItem({ productId, variantId } = {}) {\n  let result;\n\n  if (variantId) {\n    result = await Media.findOne({\n      \"metadata.variantId\": variantId\n    }, { sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 } });\n  }\n\n  if (!result && productId) {\n    result = await Media.findOne({\n      \"metadata.productId\": productId\n    }, { sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 } });\n  }\n\n  return result || null;\n}\n\n/**\n * @name formatDateForEmail\n * @method\n * @private\n * @summary helper to generate the order date as a string for emails\n * @param {Date} date\n * @return {String} return date formatted as a MM/DD/YYYY string\n */\nfunction formatDateForEmail(date) {\n  const emailDate = new Date(date); // Clone date\n  const year = emailDate.getFullYear(); // get year\n  const month = emailDate.getMonth() + 1; // get month number + 1 (js has 0 indexed months)\n  const day = emailDate.getDate(); // get day number (js has 1 indexed days)\n\n  const paddedMonth = month > 9 ? `${month}` : `0${month}`; // generate padded month if necessary\n  const paddedDay = day > 9 ? `${day}` : `0${day}`; // generate padded days if necessary\n\n  return `${paddedMonth}/${paddedDay}/${year}`; // return MM/DD/YYYY formatted string\n}\n\n\n/**\n * @file Methods for Orders.\n *\n *\n * @namespace Methods/Orders\n*/\n\n/**\n * @name orderCreditMethod\n * @method\n * @memberof Methods/Orders\n * @summary Helper to return the order credit object.\n * Credit paymentMethod on the order as per current active shop\n * @param  {Object} order order object\n * @return {Object} returns entire payment method\n */\nexport function orderCreditMethod(order) {\n  const creditBillingRecords = order.billing.filter((value) => value.paymentMethod.method === \"credit\");\n  const billingRecord = creditBillingRecords.find((billing) => billing.shopId === Reaction.getShopId());\n  return billingRecord;\n}\n\n/**\n * @name orderDebitMethod\n * @method\n * @memberof Methods/Orders\n * @summary Helper to return the order debit object\n * @param  {Object} order order object\n * @return {Object} returns entire payment method\n */\nexport function orderDebitMethod(order) {\n  const debitBillingRecords = order.billing.filter((value) => value.paymentMethod.method === \"debit\");\n  const billingRecord = debitBillingRecords.find((billing) => billing.shopId === Reaction.getShopId());\n  return billingRecord;\n}\n\n/**\n * @name ordersInventoryAdjust\n * @method\n * @memberof Methods/Orders\n * @summary Adjust inventory when an order is placed\n * @param {String} orderId - Add tracking to orderId\n * @todo Why are we waiting until someone with orders permissions does something to reduce quantity of\n * ordered items seems like this could cause over ordered items and messed up order quantities pretty easily.\n * @return {null} no return value\n */\nexport function ordersInventoryAdjust(orderId) {\n  check(orderId, String);\n\n  if (!Reaction.hasPermission(\"orders\")) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  const order = Orders.findOne(orderId);\n  order.items.forEach((item) => {\n    Products.update({\n      _id: item.variants._id\n    }, {\n      $inc: {\n        inventoryQuantity: -item.quantity\n      }\n    }, {\n      publish: true,\n      selector: {\n        type: \"variant\"\n      }\n    });\n\n    Hooks.Events.run(\"afterUpdateCatalogProduct\", item.variant);\n\n    // Publish inventory updates to the Catalog\n    publishProductInventoryAdjustments(item.productId);\n  });\n}\n\n/**\n * @name ordersInventoryAdjustByShop\n * @method\n * @memberof Methods/Orders\n * @summary Adjust inventory for a particular shop when an order is approved\n * @todo Marketplace: Is there a reason to do this any other way? Can admins reduce for more than one shop?\n * @param {String} orderId - orderId\n * @param {String} shopId - the id of the shop approving the order\n * @return {null} no return value\n */\nexport function ordersInventoryAdjustByShop(orderId, shopId) {\n  check(orderId, String);\n  check(shopId, String);\n\n  if (!Reaction.hasPermission(\"orders\")) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  const order = Orders.findOne(orderId);\n  order.items.forEach((item) => {\n    if (item.shopId === shopId) {\n      Products.update({\n        _id: item.variants._id\n      }, {\n        $inc: {\n          inventoryQuantity: -item.quantity\n        }\n      }, {\n        publish: true,\n        selector: {\n          type: \"variant\"\n        }\n      });\n\n      Hooks.Events.run(\"afterUpdateCatalogProduct\", item.variants);\n\n      // Publish inventory updates to the Catalog\n      publishProductInventoryAdjustments(item.productId);\n    }\n  });\n}\n\n/**\n * @name orderQuantityAdjust\n * @method\n * @memberof Methods/Orders\n * @param  {String} orderId      orderId\n * @param  {Object} refundedItem refunded item\n * @return {null} no return value\n */\nexport function orderQuantityAdjust(orderId, refundedItem) {\n  check(orderId, String);\n\n  if (!Reaction.hasPermission(\"orders\")) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  const order = Orders.findOne(orderId);\n  order.items.forEach((item) => {\n    if (item._id === refundedItem.id) {\n      const itemId = item._id;\n      const newQuantity = item.quantity - refundedItem.refundedQuantity;\n\n      Orders.update({\n        _id: orderId,\n        items: { $elemMatch: { _id: itemId } }\n      }, {\n        $set: { \"items.$.quantity\": newQuantity }\n      });\n    }\n  });\n}\n\nexport const methods = {\n  /**\n   * @name orders/shipmentPicked\n   * @method\n   * @memberof Methods/Orders\n   * @summary update picking status\n   * @param {Object} order - order object\n   * @param {Object} shipment - shipment object\n   * @return {Object} return workflow result\n   */\n  \"orders/shipmentPicked\"(order, shipment) {\n    check(order, Object);\n    check(shipment, Object);\n\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Set the status of the items as picked\n    const itemIds = shipment.items.map((item) => item._id);\n\n    const result = Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/picked\", order, itemIds);\n    if (result === 1) {\n      return Orders.update({\n        \"_id\": order._id,\n        \"shipping._id\": shipment._id\n      }, {\n        $set: {\n          \"shipping.$.workflow.status\": \"coreOrderWorkflow/picked\"\n        },\n        $push: {\n          \"shipping.$.workflow.workflow\": \"coreOrderWorkflow/picked\"\n        }\n      }, { bypassCollection2: true });\n    }\n    return result;\n  },\n\n  /**\n   * @name orders/shipmentPacked\n   * @method\n   * @memberof Methods/Orders\n   * @summary update packing status\n   * @param {Object} order - order object\n   * @param {Object} shipment - shipment object\n   * @return {Object} return workflow result\n   */\n  \"orders/shipmentPacked\"(order, shipment) {\n    check(order, Object);\n    check(shipment, Object);\n\n    // REVIEW: who should have permission to do this in a marketplace setting?\n    // Do we need to update the order schema to reflect multiple packers / shipments?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Set the status of the items as packed\n    const itemIds = shipment.items.map((item) => item._id);\n\n    const result = Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/packed\", order, itemIds);\n    if (result === 1) {\n      return Orders.update({\n        \"_id\": order._id,\n        \"shipping._id\": shipment._id\n      }, {\n        $set: {\n          \"shipping.$.workflow.status\": \"coreOrderWorkflow/packed\"\n        },\n        $push: {\n          \"shipping.$.workflow.workflow\": \"coreOrderWorkflow/packed\"\n        }\n      }, { bypassCollection2: true });\n    }\n    return result;\n  },\n\n  /**\n   * @name orders/shipmentLabeled\n   * @method\n   * @memberof Methods/Orders\n   * @summary update labeling status\n   * @param {Object} order - order object\n   * @param {Object} shipment - shipment object\n   * @return {Object} return workflow result\n   */\n  \"orders/shipmentLabeled\"(order, shipment) {\n    check(order, Object);\n    check(shipment, Object);\n\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Set the status of the items as labeled\n    const itemIds = shipment.items.map((item) => item._id);\n\n    const result = Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/labeled\", order, itemIds);\n    if (result === 1) {\n      return Orders.update({\n        \"_id\": order._id,\n        \"shipping._id\": shipment._id\n      }, {\n        $set: {\n          \"shipping.$.workflow.status\": \"coreOrderWorkflow/labeled\"\n        },\n        $push: {\n          \"shipping.$.workflow.workflow\": \"coreOrderWorkflow/labeled\"\n        }\n      }, { bypassCollection2: true });\n    }\n    return result;\n  },\n\n  /**\n   * @name orders/makeAdjustmentsToInvoice\n   * @method\n   * @memberof Methods/Orders\n   * @summary Update the status of an invoice to allow adjustments to be made\n   * @param {Object} order - order object\n   * @return {Object} Mongo update\n   */\n  \"orders/makeAdjustmentsToInvoice\"(order) {\n    check(order, Object);\n\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock(); // REVIEW: Why unblock here?\n\n    return Orders.update({\n      \"_id\": order._id,\n      \"billing.shopId\": Reaction.getShopId(),\n      \"billing.paymentMethod.method\": \"credit\"\n    }, {\n      $set: {\n        \"billing.$.paymentMethod.status\": \"adjustments\"\n      }\n    });\n  },\n\n  /**\n   * @name orders/approvePayment\n   * @method\n   * @memberof Methods/Orders\n   * @summary Approve payment and apply any adjustments\n   * @param {Object} order - order object\n   * @return {Object} return this.processPayment result\n   */\n  \"orders/approvePayment\"(order) {\n    check(order, Object);\n    const { invoice } = orderCreditMethod(order);\n\n    // REVIEW: Who should have access to do this for a marketplace?\n    // Do we have/need a shopId on each order?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock(); // REVIEW: why unblock here?\n\n    // this is server side check to verify\n    // that the math all still adds up.\n    const shopId = Reaction.getShopId();\n    const { discounts, shipping, subtotal, taxes } = invoice;\n    const discountTotal = Math.max(0, subtotal - discounts); // ensure no discounting below 0.\n    const total = accounting.toFixed(Number(discountTotal) + Number(shipping) + Number(taxes), 2);\n\n    // Updates flattened inventory count on variants in Products collection\n    ordersInventoryAdjustByShop(order._id, shopId);\n\n    const result = Orders.update({\n      \"_id\": order._id,\n      \"billing.shopId\": shopId,\n      \"billing.paymentMethod.method\": \"credit\"\n    }, {\n      $set: {\n        \"billing.$.paymentMethod.amount\": total,\n        \"billing.$.paymentMethod.status\": \"approved\",\n        \"billing.$.paymentMethod.mode\": \"capture\",\n        \"billing.$.invoice.discounts\": discounts,\n        \"billing.$.invoice.total\": Number(total)\n      }\n    });\n\n    // Update search record\n    Hooks.Events.run(\"afterUpdateOrderUpdateSearchRecord\", order);\n\n    return result;\n  },\n\n  /**\n   * @name orders/cancelOrder\n   * @method\n   * @memberof Methods/Orders\n   * @summary Start the cancel order process\n   * @param {Object} order - order object\n   * @param {Boolean} returnToStock - condition to return product to stock\n   * @return {Object} ret\n   */\n  \"orders/cancelOrder\"(order, returnToStock) {\n    check(order, Object);\n    check(returnToStock, Boolean);\n\n    // REVIEW: Only marketplace admins should be able to cancel entire order?\n    // Unless order is entirely contained in a single shop? Do we need a switch on marketplace owner dashboard?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Inventory is removed from stock only once an order has been approved\n    // This is indicated by order.billing.$.paymentMethod.status being anything other than `created`\n    // We need to check to make sure the inventory has been removed before we return it to stock\n    const orderIsApproved = order.billing.find((status) => status.paymentMethod.status !== \"created\");\n\n    if (returnToStock && orderIsApproved) {\n      // Run this Product update inline instead of using ordersInventoryAdjust because the collection hooks fail\n      // in some instances which causes the order not to cancel\n      order.items.forEach((item) => {\n        if (Reaction.hasPermission(\"orders\", Meteor.userId(), item.shopId)) {\n          Products.update({\n            _id: item.variants._id,\n            shopId: item.shopId\n          }, {\n            $inc: {\n              inventoryQuantity: +item.quantity\n            }\n          }, {\n            bypassCollection2: true,\n            publish: true\n          });\n\n          Hooks.Events.run(\"afterUpdateCatalogProduct\", item.variants);\n\n          // Publish inventory updates to the Catalog\n          publishProductInventoryAdjustments(item.productId);\n        }\n      });\n    }\n\n    const billingRecord = order.billing.find((billing) => billing.shopId === Reaction.getShopId());\n    const shippingRecord = order.shipping.find((shipping) => shipping.shopId === Reaction.getShopId());\n\n    let { paymentMethod } = orderCreditMethod(order);\n    paymentMethod = Object.assign(paymentMethod, { amount: Number(paymentMethod.amount) });\n    const invoiceTotal = billingRecord.invoice.total;\n    const shipment = shippingRecord;\n    const itemIds = shipment.items.map((item) => item._id);\n\n    // refund payment to customer\n    const paymentMethodId = paymentMethod && paymentMethod.paymentPackageId;\n    const paymentMethodName = paymentMethod && paymentMethod.paymentSettingsKey;\n    const getPaymentMethod = Packages.findOne({ _id: paymentMethodId });\n    const isRefundable = getPaymentMethod && getPaymentMethod.settings && getPaymentMethod.settings[paymentMethodName]\n      && getPaymentMethod.settings[paymentMethodName].support.includes(\"Refund\");\n\n    if (isRefundable) {\n      Meteor.call(\"orders/refunds/create\", order._id, paymentMethod, Number(invoiceTotal));\n    }\n\n    // send notification to user\n    const prefix = Reaction.getShopPrefix();\n    const url = `${prefix}/notifications`;\n    const sms = true;\n    Meteor.call(\"notification/send\", order.userId, \"orderCanceled\", url, sms, (err) => {\n      if (err) Logger.error(err);\n    });\n\n    // update item workflow\n    Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/canceled\", order, itemIds);\n\n    return Orders.update({\n      \"_id\": order._id,\n      \"billing.shopId\": Reaction.getShopId(),\n      \"billing.paymentMethod.method\": \"credit\"\n    }, {\n      $set: {\n        \"workflow.status\": \"coreOrderWorkflow/canceled\",\n        \"billing.$.paymentMethod.mode\": \"cancel\"\n      },\n      $push: {\n        \"workflow.workflow\": \"coreOrderWorkflow/canceled\"\n      }\n    });\n  },\n\n  /**\n   * @name orders/processPayment\n   * @method\n   * @memberof Methods/Orders\n   * @summary trigger processPayment and workflow update\n   * @param {Object} order - order object\n   * @return {Object} return this.processPayment result\n   */\n  \"orders/processPayment\"(order) {\n    check(order, Object);\n\n    // REVIEW: Who should have access to process payment in marketplace?\n    // Probably just the shop owner for now?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    return Meteor.call(\"orders/processPayments\", order._id, function (error, result) {\n      if (result) {\n        Meteor.call(\"workflow/pushOrderWorkflow\", \"coreOrderWorkflow\", \"coreProcessPayment\", order._id);\n\n        const shippingRecord = order.shipping.find((shipping) => shipping.shopId === Reaction.getShopId());\n        // Set the status of the items as shipped\n        const itemIds = shippingRecord.items.map((item) => item._id);\n\n        Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/captured\", order, itemIds);\n\n        return this.processPayment(order);\n      }\n      return false;\n    });\n  },\n\n  /**\n   * @name orders/shipmentShipped\n   * @method\n   * @memberof Methods/Orders\n   * @summary trigger shipmentShipped status and workflow update\n   * @param {Object} order - order object\n   * @param {Object} shipment - shipment object\n   * @return {Object} return results of several operations\n   */\n  \"orders/shipmentShipped\"(order, shipment) {\n    check(order, Object);\n    check(shipment, Object);\n\n    // TODO: Who should have access to ship shipments in a marketplace setting\n    // Should be anyone who has product in an order.\n    if (!Reaction.hasPermission(\"orders\")) {\n      Logger.error(\"User does not have 'orders' permissions\");\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    let completedItemsResult;\n    let completedOrderResult;\n\n    const itemIds = shipment.items.map((item) => item._id);\n\n    // TODO: In the future, this could be handled by shipping delivery status\n    // REVIEW: This hook seems to run before the shipment has been marked as shipped\n    Hooks.Events.run(\"onOrderShipmentShipped\", order, itemIds);\n    const workflowResult = Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/shipped\", order, itemIds);\n\n    if (workflowResult === 1) {\n      // Move to completed status for items\n      completedItemsResult = Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/completed\", order, itemIds);\n\n      if (completedItemsResult === 1) {\n        // Then try to mark order as completed.\n        completedOrderResult = Meteor.call(\"workflow/pushOrderWorkflow\", \"coreOrderWorkflow\", \"completed\", order);\n      }\n    }\n\n    if (order.email) {\n      Meteor.call(\"orders/sendNotification\", order, \"shipped\");\n    } else {\n      // TODO: add to order history that no email was sent\n      Logger.warn(\"No order email found. No notification sent.\");\n    }\n\n    Orders.update({\n      \"_id\": order._id,\n      \"shipping._id\": shipment._id\n    }, {\n      $set: {\n        \"shipping.$.workflow.status\": \"coreOrderWorkflow/shipped\"\n      },\n      $push: {\n        \"shipping.$.workflow.workflow\": \"coreOrderWorkflow/shipped\"\n      }\n    }, { bypassCollection2: true });\n\n    return {\n      workflowResult,\n      completedItems: completedItemsResult,\n      completedOrder: completedOrderResult\n    };\n  },\n\n  /**\n   * @name orders/shipmentDelivered\n   * @method\n   * @memberof Methods/Orders\n   * @summary trigger shipmentShipped status and workflow update\n   * @param {Object} order - order object\n   * @return {Object} return workflow result\n   */\n  \"orders/shipmentDelivered\"(order) {\n    check(order, Object);\n\n    // REVIEW: this should be callable from the server via callback from Shippo or other webhook\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    const shipment = order.shipping.find((shipping) => shipping.shopId === Reaction.getShopId());\n\n    if (order.email) {\n      Meteor.call(\"orders/sendNotification\", order, (err) => {\n        if (err) {\n          Logger.error(err, \"orders/shipmentDelivered: Failed to send notification\");\n        }\n      });\n    } else {\n      Logger.warn(\"No order email found. No notification sent.\");\n    }\n\n    const itemIds = shipment.items.map((item) => item._id);\n\n    Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/delivered\", order, itemIds);\n    Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/completed\", order, itemIds);\n\n    const isCompleted = order.items.every((item) => item.workflow.workflow && item.workflow.workflow.includes(\"coreOrderItemWorkflow/completed\"));\n\n    Orders.update({\n      \"_id\": order._id,\n      \"shipping._id\": shipment._id\n    }, {\n      $set: {\n        \"shipping.$.workflow.status\": \"coreOrderWorkflow/delivered\"\n      },\n      $push: {\n        \"shipping.$.workflow.workflow\": \"coreOrderWorkflow/delivered\"\n      }\n    }, { bypassCollection2: true });\n\n    if (isCompleted === true) {\n      Hooks.Events.run(\"onOrderShipmentDelivered\", order._id);\n      Meteor.call(\"workflow/pushOrderWorkflow\", \"coreOrderWorkflow\", \"completed\", order);\n      return true;\n    }\n\n    Meteor.call(\"workflow/pushOrderWorkflow\", \"coreOrderWorkflow\", \"processing\", order);\n\n    return false;\n  },\n\n  /**\n   * @name orders/sendNotification\n   * @method\n   * @memberof Methods/Orders\n   * @summary send order notification email\n   * @param {Object} order - order object\n   * @param {Object} action - send notification action\n   * @return {Boolean} email sent or not\n   */\n  \"orders/sendNotification\"(order, action) {\n    check(order, Object);\n    check(action, Match.OneOf(String, undefined));\n\n    // TODO: REVIEW: SECURITY this only checks to see if a userId exists\n    if (!this.userId) {\n      Logger.error(\"orders/sendNotification: Access denied\");\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    // Get Shop information\n    const shop = Shops.findOne(order.shopId);\n    // TODO need to make this fully support multi-shop. Now it's just collapsing into one\n    // Get shop logo, if available\n    const emailLogo = Reaction.Email.getShopLogo(shop);\n\n    let subtotal = 0;\n    let shippingCost = 0;\n    let taxes = 0;\n    let discounts = 0;\n    let amount = 0;\n    let address = {};\n    let paymentMethod = {};\n    let shippingAddress = {};\n    let tracking;\n    let carrier = \"\";\n\n    for (const billingRecord of order.billing) {\n      subtotal += Number.parseFloat(billingRecord.invoice.subtotal);\n      taxes += Number.parseFloat(billingRecord.invoice.taxes);\n      discounts += Number.parseFloat(billingRecord.invoice.discounts);\n      amount += billingRecord.paymentMethod.amount;\n      ({ address } = billingRecord);\n      ({ paymentMethod } = billingRecord);\n    }\n\n    for (const shippingRecord of order.shipping) {\n      shippingAddress = shippingRecord.address;\n      ({ tracking } = shippingRecord);\n      const { shipmentMethod } = shippingRecord;\n      ({ carrier } = shipmentMethod || {});\n      const { rate } = shipmentMethod || {};\n      shippingCost += rate || 0;\n    }\n\n    const refundResult = Meteor.call(\"orders/refunds/list\", order);\n    const refundTotal = Array.isArray(refundResult) && refundResult.reduce((acc, refund) => acc + refund.amount, 0);\n\n    // Get user currency formatting from shops collection, remove saved rate\n    // using billing[0] here to get the currency and exchange rate used because\n    // in multishop mode, the currency object is different across shops\n    // and it's inconsistent, i.e. sometimes there's no exchangeRate field in the secondary\n    // shop's currency array.\n    // TODO: Remove billing[0] and properly aquire userCurrency and exchange rate\n    const userCurrencyFormatting = _.omit(shop.currencies[order.billing[0].currency.userCurrency], [\"enabled\", \"rate\"]);\n\n    // Get user currency exchange rate at time of transaction\n    const userCurrencyExchangeRate = order.billing[0].currency.exchangeRate;\n\n    // Combine same products into single \"product\" for display purposes\n    const combinedItems = [];\n    if (order) {\n      // Loop through all items in the order. The items are split into indivital items\n      for (const orderItem of order.items) {\n        // Find an exising item in the combinedItems array\n        const foundItem = combinedItems.find((combinedItem) => {\n          // If and item variant exists, then we return true\n          if (combinedItem.variants) {\n            return combinedItem.variants._id === orderItem.variants._id;\n          }\n\n          return false;\n        });\n\n        // Increment the quantity count for the duplicate product variants\n        if (foundItem) {\n          foundItem.quantity += 1;\n        } else {\n          // Otherwise push the unique item into the combinedItems array\n\n          // Add displayPrice to match user currency settings\n          orderItem.variants.displayPrice = accounting.formatMoney(orderItem.variants.price * userCurrencyExchangeRate, userCurrencyFormatting);\n\n          combinedItems.push(orderItem);\n\n          // Placeholder image if there is no product image\n          orderItem.placeholderImage = `${Meteor.absoluteUrl()}resources/placeholder.gif`;\n\n          // variant image\n          const variantImage = Promise.await(getPrimaryMediaForItem({\n            productId: orderItem.productId,\n            variantId: orderItem.variants && orderItem.variants._id\n          }));\n          if (variantImage) {\n            orderItem.variantImage = variantImage.url({ absolute: true, store: \"large\" });\n          }\n\n          // find a default image\n          const productImage = Promise.await(getPrimaryMediaForItem({ productId: orderItem.productId }));\n          if (productImage) {\n            orderItem.productImage = productImage.url({ absolute: true, store: \"large\" });\n          }\n        }\n      }\n\n      const copyrightDate = new Date().getFullYear();\n\n      // Merge data into single object to pass to email template\n      const dataForEmail = {\n        // Shop Data\n        shop,\n        contactEmail: shop.emails[0].address,\n        homepage: Meteor.absoluteUrl(),\n        emailLogo,\n        copyrightDate,\n        legalName: _.get(shop, \"addressBook[0].company\"),\n        physicalAddress: {\n          address: `${_.get(shop, \"addressBook[0].address1\")} ${_.get(shop, \"addressBook[0].address2\")}`,\n          city: _.get(shop, \"addressBook[0].city\"),\n          region: _.get(shop, \"addressBook[0].region\"),\n          postal: _.get(shop, \"addressBook[0].postal\")\n        },\n        shopName: shop.name,\n        socialLinks: {\n          display: true,\n          facebook: {\n            display: true,\n            icon: `${Meteor.absoluteUrl()}resources/email-templates/facebook-icon.png`,\n            link: \"https://www.facebook.com\"\n          },\n          googlePlus: {\n            display: true,\n            icon: `${Meteor.absoluteUrl()}resources/email-templates/google-plus-icon.png`,\n            link: \"https://plus.google.com\"\n          },\n          twitter: {\n            display: true,\n            icon: `${Meteor.absoluteUrl()}resources/email-templates/twitter-icon.png`,\n            link: \"https://www.twitter.com\"\n          }\n        },\n        // Order Data\n        order,\n        billing: {\n          address: {\n            address: `${address.address1}${address.address2 ? ` ${address.address2}` : \"\"}`,\n            city: address.city,\n            region: address.region,\n            postal: address.postal\n          },\n          paymentMethod: paymentMethod.storedCard || paymentMethod.processor,\n          subtotal: accounting.formatMoney(subtotal * userCurrencyExchangeRate, userCurrencyFormatting),\n          shipping: accounting.formatMoney(shippingCost * userCurrencyExchangeRate, userCurrencyFormatting),\n          taxes: accounting.formatMoney(taxes * userCurrencyExchangeRate, userCurrencyFormatting),\n          discounts: accounting.formatMoney(discounts * userCurrencyExchangeRate, userCurrencyFormatting),\n          refunds: accounting.formatMoney(refundTotal * userCurrencyExchangeRate, userCurrencyFormatting),\n          total: accounting.formatMoney((subtotal + shippingCost + taxes - discounts) * userCurrencyExchangeRate, userCurrencyFormatting),\n          adjustedTotal: accounting.formatMoney((amount - refundTotal) * userCurrencyExchangeRate, userCurrencyFormatting)\n        },\n        combinedItems,\n        orderDate: formatDateForEmail(order.createdAt),\n        orderUrl: `cart/completed?_id=${order.cartId}`,\n        shipping: {\n          tracking,\n          carrier,\n          address: {\n            address: `${shippingAddress.address1}${shippingAddress.address2 ? ` ${shippingAddress.address2}` : \"\"}`,\n            city: shippingAddress.city,\n            region: shippingAddress.region,\n            postal: shippingAddress.postal\n          }\n        }\n      };\n\n      Logger.debug(`orders/sendNotification status: ${order.workflow.status}`);\n\n\n      // handle missing root shop email\n      if (!shop.emails[0].address) {\n        shop.emails[0].address = \"no-reply@reactioncommerce.com\";\n        Logger.warn(\"No shop email configured. Using no-reply to send mail\");\n      }\n\n      // anonymous users without emails.\n      if (!order.email) {\n        const msg = \"No order email found. No notification sent.\";\n        Logger.warn(msg);\n        throw new Meteor.Error(\"email-error\", msg);\n      }\n\n      // Compile Email with SSR\n      let subject;\n      let tpl;\n\n      if (action === \"shipped\") {\n        tpl = \"orders/shipped\";\n        subject = \"orders/shipped/subject\";\n      } else if (action === \"refunded\") {\n        tpl = \"orders/refunded\";\n        subject = \"orders/refunded/subject\";\n      } else if (action === \"itemRefund\") {\n        tpl = \"orders/itemRefund\";\n        subject = \"orders/itemRefund/subject\";\n      } else {\n        tpl = `orders/${order.workflow.status}`;\n        subject = `orders/${order.workflow.status}/subject`;\n      }\n\n      SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n      SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n      Reaction.Email.send({\n        to: order.email,\n        from: `${shop.name} <${shop.emails[0].address}>`,\n        subject: SSR.render(subject, dataForEmail),\n        html: SSR.render(tpl, dataForEmail)\n      });\n\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * @name orders/updateShipmentTracking\n   * @summary Adds tracking information to order without workflow update.\n   * Call after any tracking code is generated\n   * @method\n   * @memberof Methods/Orders\n   * @param {Object} order - An Order object\n   * @param {Object} shipment - A Shipment object\n   * @param {String} tracking - tracking id\n   * @return {String} returns order update result\n   */\n  \"orders/updateShipmentTracking\"(order, shipment, tracking) {\n    check(order, Object);\n    check(shipment, Object);\n    check(tracking, String);\n\n    // REVIEW: This method should be callable from a webhook (e.g. Shippo)\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return Orders.update({\n      \"_id\": order._id,\n      \"shipping._id\": shipment._id\n    }, {\n      $set: {\n        \"shipping.$.tracking\": tracking\n      }\n    });\n  },\n\n  /**\n   * @name orders/addOrderEmail\n   * @method\n   * @memberof Methods/Orders\n   * @summary Adds email to order, used for guest users\n   * @param {String} cartId - add tracking to orderId\n   * @param {String} email - valid email address\n   * @return {String} returns order update result\n   */\n  \"orders/addOrderEmail\"(cartId, email) {\n    check(cartId, String);\n    check(email, String);\n    /**\n    *Instead of checking the Orders permission, we should check if user is\n    *connected.This is only needed for guest where email is\n    *provided for tracking order progress.\n    */\n\n    if (!Meteor.userId()) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied. You are not connected.\");\n    }\n\n    return Orders.update({ cartId }, { $set: { email } });\n  },\n\n  /**\n   * @name orders/updateHistory\n   * @method\n   * @memberof Methods/Orders\n   * @summary adds order history item for tracking and logging order updates\n   * @param {String} orderId - add tracking to orderId\n   * @param {String} event - workflow event\n   * @param {String} value - event value\n   * @return {String} returns order update result\n   */\n  \"orders/updateHistory\"(orderId, event, value) {\n    check(orderId, String);\n    check(event, String);\n    check(value, Match.Optional(String));\n\n    // REVIEW: For marketplace implementations\n    // This should be possible for anyone with permission to act on the order\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return Orders.update(orderId, {\n      $addToSet: {\n        history: {\n          event,\n          value,\n          userId: Meteor.userId(),\n          updatedAt: new Date()\n        }\n      }\n    });\n  },\n\n  /**\n   * @name orders/capturePayments\n   * @summary Finalize any payment where mode is \"authorize\"\n   * and status is \"approved\", reprocess as \"capture\"\n   * @method\n   * @memberof Methods/Orders\n   * @param {String} orderId - add tracking to orderId\n   * @return {null} no return value\n   */\n  \"orders/capturePayments\": (orderId) => {\n    check(orderId, String);\n    // REVIEW: For marketplace implmentations who should be able to capture payments?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const shopId = Reaction.getShopId(); // the shopId of the current user, i.e. merchant\n    const order = Orders.findOne(orderId);\n    // find the appropriate shipping record by shop\n    const shippingRecord = order.shipping.find((sRecord) => sRecord.shopId === shopId);\n    const itemIds = shippingRecord.items.map((item) => item._id);\n\n    Meteor.call(\"workflow/pushItemWorkflow\", \"coreOrderItemWorkflow/captured\", order, itemIds);\n\n    if (order.workflow.status === \"new\") {\n      Meteor.call(\"workflow/pushOrderWorkflow\", \"coreOrderWorkflow\", \"processing\", order);\n    }\n\n    // process order..payment.paymentMethod\n    // find the billing record based on shopId\n    const bilingRecord = order.billing.find((bRecord) => bRecord.shopId === shopId);\n\n    const { paymentMethod } = bilingRecord;\n    const { transactionId } = paymentMethod;\n\n    if (paymentMethod.mode === \"capture\" && paymentMethod.status === \"approved\" && paymentMethod.processor) {\n      // Grab the amount from the shipment, otherwise use the original amount\n      const processor = paymentMethod.processor.toLowerCase();\n\n      let result;\n      let error;\n      try {\n        result = Meteor.call(`${processor}/payment/capture`, paymentMethod);\n      } catch (e) {\n        error = e;\n      }\n\n      if (result && result.saved === true) {\n        const metadata = Object.assign(bilingRecord.paymentMethod.metadata || {}, result.metadata || {});\n\n        Orders.update({\n          \"_id\": orderId,\n          \"billing.paymentMethod.transactionId\": transactionId\n        }, {\n          $set: {\n            \"billing.$.paymentMethod.mode\": \"capture\",\n            \"billing.$.paymentMethod.status\": \"completed\",\n            \"billing.$.paymentMethod.metadata\": metadata\n          },\n          $push: {\n            \"billing.$.paymentMethod.transactions\": result\n          }\n        });\n\n        // event onOrderPaymentCaptured used for confirmation hooks\n        // ie: confirmShippingMethodForOrder is triggered here\n        Hooks.Events.run(\"onOrderPaymentCaptured\", orderId);\n        return { error, result };\n      }\n\n      if (result && result.error) {\n        Logger.fatal(\"Failed to capture transaction.\", order, paymentMethod.transactionId, result.error);\n      } else {\n        Logger.fatal(\"Failed to capture transaction.\", order, paymentMethod.transactionId, error);\n      }\n\n      Orders.update({\n        \"_id\": orderId,\n        \"billing.paymentMethod.transactionId\": transactionId\n      }, {\n        $set: {\n          \"billing.$.paymentMethod.mode\": \"capture\",\n          \"billing.$.paymentMethod.status\": \"error\"\n        },\n        $push: {\n          \"billing.$.paymentMethod.transactions\": result\n        }\n      });\n\n      return { error: \"orders/capturePayments: Failed to capture transaction\" };\n    }\n  },\n\n  /**\n   * @name orders/refund/list\n   * @summary loop through order's payments and find existing refunds.\n   * Get a list of refunds for a particular payment method.\n   * @method\n   * @memberof Methods/Orders\n   * @param {Object} order - order object\n   * @return {Array} Array contains refund records\n   */\n  \"orders/refunds/list\"(order) {\n    check(order, Object);\n\n    if (!this.userId === order.userId && !Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const refunds = [];\n    for (const billingRecord of order.billing) {\n      const { paymentMethod } = billingRecord;\n      const processor = paymentMethod.processor.toLowerCase();\n      const shopRefunds = Meteor.call(`${processor}/refund/list`, paymentMethod);\n      refunds.push(...shopRefunds);\n    }\n    return refunds;\n  },\n\n  /**\n   * @name orders/refund/create\n   * @method\n   * @memberof Methods/Orders\n   * @summary Apply a refund to an already captured order\n   * @param {String} orderId - order object\n   * @param {Object} paymentMethod - paymentMethod object\n   * @param {Number} amount - Amount of the refund, as a positive number\n   * @param {Bool} sendEmail - Send email confirmation\n   * @return {null} no return value\n   */\n  \"orders/refunds/create\"(orderId, paymentMethod, amount, sendEmail = true) {\n    check(orderId, String);\n    check(amount, Number);\n    check(sendEmail, Match.Optional(Boolean));\n\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    // REVIEW: For marketplace implementations, who can refund? Just the marketplace?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const processor = paymentMethod.processor.toLowerCase();\n    const order = Orders.findOne(orderId);\n    const { transactionId } = paymentMethod;\n\n    const packageId = paymentMethod.paymentPackageId;\n    const settingsKey = paymentMethod.paymentSettingsKey;\n    // check if payment provider supports de-authorize\n    const checkSupportedMethods = Packages.findOne({\n      _id: packageId\n    }).settings[settingsKey].support;\n\n    const orderMode = paymentMethod.mode;\n\n    let result;\n    let query = {};\n    if (checkSupportedMethods.includes(\"De-authorize\")) {\n      result = Meteor.call(`${processor}/payment/deAuthorize`, paymentMethod, amount);\n      query = {\n        $push: {\n          \"billing.$.paymentMethod.transactions\": result\n        }\n      };\n\n      if (result.saved === false) {\n        Logger.fatal(\"Attempt for de-authorize transaction failed\", order._id, paymentMethod.transactionId, result.error);\n        throw new Meteor.Error(\"Attempt to de-authorize transaction failed\", result.error);\n      }\n    } else if (orderMode === \"capture\") {\n      result = Meteor.call(`${processor}/refund/create`, paymentMethod, amount);\n      query = {\n        $push: {\n          \"billing.$.paymentMethod.transactions\": result\n        }\n      };\n\n      if (result.saved === false) {\n        Logger.fatal(\"Attempt for refund transaction failed\", order._id, paymentMethod.transactionId, result.error);\n        throw new Meteor.Error(\"Attempt to refund transaction failed\", result.error);\n      }\n    }\n\n    Orders.update({\n      \"_id\": orderId,\n      \"billing.shopId\": Reaction.getShopId(),\n      \"billing.paymentMethod.transactionId\": transactionId\n    }, {\n      $set: {\n        \"billing.$.paymentMethod.status\": \"refunded\"\n      },\n      ...query\n    });\n\n    Hooks.Events.run(\"onOrderRefundCreated\", orderId);\n\n    // Send email to notify customer of a refund\n    if (checkSupportedMethods.includes(\"De-authorize\")) {\n      Meteor.call(\"orders/sendNotification\", order);\n    } else if (orderMode === \"capture\" && sendEmail) {\n      Meteor.call(\"orders/sendNotification\", order, \"refunded\");\n    }\n  },\n\n  /**\n   * @name orders/refunds/refundItems\n   * @method\n   * @memberof Methods/Orders\n   * @summary Apply a refund to line items\n   * @param {String} orderId - order object\n   * @param {Object} paymentMethod - paymentMethod object\n   * @param {Object} refundItemsInfo - info about refund items\n   * @return {Object} refund boolean and result/error value\n   */\n  \"orders/refunds/refundItems\"(orderId, paymentMethod, refundItemsInfo) {\n    check(orderId, String);\n    check(refundItemsInfo, Object);\n\n    // Call both check and validate because by calling `clean`, the audit pkg\n    // thinks that we haven't checked paymentMethod arg\n    check(paymentMethod, Object);\n    PaymentMethodArgument.validate(PaymentMethodArgument.clean(paymentMethod));\n\n    // REVIEW: For marketplace implementations, who can refund? Just the marketplace?\n    if (!Reaction.hasPermission(\"orders\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const fut = new Future();\n    const order = Orders.findOne(orderId);\n    const { transactionId } = paymentMethod;\n    const amount = refundItemsInfo.total;\n    const { quantity } = refundItemsInfo;\n    const refundItems = refundItemsInfo.items;\n    const originalQuantity = order.items.reduce((acc, item) => acc + item.quantity, 0);\n\n    // refund payment to customer\n    Meteor.call(\"orders/refunds/create\", order._id, paymentMethod, Number(amount), false, (error, result) => {\n      if (error) {\n        Logger.fatal(\"Attempt for refund transaction failed\", order._id, paymentMethod.transactionId, error);\n        fut.return({\n          refund: false,\n          error\n        });\n      }\n      if (result) {\n        refundItems.forEach((refundItem) => {\n          orderQuantityAdjust(orderId, refundItem);\n        });\n\n        let refundedStatus = \"refunded\";\n\n        if (quantity < originalQuantity) {\n          refundedStatus = \"partialRefund\";\n        }\n\n        Orders.update({\n          \"_id\": orderId,\n          \"billing.shopId\": Reaction.getShopId(),\n          \"billing.paymentMethod.transactionId\": transactionId\n        }, {\n          $set: {\n            \"billing.$.paymentMethod.status\": refundedStatus\n          }\n        });\n\n        Meteor.call(\"orders/sendNotification\", order, \"itemRefund\");\n\n        fut.return({\n          refund: true,\n          result\n        });\n      }\n    });\n    return fut.wait();\n  }\n};\n\nMeteor.methods(methods);\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * @file Methods for Packages.\n *\n *\n * @namespace Methods/Package\n*/\n\n/**\n * @method package/update\n * @memberof Methods/Package\n * @summary updates the data stored for a certain Package.\n * @param {String} packageName - the name of the Package to update.\n * @param {String} field - the part of the Package's data that is to\n * be updated.\n * @param {Object} value - the new data that's to be stored for the said\n * Package.\n * @since 1.5.1\n * @return {Object} - returns an object with info about the update operation.\n */\nexport function updatePackage(packageName, field, value) {\n  check(packageName, String);\n  check(field, String);\n  check(value, Object);\n\n  const userId = Meteor.userId();\n  const shopId = Reaction.getShopId();\n  if (!Reaction.hasPermission([packageName], userId, shopId)) {\n    throw new Meteor.Error(\"access-denied\", `Access Denied. You don't have permissions for the ${packageName} package.`);\n  }\n\n  const updateResult = Packages.update({\n    name: packageName,\n    shopId\n  }, {\n    $set: {\n      [field]: value\n    }\n  });\n  if (updateResult !== 1) {\n    throw new Meteor.Error(\"server-error\", `An error occurred while updating the package ${packageName}.`);\n  }\n  return updateResult;\n}\n\nMeteor.methods({\n  \"package/update\": updatePackage\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Random } from \"meteor/random\";\nimport { check } from \"meteor/check\";\nimport { Reaction, Hooks } from \"/server/api\";\n\n/**\n * @file Methods for Payments. Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/Payments\n*/\n\nexport const methods = {\n  /**\n   * @name payments/apply\n   * @method\n   * @memberof Methods/Payments\n   * @example Meteor.call(\"payments/apply\", id, paymentMethod, collection)\n   * @summary Adds payment to order\n   * @param {String} id - id\n   * @param {Object} paymentMethod - formatted payment method object\n   * @param  {String} collection collection (either Orders or Cart)\n   * @returns {String} return cart update result\n   */\n  \"payments/apply\"(id, paymentMethod, collection = \"Cart\") {\n    check(id, String);\n    check(paymentMethod, Object);\n    check(collection, String);\n    const Collection = Reaction.Collections[collection];\n\n    const cart = Collection.findOne(id);\n    // The first record holds the selected billing address\n    const billing = cart.billing[0];\n    const billingId = Random.id();\n    const result = Collection.update({\n      _id: id\n    }, {\n      $addToSet: {\n        billing: {\n          ...billing,\n          _id: billingId,\n          paymentMethod\n        }\n      }\n    });\n    // calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", id);\n\n    return result;\n  }\n};\n\n// export methods to Meteor\nMeteor.methods(methods);\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\nimport { mergeDeep } from \"/lib/api\";\n\n/**\n * @file Methods for Registry\n *\n *\n * @namespace Methods/Registry\n*/\n\nexport const methods = {\n  /**\n   * @name registry/update\n   * @method\n   * @memberof Methods/Registry\n   * @example Meteor.call(\"registry/update\", packageId, settingsKey, fields)\n   * @param  {String} packageId id of package\n   * @param  {String} name      Name of package\n   * @param  {Array} fields     Fields to update\n   * @todo Name could be optional. Just use package name as default.\n   * @return {Boolean}          true on success, false on error\n   */\n  \"registry/update\"(packageId, name, fields) {\n    check(packageId, String);\n    check(name, String);\n    check(fields, Array);\n    // settings use just the last name from full name so that schemas don't need to define overly complex names based with\n    // x/x/x formatting.\n    // TODO Name could be optional. Just use package name as default\n    const setting = name.split(\"/\").splice(-1);\n    let dataToSave = {};\n    dataToSave[setting] = {};\n    const currentPackage = Packages.findOne(packageId);\n\n    _.each(fields, (field) => {\n      dataToSave[setting][field.property] = field.value;\n    });\n\n    if (currentPackage && currentPackage.settings) {\n      dataToSave = mergeDeep(currentPackage.settings, dataToSave);\n    }\n    // user must have permission to package to update settings\n    if (Reaction.hasPermission([currentPackage.name])) {\n      return Packages.upsert({\n        _id: packageId,\n        name: currentPackage.name,\n        enabled: currentPackage.enabled\n      }, {\n        $set: {\n          settings: dataToSave\n        }\n      }, { upsert: true });\n    }\n\n    return false;\n  }\n};\n\nMeteor.methods(methods);\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Cart, Accounts } from \"/lib/collections\";\nimport { Logger, Hooks } from \"/server/api\";\nimport { Cart as CartSchema } from \"/lib/collections/schemas\";\n\n/**\n * @file Methods for Shipping - methods typically used for checkout (shipping, taxes, etc).\n * Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/Shipping\n*/\n\n/**\n * @name createShipmentQuotes\n * @private\n * @summary Returns object with shipping object with `requestStatus` as `pending`\n * @param  {String} cartId ID\n * @param  {String} shopId ID\n * @param  {Object} rates  Shipping rates\n * @return {Object}        Update object with `shipping` object.\n */\nfunction createShipmentQuotes(cartId, shopId, rates) {\n  let update = {\n    $push: {\n      shipping: {\n        shopId,\n        shipmentQuotes: [],\n        shipmentQuotesQueryStatus: {\n          requestStatus: \"pending\"\n        }\n      }\n    }\n  };\n\n  try {\n    Cart.update({ _id: cartId }, update);\n  } catch (error) {\n    Logger.warn(`Error in setting shipping query status to \"pending\" for ${cartId}`, error);\n    throw error;\n  }\n\n  // Calculate discounts\n  Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n\n  Logger.debug(`Success in setting shipping query status to \"pending\" for ${cartId}`, rates);\n\n  if (rates.length === 1 && rates[0].requestStatus === \"error\") {\n    const errorDetails = rates[0];\n    update = {\n      $set: {\n        \"shipping.$.shipmentQuotes\": [],\n        \"shipping.$.shipmentQuotesQueryStatus\": {\n          requestStatus: errorDetails.requestStatus,\n          shippingProvider: errorDetails.shippingProvider,\n          message: errorDetails.message\n        }\n      }\n    };\n  }\n\n  if (rates.length > 0 && rates[0].requestStatus === undefined) {\n    update = {\n      $set: {\n        \"shipping.$.shipmentQuotes\": rates,\n        \"shipping.$.shipmentQuotesQueryStatus\": {\n          requestStatus: \"success\",\n          numOfShippingMethodsFound: rates.length\n        }\n      }\n    };\n  }\n\n  return update;\n}\n\n/**\n * @name pruneShippingRecordsByShop\n * @private\n * @summary if we have items in the cart, ensure that we only have shipping records\n * for shops currently represented in the cart\n * @param {Object} cart - The cart to operate on\n * @returns {undefined} undefined\n * @private\n */\nfunction pruneShippingRecordsByShop(cart) {\n  if (cart.items) {\n    const cartId = cart._id;\n    const itemsByShop = cart.getItemsByShop();\n    const shops = Object.keys(itemsByShop);\n    if (shops.length > 0 && cart.items.length > 0) {\n      Cart.update(\n        { _id: cartId },\n        {\n          $pull: {\n            shipping: { shopId: { $nin: shops } }\n          }\n        }\n      );\n    } else {\n      Cart.update(\n        { _id: cartId },\n        {\n          $unset: {\n            shipping: \"\"\n          }\n        }\n      );\n    }\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n  }\n}\n\n/**\n * @name normalizeAddresses\n * @summary - When adding shipping records, ensure that each record has an address\n * @param {Object} cart - The Cart object we need to operate on\n * @returns {undefined} undefined\n * @private\n */\nfunction normalizeAddresses(cart) {\n  if (cart.shipping && cart.shipping.length > 0) {\n    const { shipping } = cart;\n    const cartId = cart._id;\n    let address; // we can only have one address so whatever was the last assigned\n    shipping.forEach((shippingRecord) => {\n      if (shippingRecord.address) {\n        ({ address } = shippingRecord);\n      }\n    });\n    const shopIds = Object.keys(cart.getItemsByShop());\n    shopIds.forEach((shopId) => {\n      const selector = {\n        \"_id\": cartId,\n        \"shipping.shopId\": shopId\n      };\n\n      const update = {\n        $set: {\n          \"shipping.$.address\": address\n        }\n      };\n      Cart.update(selector, update);\n      // Calculate discounts\n      Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n    });\n  }\n}\n\n/**\n * @name updateShipmentQuotes\n * @param  {String} cartId   Cart ID\n * @param  {Object} rates    Rate object\n * @param  {Object} selector Selector\n * @return {Object}          Update\n * @private\n */\nfunction updateShipmentQuotes(cartId, rates, selector) {\n  let update = {\n    $set: {\n      \"shipping.$.shipmentQuotesQueryStatus\": {\n        requestStatus: \"pending\"\n      }\n    }\n  };\n\n  try {\n    Cart.update(selector, update);\n  } catch (error) {\n    Logger.warn(`Error in setting shipping query status to \"pending\" for ${cartId}`, error);\n    throw error;\n  }\n\n  // Calculate discounts\n  Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n\n  Logger.debug(`Success in setting shipping query status to \"pending\" for ${cartId}`, rates);\n\n  if (rates.length === 1 && rates[0].requestStatus === \"error\") {\n    const errorDetails = rates[0];\n    update = {\n      $set: {\n        \"shipping.$.shipmentQuotes\": [],\n        \"shipping.$.shipmentQuotesQueryStatus\": {\n          requestStatus: errorDetails.requestStatus,\n          shippingProvider: errorDetails.shippingProvider,\n          message: errorDetails.message\n        }\n      }\n    };\n  }\n\n  if (rates.length > 0 && rates[0].requestStatus === undefined) {\n    update = {\n      $set: {\n        \"shipping.$.shipmentQuotes\": rates,\n        \"shipping.$.shipmentQuotesQueryStatus\": {\n          requestStatus: \"success\",\n          numOfShippingMethodsFound: rates.length\n        }\n      }\n    };\n  }\n\n  return update;\n}\n\n/**\n * @name updateShippingRecordByShop\n * @param  {Object} cart  Cart object\n * @param  {Object} rates Rate object\n * @return {null}\n * @private\n */\nfunction updateShippingRecordByShop(cart, rates) {\n  const cartId = cart._id;\n  const itemsByShop = cart.getItemsByShop();\n\n  const shops = Object.keys(itemsByShop);\n  shops.forEach((shopId) => {\n    const selector = {\n      \"_id\": cartId,\n      \"shipping.shopId\": shopId\n    };\n    const cartForShipping = Cart.findOne(selector);\n\n    // we may have added a new shop since the last time we did this, if so we need to add a new record\n    let update;\n    if (cartForShipping) {\n      update = updateShipmentQuotes(cartId, rates, selector);\n    } else {\n      update = createShipmentQuotes(cartId, shopId, rates);\n    }\n\n    try {\n      Cart.update(selector, update);\n    } catch (error) {\n      Logger.warn(`Error updating rates for cart ${cartId}`, error);\n      throw error;\n    }\n\n    // Calculate discounts\n    Hooks.Events.run(\"afterCartUpdateCalculateDiscount\", cartId);\n\n    Logger.debug(`Success updating rates for cart ${cartId}`, rates);\n  });\n\n  pruneShippingRecordsByShop(cart);\n  normalizeAddresses(cart);\n}\n\n/**\n * @name getDefaultAddress\n * @param  {Object} cart [description]\n * @return {Object} address\n * @private\n */\nfunction getDefaultAddress(cart) {\n  const { userId } = cart;\n  const account = Accounts.findOne(userId);\n  if (account && account.profile && account.profile.addressBook) {\n    const address = account.profile.addressBook.find((addressEntry) => addressEntry.isShippingDefault === true);\n    return address;\n  }\n}\n\n/**\n * @name addAddresses\n * @summary Add the default address to the cart\n * @param {Object} cart - the cart to modify\n * @returns {undefined}\n * @private\n */\nfunction addAddresses(cart) {\n  const address = getDefaultAddress(cart);\n  if (address) {\n    const shopIds = Object.keys(cart.getItemsByShop());\n    shopIds.forEach((shopId) => {\n      Cart.update({\n        _id: cart._id\n      }, {\n        $push: {\n          shipping: {\n            shopId,\n            address\n          }\n        }\n      });\n    });\n  }\n}\n\nexport const methods = {\n  /**\n   * @name shipping/updateShipmentQuotes\n   * @method\n   * @memberof Methods/Shipping\n   * @summary Gets shipping rates and updates the users cart methods\n   * @todo Add orderId argument/fallback\n   * @param {String} cartId - cartId\n   * @return {undefined}\n   */\n  \"shipping/updateShipmentQuotes\"(cartId) {\n    check(cartId, String);\n    if (!cartId) {\n      return [];\n    }\n    this.unblock();\n    let cart = Cart.findOne(cartId);\n    CartSchema.validate(cart);\n\n    if (cart) {\n      if (!cart.shipping || cart.shipping.length === 0) {\n        addAddresses(cart);\n        cart = Cart.findOne(cartId);\n      }\n      const rates = Meteor.call(\"shipping/getShippingRates\", cart);\n      updateShippingRecordByShop(cart, rates);\n    }\n  },\n\n  /**\n   * @name shipping/getShippingRates\n   * @method\n   * @memberof Methods/Shipping\n   * @summary Just gets rates, without updating anything\n   * @param {Object} cart - cart object\n   * @return {Array} return updated rates in cart\n   */\n  \"shipping/getShippingRates\"(cart) {\n    CartSchema.validate(cart);\n    const rates = [];\n    const retrialTargets = [];\n    // must have items to calculate shipping\n    if (!cart.items || !cart.items.length) {\n      return rates;\n    }\n    // hooks for other shipping rate events\n    // all callbacks should return rates\n    Hooks.Events.run(\"onGetShippingRates\", [rates, retrialTargets], cart);\n\n    // Try once more.\n    if (retrialTargets.length > 0) {\n      Hooks.Events.run(\"onGetShippingRates\", [rates, retrialTargets], cart);\n\n      if (retrialTargets.length > 0) {\n        Logger.warn(\"Failed to get shipping methods from these packages:\", retrialTargets);\n      }\n    }\n\n    let newRates = rates.filter(({ requestStatus }) => requestStatus !== \"error\");\n    if (newRates.length === 0) {\n      newRates = [{\n        requestStatus: \"error\",\n        shippingProvider: \"all\",\n        message: \"All requests for shipping methods failed.\"\n      }];\n    }\n\n    Logger.debug(\"getShippingRates returning rates\", rates);\n    return newRates;\n  }\n};\n\nMeteor.methods(methods);\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { check, Match } from \"meteor/check\";\nimport { HTTP } from \"meteor/http\";\nimport { Job } from \"/imports/plugins/core/job-collection/lib\";\nimport { GeoCoder, Hooks, Logger } from \"/server/api\";\nimport { Reaction } from \"/lib/api\";\nimport * as Collections from \"/lib/collections\";\nimport * as Schemas from \"/lib/collections/schemas\";\n\n/**\n * @name cloneShop\n * @summary Returns an existing shop object, with some values removed or changed such\n *   that it is suitable for inserting as a new shop.\n * @method\n * @param {Object} shop - the shop to clone\n * @param {Object} partialShopData - any properties you'd like to override\n * @return {Object|null} The cloned shop object or null if a shop with that ID can't be found\n */\nfunction cloneShop(shop, partialShopData = {}) {\n  // if a name is not provided, generate a unique name\n  if (!partialShopData || !partialShopData.name) {\n    const count = Collections.Shops.find().count() || \"\";\n    shop.name += count;\n  }\n\n  // merge in the partial shop data and some other current user attributes\n  Object.assign(shop, partialShopData || {});\n\n  const cleanShop = Schemas.Shop.clean(shop);\n\n  // Never create a second primary shop\n  if (!cleanShop.shopType || cleanShop.shopType === \"primary\") {\n    cleanShop.shopType = \"merchant\";\n  }\n\n  // Clean up values that get automatically added\n  delete cleanShop._id;\n  delete cleanShop.createdAt;\n  delete cleanShop.updatedAt;\n  delete cleanShop.slug;\n  // TODO audience permissions need to be consolidated into [object] and not [string]\n  // permissions with [string] on layout ie. orders and checkout, cause the insert to fail\n  delete cleanShop.layout;\n  // delete brandAssets object from shop to prevent new shops from carrying over existing shop's\n  // brand image\n  delete cleanShop.brandAssets;\n\n  return cleanShop;\n}\n\n/**\n * @name updateShopBrandAssets\n * @method\n * @param {Object} asset - brand asset {mediaId: \"\", type, \"\"}\n * @param {String} shopId - the shop id coresponding to the shop for which\n *                 the asset should be applied (defaults to Reaction.getShopId())\n * @param {String} userId - the user id on whose behalf we are performing this\n *                 action (defaults to Meteor.userId())\n * @return {Int} returns update result\n */\nexport function updateShopBrandAssets(asset, shopId = Reaction.getShopId(), userId = Meteor.userId()) {\n  check(asset, {\n    mediaId: String,\n    type: String\n  });\n  check(shopId, String);\n\n  // must have core permissions\n  if (!Reaction.hasPermission(\"core\", userId, shopId)) {\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n\n  // Does our shop contain the brandasset we're tring to add\n  const shopWithBrandAsset = Collections.Shops.findOne({\n    \"_id\": shopId,\n    \"brandAssets.type\": asset.type\n  });\n\n  // If it does, then we update it with the new asset reference\n  if (shopWithBrandAsset) {\n    return Collections.Shops.update({\n      \"_id\": shopId,\n      \"brandAssets.type\": asset.type\n    }, {\n      $set: {\n        \"brandAssets.$\": {\n          mediaId: asset.mediaId,\n          type: asset.type\n        }\n      }\n    });\n  }\n\n  // Otherwise we insert a new brand asset reference\n  return Collections.Shops.update({\n    _id: shopId\n  }, {\n    $push: {\n      brandAssets: {\n        mediaId: asset.mediaId,\n        type: asset.type\n      }\n    }\n  });\n}\n\n/**\n * @file Meteor methods for Shop\n *\n *\n * @namespace Methods/Shop\n*/\nMeteor.methods({\n  /**\n   * @name shop/resetShopId\n   * @method\n   * @memberof Methods/Shop\n   * @summary a way for the client to notifiy the server that the shop has\n   *          changed. We could has provided #setShopId, however, the server\n   *          has all the information it needs to determine this on its own,\n   *          and allowing the client to set shopId could be a security risk\n   */\n  \"shop/resetShopId\"() {\n    return Reaction.resetShopId();\n  },\n\n  /**\n   * @name shop/createShop\n   * @method\n   * @memberof Methods/Shop\n   * @param {String} shopAdminUserId - optionally create shop for provided userId\n   * @param {Object} partialShopData - optionally provide a subset of shop data\n   *                 which will be merged with properties from the primary shop\n   *                 in order to create a document which meets the Shops schema\n   *                 requirements.\n   * @return {String} return shopId\n   */\n  \"shop/createShop\"(shopAdminUserId, partialShopData) {\n    check(shopAdminUserId, Match.Optional(String));\n    // It is not necessary to test whether shopData is valid against the Shops\n    // schema here, as shopData can be a subset of data. Later, shopData is\n    // combined with a copy of the Primary Shop to fill in the gaps. It is at\n    // that point that we validate/`check` that the combined object is valid\n    // against the Shops schema.\n    check(partialShopData, Match.Maybe(Object));\n\n    // Get the current marketplace settings\n    const marketplace = Reaction.getMarketplaceSettings();\n\n    // check to see if the current user has owner permissions for the primary shop\n    const hasPrimaryShopOwnerPermission = Reaction.hasPermission(\"owner\", Meteor.userId(), Reaction.getPrimaryShopId());\n\n    // only permit merchant signup if marketplace is enabled and allowMerchantSignup is enabled\n    let allowMerchantShopCreation = false;\n    if (marketplace && marketplace.enabled && marketplace.public && marketplace.public.allowMerchantSignup) {\n      allowMerchantShopCreation = true;\n    }\n\n    // must have owner access to create new shops when marketplace is disabled\n    if (!hasPrimaryShopOwnerPermission && !allowMerchantShopCreation) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Non-admin users may only create shops for themselves\n    if (!hasPrimaryShopOwnerPermission && shopAdminUserId !== Meteor.userId()) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Anonymous users should never be permitted to create a shop\n    if (!hasPrimaryShopOwnerPermission &&\n        Reaction.hasPermission(\"anonymous\", Meteor.userId(), Reaction.getPrimaryShopId())) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const currentUser = Meteor.user();\n    const currentAccount = Collections.Accounts.findOne({ _id: currentUser._id });\n    if (!currentUser) {\n      throw new Meteor.Error(\"server-error\", \"Unable to create shop without a user\");\n    }\n\n    let shopUser = currentUser;\n    let shopAccount = currentAccount;\n    // TODO: Create a grantable permission for creating shops so we can decouple ownership from shop creation\n    // Only marketplace owners can create shops for others\n    if (hasPrimaryShopOwnerPermission) {\n      shopUser = Meteor.users.findOne({ _id: shopAdminUserId }) || currentUser;\n      shopAccount = Collections.Accounts.findOne({ _id: shopAdminUserId }) || currentAccount;\n    }\n\n    const primaryShopId = Reaction.getPrimaryShopId();\n\n    // Disallow creation of multiple shops, even for marketplace owners\n    if (shopAccount.shopId !== primaryShopId) {\n      throw new Meteor.Error(\n        \"operation-not-permitted\",\n        \"This user already has a shop. Each user may only have one shop.\"\n      );\n    }\n\n    const shop = cloneShop(Reaction.getPrimaryShop(), partialShopData);\n\n    shop.emails = shopUser.emails;\n    shop.addressBook = shopAccount.addressBook;\n\n    Collections.Shops.simpleSchema(shop).validate(shop);\n\n    let newShopId;\n\n    try {\n      newShopId = Collections.Shops.insert(shop);\n    } catch (error) {\n      return Logger.error(error, \"Failed to shop/createShop\");\n    }\n\n    const newShop = Collections.Shops.findOne({ _id: newShopId });\n\n    // we should have created new shop, or errored\n    Logger.info(\"Created shop: \", newShopId);\n\n    // update user\n    Reaction.insertPackagesForShop(newShopId);\n    Reaction.createGroups({ shopId: newShopId });\n    const ownerGroup = Collections.Groups.findOne({ slug: \"owner\", shopId: newShopId });\n    Roles.addUsersToRoles([currentUser, shopUser._id], ownerGroup.permissions, newShopId);\n    // Set the active shopId for this user\n    Reaction.setUserPreferences(\"reaction\", \"activeShopId\", newShopId, shopUser._id);\n    Collections.Accounts.update({ _id: shopUser._id }, {\n      $set: {\n        shopId: newShopId\n      },\n      $addToSet: {\n        groups: ownerGroup._id\n      }\n    });\n    Hooks.Events.run(\"afterAccountsUpdate\", currentUser._id, {\n      accountId: shopUser._id,\n      updatedFields: [\"groups\"]\n    });\n    // Add this shop to the merchant\n    Collections.Shops.update({ _id: primaryShopId }, {\n      $addToSet: {\n        merchantShops: {\n          _id: newShopId,\n          slug: newShop.slug,\n          name: newShop.name\n        }\n      }\n    });\n\n    // Set active shop to new shop.\n    return { shopId: newShopId };\n  },\n\n  /**\n   * @name shop/getLocale\n   * @method\n   * @memberof Methods/Shop\n   * @summary determine user's countryCode and return locale object\n   * determine local currency and conversion rate from shop currency\n   * @return {Object} returns user location and locale\n   */\n  \"shop/getLocale\"() {\n    this.unblock();\n    let clientAddress;\n    const geo = new GeoCoder();\n    const result = {};\n    let defaultCountryCode = \"US\";\n    let localeCurrency = \"USD\";\n    // if called from server, ip won't be defined.\n    if (this.connection !== null) {\n      ({ clientAddress } = this.connection);\n    } else {\n      clientAddress = \"127.0.0.1\";\n    }\n\n    // get shop locale/currency related data\n    const shop = Collections.Shops.findOne(Reaction.getShopId(), {\n      fields: {\n        addressBook: 1,\n        locales: 1,\n        currencies: 1,\n        currency: 1\n      }\n    });\n\n    if (!shop) {\n      throw new Meteor.Error(\"not-found\", \"Failed to find shop data. Unable to determine locale.\");\n    }\n    // configure default defaultCountryCode\n    // fallback to shop settings\n    if (shop.addressBook) {\n      if (shop.addressBook.length >= 1) {\n        if (shop.addressBook[0].country) {\n          defaultCountryCode = shop.addressBook[0].country;\n        }\n      }\n    }\n    // geocode reverse ip lookup\n    const geoCountryCode = geo.geoip(clientAddress).country_code;\n\n    // countryCode either from geo or defaults\n    const countryCode = (geoCountryCode || defaultCountryCode).toUpperCase();\n\n    // get currency rates\n    result.currency = {};\n    result.locale = shop.locales.countries[countryCode];\n\n    // to return default currency if rates will failed, we need to bring access\n    // to this data\n    result.shopCurrency = shop.currencies[shop.currency];\n\n    // check if locale has a currency defined\n    if (typeof result.locale === \"object\" &&\n      typeof result.locale.currency === \"string\") {\n      localeCurrency = result.locale.currency.split(\",\");\n    }\n\n    // localeCurrency is an array of allowed currencies\n    _.each(localeCurrency, (currency) => {\n      let exchangeRate;\n      if (shop.currencies[currency]) {\n        result.currency = shop.currencies[currency];\n        // only fetch rates if locale and shop currency are not equal\n        // if shop.currency = locale currency the rate is 1\n        if (shop.currency !== currency) {\n          const settings = Reaction.getShopSettings();\n          const exchangeConfig = settings.openexchangerates || {};\n\n          if (exchangeConfig.appId) {\n            exchangeRate = Meteor.call(\"shop/getCurrencyRates\", currency);\n\n            if (typeof exchangeRate === \"number\") {\n              result.currency.exchangeRate = exchangeRate;\n            } else {\n              Logger.warn(\"Failed to get currency exchange rates.\");\n            }\n          }\n        }\n      }\n    });\n\n    // adjust user currency\n    const user = Collections.Accounts.findOne({\n      _id: Meteor.userId()\n    });\n    let profileCurrency = user.profile && user.profile.currency;\n    if (!profileCurrency) {\n      [localeCurrency] = localeCurrency;\n      if (shop.currencies[localeCurrency] && shop.currencies[localeCurrency].enabled) {\n        profileCurrency = localeCurrency;\n      } else {\n        [profileCurrency] = shop.currency.split(\",\");\n      }\n\n      Meteor.call(\"accounts/setProfileCurrency\", profileCurrency);\n    }\n\n    // set server side locale\n    Reaction.Locale = result;\n\n    // should contain rates, locale, currency\n    return result;\n  },\n\n  /**\n   * @name shop/getCurrencyRates\n   * @method\n   * @memberof Methods/Shop\n   * @summary It returns the current exchange rate against the shop currency\n   * usage: Meteor.call(\"shop/getCurrencyRates\",\"USD\")\n   * @param {String} currency code\n   * @return {Number|Object} currency conversion rate\n   */\n  \"shop/getCurrencyRates\"(currency) {\n    check(currency, String);\n    this.unblock();\n\n    const field = `currencies.${currency}.rate`;\n    const shop = Collections.Shops.findOne(Reaction.getShopId(), {\n      fields: {\n        [field]: 1\n      }\n    });\n\n    return typeof shop.currencies[currency].rate === \"number\" &&\n      shop.currencies[currency].rate;\n  },\n\n  /**\n   * @name shop/fetchCurrencyRate\n   * @method\n   * @memberof Methods/Shop\n   * @summary fetch the latest currency rates from\n   * https://openexchangerates.org\n   * usage: Meteor.call(\"shop/fetchCurrencyRate\")\n   * @fires Collections.Shops#update\n   * @returns {undefined}\n   */\n  \"shop/fetchCurrencyRate\"() {\n    this.unblock();\n\n    const shopId = Reaction.getShopId();\n    const shop = Collections.Shops.findOne(shopId, {\n      fields: {\n        addressBook: 1,\n        locales: 1,\n        currencies: 1,\n        currency: 1\n      }\n    });\n    const baseCurrency = shop.currency || \"USD\";\n    const shopCurrencies = shop.currencies;\n\n    // fetch shop settings for api auth credentials\n    const shopSettings = Collections.Packages.findOne({\n      shopId,\n      name: \"core\"\n    }, {\n      fields: {\n        settings: 1\n      }\n    });\n\n    // update Shops.currencies[currencyKey].rate\n    // with current rates from Open Exchange Rates\n    // warn if we don't have app_id\n    if (!shopSettings.settings.openexchangerates) {\n      throw new Meteor.Error(\n        \"not-configured\",\n        \"Open Exchange Rates not configured. Configure for current rates.\"\n      );\n    } else if (!shopSettings.settings.openexchangerates.appId) {\n      throw new Meteor.Error(\n        \"not-configured\",\n        \"Open Exchange Rates AppId not configured. Configure for current rates.\"\n      );\n    } else {\n      // shop open exchange rates appId\n      const openexchangeratesAppId = shopSettings.settings.openexchangerates.appId;\n\n      // we'll update all the available rates in Shops.currencies whenever we\n      // get a rate request, using base currency\n      const rateUrl =\n              `https://openexchangerates.org/api/latest.json?base=${\n                baseCurrency}&app_id=${openexchangeratesAppId}`;\n      let rateResults;\n\n      // We can get an error if we try to change the base currency with a simple\n      // account\n      try {\n        rateResults = HTTP.get(rateUrl);\n      } catch (error) {\n        if (error.error) {\n          Logger.error(error.message);\n          throw new Meteor.Error(\"server-error\", error.message);\n        } else {\n          // https://openexchangerates.org/documentation#errors\n          throw new Meteor.Error(\"server-error\", error.response.data.description);\n        }\n      }\n\n      const exchangeRates = rateResults.data.rates;\n\n      _.each(shopCurrencies, (currencyConfig, currencyKey) => {\n        if (exchangeRates[currencyKey] !== undefined) {\n          const rateUpdate = {\n            // this needed for shop/flushCurrencyRates Method\n            \"currencies.updatedAt\": new Date(rateResults.data.timestamp * 1000)\n          };\n          const collectionKey = `currencies.${currencyKey}.rate`;\n          rateUpdate[collectionKey] = exchangeRates[currencyKey];\n          Collections.Shops.update(shopId, {\n            $set: rateUpdate\n          });\n        }\n      });\n    }\n  },\n\n  /**\n   * @name shop/flushCurrencyRate\n   * @method\n   * @memberof Methods/Shop\n   * @description Method calls by cron job\n   * @summary It removes exchange rates that are too old\n   * usage: Meteor.call(\"shop/flushCurrencyRate\")\n   * @fires Collections.Shops#update\n   * @returns {undefined}\n   */\n  \"shop/flushCurrencyRate\"() {\n    this.unblock();\n\n    let shopId;\n    const marketplaceSettings = Reaction.getMarketplaceSettings();\n\n    if (marketplaceSettings && marketplaceSettings.public && marketplaceSettings.public.merchantLocale) {\n      shopId = Reaction.getShopId();\n    } else {\n      shopId = Reaction.getPrimaryShopId();\n    }\n\n    const shop = Collections.Shops.findOne(shopId, {\n      fields: {\n        currencies: 1\n      }\n    });\n    const { updatedAt } = shop.currencies;\n\n    // if updatedAt is not a Date(), then there is no rates yet\n    if (typeof updatedAt !== \"object\") {\n      throw new Meteor.Error(\n        \"error-occurred\",\n        \"[flushCurrencyRates worker]: There is nothing to flush.\"\n      );\n    }\n\n    updatedAt.setHours(updatedAt.getHours() + 48);\n    const now = new Date();\n\n    if (now < updatedAt) { // todo remove this line. its for tests\n      _.each(shop.currencies, (currencyConfig, currencyKey) => {\n        const rate = `currencies.${currencyKey}.rate`;\n\n        if (typeof currencyConfig.rate === \"number\") {\n          Collections.Shops.update(shopId, {\n            $unset: {\n              [rate]: \"\"\n            }\n          });\n        }\n      });\n    }\n  },\n\n  /**\n   * @name shop/updateShopExternalServices\n   * @method\n   * @memberof Methods/Shop\n   * @description On submit OpenExchangeRatesForm handler\n   * @summary we need to rerun fetch exchange rates job on every form submit,\n   * that's why we update autoform type to \"method-update\"\n   * @param {Object} details An object with _id and modifier props\n   * @fires Collections.Packages#update\n   * @todo This method fires Packages collection, so maybe someday it could be moved to another file\n   * @returns {undefined}\n   */\n  \"shop/updateShopExternalServices\"(details) {\n    check(details, {\n      _id: String,\n      modifier: Object // actual schema validation happens below\n    });\n\n    const { _id, modifier } = details;\n    Schemas.CorePackageConfig.validate(modifier, { modifier: true });\n\n    // must have core permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    this.unblock();\n\n    // we should run new job on every form change, even if not all of them will\n    // change currencyRate job\n    const refreshPeriod = modifier.$set[\"settings.openexchangerates.refreshPeriod\"];\n    const fetchCurrencyRatesJob = new Job(Collections.Jobs, \"shop/fetchCurrencyRates\", {})\n      .priority(\"normal\")\n      .retry({\n        retries: 5,\n        wait: 60000,\n        backoff: \"exponential\" // delay by twice as long for each subsequent retry\n      })\n      .repeat({\n        // wait: refreshPeriod * 60 * 1000\n        schedule: Collections.Jobs.later.parse.text(refreshPeriod)\n      })\n      .save({\n        // Cancel any jobs of the same type,\n        // but only if this job repeats forever.\n        cancelRepeats: true\n      });\n\n    Collections.Packages.update(_id, modifier);\n    return fetchCurrencyRatesJob;\n  },\n\n  /**\n   * @name shop/locateAddress\n   * @method\n   * @memberof Methods/Shop\n   * @summary determine user's full location for autopopulating addresses\n   * @param {Number} latitude - latitude\n   * @param {Number} longitude - longitude\n   * @return {Object} returns address\n   */\n  \"shop/locateAddress\"(latitude, longitude) {\n    check(latitude, Match.Optional(Number));\n    check(longitude, Match.Optional(Number));\n    let clientAddress;\n    this.unblock();\n\n    // if called from server, ip won't be defined.\n    if (this.connection !== null) {\n      ({ clientAddress } = this.connection);\n    } else {\n      clientAddress = \"127.0.0.1\";\n    }\n\n    // begin actual address lookups\n    if (latitude !== null && longitude !== null) {\n      const geo = new GeoCoder();\n      return geo.reverse(latitude, longitude);\n    }\n    // geocode reverse ip lookup\n    const geo = new GeoCoder();\n    return geo.geoip(clientAddress);\n  },\n\n  /**\n   * @name shop/createTag\n   * @method\n   * @memberof Methods/Shop\n   * @summary creates new tag\n   * @param {String} tagName - new tag name\n   * @param {Boolean} isTopLevel - if true -- new tag will be created on top of\n   * tags tree\n   * @since 0.14.0\n   * @hooks after method\n   * @return {String} with created tag _id\n   */\n  \"shop/createTag\"(tagName, isTopLevel) {\n    check(tagName, String);\n    check(isTopLevel, Boolean);\n\n    // must have 'core' permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const tag = {\n      name: tagName,\n      slug: Reaction.getSlug(tagName),\n      isTopLevel,\n      updatedAt: new Date(),\n      createdAt: new Date()\n    };\n\n    return Collections.Tags.insert(tag);\n  },\n\n  /**\n   * @name shop/updateHeaderTags\n   * @method\n   * @memberof Methods/Shop\n   * @summary method to insert or update tag with hierarchy\n   * @param {String} tagName will insert, tagName + tagId will update existing\n   * @param {String} tagId - tagId to update\n   * @param {String} currentTagId - currentTagId will update related/hierarchy\n   * @return {Boolean} return true/false after insert\n   */\n  \"shop/updateHeaderTags\"(tagName, tagId, currentTagId) {\n    check(tagName, String);\n    check(tagId, Match.OneOf(String, null, undefined));\n    check(currentTagId, Match.OneOf(String, null, undefined));\n\n    let newTagId = {};\n    // must have 'core' permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    this.unblock();\n\n    const newTag = {\n      slug: Reaction.getSlug(tagName),\n      name: tagName\n    };\n\n    const existingTag = Collections.Tags.findOne({\n      slug: Reaction.getSlug(tagName),\n      name: tagName\n    });\n\n    let result;\n\n    if (tagId) {\n      result = Collections.Tags.update(tagId, { $set: newTag });\n      Logger.debug(`Changed name of tag ${tagId} to ${tagName}`);\n      return result;\n    }\n\n    if (existingTag) {\n      // if is currentTag\n      if (currentTagId) {\n        result = Collections.Tags.update(currentTagId, {\n          $addToSet: {\n            relatedTagIds: existingTag._id\n          }\n        });\n        Logger.debug(`Added tag ${existingTag.name} to the related tags list for tag ${currentTagId}`);\n        return result;\n      }\n\n      // update existing tag\n      result = Collections.Tags.update(existingTag._id, {\n        $set: {\n          isTopLevel: true\n        }\n      });\n      Logger.debug(`Marked tag ${existingTag.name} as a top level tag`);\n      return result;\n    }\n\n    // create newTags\n    newTagId = Meteor.call(\"shop/createTag\", tagName, !currentTagId);\n\n    // if result is an Error object, we return it immediately\n    if (typeof newTagId !== \"string\") return newTagId;\n\n    if (currentTagId) {\n      result = Collections.Tags.update(currentTagId, {\n        $addToSet: {\n          relatedTagIds: newTagId\n        }\n      });\n      Logger.debug(`Added tag${newTag.name} to the related tags list for tag ${currentTagId}`);\n      return result;\n    }\n\n    // TODO: refactor this. unnecessary check\n    if (typeof newTagId === \"string\" && !currentTagId) return true;\n\n    throw new Meteor.Error(\"access-denied\", \"Failed to update header tags.\");\n  },\n\n  /**\n   * @name shop/removeHeaderTag\n   * @method\n   * @memberof Methods/Shop\n   * @param {String} tagId - method to remove tag navigation tags\n   * @param {String} currentTagId - currentTagId\n   * @return {String} returns remove result\n   */\n  \"shop/removeHeaderTag\"(tagId, currentTagId) {\n    check(tagId, String);\n    check(currentTagId, String);\n    // must have core permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    this.unblock();\n    // remove from related tag use\n    Collections.Tags.update(currentTagId, {\n      $pull: {\n        relatedTagIds: tagId\n      }\n    });\n    // check to see if tag is in use.\n    const productCount = Collections.Products.find({\n      hashtags: tagId\n    }).count();\n    // check to see if in use as a related tag\n    const relatedTagsCount = Collections.Tags.find({\n      relatedTagIds: tagId\n    }).count();\n    // not in use anywhere, delete it\n    if (productCount === 0 && relatedTagsCount === 0) {\n      return Collections.Tags.remove(tagId);\n    }\n    // unable to delete anything\n    throw new Meteor.Error(\"access-denied\", \"Unable to delete tags that are in use.\");\n  },\n\n  /**\n   * @name shop/hideHeaderTag\n   * @method\n   * @memberof Methods/Shop\n   * @param {String} tagId - method to remove tag navigation tags\n   * @return {String} returns remove result\n   */\n  \"shop/hideHeaderTag\"(tagId) {\n    check(tagId, String);\n    // must have core permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    this.unblock();\n    // hide it\n    return Collections.Tags.update({\n      _id: tagId\n    }, {\n      $set: {\n        isTopLevel: false\n      }\n    });\n  },\n\n  /**\n   * @name shop/getWorkflow\n   * @method\n   * @memberof Methods/Shop\n   * @summary gets the current shop workflows\n   * @param {String} name - workflow name\n   * @return {Array} returns workflow array\n   */\n  \"shop/getWorkflow\"(name) {\n    check(name, String);\n\n    const shopWorkflows = Collections.Shops.findOne({\n      defaultWorkflows: {\n        $elemMatch: {\n          provides: name\n        }\n      }\n    }, {\n      fields: {\n        defaultWorkflows: true\n      }\n    });\n    return shopWorkflows;\n  },\n\n  /**\n   * @name shop/updateLanguageConfiguration\n   * @method\n   * @memberof Methods/Shop\n   * @summary enable / disable a language\n   * @param {String} language - language name | \"all\" to bulk enable / disable\n   * @param {Boolean} enabled - true / false\n   * @return {Array} returns workflow array\n   */\n  \"shop/updateLanguageConfiguration\"(language, enabled) {\n    check(language, String);\n    check(enabled, Boolean);\n\n    // must have core permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    this.unblock();\n\n    const shop = Collections.Shops.findOne({\n      _id: Reaction.getShopId()\n    });\n\n    const defaultLanguage = shop.language;\n\n    if (language === \"all\") {\n      const updateObject = {};\n\n      if (Array.isArray(shop.languages)) {\n        shop.languages.forEach((languageData, index) => {\n          if (languageData.i18n === defaultLanguage) {\n            updateObject[`languages.${index}.enabled`] = true;\n          } else {\n            updateObject[`languages.${index}.enabled`] = enabled;\n          }\n        });\n      }\n      return Collections.Shops.update({\n        _id: Reaction.getShopId()\n      }, {\n        $set: updateObject\n      });\n    } else if (language === defaultLanguage) {\n      return Collections.Shops.update({\n        \"_id\": Reaction.getShopId(),\n        \"languages.i18n\": language\n      }, {\n        $set: {\n          \"languages.$.enabled\": true\n        }\n      });\n    }\n\n    return Collections.Shops.update({\n      \"_id\": Reaction.getShopId(),\n      \"languages.i18n\": language\n    }, {\n      $set: {\n        \"languages.$.enabled\": enabled\n      }\n    });\n  },\n\n  /**\n   * @name shop/updateCurrencyConfiguration\n   * @method\n   * @memberof Methods/Shop\n   * @summary enable / disable a currency\n   * @param {String} currency - currency name | \"all\" to bulk enable / disable\n   * @param {Boolean} enabled - true / false\n   * @return {Number} returns mongo update result\n   */\n  \"shop/updateCurrencyConfiguration\"(currency, enabled) {\n    check(currency, String);\n    check(enabled, Boolean);\n    // must have core permissions\n    if (!Reaction.hasPermission(\"core\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    this.unblock();\n\n    const shop = Collections.Shops.findOne({\n      _id: Reaction.getShopId()\n    });\n\n    const defaultCurrency = shop.currency;\n\n    if (currency === \"all\") {\n      const updateObject = {};\n      for (const currencyName in shop.currencies) {\n        if ({}.hasOwnProperty.call(shop.currencies, currencyName) && currencyName !== \"updatedAt\") {\n          if (currencyName === defaultCurrency) {\n            updateObject[`currencies.${currencyName}.enabled`] = true;\n          } else {\n            updateObject[`currencies.${currencyName}.enabled`] = enabled;\n          }\n        }\n      }\n\n      return Collections.Shops.update({\n        _id: Reaction.getShopId()\n      }, {\n        $set: updateObject\n      });\n    } else if (currency === defaultCurrency) {\n      return Collections.Shops.update({\n        _id: Reaction.getShopId()\n      }, {\n        $set: {\n          [`currencies.${currency}.enabled`]: true\n        }\n      });\n    }\n\n    return Collections.Shops.update({\n      _id: Reaction.getShopId()\n    }, {\n      $set: {\n        [`currencies.${currency}.enabled`]: enabled\n      }\n    });\n  },\n\n  /**\n   * @name shop/updateBrandAsset\n   * @method\n   * @memberof Methods/Shop\n   * @param {Object} asset - brand asset {mediaId: \"\", type, \"\"}\n   * @return {Int} returns update result\n   */\n  \"shop/updateBrandAssets\"(asset) {\n    check(asset, {\n      mediaId: String,\n      type: String\n    });\n\n    this.unblock();\n\n    return updateShopBrandAssets(asset);\n  },\n\n  /**\n   * @name shop/togglePackage\n   * @method\n   * @memberof Methods/Shop\n   * @summary enable/disable Reaction package\n   * @param {String} packageId - package _id\n   * @param {Boolean} enabled - current package `enabled` state\n   * @return {Number} mongo update result\n   */\n  \"shop/togglePackage\"(packageId, enabled) {\n    check(packageId, String);\n    check(enabled, Boolean);\n    if (!Reaction.hasAdminAccess()) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return Collections.Packages.update(packageId, {\n      $set: {\n        enabled: !enabled\n      }\n    });\n  },\n\n  /**\n   * @name shop/changeLayout\n   * @method\n   * @memberof Methods/Shop\n   * @summary Change the layout for all workflows so you can use a custom one\n   * @param {String} shopId - the shop's ID\n   * @param {String} newLayout - new layout to use\n   * @return {Number} mongo update result\n   */\n  \"shop/changeLayouts\"(shopId, newLayout) {\n    check(shopId, String);\n    check(newLayout, String);\n    const shop = Collections.Shops.findOne(shopId);\n    for (let i = 0; i < shop.layout.length; i += 1) {\n      shop.layout[i].layout = newLayout;\n    }\n    return Collections.Shops.update(shopId, {\n      $set: { layout: shop.layout }\n    });\n  },\n\n\n  /**\n   * @name shop/getBaseLanguage\n   * @method\n   * @memberof Methods/Shop\n   * @summary Return the shop's base language ISO code\n   * @return {String} ISO lang code\n   */\n  \"shop/getBaseLanguage\"() {\n    if (!Reaction.hasPermission()) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const shopId = Reaction.getShopId();\n    return Collections.Shops.findOne(shopId).language;\n  }\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Accounts } from \"meteor/accounts-base\";\nimport { Reaction, Logger } from \"/server/api\";\n\n/**\n * @name accounts/sendResetPasswordEmail\n * @memberof Methods/Accounts\n * @method\n * @example Meteor.call(\"accounts/sendResetPasswordEmail\", options)\n * @summary Send reset password email\n * @param {Object} options\n * @param {String} options.email - email of user\n * @returns {false}\n */\nMeteor.methods({\n  \"accounts/sendResetPasswordEmail\"(options) {\n    check(options, {\n      email: String\n    });\n\n    const user = Accounts.findUserByEmail(options.email);\n\n    if (!user) {\n      Logger.error(\"accounts/sendResetPasswordEmail - User not found\");\n      throw new Meteor.Error(\"not-found\", \"User not found\");\n    }\n\n    const emails = _.map(user.emails || [], \"address\");\n\n    const caseInsensitiveEmail = _.find(emails, (email) => email.toLowerCase() === options.email.toLowerCase());\n\n    Reaction.Accounts.sendResetPasswordEmail(user._id, caseInsensitiveEmail);\n  }\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Random } from \"meteor/random\";\nimport { Accounts as MeteorAccounts } from \"meteor/accounts-base\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { SSR } from \"meteor/meteorhacks:ssr\";\nimport { Accounts, Cart, Groups, Shops, Packages } from \"/lib/collections\";\nimport * as Schemas from \"/lib/collections/schemas\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\nimport { sendUpdatedVerificationEmail } from \"/server/api/core/accounts\";\n\n/**\n * @file Extends Meteor's {@link https://github.com/meteor/meteor/tree/master/packages/accounts-base Accounts-Base}\n * with methods for Reaction-specific behavior and user interaction. Run these methods using: `Meteor.call()`\n * @example Meteor.call(\"accounts/verifyAccount\", email, token)\n * @namespace Methods/Accounts\n */\n\n/**\n * @name accounts/verifyAccount\n * @memberof Methods/Accounts\n * @method\n * @summary Verifies the email address in account document (if user verification in users collection was successful already)\n * @example Meteor.call(\"accounts/verifyAccount\")\n * @returns {Boolean} - returns true on success\n */\nexport function verifyAccount() {\n  if (!this.userId) {\n    // not logged in\n    return;\n  }\n\n  const user = Meteor.user();\n  const addresses = user.emails\n    .filter((email) => email.verified)\n    .map((email) => email.address);\n  const result = Accounts.update({\n    \"userId\": this.userId,\n    \"emails.address\": { $in: addresses }\n  }, {\n    $set: {\n      \"emails.$.verified\": true\n    }\n  });\n\n  if (result) {\n    Hooks.Events.run(\n      \"afterAccountsUpdate\",\n      this.userId, {\n        accountId: Accounts.findOne({ userId: this.userId })._id,\n        updatedFields: [\"emails\"]\n      }\n    );\n  }\n  return result;\n}\n\n/**\n * @name accounts/updateEmailAddress\n * @memberof Methods/Accounts\n * @method\n * @summary Update a user's email address\n * @param {String} email - user email\n * @returns {Boolean} - return True on success\n */\nexport function updateEmailAddress(email) {\n  check(email, String);\n  const user = Meteor.user();\n\n  // Add email to user account\n  MeteorAccounts.addEmail(user._id, email);\n\n  return true;\n}\n\n/**\n * @name accounts/removeEmailAddress\n * @memberof Methods/Accounts\n * @method\n * @summary Remove a user's email address.\n * @param {String} email - user email.\n * @returns {Boolean} - returns boolean.\n */\nexport function removeEmailAddress(email) {\n  check(email, String);\n\n  const user = Meteor.user();\n\n  // Remove email address from user\n  MeteorAccounts.removeEmail(user._id, email);\n\n  // Verify new address\n  sendUpdatedVerificationEmail(user._id);\n\n  // Sync users and accounts collections\n  syncUsersAndAccounts();\n\n  return true;\n}\n\n/**\n * @name accounts/syncUsersAndAccounts\n * @memberof Methods/Accounts\n * @method\n * @summary Syncs emails associated with a user profile between the Users and Accounts collections.\n * @returns {Boolean} - returns boolean.\n */\nexport function syncUsersAndAccounts() {\n  const user = Meteor.user();\n\n  Accounts.update({\n    _id: user._id\n  }, {\n    $set: {\n      emails: [\n        user.emails[0]\n      ]\n    }\n  });\n  Hooks.Events.run(\"afterAccountsUpdate\", user._id, {\n    accountId: user._id,\n    updatedFields: [\"emails\"]\n  });\n\n  return true;\n}\n\n/**\n * @name getValidator\n * @summary Returns the name of the geocoder method to use\n * @returns {string} Name of the Geocoder method to use\n * @private\n */\nfunction getValidator() {\n  const shopId = Reaction.getShopId();\n  const geoCoders = Packages.find({\n    \"registry\": { $elemMatch: { provides: \"addressValidation\" } },\n    \"settings.addressValidation.enabled\": true,\n    shopId,\n    \"enabled\": true\n  }).fetch();\n\n  if (!geoCoders.length) {\n    return \"\";\n  }\n  let geoCoder;\n  // Just one?, use that one\n  if (geoCoders.length === 1) {\n    [geoCoder] = geoCoders;\n  }\n  // If there are two, we default to the one that is not the Reaction one\n  if (geoCoders.length === 2) {\n    geoCoder = geoCoders.find((coder) => !coder.name.includes(\"reaction\"));\n  }\n\n  // check if addressValidation is enabled but the package is disabled, don't do address validation\n  let registryName;\n  for (const registry of geoCoder.registry) {\n    if (registry.provides && registry.provides.includes(\"addressValidation\")) {\n      registryName = registry.name;\n    }\n  }\n  const packageKey = registryName.split(\"/\")[2]; // \"taxes/addressValidation/{packageKey}\"\n  if (!_.get(geoCoder.settings[packageKey], \"enabled\")) {\n    return \"\";\n  }\n\n  const methodName = geoCoder.settings.addressValidation.addressValidationMethod;\n  return methodName;\n}\n\n/**\n * @name compareAddress\n * @summary Compare individual fields of address and accumulate errors\n * @param {Object} address - the address provided by the customer\n * @param {Object} validationAddress - address provided by validator\n * @returns {Object} An object with an array of errors per field\n * @private\n */\nfunction compareAddress(address, validationAddress) {\n  const errors = {\n    address1: [],\n    address2: [],\n    city: [],\n    postal: [],\n    region: [],\n    country: [],\n    totalErrors: 0\n  };\n  // first check, if a field is missing (and was present in original address), that means it didn't validate\n  // TODO rewrite with just a loop over field names but KISS for now\n  if (address.address1 && !validationAddress.address1) {\n    errors.address1.push(\"Address line one did not validate\");\n    errors.totalErrors += 1;\n  }\n\n  if (address.address2 && validationAddress.address2 && _.trim(_.upperCase(address.address2)) !== _.trim(_.upperCase(validationAddress.address2))) {\n    errors.address2.push(\"Address line 2 did not validate\");\n    errors.totalErrors += 1;\n  }\n\n  if (!validationAddress.city) {\n    errors.city.push(\"City did not validate\");\n    errors.totalErrors += 1;\n  }\n  if (address.postal && !validationAddress.postal) {\n    errors.postal.push(\"Postal did not validate\");\n    errors.totalErrors += 1;\n  }\n\n  if (address.region && !validationAddress.region) {\n    errors.region.push(\"Region did not validate\");\n    errors.totalErrors += 1;\n  }\n\n  if (address.country && !validationAddress.country) {\n    errors.country.push(\"Country did not validate\");\n    errors.totalErrors += 1;\n  }\n  // second check if both fields exist, but they don't match (which almost always happen for certain fields on first time)\n  if (validationAddress.address1 && address.address1 && _.trim(_.upperCase(address.address1)) !== _.trim(_.upperCase(validationAddress.address1))) {\n    errors.address1.push({ address1: \"Address line 1 did not match\" });\n    errors.totalErrors += 1;\n  }\n\n  if (validationAddress.address2 && address.address2 && (_.upperCase(address.address2) !== _.upperCase(validationAddress.address2))) {\n    errors.address2.push(\"Address line 2 did not match\");\n    errors.totalErrors += 1;\n  }\n\n  if (validationAddress.city && address.city && _.trim(_.upperCase(address.city)) !== _.trim(_.upperCase(validationAddress.city))) {\n    errors.city.push(\"City did not match\");\n    errors.totalErrors += 1;\n  }\n\n  if (validationAddress.postal && address.postal && _.trim(_.upperCase(address.postal)) !== _.trim(_.upperCase(validationAddress.postal))) {\n    errors.postal.push(\"Postal Code did not match\");\n    errors.totalErrors += 1;\n  }\n\n  if (validationAddress.region && address.region && _.trim(_.upperCase(address.region)) !== _.trim(_.upperCase(validationAddress.region))) {\n    errors.region.push(\"Region did not match\");\n    errors.totalErrors += 1;\n  }\n\n  if (validationAddress.country && address.country && _.upperCase(address.country) !== _.upperCase(validationAddress.country)) {\n    errors.country.push(\"Country did not match\");\n    errors.totalErrors += 1;\n  }\n  return errors;\n}\n\n/**\n * @name accounts/validateAddress\n * @memberof Methods/Accounts\n * @method\n * @summary Validates an address, and if fails returns details of issues\n * @param {Object} address - The address object to validate\n * @returns {{validated: boolean, address: *}} - The results of the validation\n */\nexport function validateAddress(address) {\n  Schemas.Address.clean(address);\n  Schemas.Address.validate(address);\n\n  let validated = true;\n  let validationErrors;\n  let suggestedAddress = {};\n  let formErrors;\n  const validator = getValidator();\n  if (validator) {\n    const validationResult = Meteor.call(validator, address);\n    ({ validatedAddress: suggestedAddress } = validationResult);\n    formErrors = validationResult.errors;\n    if (suggestedAddress) {\n      validationErrors = compareAddress(address, suggestedAddress);\n      if (validationErrors.totalErrors || formErrors.length) {\n        validated = false;\n        suggestedAddress.failedValidation = true;\n      }\n    } else {\n      // No address, fail validation\n      validated = false;\n      suggestedAddress = {\n        failedValidation: true\n      };\n    }\n  }\n  suggestedAddress = { ...address, ...suggestedAddress };\n  const validationResults = { validated, fieldErrors: validationErrors, formErrors, suggestedAddress, enteredAddress: address };\n  return validationResults;\n}\n\n/**\n * @name currentUserHasPassword\n * @summary Check if current user has password\n * @returns {Boolean} True if current user has password\n * @private\n */\nfunction currentUserHasPassword() {\n  const user = Meteor.users.findOne(Meteor.userId());\n  return !!user.services.password;\n}\n\n/**\n * @name accounts/addressBookAdd\n * @memberof Methods/Accounts\n * @method\n * @summary Add new addresses to an account\n * @example Meteor.call(\"accounts/addressBookAdd\", address, callBackFunction(error, result))\n * @param {Object} address - address\n * @param {String} [accountUserId] - `account.userId` used by admin to edit users\n * @return {Object} with updated address\n */\nexport function addressBookAdd(address, accountUserId) {\n  Schemas.Address.validate(address);\n  check(accountUserId, Match.Optional(String));\n  // security, check for admin access. We don't need to check every user call\n  // here because we are calling `Meteor.userId` from within this Method.\n  if (typeof accountUserId === \"string\") { // if this will not be a String -\n    // `check` will not pass it.\n    if (Meteor.userId() !== accountUserId && !Reaction.hasPermission(\"reaction-accounts\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n  }\n  this.unblock();\n\n  const userId = accountUserId || Meteor.userId();\n  const account = Accounts.findOne({\n    userId\n  });\n  // required default id\n  if (!address._id) {\n    address._id = Random.id();\n  }\n  // if address got shippment or billing default, we need to update cart\n  // addresses accordingly\n  if (address.isShippingDefault || address.isBillingDefault) {\n    const cart = Cart.findOne({ userId });\n    // if cart exists\n    // First amend the cart,\n    if (typeof cart === \"object\") {\n      if (address.isShippingDefault) {\n        Meteor.call(\"cart/setShipmentAddress\", cart._id, address);\n      }\n      if (address.isBillingDefault) {\n        Meteor.call(\"cart/setPaymentAddress\", cart._id, address);\n      }\n    }\n    // then change the address that has been affected\n    if (address.isShippingDefault) {\n      Accounts.update({\n        userId,\n        \"profile.addressBook.isShippingDefault\": true\n      }, {\n        $set: {\n          \"profile.addressBook.$.isShippingDefault\": false\n        }\n      });\n      Hooks.Events.run(\"afterAccountsUpdate\", Meteor.userId(), {\n        accountId: account._id,\n        updatedFields: [\"isShippingDefault\"]\n      });\n    }\n    if (address.isBillingDefault) {\n      Accounts.update({\n        userId,\n        \"profile.addressBook.isBillingDefault\": true\n      }, {\n        $set: {\n          \"profile.addressBook.$.isBillingDefault\": false\n        }\n      });\n      Hooks.Events.run(\"afterAccountsUpdate\", Meteor.userId(), {\n        accountId: account._id,\n        updatedFields: [\"isBillingDefault\"]\n      });\n    }\n  }\n\n  const userUpdateQuery = {\n    $set: {\n      \"profile.addressBook\": address\n    }\n  };\n  const accountsUpdateQuery = {\n    $set: {\n      userId\n    },\n    $addToSet: {\n      \"profile.addressBook\": address\n    }\n  };\n\n  if (!account.name || _.get(account, \"profile.addressBook.length\", 0) === 0) {\n    userUpdateQuery.$set.name = address.fullName;\n    accountsUpdateQuery.$set.name = address.fullName;\n  }\n\n  Meteor.users.update(Meteor.userId(), userUpdateQuery);\n\n  const result = Accounts.upsert({\n    userId\n  }, accountsUpdateQuery);\n\n  // If the address update was successful, then return the full updated addrtess\n  if (result.numberAffected === 1) {\n    // Find the account\n    const updatedAccount = Accounts.findOne({\n      userId\n    });\n\n    // Pull the updated address and return it\n    return updatedAccount.profile.addressBook.find((updatedAddress) => address._id === updatedAddress._id);\n  }\n\n  throw new Meteor.Error(\"server-error\", \"Unable to add address to account\");\n}\n\n/**\n * @name accounts/addressBookUpdate\n * @memberof Methods/Accounts\n * @method\n * @summary Update existing address in user's profile\n * @param {Object} address - address\n * @param {String|null} [accountUserId] - `account.userId` used by admin to edit users\n * @param {shipping|billing} [type] - name of selected address type\n * @return {Object} The updated address\n */\nexport function addressBookUpdate(address, accountUserId, type) {\n  Schemas.Address.validate(address);\n  check(accountUserId, Match.OneOf(String, null, undefined));\n  check(type, Match.Maybe(String));\n  // security, check for admin access. We don't need to check every user call\n  // here because we are calling `Meteor.userId` from within this Method.\n  if (typeof accountUserId === \"string\") { // if this will not be a String -\n    // `check` will not pass it.\n    if (Meteor.userId() !== accountUserId && !Reaction.hasPermission(\"reaction-accounts\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n  }\n  this.unblock();\n\n  // If no userId is provided, use the current user\n  const userId = accountUserId || Meteor.userId();\n  // Find old state of isShippingDefault & isBillingDefault to compare and reflect in cart\n  const account = Accounts.findOne({ userId });\n  const oldAddress = (account.profile.addressBook || []).find((addr) => addr._id === address._id);\n\n  if (!oldAddress) throw new Meteor.Error(\"not-found\", `No existing address found with ID ${address._id}`);\n\n  // Set new address to be default for `type`\n  if (typeof type === \"string\") {\n    Object.assign(address, { [type]: true });\n  }\n\n  // We want the cart addresses to be updated when current default address\n  // (shipping or Billing) are different than the previous one, but also\n  // when the current default address(ship or bill) gets edited(so Current and Previous default are the same).\n  // This check can be simplified to :\n  if (address.isShippingDefault || address.isBillingDefault ||\n    oldAddress.isShippingDefault || oldAddress.isBillingDefault) {\n    // Find user cart\n    // Cart should exist to this moment, so we don't need to to verify its existence.\n    const cart = Cart.findOne({ userId });\n\n    // If isShippingDefault address has changed\n    if (oldAddress.isShippingDefault !== address.isShippingDefault) {\n      // Update the cart to use new default shipping address\n      if (address.isShippingDefault) {\n        Meteor.call(\"cart/setShipmentAddress\", cart._id, address);\n      } else {\n        // If the new address is not the shipping default, remove it from the cart\n        Meteor.call(\"cart/unsetAddresses\", address._id, userId, \"shipping\");\n      }\n    } else if (address.isShippingDefault && oldAddress.isShippingDefault) {\n      // If shipping address was edited, but isShippingDefault status not changed, update the cart address\n      Meteor.call(\"cart/setShipmentAddress\", cart._id, address);\n    }\n\n    // If isBillingDefault address has changed\n    if (oldAddress.isBillingDefault !== address.isBillingDefault) {\n      // Update the cart to use new default billing address\n      if (address.isBillingDefault) {\n        Meteor.call(\"cart/setPaymentAddress\", cart._id, address);\n      } else {\n        // If the new address is not the shipping default, remove it from the cart\n        Meteor.call(\"cart/unsetAddresses\", address._id, userId, \"billing\");\n      }\n    } else if (address.isBillingDefault && oldAddress.isBillingDefault) {\n      // If shipping address was edited, but isShippingDefault status not changed, update the cart address\n      Meteor.call(\"cart/setPaymentAddress\", cart._id, address);\n    }\n  }\n\n  // Update all other to set the default type to false\n  account.profile.addressBook.forEach((addr) => {\n    if (addr._id === address._id) {\n      Object.assign(addr, address);\n    } else if (typeof type === \"string\") {\n      Object.assign(addr, { [type]: false });\n    }\n  });\n\n  // TODO: revisit why we update Meteor.users differently than accounts\n  // We could possibly remove the whole `userUpdateQuery` variable\n  // and update Meteor.users with the accountsUpdateQuery data\n  const userUpdateQuery = {\n    $set: {\n      \"profile.addressBook\": address\n    }\n  };\n\n  const accountsUpdateQuery = {\n    $set: {\n      \"profile.addressBook\": account.profile.addressBook\n    }\n  };\n  // update the name when there is no name or the user updated his only shipping address\n  if (!account.name || _.get(account, \"profile.addressBook.length\", 0) <= 1) {\n    userUpdateQuery.$set.name = address.fullName;\n    accountsUpdateQuery.$set.name = address.fullName;\n  }\n\n  // Update the Meteor.users collection with new address info\n  Meteor.users.update(Meteor.userId(), userUpdateQuery);\n\n  // Update the Reaction Accounts collection with new address info\n  const updatedAccountResult = Accounts.update({\n    userId\n  }, accountsUpdateQuery);\n\n  // Create an array which contains all fields that have changed\n  // This is used for search, to determine if we need to re-index\n  const updatedFields = [];\n  Object.keys(address).forEach((key) => {\n    if (address[key] !== oldAddress[key]) {\n      updatedFields.push(key);\n    }\n  });\n\n  // Run afterAccountsUpdate hook to update Accounts Search\n  Hooks.Events.run(\"afterAccountsUpdate\", Meteor.userId(), {\n    accountId: account._id,\n    updatedFields\n  });\n\n  // If the address update was successful, then return the full updated addrtess\n  if (updatedAccountResult === 1) {\n    // Find the account\n    const updatedAccount = Accounts.findOne({\n      userId\n    });\n\n    // Pull the updated address and return it\n    return updatedAccount.profile.addressBook.find((updatedAddress) => address._id === updatedAddress._id);\n  }\n\n  throw new Meteor.Error(\"server-error\", \"Unable to update account address\");\n}\n\n/**\n * @name accounts/addressBookRemove\n * @memberof Methods/Accounts\n * @method\n * @summary Remove existing address in user's profile\n * @param {String} addressId - address `_id`\n * @param {String} [accountUserId] - `account.userId` used by admin to edit users\n * @return {Object} Removed address object\n */\nexport function addressBookRemove(addressId, accountUserId) {\n  check(addressId, String);\n  check(accountUserId, Match.Optional(String));\n  // security, check for admin access. We don't need to check every user call\n  // here because we are calling `Meteor.userId` from within this Method.\n  if (typeof accountUserId === \"string\") { // if this will not be a String -\n    // `check` will not pass it.\n    if (Meteor.userId() !== accountUserId && !Reaction.hasPermission(\"reaction-accounts\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access denied\");\n    }\n  }\n  this.unblock();\n\n  const userId = accountUserId || Meteor.userId();\n  const account = Accounts.findOne({ userId });\n  // remove this address in cart, if used, before completely removing\n  Meteor.call(\"cart/unsetAddresses\", addressId, userId);\n\n  const updatedAccountResult = Accounts.update({\n    userId,\n    \"profile.addressBook._id\": addressId\n  }, {\n    $pull: {\n      \"profile.addressBook\": {\n        _id: addressId\n      }\n    }\n  }, { bypassCollection2: true });\n\n  // forceIndex when removing an address\n  Hooks.Events.run(\"afterAccountsUpdate\", Meteor.userId(), {\n    accountId: account._id,\n    updatedFields: [\"forceIndex\"]\n  });\n\n  // If the address remove was successful, then return the removed addrtess\n  if (updatedAccountResult === 1) {\n    // Pull the address from the account before it was updated and return it\n    return account.profile.addressBook.find((removedAddress) => addressId === removedAddress._id);\n  }\n\n  throw new Meteor.Error(\"server-error\", \"Unable to remove address from account\");\n}\n\n/**\n * @name accounts/inviteShopOwner\n * @summary Invite a new user as owner of a new shop\n * @memberof Methods/Accounts\n * @method\n * @param {Object} options -\n * @param {String} options.email - email of invitee\n * @param {String} options.name - name of invitee\n * @param {Object} shopData - (optional) data used to create the new shop\n * @returns {Boolean} returns true\n */\nexport function inviteShopOwner(options, shopData) {\n  check(options, Object);\n  check(options.email, String);\n  check(options.name, String);\n  check(shopData, Match.Maybe(Object));\n  const { name, email } = options;\n\n  if (!Reaction.hasPermission(\"admin\", this.userId, Reaction.getPrimaryShopId())) {\n    throw new Meteor.Error(\"access-denied\", \"Access denied\");\n  }\n  const user = Meteor.users.findOne({ \"emails.address\": email });\n  let userId;\n  if (user) {\n    // TODO: Verify email address\n    userId = user._id;\n  } else {\n    userId = MeteorAccounts.createUser({\n      email,\n      name,\n      profile: { invited: true }\n    });\n  }\n\n  Meteor.call(\"shop/createShop\", userId, shopData);\n  const primaryShop = Reaction.getPrimaryShop();\n\n  // Compile Email with SSR\n  const tpl = \"accounts/inviteShopOwner\";\n  const subject = \"accounts/inviteShopOwner/subject\";\n\n  SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n  SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n  const emailLogo = Reaction.Email.getShopLogo(primaryShop);\n  const token = Random.id();\n  const currentUser = Meteor.users.findOne(this.userId);\n  const currentUserName = getCurrentUserName(currentUser);\n  // uses primaryShop's data (name, address etc) in email copy sent to new merchant\n  const dataForEmail = getDataForEmail({ shop: primaryShop, currentUserName, name, token, emailLogo });\n\n  Meteor.users.update(userId, {\n    $set: {\n      \"services.password.reset\": { token, email, when: new Date() },\n      name\n    }\n  });\n\n  Reaction.Email.send({\n    to: email,\n    from: `${_.get(dataForEmail, \"primaryShop.name\")} <${_.get(dataForEmail, \"primaryShop.emails[0].address\")}>`,\n    subject: SSR.render(subject, dataForEmail),\n    html: SSR.render(tpl, dataForEmail)\n  });\n\n  return true;\n}\n\n/**\n * @name accounts/inviteShopMember\n * @summary Invite new admin users (not consumers) to secure access in the dashboard to permissions\n * as specified in packages/roles\n * @memberof Methods/Accounts\n * @method\n * @param {Object} options -\n * @param {String} options.shopId - shop to invite user\n * @param {String} options.groupId - groupId to invite user\n * @param {String} options.email - email of invitee\n * @param {String} options.name - name of invitee\n * @returns {Boolean} returns true\n */\nexport function inviteShopMember(options) {\n  const { shopId, email, name, groupId } = options;\n  check(options, Object);\n  check(shopId, String);\n  check(email, String);\n  check(name, String);\n  check(groupId, String);\n\n  this.unblock();\n\n  const shop = Shops.findOne(shopId);\n  const primaryShop = Reaction.getPrimaryShop();\n\n  if (!shop) {\n    const msg = `accounts/inviteShopMember - Shop ${shopId} not found`;\n    Logger.error(msg);\n    throw new Meteor.Error(\"not-found\", msg);\n  }\n\n  if (!Reaction.hasPermission(\"reaction-accounts\", this.userId, shopId)) {\n    Logger.error(`User ${this.userId} does not have reaction-accounts permissions`);\n    throw new Meteor.Error(\"access-denied\", \"Access denied\");\n  }\n\n  const group = Groups.findOne({ _id: groupId }) || {};\n\n  // check to ensure that invitee has roles required to perform the invitation\n  if (!Reaction.canInviteToGroup({ group, user: Meteor.user() })) {\n    throw new Meteor.Error(\"access-denied\", \"Cannot invite to group\");\n  }\n\n  if (group.slug === \"owner\") {\n    throw new Meteor.Error(\"bad-request\", \"Cannot directly invite owner\");\n  }\n\n  const currentUser = Meteor.users.findOne(this.userId);\n  const currentUserName = getCurrentUserName(currentUser);\n  const emailLogo = Reaction.Email.getShopLogo(primaryShop);\n  const user = Meteor.users.findOne({ \"emails.address\": email });\n  const token = Random.id();\n  let dataForEmail;\n  let userId;\n  let tpl;\n  let subject;\n\n  // If the user already has an account, send informative email, not \"invite\" email\n  if (user) {\n    // The user already exists, we promote the account, rather than creating a new one\n    userId = user._id;\n    Meteor.call(\"group/addUser\", userId, groupId);\n\n    // do not send token, as no password reset is needed\n    const url = Meteor.absoluteUrl();\n\n    // use primaryShop's data (name, address etc) in email copy sent to new shop manager\n    dataForEmail = getDataForEmail({ shop: primaryShop, currentUserName, name, emailLogo, url });\n\n    // Get email template and subject\n    tpl = \"accounts/inviteShopMember\";\n    subject = \"accounts/inviteShopMember/subject\";\n  } else {\n    // The user does not already exist, we need to create a new account\n    userId = MeteorAccounts.createUser({\n      profile: { invited: true },\n      email,\n      name,\n      groupId\n    });\n    // set token to be used for first login for the new account\n    const tokenUpdate = {\n      \"services.password.reset\": { token, email, when: new Date() },\n      name\n    };\n    Meteor.users.update(userId, { $set: tokenUpdate });\n\n    // use primaryShop's data (name, address etc) in email copy sent to new shop manager\n    dataForEmail = getDataForEmail({ shop: primaryShop, currentUserName, name, token, emailLogo });\n\n    // Get email template and subject\n    tpl = \"accounts/inviteNewShopMember\";\n    subject = \"accounts/inviteNewShopMember/subject\";\n  }\n\n  dataForEmail.groupName = _.startCase(group.name);\n\n  // Compile Email with SSR\n  SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n  SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n  // send invitation email from primary shop email\n  Reaction.Email.send({\n    to: email,\n    from: `${dataForEmail.primaryShop.name} <${dataForEmail.primaryShop.emails[0].address}>`,\n    subject: SSR.render(subject, dataForEmail),\n    html: SSR.render(tpl, dataForEmail)\n  });\n\n  return Accounts.findOne({ userId });\n}\n\n/**\n * @name accounts/sendWelcomeEmail\n * @summary Send an email to consumers on sign up\n * @memberof Methods/Accounts\n * @method\n * @param {String} shopId - shopId of new User\n * @param {String} userId - new userId to welcome\n * @param {String} token - the token for the verification URL\n * @returns {Boolean} returns true on success\n */\nexport function sendWelcomeEmail(shopId, userId, token) {\n  check(shopId, String);\n  check(userId, String);\n  check(token, String);\n\n  this.unblock();\n\n  const account = Accounts.findOne(userId);\n  // anonymous users arent welcome here\n  if (!account.emails || !account.emails.length > 0) {\n    return false;\n  }\n\n  const shop = Shops.findOne(shopId);\n\n  // Get shop logo, if available. If not, use default logo from file-system\n  const emailLogo = Reaction.Email.getShopLogo(shop);\n  const copyrightDate = new Date().getFullYear();\n  const user = Meteor.user();\n  const dataForEmail = {\n    // Shop Data\n    shop,\n    contactEmail: shop.emails[0].address,\n    emailLogo,\n    copyrightDate,\n    legalName: _.get(shop, \"addressBook[0].company\"),\n    physicalAddress: {\n      address: `${_.get(shop, \"addressBook[0].address1\")} ${_.get(shop, \"addressBook[0].address2\")}`,\n      city: _.get(shop, \"addressBook[0].city\"),\n      region: _.get(shop, \"addressBook[0].region\"),\n      postal: _.get(shop, \"addressBook[0].postal\")\n    },\n    shopName: shop.name,\n    socialLinks: {\n      display: true,\n      facebook: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/facebook-icon.png`,\n        link: \"https://www.facebook.com\"\n      },\n      googlePlus: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/google-plus-icon.png`,\n        link: \"https://plus.google.com\"\n      },\n      twitter: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/twitter-icon.png`,\n        link: \"https://www.twitter.com\"\n      }\n    },\n    user\n  };\n\n  dataForEmail.verificationUrl = MeteorAccounts.urls.verifyEmail(token);\n\n  const userEmail = account.emails[0].address;\n  let shopEmail;\n  // provide some defaults for missing shop email.\n  if (!shop.emails) {\n    shopEmail = `${shop.name}@localhost`;\n    Logger.debug(`Shop email address not configured. Using ${shopEmail}`);\n  } else {\n    shopEmail = shop.emails[0].address;\n  }\n\n  const tpl = \"accounts/sendWelcomeEmail\";\n  const subject = \"accounts/sendWelcomeEmail/subject\";\n  SSR.compileTemplate(tpl, Reaction.Email.getTemplate(tpl));\n  SSR.compileTemplate(subject, Reaction.Email.getSubject(tpl));\n\n  Reaction.Email.send({\n    to: userEmail,\n    from: `${shop.name} <${shopEmail}>`,\n    subject: SSR.render(subject, dataForEmail),\n    html: SSR.render(tpl, dataForEmail)\n  });\n\n  return true;\n}\n\n/**\n * @name accounts/addUserPermissions\n * @memberof Methods/Accounts\n * @method\n * @param {String} userId - userId\n * @param {Array|String} permissions - Name of role/permission.\n * If array, users returned will have at least one of the roles specified but need not have _all_ roles.\n * @param {String} [group] Optional name of group to restrict roles to. User's Roles.GLOBAL_GROUP will also be checked.\n * @returns {Boolean} success/failure\n */\nexport function addUserPermissions(userId, permissions, group) {\n  if (!Reaction.hasPermission(\"reaction-accounts\", Meteor.userId(), group)) {\n    throw new Meteor.Error(\"access-denied\", \"Access denied\");\n  }\n  check(userId, Match.OneOf(String, Array));\n  check(permissions, Match.OneOf(String, Array));\n  check(group, Match.Optional(String));\n  this.unblock();\n  try {\n    return Roles.addUsersToRoles(userId, permissions, group);\n  } catch (error) {\n    return Logger.error(error);\n  }\n}\n\n/**\n * @name accounts/removeUserPermissions\n * @memberof Methods/Accounts\n * @method\n * @param {String} userId - userId\n * @param {Array|String} permissions - Name of role/permission.\n * If array, users returned will have at least one of the roles specified but need not have _all_ roles.\n * @param {String} [group] Optional name of group to restrict roles to.\n * @returns {Boolean} success/failure\n */\nexport function removeUserPermissions(userId, permissions, group) {\n  if (!Reaction.hasPermission(\"reaction-accounts\", Meteor.userId(), group)) {\n    throw new Meteor.Error(\"access-denied\", \"Access denied\");\n  }\n  check(userId, String);\n  check(permissions, Match.OneOf(String, Array));\n  check(group, Match.Optional(String, null));\n  this.unblock();\n  try {\n    return Roles.removeUsersFromRoles(userId, permissions, group);\n  } catch (error) {\n    Logger.error(error);\n    throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n  }\n}\n\n/**\n * @name accounts/setUserPermissions\n * @memberof Methods/Accounts\n * @method\n * @param {String} userId - userId\n * @param {String|Array} permissions - string/array of permissions\n * @param {String} group - group\n * @returns {Boolean} returns Roles.setUserRoles result\n */\nexport function setUserPermissions(userId, permissions, group) {\n  if (!Reaction.hasPermission(\"reaction-accounts\", Meteor.userId(), group)) {\n    throw new Meteor.Error(\"access-denied\", \"Access denied\");\n  }\n  check(userId, String);\n  check(permissions, Match.OneOf(String, Array));\n  check(group, Match.Optional(String));\n  this.unblock();\n  try {\n    return Roles.setUserRoles(userId, permissions, group);\n  } catch (error) {\n    Logger.error(error);\n    return error;\n  }\n}\n\n/**\n * @name getCurrentUserName\n * @memberof Methods/Accounts\n * @method\n * @private\n * @param  {Object} currentUser - User\n * @return {String} Name of currentUser or \"Admin\"\n */\nfunction getCurrentUserName(currentUser) {\n  if (currentUser) {\n    if (currentUser.profile && currentUser.profile.name) {\n      return currentUser.profile.name;\n    }\n\n    if (currentUser.name) {\n      return currentUser.name;\n    }\n\n    if (currentUser.username) {\n      return currentUser.username;\n    }\n  }\n\n  return \"Admin\";\n}\n\n/**\n * @name getDataForEmail\n * @memberof Methods/Accounts\n * @method\n * @private\n * @param  {Object} options - shop, currentUserName, token, emailLogo, name\n * @return {Object} data - primaryShop, shop, contactEmail, homepage,\n * emailLogo, legalName, physicalAddress, shopName, socialLinks, user, invitedUserName, url\n */\nfunction getDataForEmail(options) {\n  const { shop, currentUserName, token, emailLogo, name, url } = options;\n  const primaryShop = Shops.findOne(Reaction.getPrimaryShopId());\n  const copyrightDate = new Date().getFullYear();\n\n  return {\n    primaryShop, // Primary shop data - may or may not be the same as shop\n    shop, // Shop Data\n    contactEmail: _.get(shop, \"emails[0].address\"),\n    homepage: Meteor.absoluteUrl(),\n    emailLogo,\n    copyrightDate,\n    legalName: _.get(shop, \"addressBook[0].company\"),\n    physicalAddress: {\n      address: `${_.get(shop, \"addressBook[0].address1\")} ${_.get(shop, \"addressBook[0].address2\")}`,\n      city: _.get(shop, \"addressBook[0].city\"),\n      region: _.get(shop, \"addressBook[0].region\"),\n      postal: _.get(shop, \"addressBook[0].postal\")\n    },\n    shopName: shop.name,\n    socialLinks: {\n      display: true,\n      facebook: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/facebook-icon.png`,\n        link: \"https://www.facebook.com\"\n      },\n      googlePlus: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/google-plus-icon.png`,\n        link: \"https://plus.google.com\"\n      },\n      twitter: {\n        display: true,\n        icon: `${Meteor.absoluteUrl()}resources/email-templates/twitter-icon.png`,\n        link: \"https://www.twitter.com\"\n      }\n    },\n    user: Meteor.user(), // Account Data\n    currentUserName,\n    invitedUserName: name,\n    url: url || getEmailUrl(token)\n  };\n\n  function getEmailUrl(userToken) {\n    if (userToken) {\n      return MeteorAccounts.urls.enrollAccount(userToken);\n    }\n    return Meteor.absoluteUrl();\n  }\n}\n\n/**\n * @name accounts/createFallbackLoginToken\n * @memberof Methods/Accounts\n * @method\n * @summary Returns a new loginToken for current user, that can be used for special login scenarios\n * e.g. store the newly created token as cookie on the browser, if the client does not offer local storage.\n * @returns {String} loginToken for current user\n */\nexport function createFallbackLoginToken() {\n  if (this.userId) {\n    const stampedLoginToken = MeteorAccounts._generateStampedLoginToken();\n    const loginToken = stampedLoginToken.token;\n    MeteorAccounts._insertLoginToken(this.userId, stampedLoginToken);\n    return loginToken;\n  }\n}\n\n/**\n * @name accounts/setProfileCurrency\n * @memberof Methods/Accounts\n * @method\n * @param {String} currencyName - currency symbol to add to user profile\n * @param {String} [accountId] - accountId of user to set currency of. Defaults to current user ID\n * @summary Sets users profile currency\n */\nexport function setProfileCurrency(currencyName, accountId) {\n  check(currencyName, String);\n  check(accountId, Match.Maybe(String));\n\n  const currentUserId = this.userId;\n  const userId = accountId || currentUserId;\n  if (!userId) throw new Meteor.Error(\"access-denied\", \"You must be logged in to set profile currency\");\n\n  const account = Accounts.findOne({ userId }, { fields: { shopId: 1 } });\n  if (!account) throw new Meteor.Error(\"not-found\", \"Account not found\");\n\n  if (userId !== currentUserId && !Reaction.hasPermission(\"reaction-accounts\", currentUserId, account.shopId)) {\n    throw new Meteor.Error(\"access-denied\", \"Access denied\");\n  }\n\n  // Make sure this currency code is in the related shop currencies list\n  const shop = Shops.findOne({ _id: account.shopId }, { fields: { currencies: 1 } });\n\n  if (!shop || !shop.currencies || !shop.currencies[currencyName]) {\n    throw new Meteor.Error(\"invalid-argument\", `The shop for this account does not define any currency with code \"${currencyName}\"`);\n  }\n\n  Accounts.update({ userId }, { $set: { \"profile.currency\": currencyName } });\n  Hooks.Events.run(\"afterAccountsUpdate\", userId, {\n    accountId: account._id,\n    updatedFields: [\"currency\"]\n  });\n\n  return Accounts.findOne({ userId });\n}\n\n/**\n * @name markAddressValidationBypassed\n * @summary Write that the customer has bypassed address validation\n * @returns {Number} updateResult - Result of the update\n */\nfunction markAddressValidationBypassed(value = true) {\n  check(value, Boolean);\n  const userId = Meteor.userId();\n  const updateResult = Cart.update({ userId }, { $set: { bypassAddressValidation: value } });\n  return updateResult;\n}\n\n/**\n * @name markTaxCalculationFailed\n * @summary Write tax calculation has failed for this customer\n * @returns {Number} updateResult - Result of the update\n */\nfunction markTaxCalculationFailed(value = true) {\n  check(value, Boolean);\n  const userId = Meteor.userId();\n  const updateResult = Cart.update({ userId }, { $set: { taxCalculationFailed: value } });\n  return updateResult;\n}\n\nMeteor.methods({\n  \"accounts/verifyAccount\": verifyAccount,\n  \"accounts/validateAddress\": validateAddress,\n  \"accounts/currentUserHasPassword\": currentUserHasPassword,\n  \"accounts/addressBookAdd\": addressBookAdd,\n  \"accounts/addressBookUpdate\": addressBookUpdate,\n  \"accounts/addressBookRemove\": addressBookRemove,\n  \"accounts/inviteShopMember\": inviteShopMember,\n  \"accounts/inviteShopOwner\": inviteShopOwner,\n  \"accounts/sendWelcomeEmail\": sendWelcomeEmail,\n  \"accounts/addUserPermissions\": addUserPermissions,\n  \"accounts/removeUserPermissions\": removeUserPermissions,\n  \"accounts/setUserPermissions\": setUserPermissions,\n  \"accounts/createFallbackLoginToken\": createFallbackLoginToken,\n  \"accounts/updateEmailAddress\": updateEmailAddress,\n  \"accounts/removeEmailAddress\": removeEmailAddress,\n  \"accounts/setProfileCurrency\": setProfileCurrency,\n  \"accounts/markAddressValidationBypassed\": markAddressValidationBypassed,\n  \"accounts/markTaxCalculationFailed\": markTaxCalculationFailed\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { ServiceConfiguration } from \"meteor/service-configuration\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * @name accounts/updateServiceConfiguration\n * @memberof Methods/Accounts\n * @method\n * @example Meteor.call(\"accounts/updateServiceConfiguration\", service, fields, (callBackFunction))\n * @summary Update service configuration\n * @param {String} service\n * @param {Array} fields\n * @returns {false}\n */\nMeteor.methods({\n  \"accounts/updateServiceConfiguration\"(service, fields) {\n    check(service, String);\n    check(fields, Array);\n    const dataToSave = {};\n\n    _.each(fields, (field) => {\n      dataToSave[field.property] = field.value;\n    });\n\n    if (Reaction.hasPermission([\"dashboard/accounts\"])) {\n      return ServiceConfiguration.configurations.upsert({\n        service\n      }, {\n        $set: dataToSave\n      });\n    }\n    return false;\n  }\n});\n","import _ from \"lodash\";\nimport { check, Match } from \"meteor/check\";\nimport { Random } from \"meteor/random\";\nimport { EJSON } from \"meteor/ejson\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { ProductRevision as Catalog } from \"/imports/plugins/core/revisions/server/hooks\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\nimport { MediaRecords, Products, Revisions, Tags } from \"/lib/collections\";\nimport { Media } from \"/imports/plugins/core/files/server\";\n\n/* eslint new-cap: 0 */\n/* eslint no-loop-func: 0 */\n/* eslint quotes: 0 */\n\n/**\n * @file Methods for Products. Run these methods using `Meteor.call()`.\n *\n *\n * @namespace Methods/Products\n*/\n\n/**\n * updateVariantProductField\n * @private\n * @summary updates the variant\n * @param {Array} variants - the array of variants\n * @param {String} field - the field to update\n * @param {String} value - the value to add\n * @return {Array} - return an array\n */\nfunction updateVariantProductField(variants, field, value) {\n  return variants.map((variant) => Meteor.call(\"products/updateProductField\", variant._id, field, value));\n}\n\n/**\n * @array toDenormalize\n * @private\n * @summary contains a list of fields, which should be denormalized\n * @type {string[]}\n */\nconst toDenormalize = [\n  \"price\",\n  \"inventoryQuantity\",\n  \"lowInventoryWarningThreshold\",\n  \"inventoryPolicy\",\n  \"inventoryManagement\"\n];\n\n/**\n * @function createTitle\n * @private\n * @description Recursive method which trying to find a new `title`, given the\n * existing copies\n * @param {String} newTitle - product `title`\n * @param {String} productId - current product `_id`\n * @return {String} title - modified `title`\n */\nfunction createTitle(newTitle, productId) {\n  // exception product._id needed for cases then double triggering happens\n  let title = newTitle || \"\";\n  const titleCount = Products.find({\n    title,\n    _id: {\n      $nin: [productId]\n    }\n  }).count();\n  // current product \"copy\" number\n  let titleNumberSuffix = 0;\n  // product handle prefix\n  let titleString = title;\n  // copySuffix \"-copy-number\" suffix of product\n  const copySuffix = titleString.match(/-copy-\\d+$/) || titleString.match(/-copy$/);\n  // if product is a duplicate, we should take the copy number, and cut\n  // the handle\n  if (copySuffix) {\n    // we can have two cases here: copy-number and just -copy. If there is\n    // no numbers in copySuffix then we should put 1 in handleNumberSuffix\n    titleNumberSuffix = +String(copySuffix).match(/\\d+$/) || 1;\n    // removing last numbers and last \"-\" if it presents\n    titleString = title.replace(/\\d+$/, '').replace(/-$/, '');\n  }\n\n  // if we have more than one product with the same handle, we should mark\n  // it as \"copy\" or increment our product handle if it contain numbers.\n  if (titleCount > 0) {\n    // if we have product with name like \"product4\", we should take care\n    // about its uniqueness\n    if (titleNumberSuffix > 0) {\n      title = `${titleString}-${titleNumberSuffix + titleCount}`;\n    } else {\n      // first copy will be \"...-copy\", second: \"...-copy-2\"\n      title = `${titleString}-copy${titleCount > 1 ? `-${titleCount}` : \"\"}`;\n    }\n  }\n\n  // we should check again if there are any new matches with DB\n  if (Products.find({\n    title\n  }).count() !== 0) {\n    title = createTitle(title, productId);\n  }\n  return title;\n}\n\n/**\n * @function createHandle\n * @private\n * @description Recursive method which trying to find a new `handle`, given the\n * existing copies\n * @param {String} productHandle - product `handle`\n * @param {String} productId - current product `_id`\n * @return {String} handle - modified `handle`\n */\nfunction createHandle(productHandle, productId) {\n  let handle = productHandle || \"\";\n  // exception product._id needed for cases then double triggering happens\n  const handleCount = Products.find({\n    handle,\n    _id: {\n      $nin: [productId]\n    }\n  }).count();\n  // current product \"copy\" number\n  let handleNumberSuffix = 0;\n  // product handle prefix\n  let handleString = handle;\n  // copySuffix \"-copy-number\" suffix of product\n  const copySuffix = handleString.match(/-copy-\\d+$/) || handleString.match(/-copy$/);\n\n  // if product is a duplicate, we should take the copy number, and cut\n  // the handle\n  if (copySuffix) {\n    // we can have two cases here: copy-number and just -copy. If there is\n    // no numbers in copySuffix then we should put 1 in handleNumberSuffix\n    handleNumberSuffix = +String(copySuffix).match(/\\d+$/) || 1;\n    // removing last numbers and last \"-\" if it presents\n    handleString = handle.replace(/\\d+$/, '').replace(/-$/, '');\n  }\n\n  // if we have more than one product with the same handle, we should mark\n  // it as \"copy\" or increment our product handle if it contain numbers.\n  if (handleCount > 0) {\n    // if we have product with name like \"product4\", we should take care\n    // about its uniqueness\n    if (handleNumberSuffix > 0) {\n      handle = `${handleString}-${handleNumberSuffix + handleCount}`;\n    } else {\n      // first copy will be \"...-copy\", second: \"...-copy-2\"\n      handle = `${handleString}-copy${handleCount > 1 ? `-${handleCount}` : ''}`;\n    }\n  }\n\n  // we should check again if there are any new matches with DB\n  // exception product._id needed for cases then double triggering happens\n  const newHandleCount = Products.find({\n    handle,\n    _id: {\n      $nin: [productId]\n    }\n  }).count();\n\n  if (newHandleCount !== 0) {\n    handle = createHandle(handle, productId);\n  }\n\n  return handle;\n}\n\n/**\n * @function copyMedia\n * @private\n * @description copy images links to cloned variant from original\n * @param {String} newId - [cloned|original] product _id\n * @param {String} variantOldId - old variant _id\n * @param {String} variantNewId - - cloned variant _id\n * @return {undefined}\n */\nfunction copyMedia(newId, variantOldId, variantNewId) {\n  Media.find({\n    \"metadata.variantId\": variantOldId\n  })\n    .then((fileRecords) => {\n      fileRecords.forEach((fileRecord) => {\n        // Copy File and insert directly, bypasing revision control\n        fileRecord.fullClone({\n          productId: newId,\n          variantId: variantNewId\n        }).catch((error) => {\n          Logger.error(`Error in copyMedia for product ${newId}`, error);\n        });\n      });\n    })\n    .catch((error) => {\n      Logger.error(`Error in copyMedia for product ${newId}`, error);\n    });\n}\n\n/**\n * @function denormalize\n * @private\n * @description With flattened model we do not want to get variant docs in\n * `products` publication, but we need some data from variants to display price,\n * quantity, etc. That's why we are denormalizing these properties into product\n * doc. Also, this way should have a speed benefit comparing the way where we\n * could dynamically build denormalization inside `products` publication.\n * @summary update product denormalized properties if variant was updated or\n * removed\n * @param {String} id - product _id\n * @param {String} field - type of field. Could be:\n * \"price\",\n * \"inventoryQuantity\",\n * \"inventoryManagement\",\n * \"inventoryPolicy\",\n * \"lowInventoryWarningThreshold\"\n * @since 0.11.0\n * @return {Number} - number of successful update operations. Should be \"1\".\n */\nfunction denormalize(id, field) {\n  const doc = Products.findOne(id);\n  let variants;\n  if (doc.type === \"simple\") {\n    variants = Catalog.getTopVariants(id);\n  } else if (doc.type === \"variant\" && doc.ancestors.length === 1) {\n    variants = Catalog.getVariants(id);\n  }\n  const update = {};\n\n  switch (field) {\n    case \"inventoryPolicy\":\n    case \"inventoryQuantity\":\n    case \"inventoryManagement\":\n      Object.assign(update, {\n        isSoldOut: isSoldOut(variants),\n        isLowQuantity: isLowQuantity(variants),\n        isBackorder: isBackorder(variants)\n      });\n      break;\n    case \"lowInventoryWarningThreshold\":\n      Object.assign(update, {\n        isLowQuantity: isLowQuantity(variants)\n      });\n      break;\n    default: { // \"price\" is object with range, min, max\n      const priceObject = Catalog.getProductPriceRange(id);\n      Object.assign(update, {\n        price: priceObject\n      });\n    }\n  }\n\n  // TODO: Determine if product revision needs to be updated as well.\n  Products.update(id, {\n    $set: update\n  }, {\n    selector: {\n      type: \"simple\"\n    }\n  });\n}\n\n/**\n * isSoldOut\n * @private\n * @summary We are stop accepting new orders if product marked as `isSoldOut`.\n * @param {Array} variants - Array with top-level variants\n * @return {Boolean} true if summary product quantity is zero.\n */\nfunction isSoldOut(variants) {\n  return variants.every((variant) => {\n    if (variant.inventoryManagement && variant.inventoryPolicy) {\n      return Catalog.getVariantQuantity(variant) <= 0;\n    }\n    return false;\n  });\n}\n\n/**\n * isLowQuantity\n * @private\n * @summary If at least one of the variants is less than the threshold, then function returns `true`\n * @param {Array} variants - array of child variants\n * @return {boolean} low quantity or not\n */\nfunction isLowQuantity(variants) {\n  return variants.some((variant) => {\n    const quantity = Catalog.getVariantQuantity(variant);\n    // we need to keep an eye on `inventoryPolicy` too and qty > 0\n    if (variant.inventoryManagement && variant.inventoryPolicy && quantity) {\n      return quantity <= variant.lowInventoryWarningThreshold;\n    }\n    // TODO: need to test this function with real data\n    return false;\n  });\n}\n\n/**\n * isBackorder\n * @private\n * @description Is products variants is still available to be ordered after summary variants quantity is zero\n * @param {Array} variants - array with variant objects\n * @return {boolean} is backorder allowed or not for a product\n */\nfunction isBackorder(variants) {\n  return variants.every((variant) => !variant.inventoryPolicy && variant.inventoryManagement &&\n      variant.inventoryQuantity === 0);\n}\n\n/**\n * flushQuantity\n * @private\n * @summary if variant `inventoryQuantity` not zero, function update it to\n * zero. This needed in case then option with it's own `inventoryQuantity`\n * creates to top-level variant. In that case top-level variant should display\n * sum of his options `inventoryQuantity` fields.\n * @param {String} id - variant _id\n * @return {Number} - collection update results\n */\nfunction flushQuantity(id) {\n  const variant = Products.findOne(id);\n  // if variant already have descendants, quantity should be 0, and we don't\n  // need to do all next actions\n  if (variant.inventoryQuantity === 0) {\n    return 1; // let them think that we have one successful operation here\n  }\n\n  const productUpdate = Products.update({\n    _id: id\n  }, {\n    $set: {\n      inventoryQuantity: 0\n    }\n  }, {\n    selector: {\n      type: \"variant\"\n    }\n  });\n\n  return productUpdate;\n}\n\n/**\n * @function createProduct\n * @private\n * @description creates a product\n * @param {Object} props - initial product properties\n * @return {Object} product - new product\n */\nfunction createProduct(props = null) {\n  const _id = Products.insert({\n    type: \"simple\",\n    ...props\n  }, {\n    validate: false\n  });\n\n  const newProduct = Products.findOne({ _id });\n\n  Hooks.Events.run(\"afterInsertCatalogProduct\", newProduct);\n\n  return newProduct;\n}\n\n/**\n * @function\n * @name updateCatalogProduct\n * @summary Updates a product's revision and conditionally updates\n * the underlying product.\n *\n * @param {String} userId - currently logged in user\n * @param {Object} selector - selector for product to update\n * @param {Object} modifier - Object describing what parts of the document to update.\n * @param {Object} validation - simple schema validation options\n * @return {String} _id of updated document\n */\nfunction updateCatalogProduct(userId, selector, modifier, validation) {\n  const product = Products.findOne(selector);\n\n  const shouldUpdateProduct = Hooks.Events.run(\"beforeUpdateCatalogProduct\", product, {\n    userId,\n    modifier,\n    validation\n  });\n\n  if (shouldUpdateProduct) {\n    const result = Products.update(selector, modifier, validation);\n\n    Hooks.Events.run(\"afterUpdateCatalogProduct\", product, { modifier });\n\n    return result;\n  }\n\n  Logger.debug(`beforeUpdateCatalogProduct hook returned falsy, not updating catalog product`);\n\n  return false;\n}\n\n\nMeteor.methods({\n  /**\n   * @name products/cloneVariant\n   * @memberof Methods/Products\n   * @method\n   * @summary clones a product variant into a new variant\n   * @description the method copies variants, but will also create and clone\n   * child variants (options)\n   * @param {String} productId - the productId we're whose variant we're\n   * cloning\n   * @param {String} variantId - the variantId that we're cloning\n   * @todo rewrite @description\n   * @return {Array} - list with cloned variants _ids\n   */\n  \"products/cloneVariant\"(productId, variantId) {\n    check(productId, String);\n    check(variantId, String);\n\n    // Check first if Variant exists and then if user has the right to clone it\n    const variant = Products.findOne(variantId);\n    if (!variant) {\n      throw new Meteor.Error(\"not-found\", \"Variant not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, variant.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Verify that this variant and any ancestors are not deleted.\n    // Child variants cannot be added if a parent product or product revision\n    // is marked as `{ isDeleted: true }`\n    if (ReactionProduct.isAncestorDeleted(variant, true)) {\n      throw new Meteor.Error(\"server-error\", \"Unable to create product variant\");\n    }\n\n    const variants = Products.find({\n      $or: [{\n        _id: variantId\n      }, {\n        ancestors: {\n          $in: [variantId]\n        },\n        isDeleted: false\n      }],\n      type: \"variant\"\n    }).fetch();\n    // exit if we're trying to clone a ghost\n    if (variants.length === 0) {\n      return;\n    }\n    const variantNewId = Random.id(); // for the parent variant\n    // we need to make sure that top level variant will be cloned first, his\n    // descendants later.\n    // we could use this way in future: http://stackoverflow.com/questions/\n    // 9040161/mongo-order-by-length-of-array, by now following are allowed\n    // @link https://lodash.com/docs#sortBy\n    const sortedVariants = _.sortBy(variants, (doc) => doc.ancestors.length);\n\n    return sortedVariants.map((sortedVariant) => {\n      const oldId = sortedVariant._id;\n      let type = \"child\";\n      const clone = {};\n      if (variantId === sortedVariant._id) {\n        type = \"parent\";\n        Object.assign(clone, sortedVariant, {\n          _id: variantNewId,\n          title: `${sortedVariant.title} - copy`,\n          optionTitle: `${sortedVariant.optionTitle} - copy`,\n          price: `${sortedVariant.price}` ?\n            `${sortedVariant.price}` :\n            `${variant.price}`,\n          compareAtPrice: `${sortedVariant.compareAtPrice}` ?\n            `${sortedVariant.compareAtPrice}` :\n            `${variant.compareAtPrice}`\n        });\n      } else {\n        const parentIndex = sortedVariant.ancestors.indexOf(variantId);\n        const ancestorsClone = sortedVariant.ancestors.slice(0);\n        // if variantId exists in ancestors, we override it by new _id\n        if (parentIndex >= 0) ancestorsClone.splice(parentIndex, 1, variantNewId);\n        Object.assign(clone, variant, {\n          _id: Random.id(),\n          ancestors: ancestorsClone,\n          title: `${sortedVariant.title}`,\n          optionTitle: `${sortedVariant.optionTitle}`,\n          price: `${sortedVariant.price}` ?\n            `${sortedVariant.price}` :\n            `${variant.price}`,\n          compareAtPrice: `${sortedVariant.compareAtPrice}` ?\n            `${sortedVariant.compareAtPrice}` :\n            `${variant.compareAtPrice}`,\n          height: `${sortedVariant.height}`,\n          width: `${sortedVariant.width}`,\n          weight: `${sortedVariant.weight}`,\n          length: `${sortedVariant.length}`\n        });\n      }\n      delete clone.updatedAt;\n      delete clone.createdAt;\n      delete clone.inventoryQuantity;\n      delete clone.lowInventoryWarningThreshold;\n\n      copyMedia(productId, oldId, clone._id);\n\n      let newId;\n      try {\n        Hooks.Events.run(\"beforeInsertCatalogProductInsertRevision\", clone);\n        newId = Products.insert(clone, { validate: false });\n        const newProduct = Products.findOne(newId);\n        Hooks.Events.run(\"afterInsertCatalogProduct\", newProduct);\n        Logger.debug(`products/cloneVariant: created ${type === \"child\" ? \"sub child \" : \"\"}clone: ${\n          clone._id} from ${variantId}`);\n      } catch (error) {\n        Logger.error(`products/cloneVariant: cloning of ${variantId} was failed: ${error}`);\n        throw error;\n      }\n\n      Hooks.Events.run(\"afterInsertProduct\", clone);\n\n      return newId;\n    });\n  },\n\n  /**\n   * @name products/createVariant\n   * @memberof Methods/Products\n   * @method\n   * @summary initializes empty variant template\n   * @param {String} parentId - the product _id or top level variant _id where\n   * we create variant\n   * @param {Object} [newVariant] - variant object\n   * @return {String} new variantId\n   */\n  \"products/createVariant\"(parentId, newVariant) {\n    check(parentId, String);\n    check(newVariant, Match.Optional(Object));\n\n    // Check first if Product exists and then if user has the rights\n    const product = Products.findOne(parentId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const newVariantId = Random.id();\n    // get parent ancestors to build new ancestors array\n    const { ancestors } = product;\n\n    // Verify that the parent variant and any ancestors are not deleted.\n    // Child variants cannot be added if a parent product or product revision\n    // is marked as `{ isDeleted: true }`\n    if (ReactionProduct.isAncestorDeleted(product, true)) {\n      throw new Meteor.Error(\"server-error\", \"Unable to create product variant\");\n    }\n\n    Array.isArray(ancestors) && ancestors.push(parentId);\n    const assembledVariant = Object.assign(newVariant || {}, {\n      _id: newVariantId,\n      ancestors,\n      type: \"variant\"\n    });\n\n    if (!newVariant) {\n      Object.assign(assembledVariant, {\n        title: `${product.title} - Untitled option`,\n        price: 0.00\n      });\n    }\n\n    // if we are inserting child variant to top-level variant, we need to remove\n    // all top-level's variant inventory records and flush it's quantity,\n    // because it will be hold sum of all it descendants quantities.\n    if (ancestors.length === 2) {\n      flushQuantity(parentId);\n    }\n\n    Hooks.Events.run(\"beforeInsertCatalogProduct\", assembledVariant);\n    const _id = Products.insert(assembledVariant);\n    Hooks.Events.run(\"afterInsertCatalogProduct\", assembledVariant);\n\n    Hooks.Events.run(\"afterInsertCatalogProductInsertRevision\", Products.findOne({ _id }));\n\n    Logger.debug(`products/createVariant: created variant: ${newVariantId} for ${parentId}`);\n\n    return newVariantId;\n  },\n\n  /**\n   * @name products/updateVariant\n   * @memberof Methods/Products\n   * @method\n   * @summary update individual variant with new values, merges into original\n   * only need to supply updated information. Currently used for a one use case\n   * - to manage top-level variant autoform.\n   * @param {Object} variant - current variant object\n   * @todo some use cases of this method was moved to \"products/\n   * updateProductField\", but it still used\n   * @return {Number} returns update result\n   */\n  \"products/updateVariant\"(variant) {\n    check(variant, Object);\n\n    // Check first if Variant exists and then if user has the right to clone it\n    const currentVariant = Products.findOne(variant._id);\n    if (!currentVariant) {\n      throw new Meteor.Error(\"not-found\", \"Variant not found\");\n    }\n\n    if (!Reaction.hasPermission(\"createProduct\", this.userId, currentVariant.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const newVariant = Object.assign({}, currentVariant, variant);\n\n    const variantUpdateResult = updateCatalogProduct(\n      this.userId,\n      {\n        _id: variant._id\n      },\n      {\n        $set: newVariant\n      },\n      {\n        selector: { type: currentVariant.type },\n        validate: false\n      }\n    );\n\n    const productId = currentVariant.ancestors[0];\n    // we need manually check is these fields were updated?\n    // we can't stop after successful denormalization, because we have a\n    // case when several fields could be changed in top-level variant\n    // before form will be submitted.\n    toDenormalize.forEach((field) => {\n      if (currentVariant[field] !== variant[field]) {\n        denormalize(productId, field);\n      }\n    });\n\n    return variantUpdateResult;\n  },\n\n  /**\n   * @name products/deleteVariant\n   * @memberof Methods/Products\n   * @method\n   * @summary delete variant, which should also delete child variants\n   * @param {String} variantId - variantId to delete\n   * @returns {Boolean} returns update results: `true` - if at least one variant\n   * was removed or `false` if nothing was removed\n   */\n  \"products/deleteVariant\"(variantId) {\n    check(variantId, String);\n\n    // Check first if Variant exists and then if user has the right to delete it\n    const variant = Products.findOne(variantId);\n    if (!variant) {\n      throw new Meteor.Error(\"not-found\", \"Variant not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, variant.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const selector = {\n      // Don't \"archive\" variants that are already marked deleted.\n      isDeleted: {\n        $in: [false, undefined]\n      },\n      $or: [{\n        _id: variantId\n      }, {\n        ancestors: {\n          $in: [variantId]\n        }\n      }]\n    };\n    const toDelete = Products.find(selector).fetch();\n\n    // out if nothing to delete\n    if (!Array.isArray(toDelete) || toDelete.length === 0) return false;\n\n    // Flag the variant and all its children as deleted in Revisions collection.\n    toDelete.forEach((product) => {\n      Hooks.Events.run(\"beforeRemoveCatalogProduct\", product, { userId: this.userId });\n      Hooks.Events.run(\"afterRemoveCatalogProduct\", this.userId, product);\n    });\n\n    // After variant was removed from product, we need to recalculate all\n    // denormalized fields\n    const productId = toDelete[0].ancestors[0];\n    toDenormalize.forEach((field) => denormalize(productId, field));\n\n    Logger.debug(`Flagged variant and all its children as deleted.`);\n\n    return true;\n  },\n\n  /**\n   * @name products/cloneProduct\n   * @memberof Methods/Products\n   * @method\n   * @summary clone a whole product, defaulting visibility, etc\n   * in the future we are going to do an inheritance product\n   * that maintains relationships with the cloned product tree\n   * @param {Array} productOrArray - products array to clone\n   * @returns {Array} returns insert results\n   */\n  \"products/cloneProduct\"(productOrArray) {\n    check(productOrArray, Match.OneOf(Array, Object));\n\n    // REVIEW: This check may be unnecessary now - checks that user has permission to clone\n    // for active shop\n    if (!Reaction.hasPermission(\"createProduct\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    if (Array.isArray(productOrArray)) {\n      // Reduce to unique shops found among producs in this array\n      const shopIds = productOrArray.map((prod) => prod.shopId);\n      const uniqueShopIds = [...new Set(shopIds)];\n\n      // For each unique shopId check to make sure that user has permission to clone\n      uniqueShopIds.forEach((shopId) => {\n        if (!Reaction.hasPermission(\"createProduct\", this.userId, shopId)) {\n          throw new Meteor.Error(\n            \"access-denied\",\n            \"Access Denied\"\n          );\n        }\n      });\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, productOrArray.shopId)) { // Single product was passed in - ensure that user has permission to clone\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    let result;\n    let products;\n    const results = [];\n    const pool = []; // pool of id pairs: { oldId, newId }\n\n    function getIds(id) {\n      return pool.filter(function (pair) {\n        return pair.oldId === this.id;\n      }, {\n        id\n      });\n    }\n\n    function setId(ids) {\n      return pool.push(ids);\n    }\n\n    function buildAncestors(ancestors) {\n      const newAncestors = [];\n      ancestors.map((oldId) => {\n        const pair = getIds(oldId);\n        // TODO do we always have newId on this step?\n        newAncestors.push(pair[0].newId);\n        return newAncestors;\n      });\n      return newAncestors;\n    }\n\n    if (!Array.isArray(productOrArray)) {\n      products = [productOrArray];\n    } else {\n      products = productOrArray;\n    }\n\n    for (const product of products) {\n      // cloning product\n      const productNewId = Random.id();\n      setId({\n        oldId: product._id,\n        newId: productNewId\n      });\n\n      const newProduct = Object.assign({}, product, {\n        _id: productNewId\n        // ancestors: product.ancestors.push(product._id)\n      });\n      delete newProduct.updatedAt;\n      delete newProduct.createdAt;\n      delete newProduct.publishedAt;\n      delete newProduct.positions;\n      delete newProduct.handle;\n      newProduct.isVisible = false;\n      if (newProduct.title) {\n        // todo test this\n        newProduct.title = createTitle(newProduct.title, newProduct._id);\n        newProduct.handle = createHandle(\n          Reaction.getSlug(newProduct.title),\n          newProduct._id\n        );\n      }\n      Hooks.Events.run(\"beforeInsertCatalogProductInsertRevision\", newProduct);\n      result = Products.insert(newProduct, { validate: false });\n      Hooks.Events.run(\"afterInsertCatalogProduct\", newProduct);\n      results.push(result);\n\n      // cloning variants\n      const variants = Products.find({\n        ancestors: {\n          $in: [product._id]\n        },\n        type: \"variant\"\n      }).fetch();\n      // why we are using `_.sortBy` described in `products/cloneVariant`\n      const sortedVariants = _.sortBy(variants, (doc) => doc.ancestors.length);\n      for (const variant of sortedVariants) {\n        const variantNewId = Random.id();\n        setId({\n          oldId: variant._id,\n          newId: variantNewId\n        });\n        const ancestors = buildAncestors(variant.ancestors);\n        const newVariant = Object.assign({}, variant, {\n          _id: variantNewId,\n          ancestors\n        });\n        delete newVariant.updatedAt;\n        delete newVariant.createdAt;\n        delete newVariant.publishedAt; // TODO can variant have this param?\n\n        Hooks.Events.run(\"beforeInsertCatalogProductInsertRevision\", newVariant);\n        result = Products.insert(newVariant, { validate: false });\n        Hooks.Events.run(\"afterInsertCatalogProduct\", newVariant);\n        copyMedia(productNewId, variant._id, variantNewId);\n        results.push(result);\n      }\n    }\n    return results;\n  },\n\n  /**\n   * @name products/createProduct\n   * @memberof Methods/Products\n   * @method\n   * @summary when we create a new product, we create it with an empty variant.\n   * all products have a variant with pricing and details\n   * @param {Object} [product] - optional product object\n   * @return {String} The new product ID\n   */\n  \"products/createProduct\"(product) {\n    check(product, Match.Optional(Object));\n\n    // Ensure user has createProduct permission for active shop\n    if (!Reaction.hasPermission(\"createProduct\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // also if a product is provided, check first that the user doesn't mock a shop with no permissions to it\n    if (product) {\n      if (!product.shopId || !Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n        throw new Meteor.Error(\"invalid-parameter\", \"Product should have a valid shopId\");\n      }\n\n      // Create product revision\n      Hooks.Events.run(\"beforeInsertCatalogProductInsertRevision\", product);\n\n      return Products.insert(product);\n    }\n\n    const newSimpleProduct = createProduct();\n\n    // Create simple product revision\n    Hooks.Events.run(\"afterInsertCatalogProductInsertRevision\", newSimpleProduct);\n\n    const newVariant = createProduct({\n      ancestors: [newSimpleProduct._id],\n      price: 0.00,\n      title: \"\",\n      type: \"variant\" // needed for multi-schema\n    });\n\n    // Create variant revision\n    Hooks.Events.run(\"afterInsertCatalogProductInsertRevision\", newVariant);\n\n    return newSimpleProduct._id;\n  },\n\n  /**\n   * @name products/archiveProduct\n   * @memberof Methods/Products\n   * @method\n   * @summary archive a product and unlink it from all media\n   * @param {String} productId - productId to delete\n   * @returns {Number} returns number of removed products\n   */\n  \"products/archiveProduct\"(productId) {\n    check(productId, Match.OneOf(Array, String));\n\n    let extractedProductId;\n    if (Array.isArray(productId)) {\n      [extractedProductId] = productId;\n    }\n\n    // Check first if Product exists and then if user has the right to delete it\n    const product = Products.findOne(extractedProductId || productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    let productIds;\n\n    if (!Array.isArray(productId)) {\n      productIds = [productId];\n    } else {\n      productIds = productId;\n    }\n    const productsWithVariants = Products.find({\n      // Don't \"archive\" products that are already marked deleted.\n      isDeleted: {\n        $in: [false, undefined]\n      },\n      $or: [{\n        _id: {\n          $in: productIds\n        }\n      }, {\n        ancestors: {\n          $in: productIds\n        }\n      }]\n    }).fetch();\n\n    const ids = [];\n    productsWithVariants.map((doc) => {\n      ids.push(doc._id);\n      return ids;\n    });\n\n    // Flag the product and all its variants as deleted in the Revisions collection.\n    productsWithVariants.forEach((toArchiveProduct) => {\n      Hooks.Events.run(\"beforeRemoveCatalogProduct\", toArchiveProduct, { userId: this.userId });\n\n      Hooks.Events.run(\"afterRemoveCatalogProduct\", this.userId, toArchiveProduct);\n    });\n\n    const numFlaggedAsDeleted = Revisions.find({\n      \"documentId\": {\n        $in: ids\n      },\n      \"documentData.isDeleted\": true\n    }).count();\n\n    if (numFlaggedAsDeleted > 0) {\n      // Flag associated MediaRecords as deleted.\n      MediaRecords.update({\n        \"metadata.productId\": {\n          $in: ids\n        },\n        \"metadata.variantId\": {\n          $in: ids\n        }\n      }, {\n        $set: {\n          \"metadata.isDeleted\": true\n        }\n      });\n      return numFlaggedAsDeleted;\n    }\n\n    Logger.debug(`${numFlaggedAsDeleted} products have been flagged as deleted`);\n  },\n\n  /**\n   * @name products/updateProductField\n   * @memberof Methods/Products\n   * @method\n   * @summary update single product or variant field\n   * @param {String} _id - product._id or variant._id to update\n   * @param {String} field - key to update\n   * @param {*} value - update property value\n   * @todo rename it to something like \"products/updateField\" to  reflect\n   * @todo we need to know which type of entity field belongs. For that we could\n   * do something like: const type = Products.findOne(_id).type or transmit type\n   * as param if it possible\n   * latest changes. its used for products and variants\n   * @return {Number} returns update result\n   */\n  \"products/updateProductField\"(_id, field, value) {\n    check(_id, String);\n    check(field, String);\n    check(value, Match.OneOf(String, Object, Array, Boolean, Number));\n\n    // Must have createProduct permission for active shop\n    if (!Reaction.hasPermission(\"createProduct\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // Check first if Product exists and then if user has the right to alter it\n    const doc = Products.findOne(_id);\n    if (!doc) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, doc.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const { type } = doc;\n    let update;\n    // handle booleans with correct typing\n    if (value === \"false\" || value === \"true\") {\n      const booleanValue = (value === \"true\" || value === true);\n      update = EJSON.parse(`{\"${field}\":${booleanValue}}`);\n    } else if (field === \"handle\") {\n      update = {\n        // TODO: write function to ensure new handle is unique.\n        // Should be a call similar to the line below.\n        [field]: createHandle(value, _id) // handle should be unique\n      };\n    } else if (field === \"title\" && doc.handle === doc._id) { // update handle once title is set\n      const handle = createHandle(Reaction.getSlug(value), _id);\n      update = {\n        [field]: value,\n        handle\n      };\n    } else {\n      const stringValue = EJSON.stringify(value);\n      update = EJSON.parse(`{\"${field}\":${stringValue}}`);\n    }\n\n\n    // we need to use sync mode here, to return correct error and result to UI\n    let result;\n\n    try {\n      result = updateCatalogProduct(\n        this.userId,\n        {\n          _id\n        },\n        {\n          $set: update\n        },\n        {\n          selector: { type }\n        }\n      );\n    } catch (e) {\n      throw new Meteor.Error(\"server-error\", e.message);\n    }\n\n    // If we get a result from the product update,\n    // meaning the update went past revision control,\n    // denormalize and attach results to top-level product\n    if (result === 1) {\n      if (type === \"variant\" && toDenormalize.indexOf(field) >= 0) {\n        denormalize(doc.ancestors[0], field);\n      }\n    }\n    return result;\n  },\n\n  /**\n   * @name products/updateProductTags\n   * @memberof Methods/Products\n   * @method\n   * @summary method to insert or update tag with hierarchy\n   * @param {String} productId - productId\n   * @param {String} tagName - tagName\n   * @param {String} tagId - tagId\n   * @return {Number} return result\n   */\n  \"products/updateProductTags\"(productId, tagName, tagId) {\n    check(productId, String);\n    check(tagName, String);\n    check(tagId, Match.OneOf(String, null));\n\n    // Check first if Product exists and then if user has the right to alter it\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    const newTag = {\n      slug: Reaction.getSlug(tagName),\n      name: tagName\n    };\n\n    const existingTag = Tags.findOne({\n      slug: Reaction.getSlug(tagName)\n    });\n\n    if (existingTag) {\n      const productCount = Products.find({\n        _id: productId,\n        hashtags: existingTag._id\n      }).count();\n      if (productCount > 0) {\n        throw new Meteor.Error(\"server-error\", \"Existing Tag, Update Denied\");\n      }\n      return updateCatalogProduct(\n        this.userId,\n        {\n          _id: productId\n        },\n        {\n          $push: {\n            hashtags: existingTag._id\n          }\n        },\n        {\n          selector: { type: \"simple\" }\n        }\n      );\n    } else if (tagId) {\n      return Tags.update(tagId, { $set: newTag });\n    }\n\n    const newTagId = Meteor.call(\"shop/createTag\", tagName, false);\n\n    // if result is an Error object, we return it immediately\n    if (typeof newTagId !== \"string\") {\n      return newTagId;\n    }\n\n    return updateCatalogProduct(\n      this.userId,\n      {\n        _id: productId\n      },\n      {\n        $push: {\n          hashtags: newTagId\n        }\n      },\n      {\n        selector: { type: \"simple\" }\n      }\n    );\n  },\n\n  /**\n   * @name products/removeProductTag\n   * @memberof Methods/Products\n   * @method\n   * @summary method to remove tag from product\n   * @param {String} productId - productId\n   * @param {String} tagId - tagId\n   * @return {String} return update result\n   */\n  \"products/removeProductTag\"(productId, tagId) {\n    check(productId, String);\n    check(tagId, String);\n\n    // Check first if Product exists and then if user has the right to alter it\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    updateCatalogProduct(\n      this.userId,\n      {\n        _id: productId\n      },\n      {\n        $pull: {\n          hashtags: tagId\n        }\n      },\n      {\n        selector: { type: \"simple\" }\n      }\n    );\n  },\n\n  /**\n   * @name products/setHandle\n   * @memberof Methods/Products\n   * @method\n   * @summary copy of \"products/setHandleTag\", but without tag\n   * @param {String} productId - productId\n   * @returns {String} handle - product handle\n   */\n  \"products/setHandle\"(productId) {\n    check(productId, String);\n\n    // Check first if Product exists and then if user has the right to alter it\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    let handle = Reaction.getSlug(product.title);\n    handle = createHandle(handle, product._id);\n    updateCatalogProduct(\n      this.userId,\n      {\n        _id: product._id\n      },\n      {\n        $set: { handle, type: \"simple\" }\n      },\n    );\n\n    return handle;\n  },\n\n  /**\n   * @name products/setHandleTag\n   * @memberof Methods/Products\n   * @method\n   * @summary set or toggle product handle\n   * @param {String} productId - productId\n   * @param {String} tagId - tagId\n   * @return {String} return update result\n   */\n  \"products/setHandleTag\"(productId, tagId) {\n    check(productId, String);\n    check(tagId, String);\n    // Check first if Product exists and then if user has the right to alter it\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    function getSet(handle) {\n      return {\n        $set: {\n          handle,\n          type: \"simple\"\n        }\n      };\n    }\n\n    const tag = Tags.findOne(tagId);\n    // set handle\n    if (product.handle === tag.slug) {\n      let handle = Reaction.getSlug(product.title);\n      handle = createHandle(handle, product._id);\n      Products.update(product._id, getSet(handle));\n\n      return handle;\n    }\n    // toggle handle\n    const existingHandles = Products.find({\n      handle: tag.slug\n    }).fetch();\n    // this is needed to take care about product's handle which(product) was\n    // previously tagged.\n    for (const currentProduct of existingHandles) {\n      const currentProductHandle = createHandle(\n        Reaction.getSlug(currentProduct.title),\n        currentProduct._id\n      );\n      updateCatalogProduct(\n        this.userId,\n        {\n          _id: currentProduct._id\n        },\n        getSet(currentProductHandle)\n      );\n    }\n\n    updateCatalogProduct(\n      this.userId,\n      {\n        _id: product._id\n      },\n      getSet(tag.slug)\n    );\n\n    return tag.slug;\n  },\n\n  /**\n   * @name products/updateProductPosition\n   * @memberof Methods/Products\n   * @method\n   * @summary update product grid positions\n   * @param {String} productId - productId\n   * @param {Object} positionData -  an object with position,dimensions\n   * @param {String} tag - current route name. If it is not tag, then we using\n   * shop name as base `positions` name. Could be useful for multi-shopping.\n   * @return {Number} collection update returns\n   */\n  \"products/updateProductPosition\"(productId, positionData, tag) {\n    check(productId, String);\n    check(positionData, Object);\n    check(tag, String);\n\n    // Check first if Product exists and then if user has the proper rights\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    const position = `positions.${tag}.position`;\n    const pinned = `positions.${tag}.pinned`;\n    const weight = `positions.${tag}.weight`;\n    const updatedAt = `positions.${tag}.updatedAt`;\n\n    return updateCatalogProduct(\n      this.userId,\n      {\n        _id: productId\n      },\n      {\n        $set: {\n          [position]: positionData.position,\n          [pinned]: positionData.pinned,\n          [weight]: positionData.weight,\n          [updatedAt]: new Date(),\n          type: \"simple\" // for multi-schema\n        }\n      }\n    );\n  },\n\n  /**\n   * @name products/updateVariantsPosition\n   * @memberof Methods/Products\n   * @method\n   * @description updates top level variant position index\n   * @param {Array} sortedVariantIds - array of top level variant `_id`s\n   * @since 0.11.0\n   * @return {Number} Products.update result\n   */\n  \"products/updateVariantsPosition\"(sortedVariantIds) {\n    check(sortedVariantIds, [String]);\n\n    // This checks to make sure the user has createProduct permissions for the active shop.\n    // TODO: We should determine if that is the correct role that a user should have\n    // to be permitted to re-arrange products on the grid\n    if (!Reaction.hasPermission(\"createProduct\")) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    sortedVariantIds.forEach((id, index) => {\n      updateCatalogProduct(\n        this.userId,\n        {\n          _id: id\n        },\n        {\n          $set: { index }\n        },\n        {\n          selector: { type: \"variant\" }\n        }\n      );\n      Logger.debug(`Variant ${id} position was updated to index ${index}`);\n    });\n  },\n\n  /**\n   * @name products/updateMetaFields\n   * @memberof Methods/Products\n   * @method\n   * @summary update product metafield\n   * @param {String} productId - productId\n   * @param {Object} updatedMeta - update object with metadata\n   * @param {Object|Number|undefined|null} meta - current meta object, or a number index\n   * @todo should this method works for variants also?\n   * @return {Number} collection update result\n   */\n  \"products/updateMetaFields\"(productId, updatedMeta, meta) {\n    check(productId, String);\n    check(updatedMeta, Object);\n    check(meta, Match.OneOf(Object, Number, undefined, null));\n\n    // Check first if Product exists and then if user has the proper rights\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    // update existing metadata\n    if (typeof meta === \"object\") {\n      return updateCatalogProduct(\n        this.userId,\n        {\n          _id: productId,\n          metafields: meta\n        }, {\n          $set: {\n            \"metafields.$\": updatedMeta\n          }\n        }, {\n          selector: { type: \"simple\", metafields: meta }\n        }\n      );\n    } else if (typeof meta === \"number\") {\n      return updateCatalogProduct(\n        this.userId,\n        {\n          _id: productId\n        },\n        {\n          $set: {\n            [`metafields.${meta}`]: updatedMeta\n          }\n        },\n        {\n          selector: { type: \"simple\", metafields: meta }\n        }\n      );\n    }\n\n    // adds metadata\n    return updateCatalogProduct(\n      this.userId,\n      {\n        _id: productId\n      },\n      {\n        $addToSet: {\n          metafields: updatedMeta\n        }\n      },\n      {\n        selector: { type: \"simple\" }\n      }\n    );\n  },\n\n  /**\n   * @name products/removeMetaFields\n   * @memberof Methods/Products\n   * @method\n   * @summary update product metafield\n   * @param {String} productId - productId\n   * @param {Object} metafields - metadata object to remove\n   * @param {Object} type - optional product type for schema selection\n   * @return {Number} collection update result\n   */\n  \"products/removeMetaFields\"(productId, metafields, type = \"simple\") {\n    check(productId, String);\n    check(metafields, Object);\n    check(type, String);\n\n    // Check first if Product exists and then if user has the proper rights\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    return updateCatalogProduct(\n      this.userId,\n      {\n        _id: productId,\n        type\n      },\n      {\n        $pull: { metafields }\n      }\n    );\n  },\n\n  /**\n   * @name products/publishProduct\n   * @memberof Methods/Products\n   * @method\n   * @summary publish (visibility) of product\n   * @todo hook into publishing flow\n   * @param {String} productId - productId\n   * @return {Boolean} product.isVisible\n   */\n  \"products/publishProduct\"(productId) {\n    check(productId, String);\n\n    // Check first if Product exists and then if user has the proper rights\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    } else if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const variants = Products.find({\n      ancestors: {\n        $in: [productId]\n      }\n    }).fetch();\n    let variantValidator = true;\n\n    if (typeof product === \"object\" && product.title.length > 1) {\n      if (variants.length > 0) {\n        variants.forEach((variant) => {\n          // if this is a top variant with children, we avoid it to check price\n          // because we using price of its children\n          if ((variant.ancestors.length === 1 && !Catalog.getVariants(variant._id, \"variant\").length) ||\n            variant.ancestors.length !== 1) {\n            if (!(typeof variant.price === \"number\" && variant.price > 0)) {\n              variantValidator = false;\n            }\n          }\n          // if variant has no title\n          if (typeof variant.title === \"string\" && !variant.title.length) {\n            variantValidator = false;\n          }\n          if (typeof variant.optionTitle === \"string\" && !variant.optionTitle.length) {\n            variantValidator = false;\n          }\n        });\n      } else {\n        Logger.debug(\"invalid product visibility \", productId);\n        throw new Meteor.Error(\"invalid-parameter\", \"Variant is required\");\n      }\n\n      if (!variantValidator) {\n        Logger.debug(\"invalid product visibility \", productId);\n        throw new Meteor.Error(\n          \"invalid-parameter\",\n          \"Some properties are missing.\"\n        );\n      }\n\n      // update product visibility\n      Logger.debug(\"toggle product visibility \", product._id, !product.isVisible);\n\n      const res = updateCatalogProduct(\n        this.userId,\n        {\n          _id: product._id\n        },\n        {\n          $set: {\n            isVisible: !product.isVisible\n          }\n        },\n        {\n\n          selector: { type: \"simple\" }\n        }\n      );\n\n      // update product variants visibility\n      updateVariantProductField(variants, \"isVisible\", !product.isVisible);\n      // if collection updated we return new `isVisible` state\n      return res === 1 && !product.isVisible;\n    }\n    Logger.debug(\"invalid product visibility \", productId);\n    throw new Meteor.Error(\"invalid-parameter\", \"Bad Request\");\n  },\n\n  /**\n   * @name products/toggleVisibility\n   * @memberof Methods/Products\n   * @method\n   * @summary publish (visibility) of product\n   * @todo hook into publishing flow\n   * @param {String} productId - productId\n   * @return {Boolean} product.isVisible\n   */\n  \"products/toggleVisibility\"(productId) {\n    check(productId, String);\n\n    // Check first if Product exists and then if user has the proper rights\n    const product = Products.findOne(productId);\n    if (!product) {\n      throw new Meteor.Error(\"not-found\", \"Product not found\");\n    }\n\n    if (!Reaction.hasPermission(\"createProduct\", this.userId, product.shopId)) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const res = updateCatalogProduct(\n      this.userId,\n      {\n        _id: productId\n      },\n      {\n        $set: {\n          isVisible: !product.isVisible\n        }\n      },\n      {\n        selector: {\n          type: product.type\n        }\n      }\n    );\n\n    if (Array.isArray(product.ancestors) && product.ancestors.length) {\n      const updateId = product.ancestors[0] || product._id;\n      const updatedPriceRange = ReactionProduct.getProductPriceRange(updateId);\n\n      Meteor.call(\"products/updateProductField\", updateId, \"price\", updatedPriceRange);\n    }\n\n    // if collection updated we return new `isVisible` state\n    return res === 1 && !product.isVisible;\n  }\n});\n","import getServiceConfig from \"nodemailer-wellknown\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Jobs, Packages } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\n\n/**\n * @file Methods for sending emails, retrying failed emails and verifying email configuration.\n * Run these methods using `Meteor.call()`\n *\n * @example Meteor.call(\"emails/retryFailed\", email._id, (err)\n * @namespace Methods/Email\n*/\nMeteor.methods({\n  /**\n   * @name email/verifySettings\n   * @method\n   * @summary Verify the current email configuration\n   * @memberof Methods/Email\n   * @param {Object} settings - optional settings object (otherwise uses settings in database)\n   * @return {Boolean} - returns true if SMTP connection succeeds\n   */\n  \"email/verifySettings\"(settings) {\n    if (!Reaction.hasPermission([\"owner\", \"admin\", \"dashboard\"], this.userId)) {\n      Logger.error(\"email/verifySettings: Access Denied\");\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    this.unblock();\n\n    check(settings, Match.Optional(Object));\n\n    let config;\n\n    // if a settings object has been provided, build a config\n    if (typeof settings === \"object\") {\n      const { service, host, port, user, password } = settings;\n\n      if (service === \"custom\" && host && port) {\n        // create a custom Nodemailer config\n        config = { host, port };\n\n        if (host === \"localhost\") {\n          config.ignoreTLS = true;\n        }\n      } else if (service) {\n        // create a Nodemailer config from the nodemailer-wellknown services\n        config = getServiceConfig(service) || {};\n      }\n\n      if (user && password) {\n        config.auth = { user, pass: password };\n      }\n    }\n\n    const { Email } = Reaction;\n\n    const conf = config || Email.getMailConfig();\n\n    Logger.debug(conf, \"Verifying email config settings\");\n\n    try {\n      return Meteor.wrapAsync(Email.verifyConfig)(conf);\n    } catch (e) {\n      Logger.error(e);\n      throw new Meteor.Error(e.responseCode, e.response);\n    }\n  },\n\n  /**\n   * @name email/saveSettings\n   * @method\n   * @summary Save new email configuration\n   * @memberof Methods/Email\n   * @param {Object} settings - mail provider settings\n   * @return {Boolean} - returns true if update succeeds\n   */\n  \"email/saveSettings\"(settings) {\n    if (!Reaction.hasPermission([\"owner\", \"admin\", \"dashboard\"], this.userId)) {\n      Logger.error(\"email/saveSettings: Access Denied\");\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    check(settings, {\n      service: String,\n      host: Match.Optional(String),\n      port: Match.Optional(Number),\n      user: Match.Optional(String),\n      password: Match.Optional(String)\n    });\n\n    Packages.update({ name: \"core\", shopId: Reaction.getShopId() }, {\n      $set: {\n        \"settings.mail\": settings\n      }\n    });\n\n    delete settings.password;\n\n    Logger.info(settings, \"Email settings updated\");\n\n    return true;\n  },\n\n  /**\n   * @name email/retryFailed\n   * @method\n   * @summary Retry a failed or cancelled email job\n   * @memberof Methods/Email\n   * @param {String} jobId - a sendEmail job ID\n   * @return {Boolean} - returns true if job is successfully restarted\n   */\n  \"emails/retryFailed\"(jobId) {\n    if (!Reaction.hasPermission([\"owner\", \"admin\", \"reaction-email\"], this.userId)) {\n      Logger.error(\"email/retryFailed: Access Denied\");\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    check(jobId, String);\n    let emailJobId = jobId;\n\n    Logger.debug(`emails/retryFailed - restarting email job \"${jobId}\"`);\n\n    // Get email job to retry\n    const job = Jobs.getJob(jobId);\n    // If this job was never completed, restart it and set it to \"ready\"\n    if (job._doc.status !== \"completed\") {\n      job.restart();\n      job.ready();\n    } else {\n      // Otherwise rerun the completed job\n      // `rerun` clones the job and returns the id.\n      // We'll set the new one to ready\n      emailJobId = job.rerun(); // Clone job to rerun\n    }\n\n    // Set the job status to ready to trigger the Jobs observer to trigger sendEmail\n    Jobs.update({ _id: emailJobId }, {\n      $set: {\n        status: \"ready\"\n      }\n    });\n\n    return true;\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\n\n/**\n * @file Meteor methods for Reaction\n *\n *\n * @namespace Methods/Reaction\n*/\nMeteor.methods({\n  /**\n   * @name reaction/getUserId\n   * @method\n   * @memberof Methods/Reaction\n   * @summary return server side userId if available\n   * @return {String} userId - if available\n   */\n  \"reaction/getUserId\"() {\n    return Meteor.userId();\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Translations } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\nimport { reloadAllTranslations, reloadTranslationsForShop } from \"/server/startup/i18n\";\n\nMeteor.methods({\n  /**\n   * @name i18n/flushTranslations\n   * @method\n   * @memberof i18n\n   * @example Meteor.call(\"i18n/flushTranslations\")\n   * @summary Method to remove all translations for the current shop, and reload from jsonFiles\n   * @return {undefined}\n   */\n  \"i18n/flushTranslations\"() {\n    if (!Reaction.hasAdminAccess()) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    const shopId = Reaction.getShopId();\n    reloadTranslationsForShop(shopId);\n  },\n\n  /**\n * @name i18n/flushAllTranslations\n * @method\n * @memberof i18n\n * @example Meteor.call(\"i18n/flushAllTranslations\")\n * @summary Method to remove all translations for all shops, and reload from jsonFiles\n * @return {undefined}\n */\n  \"i18n/flushAllTranslations\"() {\n    if (!Reaction.hasPermission(\"admin\", Meteor.userId(), Reaction.getPrimaryShopId())) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n\n    reloadAllTranslations();\n  },\n\n  /**\n   * @name i18n/addTranslation\n   * @method\n   * @memberof i18n\n   * @example Meteor.call(\"i18n/addTranslation\", \"en\", \"addProductLabel\", \"Add product\")\n   * @param {String | Array} lng - language\n   * @param {String} namespace - namespace\n   * @param {String} key - i18n key\n   * @param {String} message - i18n message\n   * @summary Meteor method to add translations\n   * @return {String} insert result\n   */\n  \"i18n/addTranslation\"(lng, namespace, key, message) {\n    check(lng, Match.OneOf(String, Array));\n    check(namespace, String);\n    check(key, String);\n    check(message, String);\n    // string or first langauge\n    let i18n = lng;\n    if (typeof lng === \"object\") {\n      [i18n] = lng;\n    }\n\n    if (!Reaction.hasAdminAccess()) {\n      throw new Meteor.Error(\"access-denied\", \"Access Denied\");\n    }\n    const tran = `\n      \"i18n\": \"${i18n}\",\n      \"shopId\": \"${Reaction.getShopId()}\"\n    `;\n\n    const setTran = `\"translation.${namespace}.${key}\": \"${message}\"`;\n    Translations.update({ tran }, { setTran });\n  }\n});\n","import { ServiceConfiguration } from \"meteor/service-configuration\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * Publish ServiceConfiguration\n * @param {String} checkUserId - we not using it directly because if shows not\n * correct userId. Instead of it we are believe only to `this.userId`\n */\nMeteor.publish(\"ServiceConfiguration\", function (checkUserId) {\n  check(checkUserId, Match.OneOf(String, null));\n  if (this.userId === null) {\n    return this.ready();\n  }\n  // Admins and account managers can manage the login methods for the shop\n  if (Roles.userIsInRole(\n    this.userId, [\"owner\", \"admin\", \"dashboard/accounts\"],\n    Reaction.getShopId()\n  )) {\n    return ServiceConfiguration.configurations.find({}, {\n      fields: {\n        secret: 1\n      }\n    });\n  }\n\n  return ServiceConfiguration.configurations.find({});\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport * as Collections from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * accounts\n */\n\nMeteor.publish(\"Accounts\", function (userId) {\n  check(userId, Match.OneOf(String, null));\n  // we could additionally make checks of useId defined, but this could lead to\n  // situation when user will may not have time to get an account\n  if (this.userId === null) {\n    return this.ready();\n  }\n\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  const nonAdminGroups = Collections.Groups.find({\n    name: { $in: [\"guest\"] },\n    shopId\n  }, {\n    fields: { _id: 1 }\n  }).fetch().map((group) => group._id);\n\n  // global admin can get all accounts\n  if (Roles.userIsInRole(this.userId, [\"owner\"], Roles.GLOBAL_GROUP)) {\n    return Collections.Accounts.find({\n      groups: { $nin: nonAdminGroups }\n    });\n\n  // shop admin gets accounts for just this shop\n  } else if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\", \"reaction-accounts\"], shopId)) {\n    return Collections.Accounts.find({\n      groups: { $nin: nonAdminGroups },\n      shopId\n    });\n  }\n\n  // regular users should get just their account\n  return Collections.Accounts.find({\n    userId: this.userId\n  });\n});\n\n/**\n * Single account\n * @params {String} userId -  id of user to find\n */\nMeteor.publish(\"UserAccount\", function (userId) {\n  check(userId, Match.OneOf(String, null));\n\n  const shopId = Reaction.getShopId();\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\"], shopId)) {\n    return Collections.Accounts.find({\n      userId\n    });\n  }\n  return this.ready();\n});\n\n/**\n * userProfile\n * @deprecated since version 0.10.2\n * get any user name,social profile image\n * should be limited, secure information\n * users with permissions  [\"dashboard/orders\", \"owner\", \"admin\", \"dashboard/\n * customers\"] may view the profileUserId\"s profile data.\n *\n * @params {String} profileUserId -  view this users profile when permitted\n */\nMeteor.publish(\"UserProfile\", function (profileUserId) {\n  check(profileUserId, Match.OneOf(String, null));\n  if (this.userId === null) {\n    return this.ready();\n  }\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n  const permissions = [\"dashboard/orders\", \"owner\", \"admin\",\n    \"dashboard/customers\"];\n  // no need to normal user so see his password hash\n  const fields = {\n    \"emails\": 1,\n    \"name\": 1,\n    \"profile.lang\": 1,\n    \"profile.firstName\": 1,\n    \"profile.lastName\": 1,\n    \"profile.familyName\": 1,\n    \"profile.secondName\": 1,\n    \"profile.name\": 1,\n    \"services.twitter.profile_image_url_https\": 1,\n    \"services.facebook.id\": 1,\n    \"services.google.picture\": 1,\n    \"services.github.username\": 1,\n    \"services.instagram.profile_picture\": 1\n  };\n  // TODO: this part currently not working as expected.\n  // we could have three situation here:\n  // 1 - registered user log in.\n  // 2 - admin log in\n  // 3 - admin want to get user data\n  // I'm not sure about the 3rd case, but we do not cover 2nd case here, because\n  // we can see a situation when anonymous user still represented by\n  // `profileUserId`, but admin user already could be found by `this.userId`\n  // In that case what we should do here?\n  if (profileUserId !== this.userId && Roles.userIsInRole(\n    this.userId,\n    permissions, shopId ||\n    Roles.userIsInRole(this.userId, permissions, Roles.GLOBAL_GROUP)\n  )) {\n    return Meteor.users.find({\n      _id: profileUserId\n    }, {\n      fields\n    });\n  }\n\n  return Meteor.users.find({\n    _id: this.userId\n  }, {\n    fields\n  });\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Cart, MediaRecords } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * cart\n */\n\nMeteor.publish(\"Cart\", function (sessionId, userId) {\n  check(sessionId, Match.OneOf(String, null));\n  check(userId, Match.OptionalOrNull(String));\n  // sessionId is required, not for selecting the cart, (userId), but as a key\n  // in merging anonymous user carts into authenticated existing user carts.\n  // we won't create carts unless we've got sessionId\n  if (this.userId === null || sessionId === null) {\n    return this.ready();\n  }\n  // use case happens between switching from anonymous to registered user. and\n  // vice versa\n  if (typeof userId === \"string\" && this.userId !== userId) {\n    return this.ready();\n  }\n  // we have a very rare case when cart has not been created for an anonymous\n  // and because of that, for some reason, he is considered as not logged in.\n  // in that case he doesn't have `userId`. Only way for him to get userId is\n  // to flush browser's session or log in as normal user. We could detect this\n  // case from here by comparing this.userId is string and this.userId !==\n  // Meteor.userId(). If this case will happens someday, we could try to send\n  // some logout call to accounts. This is it: https://github.com/meteor/meteor/\n  // issues/5103\n\n  // shopId is also required.\n  let shopId = Reaction.getPrimaryShopId();\n  const marketplaceSettings = Reaction.getMarketplaceSettings();\n  if (marketplaceSettings && marketplaceSettings.public && marketplaceSettings.public.merchantCart === true) {\n    shopId = Reaction.getShopId();\n  }\n\n  if (!shopId) {\n    return this.ready();\n  }\n\n  // exclude these fields\n  // from the client cart\n  const fields = {\n    taxes: 0\n  };\n\n  // select user cart\n  const cart = Cart.find({\n    userId: this.userId,\n    shopId\n  }, {\n    fields\n  });\n\n  if (cart.count()) {\n    // we could keep `sessionId` of normal user up to date from here, but with\n    // current session logic we don't need this. That's why we just return\n    // cursor as is with whatever `sessionId`.\n    return cart;\n  }\n  // we may create a cart if we didn't find one.\n  const cartId = Meteor.call(\"cart/createCart\", this.userId, sessionId);\n\n  return Cart.find(cartId);\n});\n\n\nMeteor.publish(\"CartImages\", (cartId) => {\n  check(cartId, Match.Optional(String));\n  if (!cartId) return [];\n\n  const cart = Cart.findOne(cartId);\n  const { items: cartItems } = cart || {};\n  if (!Array.isArray(cartItems)) return [];\n\n  // Ensure each of these are unique\n  const productIds = [...new Set(cartItems.map((item) => item.product._id))];\n  const variantIds = [...new Set(cartItems.map((item) => item.variants._id))];\n\n  // return image for each the top level product or the variant and let the client code decide which to display\n  return MediaRecords.find({\n    \"$or\": [\n      {\n        \"metadata.productId\": {\n          $in: productIds\n        }\n      },\n      {\n        \"metadata.variantId\": {\n          $in: variantIds\n        }\n      }\n    ],\n    \"metadata.workflow\": {\n      $nin: [\"archived\", \"unpublished\"]\n    }\n  });\n});\n","import { Groups } from \"/lib/collections\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\n\nMeteor.publish(\"Groups\", function (query = {}) {\n  check(query, Object);\n  const shopId = query.shopId || Reaction.getShopId();\n\n  if (!shopId) {\n    return this.ready();\n  }\n  const select = query || {};\n  select.shopId = shopId;\n  return Groups.find(select);\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { MediaRecords } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * BrandAssets publication\n *\n * Publishes all media where metadata.type is \"brandAsset\".\n * No security checks.\n */\nMeteor.publish(\"BrandAssets\", () => MediaRecords.find({ \"metadata.type\": \"brandAsset\" }));\n\n/**\n * ProductGridMedia publication\n *\n * Publishes all published media associated with any of the product IDs passed in.\n *\n * For those with createProduct permission, non-published associated media is also published.\n */\nMeteor.publish(\"ProductGridMedia\", function productGridMediaPublish(productIds) {\n  check(productIds, [String]);\n\n  if (productIds.length === 0) return [];\n\n  const selector = {\n    \"metadata.productId\": { $in: productIds },\n    // No one needs to see archived images on products\n    \"metadata.workflow\": {\n      $nin: [\"archived\"]\n    }\n  };\n\n  // Product editors can see both published and unpublished images\n  // There is an implied shopId in Reaction.hasPermission that defaults to\n  // the active shopId via Reaction.getShopId\n  if (!Reaction.hasPermission([\"createProduct\"], this.userId)) {\n    selector[\"metadata.workflow\"].$in = [null, \"published\"];\n  }\n\n  return MediaRecords.find(selector);\n});\n\n/**\n * ProductMedia publication\n *\n * Publishes all published media associated with the single product ID passed in.\n *\n * For those with createProduct permission, non-published associated media is also published.\n */\nMeteor.publish(\"ProductMedia\", function productMediaPublish(id) {\n  check(id, String);\n\n  const selector = {\n    \"metadata.productId\": id,\n    // No one needs to see archived images on products\n    \"metadata.workflow\": {\n      $nin: [\"archived\"]\n    }\n  };\n\n  // Product editors can see both published and unpublished images\n  // There is an implied shopId in Reaction.hasPermission that defaults to\n  // the active shopId via Reaction.getShopId\n  if (!Reaction.hasPermission([\"createProduct\"], this.userId)) {\n    selector[\"metadata.workflow\"].$in = [null, \"published\"];\n  }\n\n  return MediaRecords.find(selector);\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { EJSON } from \"meteor/ejson\";\n\nimport { Roles } from \"meteor/alanning:roles\";\n\nimport { Logger, Reaction } from \"/server/api\";\n\n/* eslint quote-props: 0 */\n/**\n * ShopMembers\n * This publication is only exposed to owner/admin in\n * Accounts page, and should not be used anywhere else.\n *\n * @return {Array} users\n */\nMeteor.publish(\"ShopMembers\", function () {\n  // here we are comparing with the string to make it compatible with tests\n  if (typeof this.userId !== \"string\") {\n    return this.ready();\n  }\n  const readPermissions = [\"reaction-orders\", \"owner\", \"admin\", \"reaction-accounts\"];\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  if (Roles.userIsInRole(this.userId, readPermissions, shopId)) {\n    // seems like we can't use \"`\" inside db.call directly\n    // do not add comments or otherwise format this query\n    const selector = `{\"roles.${shopId}\": {\"$nin\": [\"anonymous\"]}}`;\n    const publish = {\n      fields: {\n        _id: 1,\n        emails: 1,\n        username: 1,\n        roles: 1,\n        \"profile.lang\": 1,\n        \"services.google.name\": 1,\n        \"services.google.email\": 1,\n        \"services.google.picture\": 1,\n        \"services.twitter.name\": 1,\n        \"services.twitter.email\": 1,\n        \"services.twitter.profile_image_url_https\": 1,\n        \"services.facebook.name\": 1,\n        \"services.facebook.email\": 1,\n        \"services.facebook.id\": 1,\n        \"services.weibo.name\": 1,\n        \"services.weibo.email\": 1,\n        \"services.weibo.picture\": 1,\n        \"services.github.name\": 1,\n        \"services.github.email\": 1,\n        \"services.github.username\": 1\n      }\n    };\n\n    return Meteor.users.find(EJSON.parse(selector), publish);\n  }\n\n  Logger.debug(\"ShopMembers access denied\");\n  return this.ready();\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { ReactiveAggregate } from \"./reactiveAggregate\";\nimport { MediaRecords, Orders } from \"/lib/collections\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * A shared way of creating a projection\n * @param {String} shopId - shopId to filter records by\n * @param {Object} sort - An object containing a sort\n * @param {Number} limit - An optional limit of how many records to return\n * @param {Object} query - An optional query to match\n * @returns {Array} An array of projection operators\n * @private\n */\nfunction createAggregate(shopId, sort = { createdAt: -1 }, limit = 0, query = {}, skip = 0) {\n  // NOTE: in Mongo 3.4 using the $in operator will be supported for projection filters\n  const aggregate = [\n    { $match: { \"items.shopId\": shopId, ...query } },\n    {\n      $project: {\n        items: {\n          $filter: {\n            input: \"$items\",\n            as: \"item\",\n            cond: { $eq: [\"$$item.shopId\", shopId] }\n          }\n        },\n        billing: {\n          $filter: {\n            input: \"$billing\",\n            as: \"billing\",\n            cond: { $eq: [\"$$billing.shopId\", shopId] }\n          }\n        },\n        shipping: {\n          $filter: {\n            input: \"$shipping\",\n            as: \"shipping\",\n            cond: { $eq: [\"$$shipping.shopId\", shopId] }\n          }\n        },\n        cartId: 1,\n        sessionId: 1,\n        shopId: 1, // workflow is still stored at the top level and used to showing status\n        workflow: 1,\n        discount: 1,\n        tax: 1,\n        email: 1,\n        createdAt: 1,\n        userId: 1,\n        taxCalculationFailed: 1,\n        bypassAddressValidation: 1\n      }\n    },\n    { $sort: sort },\n    { $skip: skip }\n  ];\n\n  if (limit > 0) {\n    aggregate.push({ $limit: limit });\n  }\n  return aggregate;\n}\n\nMeteor.publish(\"Orders\", function () {\n  if (this.userId === null) {\n    return this.ready();\n  }\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  // return any order for which the shopId is attached to an item\n  const aggregateOptions = {\n    observeSelector: {\n      \"items.shopId\": shopId\n    }\n  };\n  const aggregate = createAggregate(shopId);\n\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\", \"orders\"], shopId)) {\n    ReactiveAggregate(this, Orders, aggregate, aggregateOptions);\n  } else {\n    return Orders.find({\n      shopId,\n      userId: this.userId\n    });\n  }\n});\n\n\nMeteor.publish(\"PaginatedOrders\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  if (this.userId === null) {\n    return this.ready();\n  }\n  const shopId = Reaction.getUserShopId(this.userId) || Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  // return any order for which the shopId is attached to an item\n  const aggregateOptions = {\n    observeSelector: {\n      \"items.shopId\": shopId\n    }\n  };\n  const limit = (options && options.limit) ? options.limit : 0;\n  const skip = (options && options.skip) ? options.skip : 0;\n  const aggregate = createAggregate(shopId, { createdAt: -1 }, limit, query, skip);\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\", \"orders\"], shopId)) {\n    Counts.publish(this, \"orders-count\", Orders.find(), { noReady: true });\n    ReactiveAggregate(this, Orders, aggregate, aggregateOptions);\n  } else {\n    return Orders.find({\n      shopId,\n      userId: this.userId\n    });\n  }\n});\n\n/**\n * account orders\n */\nMeteor.publish(\"AccountOrders\", function (userId, currentShopId) {\n  check(userId, String);\n  check(currentShopId, Match.OptionalOrNull(String));\n\n  if (this.userId === \"\") {\n    return this.ready();\n  }\n  const shopId = currentShopId || Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n  return Orders.find({\n    userId,\n    shopId\n  });\n});\n\n/**\n * completed cart order\n */\nMeteor.publish(\"CompletedCartOrder\", function (userId, cartId) {\n  check(userId, Match.OneOf(String, null));\n  check(cartId, String);\n  if (this.userId === null) {\n    return this.ready();\n  }\n  if (typeof userId === \"string\" && userId !== this.userId) {\n    return this.ready();\n  }\n\n  return Orders.find({\n    cartId,\n    userId\n  });\n});\n\nMeteor.publish(\"OrderImages\", (orderId) => {\n  check(orderId, Match.Optional(String));\n  if (!orderId) return [];\n\n  const order = Orders.findOne(orderId);\n  const { items: orderItems } = order || {};\n  if (!Array.isArray(orderItems)) return [];\n\n  // Ensure each of these are unique\n  const productIds = [...new Set(orderItems.map((item) => item.product._id))];\n  const variantIds = [...new Set(orderItems.map((item) => item.variants._id))];\n\n  // return image for each the top level product or the variant and let the client code decide which to display\n  return MediaRecords.find({\n    \"$or\": [\n      {\n        \"metadata.productId\": {\n          $in: productIds\n        }\n      },\n      {\n        \"metadata.variantId\": {\n          $in: variantIds\n        }\n      }\n    ],\n    \"metadata.workflow\": {\n      $nin: [\"archived\", \"unpublished\"]\n    }\n  });\n});\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\nimport { translateRegistry } from \"/lib/api\";\n\n/**\n * Packages contains user specific configuration\n * @summary  package publication settings, filtered by permissions\n * @param {Object} shopCursor - current shop object\n * @returns {Object} packagesCursor - current packages for shop\n */\n\n// for transforming packages before publication sets some defaults for the client and adds i18n while checking\n// privileged settings for enabled status.\nfunction transform(doc, userId) {\n  const registrySettings = {};\n  const packageSettings = {};\n  let permissions = [\"admin\", \"owner\", doc.name];\n\n  // Get all permissions, add them to an array\n  if (doc.registry && doc.registry.permissions) {\n    for (const item of doc.registry.permissions) {\n      permissions.push(item.permission);\n    }\n  }\n  permissions = _.uniq(permissions);\n\n  // check for admin,owner or package permissions to view settings\n  const hasAdmin = Roles.userIsInRole(userId, permissions, doc.shopId);\n\n  if (doc.registry) {\n    for (let registry of doc.registry) {\n      // add some normalized defaults\n      registry.packageId = doc._id;\n      registry.shopId = doc.shopId;\n      registry.packageName = registry.packageName || doc.name;\n      [registry.settingsKey] = (registry.name || doc.name).split(\"/\").splice(-1);\n      // check and set package enabled state\n      registry.permissions = [...permissions];\n      if (registry.route) {\n        registry.permissions.push(registry.name || `${doc.name}/${registry.template}`);\n      }\n      if (doc.settings && doc.settings[registry.settingsKey]) {\n        registry.enabled = !!doc.settings[registry.settingsKey].enabled;\n      } else {\n        registry.enabled = !!doc.enabled;\n      }\n      // define export settings\n      registrySettings[registry.settingsKey] = {\n        enabled: registry.enabled\n      };\n\n      // add i18n keys\n      registry = translateRegistry(registry, doc);\n    }\n  }\n  // admin users get all settings the intent of this it so block publication of settings without limiting the use settings\n  // in this transform. non admin users should get public setting\n  if (hasAdmin === false && doc.settings) {\n    registrySettings.public = doc.settings.public;\n    delete doc.settings;\n    Object.assign(packageSettings, registrySettings);\n    doc.settings = packageSettings;\n  }\n\n  return doc;\n}\n\n//\n//  Packages Publication\n//\nMeteor.publish(\"Packages\", function (shopId) {\n  check(shopId, Match.Maybe(String));\n\n  const self = this;\n  let myShopId = shopId;\n\n  // user is required.\n  if (self.userId) {\n    // default options, we're limiting fields here that we don't want to publish unless admin user. in particular, settings\n    // should not be published but we need to use settings in the transform everything except settings.public and\n    // settings.*.enabled are removed in transform\n    let options = {\n      fields: {\n        shopId: 1,\n        name: 1,\n        enabled: 1,\n        registry: 1,\n        layout: 1,\n        icon: 1,\n        settings: 1,\n        audience: 1\n      }\n    };\n\n    if (!shopId) {\n      myShopId = Reaction.getPrimaryShopId();\n    }\n\n    // we should always have a shop\n    if (myShopId) {\n      // if admin user, return all shop properties\n      if (Roles.userIsInRole(self.userId, [\n        \"dashboard\", \"owner\", \"admin\"\n      ], Reaction.getShopId() || Roles.userIsInRole(self.userId, [\n        \"owner\", \"admin\"\n      ], Roles.GLOBAL_GROUP))) {\n        options = {};\n      }\n      // observe and transform Package registry adds i18n and other meta data\n      const observer = Packages.find({\n        shopId: myShopId\n      }, options).observe({\n        added(doc) {\n          self.added(\"Packages\", doc._id, transform(doc, self.userId));\n        },\n        changed(newDoc, origDoc) {\n          self.changed(\"Packages\", origDoc._id, transform(newDoc, self.userId));\n        },\n        removed(origDoc) {\n          self.removed(\"Packages\", origDoc._id);\n        }\n      });\n\n      self.onStop(() => {\n        observer.stop();\n      });\n    }\n    return self.ready();\n  }\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Products, Revisions, Shops } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\nimport { RevisionApi } from \"/imports/plugins/core/revisions/lib/api/revisions\";\n\n/**\n * product detail publication\n * @param {String} productIdOrHandle - productId or handle\n * @return {Object} return product cursor\n */\nMeteor.publish(\"Product\", function (productIdOrHandle, shopIdOrSlug) {\n  check(productIdOrHandle, Match.OptionalOrNull(String));\n  check(shopIdOrSlug, Match.Maybe(String));\n\n  if (!productIdOrHandle) {\n    Logger.debug(\"ignoring null request on Product subscription\");\n    return this.ready();\n  }\n\n  const selector = {\n    $or: [{\n      _id: productIdOrHandle\n    }, {\n      handle: productIdOrHandle\n    }]\n  };\n\n  if (shopIdOrSlug) {\n    const shop = Shops.findOne({\n      $or: [{\n        _id: shopIdOrSlug\n      }, {\n        slug: shopIdOrSlug\n      }]\n    });\n\n    if (shop) {\n      selector.shopId = shop._id;\n    } else {\n      return this.ready();\n    }\n  }\n\n  // TODO review for REGEX / DOS vulnerabilities.\n  // Need to peek into product to get associated shop. This is important to check permissions.\n  const product = Products.findOne(selector);\n  if (!product) {\n    // Product not found, return empty subscription.\n    return this.ready();\n  }\n\n  const { _id } = product;\n\n  selector.isVisible = true;\n  selector.isDeleted = { $in: [null, false] };\n  selector.$or = [\n    { _id },\n    { ancestors: _id },\n    { handle: productIdOrHandle }];\n\n  // Authorized content curators for the shop get special publication of the product\n  // all all relevant revisions all is one package\n  if (Reaction.hasPermission([\"owner\", \"createProduct\"], this.userId, product.shopId)) {\n    selector.isVisible = {\n      $in: [true, false, undefined]\n    };\n\n    if (RevisionApi.isRevisionControlEnabled()) {\n      const handle = Revisions.find({\n        \"workflow.status\": {\n          $nin: [\n            \"revision/published\"\n          ]\n        },\n        \"$or\": [\n          { \"documentData._id\": _id },\n          { \"documentData.ancestors\": _id }\n        ]\n      }).observe({\n        added: (revision) => {\n          this.added(\"Revisions\", revision._id, revision);\n          if (revision.documentType === \"product\") {\n            // Check merge box (session collection view), if product is already in cache.\n            // If yes, we send a `changed`, otherwise `added`. I'm assuming\n            // that this._documents.Products is somewhat equivalent to the\n            // merge box Meteor.server.sessions[sessionId].getCollectionView(\"Products\").documents\n            if (this._documents.Products && this._documents.Products[revision.documentId]) {\n              this.changed(\"Products\", revision.documentId, { __revisions: [revision] });\n            } else {\n              this.added(\"Products\", revision.documentId, { __revisions: [revision] });\n            }\n          }\n        },\n        changed: (revision) => {\n          this.changed(\"Revisions\", revision._id, revision);\n          if (revision.documentType === \"product\") {\n            if (this._documents.Products && this._documents.Products[revision.documentId]) {\n              this.changed(\"Products\", revision.documentId, { __revisions: [revision] });\n            }\n          }\n        },\n        removed: (revision) => {\n          this.removed(\"Revisions\", revision._id);\n          if (revision.documentType === \"product\") {\n            if (this._documents.Products && this._documents.Products[revision.documentId]) {\n              this.changed(\"Products\", revision.documentId, { __revisions: [] });\n            }\n          }\n        }\n      });\n      this.onStop(() => {\n        handle.stop();\n      });\n    }\n  }\n\n  return Products.find(selector);\n});\n","import _ from \"lodash\";\nimport SimpleSchema from \"simpl-schema\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Tracker } from \"meteor/tracker\";\nimport { check, Match } from \"meteor/check\";\nimport { registerSchema } from \"@reactioncommerce/schemas\";\nimport { Products, Shops, Revisions, Catalog } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { RevisionApi } from \"/imports/plugins/core/revisions/lib/api/revisions\";\n\n//\n// define search filters as a schema so we can validate\n// params supplied to the products publication\n//\nconst filters = new SimpleSchema({\n  \"shops\": {\n    type: Array,\n    optional: true\n  },\n  \"shops.$\": String,\n  \"tags\": {\n    type: Array,\n    optional: true\n  },\n  \"tags.$\": String,\n  \"query\": {\n    type: String,\n    optional: true\n  },\n  \"visibility\": {\n    type: Boolean,\n    optional: true\n  },\n  \"details\": {\n    type: Object,\n    optional: true\n  },\n  \"details.key\": {\n    type: String,\n    optional: true\n  },\n  \"details.value\": {\n    type: String,\n    optional: true\n  },\n  \"price\": {\n    type: Object,\n    optional: true\n  },\n  \"price.min\": {\n    type: String,\n    optional: true\n  },\n  \"price.max\": {\n    type: String,\n    optional: true\n  },\n  \"weight\": {\n    type: Object,\n    optional: true\n  },\n  \"weight.min\": {\n    type: String,\n    optional: true\n  },\n  \"weight.max\": {\n    type: String,\n    optional: true\n  }\n}, { check, tracker: Tracker });\n\nregisterSchema(\"filters\", filters);\n\n/**\n * Broadens an existing selector to include all variants of the given top-level productIds\n * Additionally considers the tags product filter, if given\n * Can operate on the \"Revisions\" and the \"Products\" collection\n * @param collectionName {String} - \"Revisions\" or \"Products\"\n * @param selector {object} - the selector that should be extended\n * @param productFilters { object } - the product filter (e.g. orginating from query parameters)\n * @param productIds {String[]} - the top-level productIds we want to get the variants of.\n */\nfunction extendSelectorWithVariants(collectionName, selector, productFilters, productIds) {\n  let prefix = \"\";\n\n  if (collectionName.toLowerCase() === \"revisions\") {\n    prefix = \"documentData.\";\n  } else if (collectionName.toLowerCase() !== \"products\") {\n    throw new Error(`Can't extend selector for collection ${collectionName}.`);\n  }\n\n  // Remove hashtag filter from selector (hashtags are not applied to variants, we need to get variants)\n  const newSelector = _.omit(selector, [\"hashtags\", \"ancestors\"]);\n  if (productFilters && productFilters.tags) {\n    // Re-configure selector to pick either Variants of one of the top-level products, or the top-level products in the filter\n    _.extend(newSelector, {\n      $or: [{\n        [`${prefix}ancestors`]: {\n          $in: productIds\n        }\n      }, {\n        $and: [{\n          [`${prefix}hashtags`]: {\n            $in: productFilters.tags\n          }\n        }, {\n          [`${prefix}_id`]: {\n            $in: productIds\n          }\n        }]\n      }]\n    });\n  } else {\n    _.extend(newSelector, {\n      $or: [{\n        [`${prefix}ancestors`]: {\n          $in: productIds\n        }\n      }, {\n        [`${prefix}_id`]: {\n          $in: productIds\n        }\n      }]\n    });\n  }\n  return newSelector;\n}\n\nfunction filterProducts(productFilters) {\n  // if there are filter/params that don't match the schema\n  // validate, catch except but return no results\n  try {\n    if (productFilters) filters.validate(productFilters);\n  } catch (e) {\n    Logger.debug(e, \"Invalid Product Filters\");\n    return false;\n  }\n\n  const shopIdsOrSlugs = productFilters && productFilters.shops;\n\n  if (shopIdsOrSlugs) {\n    // Get all shopIds associated with the slug or Id\n    const shopIds = Shops.find({\n      \"workflow.status\": \"active\",\n      \"$or\": [{\n        _id: { $in: shopIdsOrSlugs }\n      }, {\n        slug: { $in: shopIdsOrSlugs }\n      }]\n    }).map((shop) => shop._id);\n\n    // If we found shops, update the productFilters\n    if (shopIds) {\n      productFilters.shops = shopIds;\n    } else {\n      return false;\n    }\n  }\n\n  // Init default selector - Everyone can see products that fit this selector\n  const selector = {\n    ancestors: [], // Lookup top-level products\n    isDeleted: { $in: [null, false] }, // by default, we don't publish deleted products\n    isVisible: true // by default, only lookup visible products\n  };\n\n  if (productFilters) {\n    // handle multiple shops\n    if (productFilters.shops) {\n      _.extend(selector, {\n        shopId: {\n          $in: productFilters.shops\n        }\n      });\n    }\n\n    // filter by tags\n    if (productFilters.tags) {\n      _.extend(selector, {\n        hashtags: {\n          $in: productFilters.tags\n        }\n      });\n    }\n\n    // filter by query\n    if (productFilters.query) {\n      const cond = {\n        $regex: productFilters.query,\n        $options: \"i\"\n      };\n      _.extend(selector, {\n        $or: [{\n          title: cond\n        }, {\n          pageTitle: cond\n        }, {\n          description: cond\n        }]\n      });\n    }\n\n    // filter by details\n    if (productFilters.details) {\n      _.extend(selector, {\n        metafields: {\n          $elemMatch: {\n            key: {\n              $regex: productFilters.details.key,\n              $options: \"i\"\n            },\n            value: {\n              $regex: productFilters.details.value,\n              $options: \"i\"\n            }\n          }\n        }\n      });\n    }\n\n    // filter by visibility\n    if (productFilters.visibility !== undefined) {\n      _.extend(selector, {\n        isVisible: productFilters.visibility\n      });\n    }\n\n    // filter by gte minimum price\n    if (productFilters[\"price.min\"] && !productFilters[\"price.max\"]) {\n      _.extend(selector, {\n        \"price.min\": {\n          $gte: parseFloat(productFilters[\"price.min\"])\n        }\n      });\n    }\n\n    // filter by lte maximum price\n    if (productFilters[\"price.max\"] && !productFilters[\"price.min\"]) {\n      _.extend(selector, {\n        \"price.max\": {\n          $lte: parseFloat(productFilters[\"price.max\"])\n        }\n      });\n    }\n\n    // filter with a price range\n    if (productFilters[\"price.min\"] && productFilters[\"price.max\"]) {\n      const pmin = parseFloat(productFilters[\"price.min\"]);\n      const pmax = parseFloat(productFilters[\"price.max\"]);\n      // where product A has min 12.99 variant and a 19.99 variant\n      // price.min=12.99&price.max=19.98\n      // should return product A\n      _.extend(selector, {\n        \"price.min\": {\n          $lt: pmax\n        },\n        \"price.max\": {\n          $gt: pmin\n        }\n      });\n    }\n\n    // filter by gte minimum weight\n    if (productFilters[\"weight.min\"] && !productFilters[\"weight.max\"]) {\n      _.extend(selector, {\n        weight: {\n          $gte: parseFloat(productFilters[\"weight.min\"])\n        }\n      });\n    }\n\n    // filter by lte maximum weight\n    if (productFilters[\"weight.max\"] && !productFilters[\"weight.min\"]) {\n      _.extend(selector, {\n        weight: {\n          $lte: parseFloat(productFilters[\"weight.max\"])\n        }\n      });\n    }\n\n    // filter with a weight range\n    if (productFilters[\"weight.min\"] && productFilters[\"weight.max\"]) {\n      const wmin = parseFloat(productFilters[\"weight.min\"]);\n      const wmax = parseFloat(productFilters[\"weight.max\"]);\n      _.extend(selector, {\n        weight: {\n          $lt: wmax,\n          $gt: wmin\n        }\n      });\n    }\n  } // end if productFilters\n\n  return selector;\n}\n\n/**\n * products publication\n * @param {Number} [productScrollLimit] - optional, defaults to 24\n * @param {Array} shops - array of shopId to retrieve product from.\n * @return {Object} return product cursor\n */\nMeteor.publish(\"Products\", function (productScrollLimit = 24, productFilters, sort = {}, editMode = true) {\n  check(productScrollLimit, Number);\n  check(productFilters, Match.OneOf(undefined, Object));\n  check(sort, Match.OneOf(undefined, Object));\n  check(editMode, Match.Maybe(Boolean));\n\n  // TODO: Consider publishing the non-admin publication if a user is not in \"edit mode\" to see what is published\n\n  // Active shop\n  const shopId = Reaction.getShopId();\n  const primaryShopId = Reaction.getPrimaryShopId();\n\n  // Get a list of shopIds that this user has \"createProduct\" permissions for (owner permission is checked by default)\n  const userAdminShopIds = Reaction.getShopsWithRoles([\"createProduct\"], this.userId);\n\n  // Don't publish if we're missing an active or primary shopId\n  if (!shopId || !primaryShopId) {\n    return this.ready();\n  }\n\n  // Get active shop id's to use for filtering\n  const activeShopsIds = Shops.find({\n    $or: [\n      { \"workflow.status\": \"active\" },\n      { _id: Reaction.getPrimaryShopId() }\n    ]\n  }).fetch().map((activeShop) => activeShop._id);\n\n  const selector = filterProducts(productFilters);\n\n  if (selector === false) {\n    return this.ready();\n  }\n\n  // We publish an admin version of this publication to admins of products who are in \"Edit Mode\"\n  // Authorized content curators for shops get special publication of the product\n  // with all relevant revisions all is one package\n  // userAdminShopIds is a list of shopIds that the user has createProduct or owner access for\n  if (editMode && userAdminShopIds && Array.isArray(userAdminShopIds) && userAdminShopIds.length > 0) {\n    selector.isVisible = {\n      $in: [true, false, null, undefined]\n    };\n    selector.shopId = {\n      $in: activeShopsIds\n    };\n\n    // Get _ids of top-level products\n    const productIds = Products.find(selector, {\n      sort,\n      limit: productScrollLimit\n    }).map((product) => product._id);\n\n\n    const productSelectorWithVariants = extendSelectorWithVariants(\"Products\", selector, productFilters, productIds);\n\n    if (RevisionApi.isRevisionControlEnabled()) {\n      const revisionSelector = {\n        \"workflow.status\": {\n          $nin: [\n            \"revision/published\"\n          ]\n        }\n      };\n      const revisionSelectorWithVariants = extendSelectorWithVariants(\"Revisions\", revisionSelector, productFilters, productIds);\n      const handle = Revisions.find(revisionSelectorWithVariants).observe({\n        added: (revision) => {\n          this.added(\"Revisions\", revision._id, revision);\n          if (revision.documentType === \"product\") {\n            // Check merge box (session collection view), if product is already in cache.\n            // If yes, we send a `changed`, otherwise `added`. I'm assuming\n            // that this._documents.Products is somewhat equivalent to\n            // the merge box Meteor.server.sessions[sessionId].getCollectionView(\"Products\").documents\n            if (this._documents.Products && this._documents.Products[revision.documentId]) {\n              this.changed(\"Products\", revision.documentId, { __revisions: [revision] });\n            } else {\n              this.added(\"Products\", revision.documentId, { __revisions: [revision] });\n            }\n          }\n        },\n        changed: (revision) => {\n          this.changed(\"Revisions\", revision._id, revision);\n          if (revision.documentType === \"product\") {\n            if (this._documents.Products && this._documents.Products[revision.documentId]) {\n              this.changed(\"Products\", revision.documentId, { __revisions: [revision] });\n            }\n          }\n        },\n        removed: (revision) => {\n          this.removed(\"Revisions\", revision._id);\n          if (revision.documentType === \"product\") {\n            if (this._documents.Products && this._documents.Products[revision.documentId]) {\n              this.changed(\"Products\", revision.documentId, { __revisions: [] });\n            }\n          }\n        }\n      });\n\n      this.onStop(() => {\n        handle.stop();\n      });\n\n      return Products.find(productSelectorWithVariants);\n    }\n\n    // Revision control is disabled, but is admin\n    return Products.find(productSelectorWithVariants, {\n      sort,\n      limit: productScrollLimit\n    });\n  }\n\n  // This is where the publication begins for non-admin users\n  // Get _ids of top-level products\n  const productIds = Products.find(selector, {\n    sort,\n    limit: productScrollLimit\n  }).map((product) => product._id);\n\n  let newSelector = { ...selector };\n\n  // Remove hashtag filter from selector (hashtags are not applied to variants, we need to get variants)\n  if (productFilters && Object.keys(productFilters).length === 0 && productFilters.constructor === Object) {\n    newSelector = _.omit(selector, [\"hashtags\", \"ancestors\"]);\n\n    if (productFilters.tags) {\n      // Re-configure selector to pick either Variants of one of the top-level products,\n      // or the top-level products in the filter\n      _.extend(newSelector, {\n        $or: [{\n          ancestors: {\n            $in: productIds\n          }\n        }, {\n          $and: [{\n            hashtags: {\n              $in: productFilters.tags\n            }\n          }, {\n            _id: {\n              $in: productIds\n            }\n          }]\n        }]\n      });\n    }\n    // filter by query\n    if (productFilters.query) {\n      const cond = {\n        $regex: productFilters.query,\n        $options: \"i\"\n      };\n      _.extend(newSelector, {\n        $or: [{\n          title: cond\n        }, {\n          pageTitle: cond\n        }, {\n          description: cond\n        }, {\n          ancestors: {\n            $in: productIds\n          }\n        },\n        {\n          _id: {\n            $in: productIds\n          }\n        }]\n      });\n    }\n  } else {\n    newSelector = _.omit(selector, [\"hashtags\", \"ancestors\"]);\n\n    _.extend(newSelector, {\n      $or: [{\n        ancestors: {\n          $in: productIds\n        }\n      }, {\n        _id: {\n          $in: productIds\n        }\n      }]\n    });\n  }\n\n  // Adjust the selector to include only active shops\n  newSelector = {\n    ...newSelector,\n    shopId: {\n      $in: activeShopsIds\n    }\n  };\n\n  // Returning Complete product tree for top level products to avoid sold out warning.\n  return Products.find(newSelector, {\n    sort\n    // TODO: REVIEW Limiting final products publication for non-admins\n    // I think we shouldn't limit here, otherwise we are limited to 24 total products which\n    // could be far less than 24 top-level products\n    // limit: productScrollLimit\n  });\n});\n\n/**\n * @name Products/grid\n * @method\n * @memberof Core\n * @summary Publication method for a customer facing product grid\n * @param {number} productScrollLimit - product find limit\n * @param {object} productFilters - filters to be applied to the product find\n * @param {object} sort - sorting to be applied to the product find\n * @return {MongoCursor} Mongo cursor object of found products\n */\nMeteor.publish(\"Products/grid\", function (productScrollLimit = 24, productFilters, sort = {}) {\n  check(productScrollLimit, Number);\n  check(productFilters, Match.OneOf(undefined, Object));\n  check(sort, Match.OneOf(undefined, Object));\n\n  const newSelector = filterProducts(productFilters);\n\n  if (newSelector === false) {\n    return this.ready();\n  }\n\n  const productCursor = Catalog.find(newSelector, {\n    sort,\n    limit: productScrollLimit,\n    fields: {\n      variants: 0\n    }\n  });\n\n  return productCursor;\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Mongo, MongoInternals } from \"meteor/mongo\";\n\n// This code taken from https://github.com/meteorhacks/meteor-aggregate\n// Add the aggregate function available in tbe raw collection to normal collections\nMongo.Collection.prototype.aggregate = function (pipelines, options) {\n  const coll = this._getCollection();\n  return Meteor.wrapAsync(coll.aggregate.bind(coll))(pipelines, options);\n};\n\n// this group of methods were taken from https://github.com/meteorhacks/meteor-collection-utils\n/**\n * Provides a way to get at the underlying instance of the DB connection\n * @private\n * @returns {Object} The underlying Mongo connection\n */\nMongo.Collection.prototype._getDb = function () {\n  if (typeof this._collection._getDb === \"function\") {\n    return this._collection._getDb();\n  }\n  const mongoConn = MongoInternals.defaultRemoteCollectionDriver().mongo;\n  return wrapWithDb(mongoConn);\n};\n\n/**\n * Provides a way to get at the underlying instance of the Collection\n * @private\n * @returns {Object} The underlying Mongo collection\n */\nMongo.Collection.prototype._getCollection = function () {\n  const db = this._getDb();\n  return db.collection(this._name);\n};\n\nfunction wrapWithDb(mongoConn) {\n  if (mongoConn.db) {\n    return mongoConn.db;\n  }\n}\n\n\n/**\n * @summary Provides a wrapper around the results of a Mongo aggregate query to make it Reactive\n * @param {Object} pub - The instance of the publication we are creating\n * @param {Object} collection - The Mongo.Collection instance to query\n * @param {Array} pipeline - The aggregation pipeline to use\n * @param {Object} options - Optional options\n *  - `observeSelector` can be given to improve efficiency. This selector is used for observing the collection.\n // (e.g. `{ authorId: { $exists: 1 } }`)\n // - `observeOptions` can be given to limit fields, further improving efficiency. Ideally used to limit fields on your query.\n //   If none is given any change to the collection will cause the aggregation to be reevaluated.\n // (e.g. `{ limit: 10, sort: { createdAt: -1 } }`)\n // - `clientCollection` defaults to `collection._name` but can be overriden to sent the results\n // to a different client-side collection.\n @example\n // ## Quick Example\n //\n // A publication for one of the\n //   [examples](https://docs.mongodb.org/v3.0/reference/operator/aggregation/group/#group-documents-by-author)\n // in the MongoDB docs would look like this:\n //\n // Meteor.publish(\"booksByAuthor\", function () {\n//   ReactiveAggregate(this, Books, [{\n//     $group: {\n//       _id: \"$author\",\n//       books: { $push: \"$$ROOT\" }\n//     }\n//   }]);\n// });\n * @constructor\n */\nexport function ReactiveAggregate(pub, collection, pipeline, options) {\n  let allowDiskUse = false;\n\n  if (process.env.MONGO_ALLOW_DISK_USE) {\n    allowDiskUse = true;\n  }\n\n  const defaultOptions = {\n    observeSelector: {},\n    observeOptions: {},\n    clientCollection: collection._name,\n    allowDiskUse\n  };\n  const pubOptions = Object.assign({}, defaultOptions, options);\n\n  let initializing = true;\n  pub._ids = {};\n  pub._iteration = 1;\n\n  // run this function every time a record changes\n  function update() {\n    if (initializing) {\n      return;\n    }\n\n    // add and update documents on the client\n    collection.aggregate(pipeline, { allowDiskUse: pubOptions.allowDiskUse }).forEach((doc) => {\n      if (!pub._ids[doc._id]) {\n        pub.added(pubOptions.clientCollection, doc._id, doc);\n      } else {\n        pub.changed(pubOptions.clientCollection, doc._id, doc);\n      }\n      pub._ids[doc._id] = pub._iteration;\n    });\n    // remove documents not in the result anymore\n    for (const [key, value] of Object.entries(pub._ids)) {\n      if (value !== pub._iteration) {\n        delete pub._ids[key];\n        pub.removed(pubOptions.clientCollection, key);\n      }\n    }\n    pub._iteration += 1;\n  }\n\n  // track any changes on the collection used for the aggregation\n  const query = collection.find(pubOptions.observeSelector, pubOptions.observeOptions);\n  const handle = query.observeChanges({\n    added: update,\n    changed: update,\n    removed: update,\n    error(error) {\n      throw new Meteor.Error(\"server-error\", `Encountered an error while observing ${collection._name}`, error);\n    }\n  });\n  // observeChanges() will immediately fire an \"added\" event for each document in the query\n  // these are skipped using the initializing flag\n  initializing = false;\n  // send an initial result set to the client\n  update();\n  // mark the subscription as ready\n  pub.ready();\n\n  // stop observing the cursor when the client unsubscribes\n  pub.onStop(() => {\n    handle.stop();\n  });\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Revisions } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * accounts\n */\n\nMeteor.publish(\"Revisions\", function (documentIds) {\n  check(documentIds, Match.OneOf(String, Array));\n\n  // we could additionally make checks of useId defined, but this could lead to\n  // situation when user will may not have time to get an account\n  if (this.userId === null) {\n    return this.ready();\n  }\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n\n  if (Roles.userIsInRole(this.userId, [\"admin\", \"owner\"])) {\n    if (Array.isArray(documentIds)) {\n      return Revisions.find({\n        // shopId,\n        documentId: {\n          $in: documentIds\n        }\n      });\n    }\n\n    // global admin can get all accounts\n    return Revisions.find({\n      // shopId,\n      documentId: documentIds\n    });\n  }\n  // regular users should get just their account\n  return this.ready();\n});\n","import { Mongo } from \"meteor/mongo\";\nimport { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * Reaction Server / amplify permanent sessions\n * If no id is passed we create a new session\n * Load the session\n * If no session is loaded, creates a new one\n */\n\nexport const ServerSessions = new Mongo.Collection(\"Sessions\");\n\nMeteor.publish(\"Sessions\", (sessionId) => {\n  check(sessionId, Match.OneOf(String, null));\n  const created = new Date().getTime();\n  let newSessionId;\n  // if we don\"t have a sessionId create a new session\n  // REALLY - we should always have a client sessionId\n  if (!sessionId) {\n    newSessionId = ServerSessions.insert({ created });\n  } else {\n    newSessionId = sessionId;\n  }\n  // get the session from existing sessionId\n  const serverSession = ServerSessions.find(newSessionId);\n\n  // if not found, also create a new server session\n  if (serverSession.count() === 0) {\n    ServerSessions.insert({ _id: newSessionId, created });\n  }\n\n  // set global sessionId\n  Reaction.sessionId = newSessionId;\n\n  // return cursor\n  return ServerSessions.find(newSessionId);\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Match, check } from \"meteor/check\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Shipping } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n/**\n * shipping\n */\n\nMeteor.publish(\"Shipping\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n  const select = query || {};\n  select.shopId = shopId;\n\n  // appends a count to the collection\n  // we're doing this for use with griddleTable\n  Counts.publish(this, \"shipping-count\", Shipping.find(\n    select,\n    options\n  ));\n\n  return Shipping.find(\n    select,\n    options\n  );\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check } from \"meteor/check\";\nimport { Reaction } from \"/server/api\";\nimport { Shops } from \"/lib/collections\";\n\n// We should be able to publish just the enabled languages/currencies/\nMeteor.publish(\"PrimaryShop\", () => Shops.find({\n  shopType: \"primary\"\n}, {\n  fields: {},\n  limit: 1\n}));\n\nMeteor.publish(\"MerchantShops\", function (shopsOfUser = Reaction.getShopsForUser([\"admin\"], this.userId)) {\n  check(shopsOfUser, Array);\n\n  // Check if user has permissions for those shops\n  if (Reaction.hasPermissionForAll([\"admin\"], this.userId, shopsOfUser)) {\n    throw new Meteor.Error(\"access-denied\", \"Shops requested don't belong to user\");\n  }\n\n  const domain = Reaction.getDomain();\n  const { enabled } = Reaction.getMarketplaceSettings();\n  // Don't publish currencies, languages, or locales for merchant shops.\n  // We'll get that info from the primary shop.\n  const fields = {\n    languages: 0,\n    locales: 0,\n    currencies: 0\n  };\n\n  if (Reaction.marketplaceCurrency) {\n    delete fields.currencies;\n  }\n\n  if (Reaction.marketplaceLanguages) {\n    delete fields.languages;\n  }\n\n  if (Reaction.marketplaceLocales) {\n    delete fields.locales;\n  }\n\n  // If marketplace is disabled, don't return any merchant shops\n  if (!enabled) {\n    return this.ready();\n  }\n\n\n  const selector = {\n    domains: domain,\n    shopType: {\n      $ne: \"primary\"\n    },\n    $or: [\n      {\n        _id: {\n          $in: shopsOfUser\n        }\n      },\n      {\n        \"workflow.status\": \"active\"\n      }\n    ]\n  };\n\n  // Return all non-primary shops for this domain that belong to the user\n  // or are active\n  return Shops.find(selector, { fields });\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Tags } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n * tags\n */\nMeteor.publish(\"Tags\", function () {\n  const shopId = Reaction.getShopId();\n  if (!shopId) {\n    return this.ready();\n  }\n  // TODO: filter tag results based on permissions and isVisible or some other\n  // publication quality\n  return Tags.find({});\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Themes } from \"/lib/collections\";\n\n/**\n * Themes\n * @returns {Object} thtmes - themes cursor\n */\n\nMeteor.publish(\"Themes\", () => Themes.find({}));\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Shops, Translations } from \"/lib/collections\";\nimport { Reaction } from \"/server/api\";\n\n/**\n* @file Translations publication\n*\n*\n* @module Translations\n*/\n\n/**\n * Translations publication\n * @param {String|Array} sessionLanguages - String or array of langauges. current sessionLanguage, default to 'en'\n * @returns { Object } returns Translations\n * @todo like to see the langages validated more with a schema\n */\nMeteor.publish(\"Translations\", (languages) => {\n  check(languages, Match.OneOf(String, Array));\n  const shopId = Reaction.getShopId();\n  const shopLanguage = Shops.findOne(shopId).language;\n  const sessionLanguages = [];\n  const langTranQuery = [];\n\n  // set shop default\n  sessionLanguages.push(shopLanguage);\n  // lets get all these langauges\n  if (Array.isArray(languages)) {\n    sessionLanguages.concat(languages);\n  } else {\n    sessionLanguages.push(languages);\n  }\n  // add in the shop filter\n  for (const sessionLanguage of sessionLanguages) {\n    langTranQuery.push({\n      i18n: sessionLanguage,\n      shopId: Reaction.getPrimaryShopId()\n    });\n  }\n\n  return Translations.find({\n    $or: langTranQuery\n  });\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Shops } from \"/lib/collections\";\n\nMeteor.publish(\"shopsCount\", function () {\n  Counts.publish(this, \"shops-count\", Shops.find());\n});\n","import { Meteor } from \"meteor/meteor\";\nimport { check, Match } from \"meteor/check\";\nimport { Counts } from \"meteor/tmeasday:publish-counts\";\nimport { Reaction } from \"/server/api\";\nimport { Jobs } from \"/lib/collections\";\n\n\n/**\n * Email Job Logs\n * @type {Object}\n * @param query\n * @param options - standard publication options object\n */\nMeteor.publish(\"Emails\", function (query, options) {\n  check(query, Match.Optional(Object));\n  check(options, Match.Optional(Object));\n\n  if (Reaction.hasPermission([\"owner\", \"admin\", \"reaction-email\"], this.userId)) {\n    Counts.publish(this, \"emails-count\", Jobs.find({ type: \"sendEmail\" }));\n    return Jobs.find({ type: \"sendEmail\" });\n  }\n\n  return this.ready();\n});\n","import nodemailer from \"@reactioncommerce/nodemailer\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Emails, Jobs } from \"/lib/collections\";\nimport { Reaction, Logger } from \"/server/api\";\n\nexport default function () {\n  /**\n   * Send Email job\n   *\n   * Example usage:\n   * new Job(Jobs, \"sendEmail\", { from, to, subject, html }).save();\n   */\n  const sendEmail = Jobs.processJobs(\"sendEmail\", {\n    pollInterval: 5 * 60 * 1000, // poll every 5 mins as a backup - see the realtime observer below\n    workTimeout: 2 * 60 * 1000, // fail if it takes longer than 2mins\n    payload: 20\n  }, (jobs, callback) => {\n    jobs.forEach((job) => {\n      const { from, to, subject, html } = job.data;\n\n      if (!from || !to || !subject || !html) {\n        const msg = \"Email job requires an options object with to/from/subject/html.\";\n        Logger.error(`[Job]: ${msg}`);\n        return job.fail(msg, { fatal: true });\n      }\n\n      const jobId = job._doc._id;\n\n      Emails.update({ jobId }, {\n        $set: {\n          from,\n          to,\n          subject,\n          html,\n          status: \"processing\"\n        }\n      }, {\n        upsert: true\n      });\n\n      const config = Reaction.Email.getMailConfig();\n\n      if (config.direct) {\n        Emails.update({ jobId }, {\n          $set: {\n            status: \"failed\"\n          }\n        });\n        const msg = \"Mail not configured\";\n        Logger.error(msg);\n        return job.fail(msg);\n      }\n\n      Logger.debug(config, \"Sending email with config\");\n\n      const transport = nodemailer.createTransport(config);\n\n      transport.sendMail({ from, to, subject, html }, Meteor.bindEnvironment((error) => {\n        if (error) {\n          Emails.update({ jobId }, {\n            $set: {\n              status: \"failed\"\n            }\n          });\n          Logger.error(error, \"Email job failed\");\n          return job.fail(error.toString());\n        }\n        Emails.update({ jobId }, {\n          $set: {\n            status: \"completed\"\n          }\n        });\n        Logger.debug(`Successfully sent email to ${to}`);\n        return job.done();\n      }));\n\n      return true;\n    });\n\n    return callback();\n  });\n\n  // Job Collection Observer\n  // This processes an email sending job as soon as it's submitted\n  Jobs.find({\n    type: \"sendEmail\",\n    status: \"ready\"\n  }).observe({\n    added() {\n      sendEmail.trigger();\n    }\n  });\n}\n","import email from \"./email\";\n\nexport default function () {\n  email();\n}\n","import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Random } from \"meteor/random\";\nimport { Accounts } from \"meteor/accounts-base\";\nimport * as Collections from \"/lib/collections\";\nimport { Hooks, Logger, Reaction } from \"/server/api\";\n\nexport default function () {\n  /**\n   * Make sure initial admin user has verified their\n   * email before allowing them to login.\n   *\n   * http://docs.meteor.com/#/full/accounts_validateloginattempt\n   */\n\n  Accounts.validateLoginAttempt((attempt) => {\n    if (!attempt.allowed) {\n      return false;\n    }\n\n    // confirm this is the accounts-password login method\n    if (attempt.type !== \"password\" || attempt.methodName !== \"login\") {\n      return attempt.allowed;\n    }\n\n    if (!attempt.user) {\n      return attempt.allowed;\n    }\n\n    const loginEmail = attempt.methodArguments[0].user.email;\n    const adminEmail = process.env.REACTION_EMAIL;\n\n    if (loginEmail && loginEmail === adminEmail) {\n      // filter out the matching login email from any existing emails\n      const userEmail = _.filter(attempt.user.emails, (email) => email.address === loginEmail);\n\n      // check if the email is verified\n      if (!userEmail.length || !userEmail[0].verified) {\n        throw new Meteor.Error(\"access-denied\", \"Oops! Please validate your email first.\");\n      }\n    }\n\n    return attempt.allowed;\n  });\n\n  /**\n   * Reaction Accounts handlers\n   * creates a login type \"anonymous\"\n   * default for all unauthenticated visitors\n   */\n  Accounts.registerLoginHandler((options) => {\n    if (!options.anonymous) return {};\n\n    const stampedToken = Accounts._generateStampedLoginToken();\n    const userId = Accounts.insertUserDoc({\n      services: {\n        anonymous: true\n      },\n      token: stampedToken.token\n    });\n    const loginHandler = {\n      type: \"anonymous\",\n      userId\n    };\n    return loginHandler;\n  });\n\n  /**\n   * Accounts.onCreateUser event\n   * adding either a guest or anonymous role to the user on create\n   * adds Accounts record for reaction user profiles\n   * we clone the user into accounts, as the user collection is\n   * only to be used for authentication.\n   * - defaultVisitorRole\n   * - defaultRoles\n   * can be overriden from Shops\n   *\n   * @see: http://docs.meteor.com/#/full/accounts_oncreateuser\n   */\n  Accounts.onCreateUser((options, user) => {\n    const shopId = Reaction.getShopId(); // current shop; not primary shop\n    const groupToAddUser = options.groupId;\n    const roles = {};\n    const additionals = {\n      name: options && options.name,\n      profile: Object.assign({}, options && options.profile)\n    };\n    if (!user.emails) user.emails = [];\n    // init default user roles\n    // we won't create users unless we have a shop.\n    if (shopId) {\n      // retain language when user has defined a language\n      // perhaps should be treated as additionals\n      // or in onLogin below, or in the anonymous method options\n      if (!(Meteor.users.find().count() === 0)) { // dont set on inital admin\n        if (!user.profile) user.profile = {};\n        const currentUser = Meteor.user(user);\n        if (currentUser && currentUser.profile) {\n          if (currentUser.profile.lang && !user.profile.lang) {\n            user.profile.lang = currentUser.profile.lang;\n          }\n          if (currentUser.profile.currency && !user.profile.currency) {\n            user.profile.currency = currentUser.profile.currency;\n          }\n        }\n      }\n      // if we don't have user.services we're an anonymous user\n      if (!user.services) {\n        const group = Collections.Groups.findOne({ slug: \"guest\", shopId });\n        const defaultGuestRoles = group.permissions;\n        // if no defaultGuestRoles retrieved from DB, use the default Reaction set\n        roles[shopId] = defaultGuestRoles || Reaction.defaultVisitorRoles;\n        additionals.groups = [group._id];\n      } else {\n        let group;\n        if (groupToAddUser) {\n          group = Collections.Groups.findOne({ _id: groupToAddUser, shopId });\n        } else {\n          group = Collections.Groups.findOne({ slug: \"customer\", shopId });\n        }\n        // if no group or customer permissions retrieved from DB, use the default Reaction customer set\n        roles[shopId] = group.permissions || Reaction.defaultCustomerRoles;\n        additionals.groups = [group._id];\n        // also add services with email defined to user.emails[]\n        const userServices = user.services;\n        for (const service in userServices) {\n          if ({}.hasOwnProperty.call(userServices, service)) {\n            const serviceObj = userServices[service];\n            if (serviceObj.email) {\n              const email = {\n                provides: \"default\",\n                address: serviceObj.email,\n                verified: true\n              };\n              user.emails.push(email);\n            }\n            if (serviceObj.name) {\n              user.username = serviceObj.name;\n              additionals.profile.name = serviceObj.name;\n            }\n            // TODO: For now we have here instagram, twitter and google avatar cases\n            // need to make complete list\n            if (serviceObj.picture) {\n              additionals.profile.picture = user.services[service].picture;\n            } else if (serviceObj.profile_image_url_https) {\n              additionals.profile.picture = user.services[service].dprofile_image_url_https;\n            } else if (serviceObj.profile_picture) {\n              additionals.profile.picture = user.services[service].profile_picture;\n            }\n            // Correctly map Instagram profile data to Meteor user / Accounts\n            if (userServices.instagram) {\n              user.username = serviceObj.username;\n              user.name = serviceObj.full_name;\n              additionals.name = serviceObj.full_name;\n              additionals.profile.picture = serviceObj.profile_picture;\n              additionals.profile.bio = serviceObj.bio;\n              additionals.profile.name = serviceObj.full_name;\n              additionals.profile.username = serviceObj.username;\n            }\n          }\n        }\n      }\n\n      // clone before adding roles\n      const account = Object.assign({}, user, additionals);\n      account.userId = user._id;\n      Collections.Accounts.insert(account);\n      Hooks.Events.run(\"afterAccountsInsert\", account.userId, user._id);\n\n      const userDetails = Collections.Accounts.findOne({ _id: user._id });\n\n      // send a welcome email to new users,\n      // but skip the first default admin user and anonymous users\n      // (default admins already get a verification email)\n      if (userDetails.emails && userDetails.emails.length > 0\n        && (!(Meteor.users.find().count() === 0) && !userDetails.profile.invited)) {\n        const token = Random.secret();\n        Meteor.call(\"accounts/sendWelcomeEmail\", shopId, user._id, token);\n        const defaultEmail = userDetails.emails.find((email) => email.provides === \"default\");\n        const when = new Date();\n        const tokenObj = {\n          address: defaultEmail.address,\n          token,\n          when\n        };\n        _.set(user, \"services.email.verificationTokens\", [tokenObj]);\n      }\n\n      // assign default user roles\n      user.roles = roles;\n\n      // run onCreateUser hooks\n      // (the user object must be returned by all callbacks)\n      const userDoc = Hooks.Events.run(\"onCreateUser\", user, options);\n      return userDoc;\n    }\n  });\n\n  /**\n   * Accounts.onLogin event\n   * let's remove \"anonymous\" role, if the login type isn't \"anonymous\"\n   * @param {Object} options - user account creation options\n   * @fires \"cart/mergeCart\" Method\n   */\n  Accounts.onLogin((opts) => {\n    // run onLogin hooks\n    // (the options object must be returned by all callbacks)\n    const options = Hooks.Events.run(\"onLogin\", opts);\n\n    // remove anonymous role\n    // all users are guest, but anonymous user don't have profile access\n    // or ability to order history, etc. so ensure its removed upon login.\n    if (options.type !== \"anonymous\" && options.type !== \"resume\") {\n      const update = {\n        $pullAll: {}\n      };\n\n      update.$pullAll[`roles.${Reaction.getShopId()}`] = [\"anonymous\"];\n\n      Meteor.users.update({\n        _id: options.user._id\n      }, update, {\n        multi: true\n      });\n      // debug info\n      Logger.debug(`removed anonymous role from user: ${options.user._id}`);\n\n      // do not call `cart/mergeCart` on methodName === `createUser`, because\n      // in this case `cart/mergeCart` calls from cart publication\n      if (options.methodName === \"createUser\") return true;\n\n      // onLogin, we want to merge session cart into user cart.\n      const cart = Collections.Cart.findOne({\n        userId: options.user._id\n      });\n\n      // for a rare use cases\n      if (typeof cart !== \"object\") return false;\n      // in current version currentSessionId will be available for anonymous\n      // users only, because it is unknown for me how to pass sessionId when user\n      // logged in\n      let currentSessionId;\n      if (options.methodArguments && options.methodArguments.length === 1 && options.methodArguments[0].sessionId) {\n        currentSessionId = options.methodArguments[0].sessionId;\n      }\n      // changing of workflow status from now happens within `cart/mergeCart`\n      return Meteor.call(\"cart/mergeCart\", cart._id, currentSessionId);\n    }\n  });\n}\n","import url from \"url\";\nimport { Meteor } from \"meteor/meteor\";\nimport { BrowserPolicy } from \"meteor/browser-policy-common\";\nimport { WebApp } from \"meteor/webapp\";\n\n/**\n * Set headers for Reaction CDN\n */\nWebApp.rawConnectHandlers.use((req, res, next) => {\n  if (req._parsedUrl.pathname.match(/\\.(ttf|ttc|otf|eot|woff|svg|font\\.css|css)$/)) {\n    res.setHeader(\"Access-Control-Allow-Origin\", \"assets.reactioncommerce.com\");\n  }\n  next();\n});\n\n/**\n * Set browser policies\n */\nif (process.env.NODE_ENV === \"development\") {\n  BrowserPolicy.content.allowOriginForAll(\"localhost:*\");\n  BrowserPolicy.content.allowConnectOrigin(\"ws://localhost:*\");\n  BrowserPolicy.content.allowConnectOrigin(\"http://localhost:*\");\n  BrowserPolicy.content.allowConnectOrigin(\"https://localhost:*\");\n  BrowserPolicy.framing.allowAll();\n\n  // GraphiQL\n  BrowserPolicy.content.allowOriginForAll(\"unpkg.com\");\n  BrowserPolicy.content.allowOriginForAll(\"cdn.jsdelivr.net\");\n}\n\n// get current hostname of app\nconst { hostname } = url.parse(Meteor.absoluteUrl());\n\n// allow websockets (Safari fails without this)\nBrowserPolicy.content.allowConnectOrigin(`ws://${hostname}`);\nBrowserPolicy.content.allowConnectOrigin(`wss://${hostname}`);\n\nBrowserPolicy.content.allowOriginForAll(\"*.facebook.com\");\nBrowserPolicy.content.allowOriginForAll(\"*.fbcdn.net\");\nBrowserPolicy.content.allowOriginForAll(\"connect.facebook.net\");\nBrowserPolicy.content.allowOriginForAll(\"*.googleusercontent.com\");\nBrowserPolicy.content.allowOriginForAll(\"*.cdninstagram.com\");\n\nBrowserPolicy.content.allowImageOrigin(\"fbcdn-profile-a.akamaihd.net\");\nBrowserPolicy.content.allowImageOrigin(\"secure.gravatar.com\");\nBrowserPolicy.content.allowImageOrigin(\"i0.wp.com\");\n\nBrowserPolicy.content.allowFontDataUrl();\nBrowserPolicy.content.allowOriginForAll(\"assets.reactioncommerce.com\");\nBrowserPolicy.content.allowOriginForAll(\"cdnjs.cloudflare.com\");\nBrowserPolicy.content.allowOriginForAll(\"fonts.googleapis.com\");\nBrowserPolicy.content.allowOriginForAll(\"fonts.gstatic.com\");\nBrowserPolicy.content.allowOriginForAll(\"fonts.gstatic.com\");\n\nBrowserPolicy.content.allowOriginForAll(\"enginex.kadira.io\");\nBrowserPolicy.content.allowOriginForAll(\"*.stripe.com\");\n","import { Security } from \"meteor/ongoworks:security\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport * as Collections from \"/lib/collections\";\nimport { Reaction, Hooks } from \"/server/api\";\n\nconst {\n  Accounts,\n  Cart,\n  Packages,\n  Emails,\n  Jobs,\n  MediaRecords,\n  Orders,\n  Products,\n  Shipping,\n  Shops,\n  Tags,\n  Templates,\n  Translations\n} = Collections;\n\n/**\n * security definitions\n *\n * The following security definitions use the ongoworks:security package.\n * Rules within a single chain stack with AND relationship. Multiple\n * chains for the same collection stack with OR relationship.\n * See https://github.com/ongoworks/meteor-security\n *\n * It\"s important to note that these security rules are for inserts,\n * updates, and removes initiated from untrusted (client) code.\n * Thus there may be other actions that certain roles are allowed to\n * take, but they do not necessarily need to be listed here if the\n * database operation is executed in a server method.\n */\n\nexport default function () {\n  /*\n   * Define some additional rule chain methods\n   */\n\n  Security.defineMethod(\"ifHasRoleForActiveShop\", {\n    fetch: [],\n    transform: null,\n    allow(type, arg, userId) {\n      if (!arg) throw new Error(\"ifHasRole security rule method requires an argument\");\n      if (arg.role) {\n        // Note: userId is passed to getShopId to ensure that it returns the correct shop based on the User Preference\n        // if not passed, getShopId can default to primaryShopId if Meteor.userId is not available in the context the code is run\n        const shopId = Reaction.getUserShopId(userId) || Reaction.getShopId();\n\n        return Roles.userIsInRole(userId, arg.role, shopId);\n      }\n      return Roles.userIsInRole(userId, arg);\n    }\n  });\n\n  // use this rule for collections other than Shops\n  // matches this.shopId\n  Security.defineMethod(\"ifShopIdMatches\", {\n    fetch: [],\n    deny(type, arg, userId, doc) {\n      // Note: userId is passed to getShopId to ensure that it returns the correct shop based on the User Preference\n      // if not passed, getShopId can default to primaryShopId if Meteor.userId is not available in the context the code is run\n      const shopId = Reaction.getUserShopId(userId) || Reaction.getShopId();\n\n      return doc.shopId !== shopId;\n    }\n  });\n  // this rule is for the Shops collection\n  // use ifShopIdMatches for match on this._id\n  Security.defineMethod(\"ifShopIdMatchesThisId\", {\n    fetch: [],\n    deny(type, arg, userId, doc) {\n      // Note: userId is passed to getShopId to ensure that it returns the correct shop based on the User Preference\n      // if not passed, getShopId can default to primaryShopId if Meteor.userId is not available in the context the code is run\n      const shopId = Reaction.getUserShopId(userId) || Reaction.getShopId();\n\n      return doc._id !== shopId;\n    }\n  });\n\n  Security.defineMethod(\"ifFileBelongsToShop\", {\n    fetch: [],\n    deny(type, arg, userId, doc) {\n      // Note: userId is passed to getShopId to ensure that it returns the correct shop based on the User Preference\n      // if not passed, getShopId can default to primaryShopId if Meteor.userId is not available in the context the code is run\n      const shopId = Reaction.getUserShopId(userId) || Reaction.getShopId();\n\n      return doc.metadata.shopId !== shopId;\n    }\n  });\n\n  Security.defineMethod(\"ifUserIdMatches\", {\n    fetch: [],\n    deny(type, arg, userId, doc) {\n      return (userId && doc.userId && doc.userId !== userId) || (doc.userId && !userId);\n    }\n  });\n\n  Security.defineMethod(\"ifUserIdMatchesProp\", {\n    fetch: [],\n    deny(type, arg, userId, doc) {\n      return doc[arg] !== userId;\n    }\n  });\n\n  // todo do we need this?\n  Security.defineMethod(\"ifSessionIdMatches\", {\n    fetch: [],\n    deny(type, arg, userId, doc) {\n      return doc.sessionId !== Reaction.sessionId;\n    }\n  });\n\n  /**\n   * Define all security rules\n   */\n\n  /**\n   * admin security\n   * Permissive security for users with the \"admin\" role\n   */\n\n  Security.permit([\"insert\", \"update\", \"remove\"])\n    .collections([Accounts, Products, Tags, Translations, Shipping, Orders, Packages, Templates, Jobs])\n    .ifHasRoleForActiveShop({ role: \"admin\" })\n    .ifShopIdMatches()\n    .exceptProps([\"shopId\"])\n    .allowInClientCode();\n\n  /*\n   * Permissive security for users with the \"admin\" role for FS.Collections\n   */\n\n  Security.permit([\"insert\", \"update\", \"remove\"])\n    .collections([MediaRecords])\n    .ifHasRoleForActiveShop({ role: [\"admin\", \"owner\", \"createProduct\"] })\n    .ifFileBelongsToShop();\n\n  /*\n   * Users with the \"admin\" or \"owner\" role may update and\n   * remove their shop but may not insert one.\n   */\n\n  Shops.permit([\"update\", \"remove\"])\n    .ifHasRoleForActiveShop({ role: [\"admin\", \"owner\", \"shopSettings\"] })\n    .ifShopIdMatchesThisId()\n    .allowInClientCode();\n\n  /*\n   * Users with the \"admin\" or \"owner\" role may update and\n   * remove products, but createProduct allows just for just a product editor\n   */\n\n  Products.permit([\"insert\", \"update\", \"remove\"])\n    .ifHasRoleForActiveShop({ role: [\"createProduct\"] })\n    .ifShopIdMatches()\n    .allowInClientCode();\n\n  /*\n   * Users with the \"owner\" role may remove orders for their shop\n   */\n\n  Orders.permit(\"remove\")\n    .ifHasRoleForActiveShop({ role: [\"admin\", \"owner\"] })\n    .ifShopIdMatches()\n    .exceptProps([\"shopId\"])\n    .allowInClientCode();\n\n  /*\n   * Can update cart from client. Must insert/remove carts using\n   * server methods.\n   * Can update all session carts if not logged in or user cart if logged in as that user\n   * XXX should verify session match, but doesn't seem possible? Might have to move all cart updates to server methods, too?\n   */\n\n  Cart.permit([\"insert\", \"update\", \"remove\"])\n    .ifHasRoleForActiveShop({ role: [\"anonymous\", \"guest\"] })\n    .ifShopIdMatches()\n    .ifUserIdMatches()\n    .ifSessionIdMatches()\n    .allowInClientCode();\n\n  /*\n   * Users may update their own account\n   */\n  Collections.Accounts.permit([\"insert\", \"update\"])\n    .ifHasRoleForActiveShop({ role: [\"anonymous\", \"guest\"] })\n    .ifUserIdMatches()\n    .allowInClientCode();\n\n  /**\n   * Emails - Deny all client side ops\n   */\n  Emails.deny({\n    insert: () => true,\n    update: () => true,\n    remove: () => true\n  });\n\n  // As the above security Rules definitions happen after all known Core Initialization Event hooks,\n  // Event hook to run after security rules are initialized. Use this hook to add security via a plugin\n  Hooks.Events.run(\"afterSecurityInit\");\n}\n","import fsModule from \"fs\";\nimport path from \"path\";\nimport util from \"util\";\nimport { Assets, Translations } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\n\nconst fs = {\n  readdir: util.promisify(fsModule.readdir),\n  readFile: util.promisify(fsModule.readFile),\n  realpath: util.promisify(fsModule.realpath),\n  stat: util.promisify(fsModule.stat)\n};\n\nconst translationSources = [];\nconst rawAssetsCollection = Assets.rawCollection();\nlet bulkAssetOp;\n\nasync function directoryExists(dirPath) {\n  let info;\n\n  try {\n    info = await fs.stat(dirPath);\n  } catch (error) {\n    return false;\n  }\n\n  return info.isDirectory();\n}\n\n/**\n * @method loadTranslation\n * @memberof i18n\n * @summary Server method: Load a single translation object as an Asset\n * loadTranslation should generally be used\n * before startup, to ensure that Assets load.\n * @param  {Object} source a json i18next object\n * @return {Boolean} false if assets weren't loaded\n */\nexport function loadTranslation(source) {\n  try {\n    if (!bulkAssetOp) bulkAssetOp = rawAssetsCollection.initializeUnorderedBulkOp();\n    const content = typeof source === \"string\" ? JSON.parse(source) : source;\n    const json = typeof source === \"object\" ? JSON.stringify(source) : source;\n    const { i18n, ns } = content[0];\n\n    // Keep a record of all available translations for import later at a later time if using the\n    // reload translations icon button from the Internationalization settings panel\n    translationSources.push(source);\n\n    bulkAssetOp\n      .find({ type: \"i18n\", name: i18n, ns })\n      .upsert()\n      .update({ $set: { content: json } });\n\n    Logger.debug(\"Translation assets bulk update prepared for \", ns);\n  } catch (error) {\n    Logger.error(\"Failed to prepare bulk upsert for translation assets\", error);\n  }\n}\n\n/**\n * @method loadTranslations\n * @summary Load an array of translation objects\n * and import using loadTranslation\n * @param  {Object} sources array of i18next translations\n * @return {Boolean} false if assets weren't loaded\n */\nexport function loadTranslations(sources) {\n  sources.forEach(loadTranslation);\n}\n\nexport async function flushTranslationLoad() {\n  if (!bulkAssetOp) return Promise.resolve();\n\n  try {\n    await bulkAssetOp.execute();\n    bulkAssetOp = null;\n  } catch (error) {\n    Logger.error(\"Error flushing the translation asset upserts\");\n  }\n}\n\n/**\n * @method loadCoreTranslations\n * @memberof i18n\n * @summary imports i18n json files from private/data/i18n into the Assets collection\n * Assets collection is processed with Reaction.Import\n * after all assets have been loaded.\n * @async\n */\nexport async function loadCoreTranslations() {\n  const meteorPath = await fs.realpath(`${process.cwd()}/../`);\n  const i18nFolder = `${meteorPath}/server/assets/app/data/i18n/`;\n\n  if (await directoryExists(i18nFolder)) {\n    let files;\n    try {\n      files = await fs.readdir(i18nFolder);\n    } catch (error) {\n      throw new Error(`No translations found in ${i18nFolder} for import`, error);\n    }\n\n    const promises = files.filter((file) => file.endsWith(\".json\")).map((file) => {\n      Logger.debug(`Importing Translations from ${file}`);\n      return fs.readFile(path.join(i18nFolder, file), \"utf8\");\n    });\n\n    let fileContents = [];\n    try {\n      fileContents = await Promise.all(promises);\n    } catch (error) {\n      Logger.error(\"Failed to load translations from files\", error.message);\n    }\n\n    fileContents.forEach(loadTranslation);\n  }\n}\n\n/**\n * @method reloadAllTranslations\n * @memberof i18n\n * @summary Reload translations for all shops\n * @return {undefined}\n*/\nexport function reloadAllTranslations() {\n  // Clear assets for i18n\n  Assets.remove({ type: \"i18n\" });\n\n  // Remove translations for all shops\n  Translations.remove();\n\n  // Load translations from translation sources and prepare bulk op\n  loadTranslations(translationSources);\n\n  // Load translations\n  importAllTranslations();\n}\n\n/**\n * @method reloadTranslationsForShop\n * @memberof i18n\n * @summary Reload translations for specified shop\n * @param {string} shopId - Shop Id to reset translations for\n * @return {undefined}\n*/\nexport function reloadTranslationsForShop(shopId) {\n  // Clear assets for i18n\n  Assets.remove({ type: \"i18n\" });\n\n  // Remove translations for the current shop\n  Translations.remove({ shopId });\n\n  // Load translations from translation sources and prepare bulk op\n  loadTranslations(translationSources);\n\n  // Load translations\n  importAllTranslations();\n}\n\n/**\n * @method importAllTranslations\n * @memberof i18n\n * @summary Imports all translations into Assets collection and Translation collection\n * @return {undefined}\n */\nexport function importAllTranslations() {\n  // Get count of all i18n assets\n  const i18nAssetCount = Assets.find({ type: \"i18n\" }).count();\n\n  // If we have no assets, then this is either a fresh start or\n  // the i18n assets were cleared. In either case, allow i18n translations\n  // to be loaded into Assets collection and subsequently into the Translation collection\n  if (i18nAssetCount === 0) {\n    // Import core translations\n    Promise.await(loadCoreTranslations());\n\n    // Flush all the bulk Assets upserts created by calls to loadTranslations\n    Promise.await(flushTranslationLoad());\n\n    Logger.debug(\"All translation assets updated\");\n\n    // Then loop through those I18N assets and import them\n    Assets.find({ type: \"i18n\" }).forEach((t) => {\n      Logger.debug(`Importing ${t.name} translation for \"${t.ns}\"`);\n      if (t.content) {\n        Reaction.Importer.process(t.content, [\"i18n\"], Reaction.Importer.translation);\n      } else {\n        Logger.debug(`No translation content found for ${t.name} - ${t.ns} asset`);\n      }\n    });\n    Reaction.Importer.flush();\n\n    Logger.debug(\"All translation imported into translations collection from Assets.\");\n  } else {\n    bulkAssetOp = null;\n    Logger.debug(\"Cancel translation update. Translations have a already been imported.\");\n  }\n}\n","import SimpleSchema from \"simpl-schema\";\nimport { Meteor } from \"meteor/meteor\";\nimport Accounts from \"./accounts\";\nimport \"./browser-policy\";\nimport CollectionSecurity from \"./collection-security\";\nimport { importAllTranslations } from \"./i18n\";\nimport LoadFixtureData from \"./load-data\";\nimport Prerender from \"./prerender\";\nimport RateLimiters from \"./rate-limits\";\nimport RegisterCore from \"./register-core\";\nimport RegisterRouter from \"./register-router\";\nimport { initTemplates } from \"/server/api/core/templates\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Shops } from \"/lib/collections\";\n\n// This is needed so that it throws a Meteor.Error as `check()` would do\n// when we call schema.validate() in a Meteor method.\n// https://github.com/aldeed/node-simple-schema/#customize-the-error-that-is-thrown\nSimpleSchema.defineValidationErrorTransform((error) => {\n  const ddpError = new Meteor.Error(error.message);\n  ddpError.error = \"validation-error\";\n  ddpError.details = error.details;\n  return ddpError;\n});\n\nexport default function startup() {\n  const startTime = Date.now();\n\n  Accounts();\n  initTemplates();\n  RegisterCore();\n  RegisterRouter();\n\n  // initialize shop registry when a new shop is added\n  Shops.find().observe({\n    added(doc) {\n      Reaction.setShopName(doc);\n      Reaction.setDomain();\n    },\n    removed() {\n      // TODO SHOP REMOVAL CLEANUP FOR #357\n    }\n  });\n\n  LoadFixtureData();\n  Reaction.init();\n\n  importAllTranslations();\n\n  Prerender();\n  CollectionSecurity();\n  RateLimiters();\n\n  const endTime = Date.now();\n  Logger.info(`Reaction initialization finished: ${endTime - startTime}ms`);\n}\n","import { Meteor } from \"meteor/meteor\";\nimport { Shops } from \"/lib/collections\";\nimport { Logger, Reaction } from \"/server/api\";\nimport { Fixture } from \"/server/api/core/importer\";\n\nexport default function loadData() {\n  if (!process.env.SKIP_FIXTURES) {\n    /**\n     * Hook to setup core additional imports during Reaction init (shops process first)\n     */\n    Logger.info(\"Load default data from /private/data/\");\n\n    // Since import overwrites, only import Shops when none exist\n    if (!Reaction.getShopId()) {\n      try {\n        Logger.debug(\"Loading Shop Data\");\n        Reaction.Importer.process(Assets.getText(\"data/Shops.json\"), [\"name\"], Reaction.Importer.shop);\n        // ensure Shops are loaded first.\n        Reaction.Importer.flush(Shops);\n      } catch (error) {\n        Logger.error(error, \"Bypassing loading Shop default data\");\n      }\n\n      // make sure the default shop has been created before going further\n      while (!Reaction.getShopId()) {\n        Logger.debug(\"Loading default shop, waiting until it's ready before moving on...\");\n        Meteor._sleepForMs(1000);\n      }\n    }\n\n    try {\n      Logger.debug(\"Loading Shipping Data\");\n      Fixture.process(Assets.getText(\"data/Shipping.json\"), [\"name\"], Reaction.Importer.shipping);\n    } catch (error) {\n      Logger.error(error, \"Bypassing loading Shipping default data.\");\n    }\n\n    try {\n      Logger.debug(\"Loading Product Data\");\n      Fixture.process(Assets.getText(\"data/Products.json\"), [\"title\"], Reaction.Importer.product);\n    } catch (error) {\n      Logger.error(error, \"Bypassing loading Products default data.\");\n    }\n\n    try {\n      Logger.debug(\"Loading Tag Data\");\n      Fixture.process(Assets.getText(\"data/Tags.json\"), [\"name\"], Reaction.Importer.tag);\n    } catch (error) {\n      Logger.error(error, \"Bypassing loading Tags default data.\");\n    }\n    //\n    // these will flush and import with the rest of the imports from core init.\n    // but Bulk.find.upsert() = false\n    //\n    Fixture.flush();\n  }\n}\n","import prerender from \"prerender-node\";\nimport { WebApp } from \"meteor/webapp\";\nimport { Logger } from \"/server/api\";\n\nexport default function preRender() {\n  if (process.env.PRERENDER_TOKEN && process.env.PRERENDER_HOST) {\n    prerender.set(\"prerenderToken\", process.env.PRERENDER_TOKEN);\n    prerender.set(\"host\", process.env.PRERENDER_HOST);\n    prerender.set(\"protocol\", \"https\");\n    WebApp.rawConnectHandlers.use(prerender);\n    Logger.info(\"Prerender Initialization finished.\");\n  }\n}\n","import _ from \"lodash\";\nimport { DDPRateLimiter } from \"meteor/ddp-rate-limiter\";\n\n\nexport default function setRateLimits() {\n  /**\n   * Rate limit Meteor Accounts methods\n   * 2 attempts per connection per 5 seconds\n   */\n  const authMethods = [\n    \"login\",\n    \"logout\",\n    \"logoutOtherClients\",\n    \"getNewToken\",\n    \"removeOtherTokens\",\n    \"configureLoginService\",\n    \"changePassword\",\n    \"forgotPassword\",\n    \"resetPassword\",\n    \"verifyEmail\",\n    \"createUser\",\n    \"ATRemoveService\",\n    \"ATCreateUserServer\",\n    \"ATResendVerificationEmail\"\n  ];\n\n  DDPRateLimiter.addRule({\n    name: (name) => _.includes(authMethods, name),\n    connectionId: () => true\n  }, 2, 5000);\n\n\n  /**\n   * Rate limit \"orders/sendNotification\"\n   * 1 attempt per connection per 2 seconds\n   */\n  DDPRateLimiter.addRule({\n    name: \"orders/sendNotification\",\n    connectionId: () => true\n  }, 1, 2000);\n}\n","import { Reaction } from \"/server/api\";\n\n/*\n * register reaction core components as reaction packages\n */\nexport default function () {\n  Reaction.registerPackage({\n    label: \"Core\",\n    name: \"core\",\n    icon: \"fa fa-th\",\n    autoEnable: true,\n    settings: {\n      public: {\n        allowGuestCheckout: true\n      },\n      mail: {\n        user: \"\",\n        password: \"\",\n        host: \"\",\n        port: \"\"\n      },\n      openexchangerates: {\n        appId: \"\",\n        refreshPeriod: \"every 1 hour\"\n      },\n      paymentMethod: {\n        defaultPaymentMethod: \"\"\n      }\n    },\n    layout: [{\n      layout: \"coreLayout\",\n      workflow: \"coreWorkflow\",\n      theme: \"default\",\n      enabled: true,\n      structure: {\n        template: \"products\",\n        layoutHeader: \"NavBar\",\n        layoutFooter: \"Footer\",\n        notFound: \"productNotFound\",\n        dashboardControls: \"dashboardControls\",\n        adminControlsFooter: \"adminControlsFooter\"\n      }\n    }, {\n      layout: \"coreLayout\",\n      workflow: \"coreWorkflow\",\n      theme: \"default\",\n      enabled: true,\n      structure: {\n        template: \"unauthorized\",\n        layoutHeader: \"NavBar\",\n        layoutFooter: \"Footer\"\n      }\n    }]\n  });\n}\n","import { Reaction } from \"/server/api\";\n\nexport default function () {\n  Reaction.registerPackage({\n    label: \"Router\",\n    name: \"reaction-router\",\n    icon: \"fa fa-share-square-o\",\n    autoEnable: true,\n    settings: {\n      name: \"Layout\"\n    },\n    registry: [{\n      provides: [\"dashboard\"],\n      label: \"Routing\",\n      description: \"Routing utilities\",\n      icon: \"fa fa-share-square-o\",\n      priority: 1,\n      container: \"utilities\"\n    }]\n  });\n}\n","\n/**\n * ***** DO NOT EDIT THIS FILE MANUALLY *****\n * This file is generated automatically by the Reaction\n * plugin loader and will be reset at each startup.\n */\n\nimport '/imports/plugins/core/accounts/server';\nimport '/imports/plugins/core/catalog/server';\nimport '/imports/plugins/core/checkout/server';\nimport '/imports/plugins/core/connectors/server';\nimport '/imports/plugins/core/dashboard/server';\nimport '/imports/plugins/core/discounts/server';\nimport '/imports/plugins/core/email/server';\nimport '/imports/plugins/core/files/server';\nimport '/imports/plugins/core/graphql/server';\nimport '/imports/plugins/core/i18n/server';\nimport '/imports/plugins/core/layout/server';\nimport '/imports/plugins/core/logging/server';\nimport '/imports/plugins/core/orders/server';\nimport '/imports/plugins/core/payments/server';\nimport '/imports/plugins/core/revisions/server';\nimport '/imports/plugins/core/router/server';\nimport '/imports/plugins/core/shipping/server';\nimport '/imports/plugins/core/taxes/server';\nimport '/imports/plugins/core/templates/server';\nimport '/imports/plugins/core/ui/server';\nimport '/imports/plugins/core/ui-navbar/server';\nimport '/imports/plugins/core/ui-tagnav/server';\nimport '/imports/plugins/core/versions/server';\nimport '/imports/plugins/included/connectors-shopify/server';\nimport '/imports/plugins/included/default-theme/server';\nimport '/imports/plugins/included/discount-codes/server';\nimport '/imports/plugins/included/discount-rates/server';\nimport '/imports/plugins/included/email-templates/server';\nimport '/imports/plugins/included/inventory/server';\nimport '/imports/plugins/included/jobcontrol/server';\nimport '/imports/plugins/included/marketplace/server';\nimport '/imports/plugins/included/notifications/server';\nimport '/imports/plugins/included/payments-authnet/server';\nimport '/imports/plugins/included/payments-braintree/server';\nimport '/imports/plugins/included/payments-paypal/server';\nimport '/imports/plugins/included/payments-stripe/server';\nimport '/imports/plugins/included/product-admin/server';\nimport '/imports/plugins/included/product-detail-simple/server';\nimport '/imports/plugins/included/product-variant/server';\nimport '/imports/plugins/included/search-mongo/server';\nimport '/imports/plugins/included/shipping-rates/server';\nimport '/imports/plugins/included/shipping-shippo/server';\nimport '/imports/plugins/included/sms/server';\nimport '/imports/plugins/included/social/server';\nimport '/imports/plugins/included/taxes-avalara/server';\nimport '/imports/plugins/included/taxes-taxcloud/server';\nimport '/imports/plugins/included/taxes-taxjar/server';\nimport '/imports/plugins/included/ui-search/server';\nimport '/imports/plugins/custom/knowledge-payments/server';\nimport '/imports/plugins/custom/knowledge-theme/server';\nimport '/imports/plugins/core/accounts/register.js';\nimport '/imports/plugins/core/catalog/register.js';\nimport '/imports/plugins/core/checkout/register.js';\nimport '/imports/plugins/core/connectors/register.js';\nimport '/imports/plugins/core/dashboard/register.js';\nimport '/imports/plugins/core/discounts/register.js';\nimport '/imports/plugins/core/email/register.js';\nimport '/imports/plugins/core/i18n/register.js';\nimport '/imports/plugins/core/job-collection/register.js';\nimport '/imports/plugins/core/layout/register.js';\nimport '/imports/plugins/core/logging/register.js';\nimport '/imports/plugins/core/orders/register.js';\nimport '/imports/plugins/core/payments/register.js';\nimport '/imports/plugins/core/revisions/register.js';\nimport '/imports/plugins/core/router/register.js';\nimport '/imports/plugins/core/shipping/register.js';\nimport '/imports/plugins/core/taxes/register.js';\nimport '/imports/plugins/core/templates/register.js';\nimport '/imports/plugins/core/ui/register.js';\nimport '/imports/plugins/core/ui-navbar/register.js';\nimport '/imports/plugins/core/ui-tagnav/register.js';\nimport '/imports/plugins/core/versions/register.js';\nimport '/imports/plugins/included/connectors-shopify/register.js';\nimport '/imports/plugins/included/default-theme/register.js';\nimport '/imports/plugins/included/discount-codes/register.js';\nimport '/imports/plugins/included/email-templates/register.js';\nimport '/imports/plugins/included/inventory/register.js';\nimport '/imports/plugins/included/jobcontrol/register.js';\nimport '/imports/plugins/included/marketplace/register.js';\nimport '/imports/plugins/included/notifications/register.js';\nimport '/imports/plugins/included/payments-authnet/register.js';\nimport '/imports/plugins/included/payments-braintree/register.js';\nimport '/imports/plugins/included/payments-paypal/register.js';\nimport '/imports/plugins/included/payments-stripe/register.js';\nimport '/imports/plugins/included/product-admin/register.js';\nimport '/imports/plugins/included/product-detail-simple/register.js';\nimport '/imports/plugins/included/product-variant/register.js';\nimport '/imports/plugins/included/search-mongo/register.js';\nimport '/imports/plugins/included/shipping-rates/register.js';\nimport '/imports/plugins/included/shipping-shippo/register.js';\nimport '/imports/plugins/included/sms/register.js';\nimport '/imports/plugins/included/social/register.js';\nimport '/imports/plugins/included/taxes-avalara/register.js';\nimport '/imports/plugins/included/taxes-taxcloud/register.js';\nimport '/imports/plugins/included/ui-search/register.js';\nimport '/imports/plugins/custom/knowledge-payments/register.js';\nimport '/imports/plugins/custom/knowledge-theme/register.js';\n","import { Meteor } from \"meteor/meteor\";\nimport startup from \"./startup\";\nimport { Logger } from \"/server/api\";\n\n// handle any unhandled Promise rejections because\n// Node 8 no longer swallows them\nprocess.on(\"unhandledRejection\", (err) => {\n  Logger.error(err);\n});\n\nMeteor.startup(startup);\n"]}