{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/variantFormContainer.js","filename":"imports/plugins/included/product-variant/containers/variantFormContainer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"presets":[],"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/variantFormContainer.js","plugins":["jsx","jsx","flow","flow","objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/variantFormContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/variantFormContainer.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/builtin/extends\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nlet _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  default(v) {\n    _compose = v;\n  }\n\n}, 0);\nlet React, Component;\nmodule.watch(require(\"react\"), {\n  default(v) {\n    React = v;\n  },\n\n  Component(v) {\n    Component = v;\n  }\n\n}, 1);\nlet PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  default(v) {\n    PropTypes = v;\n  }\n\n}, 2);\nlet registerComponent;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  registerComponent(v) {\n    registerComponent = v;\n  }\n\n}, 3);\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 4);\nlet Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session(v) {\n    Session = v;\n  }\n\n}, 5);\nlet Validation;\nmodule.watch(require(\"@reactioncommerce/schemas\"), {\n  Validation(v) {\n    Validation = v;\n  }\n\n}, 6);\nlet ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct(v) {\n    ReactionProduct = v;\n  }\n\n}, 7);\nlet Packages;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Packages(v) {\n    Packages = v;\n  }\n\n}, 8);\nlet Reaction, i18next;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction(v) {\n    Reaction = v;\n  },\n\n  i18next(v) {\n    i18next = v;\n  }\n\n}, 9);\nlet TaxCodes;\nmodule.watch(require(\"../../../core/taxes/lib/collections\"), {\n  TaxCodes(v) {\n    TaxCodes = v;\n  }\n\n}, 10);\nlet ProductVariant;\nmodule.watch(require(\"../../../../../lib/collections/schemas/products\"), {\n  ProductVariant(v) {\n    ProductVariant = v;\n  }\n\n}, 11);\nlet VariantForm;\nmodule.watch(require(\"../components/variantForm\"), {\n  default(v) {\n    VariantForm = v;\n  }\n\n}, 12);\n\nconst wrapComponent = Comp => {\n  var _class, _temp;\n\n  return _temp = _class = class VariantFormContainer extends Component {\n    constructor(props) {\n      super(props);\n\n      this.isProviderEnabled = () => {\n        const shopId = Reaction.getShopId();\n        const provider = Packages.findOne({\n          shopId,\n          \"registry.provides\": \"taxCodes\",\n\n          \"$where\"() {\n            const providerName = this.name.split(\"-\")[1];\n            return this.settings[providerName].enabled;\n          }\n\n        });\n\n        if (provider) {\n          return true;\n        }\n\n        return false;\n      };\n\n      this.fetchTaxCodes = () => {\n        const shopId = Reaction.getShopId();\n        const provider = Packages.findOne({\n          shopId,\n          \"registry.provides\": \"taxCodes\",\n\n          \"$where\"() {\n            const providers = this.registry.filter(o => o.provides && o.provides.includes(\"taxCodes\"));\n            const providerName = providers[0].name.split(\"/\")[2];\n            return this.settings[providerName].enabled;\n          }\n\n        });\n        const taxCodesArray = [];\n        const codes = TaxCodes.find({\n          shopId,\n          taxCodeProvider: provider.name\n        });\n        codes.forEach(code => {\n          taxCodesArray.push({\n            value: code.taxCode,\n            label: `${code.taxCode} | ${code.label}`\n          });\n        });\n        return taxCodesArray;\n      };\n\n      this.hasChildVariants = variant => {\n        if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n          return true;\n        }\n\n        return false;\n      };\n\n      this.greyDisabledFields = variant => {\n        if (this.hasChildVariants(variant)) {\n          return {\n            backgroundColor: \"lightgrey\",\n            cursor: \"not-allowed\"\n          };\n        }\n      };\n\n      this.restoreVariant = variant => {\n        const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n        Alerts.alert({\n          title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", {\n            title\n          }),\n          showCancelButton: true,\n          confirmButtonText: \"Restore\"\n        }, isConfirm => {\n          if (isConfirm) {\n            const id = variant._id;\n            Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, error => {\n              if (error) {\n                Alerts.alert({\n                  text: i18next.t(\"productDetailEdit.restoreVariantFail\", {\n                    title\n                  }),\n                  confirmButtonText: i18next.t(\"app.close\", {\n                    defaultValue: \"Close\"\n                  })\n                });\n              }\n\n              this.setState({\n                isDeleted: !this.state.isDeleted\n              });\n            });\n          }\n        });\n      };\n\n      this.removeVariant = variant => {\n        const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n        Alerts.alert({\n          title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", {\n            title\n          }),\n          showCancelButton: true,\n          confirmButtonText: \"Archive\"\n        }, isConfirm => {\n          if (isConfirm) {\n            this.setState({\n              isDeleted: !this.state.isDeleted\n            });\n            const id = variant._id;\n            Meteor.call(\"products/deleteVariant\", id, (error, result) => {\n              if (result && ReactionProduct.selectedVariantId() === id) {\n                return ReactionProduct.setCurrentVariant(null);\n              }\n            });\n          }\n        });\n      };\n\n      this.cloneVariant = variant => {\n        const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n        const productId = ReactionProduct.selectedProductId();\n\n        if (!productId) {\n          return;\n        }\n\n        Meteor.call(\"products/cloneVariant\", productId, variant._id, (error, result) => {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.cloneVariantFail\", {\n                title\n              }),\n              confirmButtonText: i18next.t(\"app.close\", {\n                defaultValue: \"Close\"\n              })\n            });\n          } else if (result) {\n            const variantId = result[0];\n            ReactionProduct.setCurrentVariant(variantId);\n            Session.set(`variant-form-${variantId}`, true);\n          }\n        });\n      };\n\n      this.handleVariantFieldSave = (variantId, fieldName, value, variant) => {\n        const validationStatus = this.runVariantValidation(variant);\n\n        if (validationStatus.isFieldValid(fieldName)) {\n          Meteor.call(\"products/updateProductField\", variantId, fieldName, value, error => {\n            if (error) {\n              Alerts.toast(error.message, \"error\");\n            }\n\n            if (fieldName === \"inventoryPolicy\") {\n              this.updateInventoryPolicyIfChildVariants(variant);\n            }\n          });\n        }\n      };\n\n      this.handleCardExpand = cardName => {\n        Reaction.state.set(\"edit/focus\", cardName);\n      };\n\n      this.handleVariantVisibilityToggle = variant => {\n        Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", !variant.isVisible);\n      };\n\n      this.updateInventoryPolicyIfChildVariants = variant => {\n        // Get all siblings, including current variant\n        const options = ReactionProduct.getSiblings(variant); // Get parent\n\n        const parent = ReactionProduct.getVariantParent(variant); // If this is not a top-level variant, update top-level inventory policy as well\n\n        if (parent && options && options.length) {\n          // Check to see if every variant option inventory policy is true\n          const inventoryPolicy = options.every(option => option.inventoryPolicy === true); // If all inventory policies on children are true, update parent to be true\n\n          if (inventoryPolicy === true) {\n            return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", true, error => {\n              if (error) {\n                Alerts.toast(error.message, \"error\");\n              }\n            });\n          } // If any child has a false inventoryPolicy, update parent to be false\n\n\n          return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", false, error => {\n            if (error) {\n              Alerts.toast(error.message, \"error\");\n            }\n          });\n        }\n      };\n\n      this.updateQuantityIfChildVariants = variant => {\n        if (this.hasChildVariants(variant)) {\n          const variantQuantity = ReactionProduct.getVariantQuantity(variant);\n          return variantQuantity;\n        }\n      };\n\n      this.validation = new Validation(ProductVariant);\n      this.state = {\n        validationStatus: this.validation.validationStatus,\n        isDeleted: props.variant && props.variant.isDeleted\n      };\n    }\n\n    componentDidMount() {\n      this.runVariantValidation(this.props.variant);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      this.setState({\n        isDeleted: nextProps.variant && nextProps.variant.isDeleted\n      });\n    }\n\n    runVariantValidation(variant) {\n      if (variant) {\n        const validationStatus = this.validation.validate(variant);\n        this.setState(() => ({\n          validationStatus\n        }));\n        return validationStatus;\n      }\n    }\n\n    render() {\n      if (this.props.variant) {\n        return React.createElement(Comp, (0, _extends2.default)({\n          isProviderEnabled: this.isProviderEnabled,\n          fetchTaxCodes: this.fetchTaxCodes,\n          hasChildVariants: this.hasChildVariants,\n          greyDisabledFields: this.greyDisabledFields,\n          restoreVariant: this.restoreVariant,\n          removeVariant: this.removeVariant,\n          cloneVariant: this.cloneVariant,\n          onVariantFieldSave: this.handleVariantFieldSave,\n          onVisibilityButtonClick: this.handleVariantVisibilityToggle,\n          onCardExpand: this.handleCardExpand,\n          onUpdateQuantityField: this.updateQuantityIfChildVariants,\n          validation: this.state.validationStatus,\n          isDeleted: this.state.isDeleted\n        }, this.props, {\n          variant: this.props.variant\n        }));\n      }\n\n      return null;\n    }\n\n  }, _class.propTypes = {\n    variant: PropTypes.object\n  }, _temp;\n};\n\nregisterComponent(\"VariantForm\", VariantForm, wrapComponent);\nmodule.exportDefault(_compose(wrapComponent)(VariantForm));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/variantFormContainer.js"],"names":["_compose","module","watch","require","default","v","React","Component","PropTypes","registerComponent","Meteor","Session","Validation","ReactionProduct","Packages","Reaction","i18next","TaxCodes","ProductVariant","VariantForm","wrapComponent","Comp","VariantFormContainer","constructor","props","isProviderEnabled","shopId","getShopId","provider","findOne","providerName","name","split","settings","enabled","fetchTaxCodes","providers","registry","filter","o","provides","includes","taxCodesArray","codes","find","taxCodeProvider","forEach","code","push","value","taxCode","label","hasChildVariants","variant","checkChildVariants","_id","greyDisabledFields","backgroundColor","cursor","restoreVariant","title","t","Alerts","alert","showCancelButton","confirmButtonText","isConfirm","id","call","error","text","defaultValue","setState","isDeleted","state","removeVariant","result","selectedVariantId","setCurrentVariant","cloneVariant","productId","selectedProductId","variantId","set","handleVariantFieldSave","fieldName","validationStatus","runVariantValidation","isFieldValid","toast","message","updateInventoryPolicyIfChildVariants","handleCardExpand","cardName","handleVariantVisibilityToggle","isVisible","options","getSiblings","parent","getVariantParent","length","inventoryPolicy","every","option","updateQuantityIfChildVariants","variantQuantity","getVariantQuantity","validation","componentDidMount","componentWillReceiveProps","nextProps","validate","render","propTypes","object","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { compose } from \"recompose\";\nimport { registerComponent } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { Validation } from \"@reactioncommerce/schemas\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { TaxCodes } from \"/imports/plugins/core/taxes/lib/collections\";\nimport { ProductVariant } from \"/lib/collections/schemas/products\";\nimport VariantForm from \"../components/variantForm\";\n\nconst wrapComponent = (Comp) => (\n  class VariantFormContainer extends Component {\n    static propTypes = {\n      variant: PropTypes.object\n    }\n\n    constructor(props) {\n      super(props);\n\n      this.validation = new Validation(ProductVariant);\n\n      this.state = {\n        validationStatus: this.validation.validationStatus,\n        isDeleted: props.variant && props.variant.isDeleted\n      };\n    }\n\n    componentDidMount() {\n      this.runVariantValidation(this.props.variant);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      this.setState({\n        isDeleted: nextProps.variant && nextProps.variant.isDeleted\n      });\n    }\n\n    runVariantValidation(variant) {\n      if (variant) {\n        const validationStatus = this.validation.validate(variant);\n\n        this.setState(() => ({\n          validationStatus\n        }));\n\n        return validationStatus;\n      }\n    }\n\n    isProviderEnabled = () => {\n      const shopId = Reaction.getShopId();\n\n      const provider = Packages.findOne({\n        shopId,\n        \"registry.provides\": \"taxCodes\",\n        \"$where\"() {\n          const providerName = this.name.split(\"-\")[1];\n          return this.settings[providerName].enabled;\n        }\n      });\n\n      if (provider) {\n        return true;\n      }\n      return false;\n    }\n\n    fetchTaxCodes = () => {\n      const shopId = Reaction.getShopId();\n      const provider = Packages.findOne({\n        shopId,\n        \"registry.provides\": \"taxCodes\",\n        \"$where\"() {\n          const providers = this.registry.filter((o) => o.provides && o.provides.includes(\"taxCodes\"));\n          const providerName = providers[0].name.split(\"/\")[2];\n\n          return this.settings[providerName].enabled;\n        }\n      });\n      const taxCodesArray = [];\n\n      const codes = TaxCodes.find({\n        shopId,\n        taxCodeProvider: provider.name\n      });\n\n      codes.forEach((code) => {\n        taxCodesArray.push({\n          value: code.taxCode,\n          label: `${code.taxCode} | ${code.label}`\n        });\n      });\n      return taxCodesArray;\n    }\n\n    hasChildVariants = (variant) => {\n      if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n        return true;\n      }\n      return false;\n    }\n\n    greyDisabledFields = (variant) => {\n      if (this.hasChildVariants(variant)) {\n        return { backgroundColor: \"lightgrey\", cursor: \"not-allowed\" };\n      }\n    }\n\n    restoreVariant = (variant) => {\n      const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n      Alerts.alert({\n        title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", { title }),\n        showCancelButton: true,\n        confirmButtonText: \"Restore\"\n      }, (isConfirm) => {\n        if (isConfirm) {\n          const id = variant._id;\n          Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, (error) => {\n            if (error) {\n              Alerts.alert({\n                text: i18next.t(\"productDetailEdit.restoreVariantFail\", { title }),\n                confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n              });\n            }\n            this.setState({\n              isDeleted: !this.state.isDeleted\n            });\n          });\n        }\n      });\n    }\n\n    removeVariant = (variant) => {\n      const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n      Alerts.alert({\n        title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", { title }),\n        showCancelButton: true,\n        confirmButtonText: \"Archive\"\n      }, (isConfirm) => {\n        if (isConfirm) {\n          this.setState({\n            isDeleted: !this.state.isDeleted\n          });\n          const id = variant._id;\n          Meteor.call(\"products/deleteVariant\", id, (error, result) => {\n            if (result && ReactionProduct.selectedVariantId() === id) {\n              return ReactionProduct.setCurrentVariant(null);\n            }\n          });\n        }\n      });\n    }\n\n    cloneVariant = (variant) => {\n      const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n      const productId = ReactionProduct.selectedProductId();\n      if (!productId) {\n        return;\n      }\n      Meteor.call(\"products/cloneVariant\", productId, variant._id, (error, result) => {\n        if (error) {\n          Alerts.alert({\n            text: i18next.t(\"productDetailEdit.cloneVariantFail\", { title }),\n            confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n          });\n        } else if (result) {\n          const variantId = result[0];\n\n          ReactionProduct.setCurrentVariant(variantId);\n          Session.set(`variant-form-${variantId}`, true);\n        }\n      });\n    }\n\n    handleVariantFieldSave = (variantId, fieldName, value, variant) => {\n      const validationStatus = this.runVariantValidation(variant);\n\n      if (validationStatus.isFieldValid(fieldName)) {\n        Meteor.call(\"products/updateProductField\", variantId, fieldName, value, (error) => {\n          if (error) {\n            Alerts.toast(error.message, \"error\");\n          }\n\n          if (fieldName === \"inventoryPolicy\") {\n            this.updateInventoryPolicyIfChildVariants(variant);\n          }\n        });\n      }\n    }\n\n    handleCardExpand = (cardName) => {\n      Reaction.state.set(\"edit/focus\", cardName);\n    }\n\n    handleVariantVisibilityToggle = (variant) => {\n      Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", !variant.isVisible);\n    }\n\n    /**\n     * @method updateInventoryPolicyIfChildVariants\n     * @description update parent inventory policy if variant has children\n     * @param {Object} variant product or variant document\n     * @return {undefined} return nothing\n     */\n    updateInventoryPolicyIfChildVariants = (variant) => {\n      // Get all siblings, including current variant\n      const options = ReactionProduct.getSiblings(variant);\n      // Get parent\n      const parent = ReactionProduct.getVariantParent(variant);\n\n      // If this is not a top-level variant, update top-level inventory policy as well\n      if (parent && options && options.length) {\n        // Check to see if every variant option inventory policy is true\n        const inventoryPolicy = options.every((option) => option.inventoryPolicy === true);\n\n        // If all inventory policies on children are true, update parent to be true\n        if (inventoryPolicy === true) {\n          return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", true, (error) => {\n            if (error) {\n              Alerts.toast(error.message, \"error\");\n            }\n          });\n        }\n        // If any child has a false inventoryPolicy, update parent to be false\n        return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", false, (error) => {\n          if (error) {\n            Alerts.toast(error.message, \"error\");\n          }\n        });\n      }\n    }\n\n    updateQuantityIfChildVariants = (variant) => {\n      if (this.hasChildVariants(variant)) {\n        const variantQuantity = ReactionProduct.getVariantQuantity(variant);\n        return variantQuantity;\n      }\n    }\n\n    render() {\n      if (this.props.variant) {\n        return (\n          <Comp\n            isProviderEnabled={this.isProviderEnabled}\n            fetchTaxCodes={this.fetchTaxCodes}\n            hasChildVariants={this.hasChildVariants}\n            greyDisabledFields={this.greyDisabledFields}\n            restoreVariant={this.restoreVariant}\n            removeVariant={this.removeVariant}\n            cloneVariant={this.cloneVariant}\n            onVariantFieldSave={this.handleVariantFieldSave}\n            onVisibilityButtonClick={this.handleVariantVisibilityToggle}\n            onCardExpand={this.handleCardExpand}\n            onUpdateQuantityField={this.updateQuantityIfChildVariants}\n            validation={this.state.validationStatus}\n            isDeleted={this.state.isDeleted}\n            {...this.props}\n            variant={this.props.variant}\n          />\n        );\n      }\n\n      return null;\n    }\n  }\n);\n\nregisterComponent(\"VariantForm\", VariantForm, wrapComponent);\n\nexport default compose(wrapComponent)(VariantForm);\n"]},"sourceType":"script","hash":"87cc45c2f0e238005b9c80dce0e41f7055fce48a"}
