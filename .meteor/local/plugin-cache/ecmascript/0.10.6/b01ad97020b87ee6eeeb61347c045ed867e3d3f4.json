{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-detail-simple/client/containers/productDetail.js","filename":"imports/plugins/included/product-detail-simple/client/containers/productDetail.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-detail-simple/client/containers/productDetail.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-detail-simple/client/containers/productDetail.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-detail-simple/client/containers/productDetail.js"}},"code":"var _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  \"default\": function (v) {\n    _compose = v;\n  }\n}, 0);\n\nvar _map;\n\nmodule.watch(require(\"lodash/map\"), {\n  \"default\": function (v) {\n    _map = v;\n  }\n}, 1);\n\nvar _isArray;\n\nmodule.watch(require(\"lodash/isArray\"), {\n  \"default\": function (v) {\n    _isArray = v;\n  }\n}, 2);\n\nvar _isEmpty;\n\nmodule.watch(require(\"lodash/isEmpty\"), {\n  \"default\": function (v) {\n    _isEmpty = v;\n  }\n}, 3);\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 4);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 5);\nvar StyleRoot;\nmodule.watch(require(\"radium\"), {\n  StyleRoot: function (v) {\n    StyleRoot = v;\n  }\n}, 6);\nvar Components, registerComponent, composeWithTracker;\nmodule.watch(require(\"../../../../core/components/lib\"), {\n  Components: function (v) {\n    Components = v;\n  },\n  registerComponent: function (v) {\n    registerComponent = v;\n  },\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 7);\nvar $;\nmodule.watch(require(\"meteor/jquery\"), {\n  $: function (v) {\n    $ = v;\n  }\n}, 8);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 9);\nvar ReactionProduct;\nmodule.watch(require(\"../../../../../../lib/api\"), {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 10);\nvar Reaction, i18next, Logger;\nmodule.watch(require(\"../../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  },\n  Logger: function (v) {\n    Logger = v;\n  }\n}, 11);\nvar Tags, Cart;\nmodule.watch(require(\"../../../../../../lib/collections\"), {\n  Tags: function (v) {\n    Tags = v;\n  },\n  Cart: function (v) {\n    Cart = v;\n  }\n}, 12);\nvar ProductDetail;\nmodule.watch(require(\"../components\"), {\n  ProductDetail: function (v) {\n    ProductDetail = v;\n  }\n}, 13);\nvar SocialContainer, VariantListContainer;\nmodule.watch(require(\"./\"), {\n  SocialContainer: function (v) {\n    SocialContainer = v;\n  },\n  VariantListContainer: function (v) {\n    VariantListContainer = v;\n  }\n}, 14);\nvar Media;\nmodule.watch(require(\"../../../../core/files/client\"), {\n  Media: function (v) {\n    Media = v;\n  }\n}, 15);\n\nvar wrapComponent = function (Comp) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    (0, _inheritsLoose2.default)(ProductDetailContainer, _Component);\n\n    function ProductDetailContainer(props) {\n      var _this;\n\n      _this = _Component.call(this, props) || this;\n\n      _this.handleCartQuantityChange = function (event, quantity) {\n        _this.setState({\n          cartQuantity: Math.max(quantity, 1)\n        });\n      };\n\n      _this.handleAddToCart = function () {\n        var productId;\n        var quantity;\n        var maxQuantity;\n        var totalQuantity;\n        var storedQuantity = 0;\n        var currentVariant = ReactionProduct.selectedVariant();\n        var currentProduct = ReactionProduct.selectedProduct();\n\n        if (currentVariant) {\n          if (currentVariant.ancestors.length === 1) {\n            var options = ReactionProduct.getVariants(currentVariant._id);\n\n            if (options.length > 0) {\n              Alerts.inline(\"Please choose options before adding to cart\", \"warning\", {\n                placement: \"productDetail\",\n                i18nKey: \"productDetail.chooseOptions\",\n                autoHide: 10000\n              });\n              return [];\n            }\n          }\n\n          if (currentVariant.inventoryPolicy && currentVariant.inventoryQuantity < 1) {\n            Alerts.inline(\"Sorry, this item is out of stock!\", \"warning\", {\n              placement: \"productDetail\",\n              i18nKey: \"productDetail.outOfStock\",\n              autoHide: 10000\n            });\n            return [];\n          }\n\n          if (_this.props.storedCart && _this.props.storedCart.items) {\n            _this.props.storedCart.items.forEach(function (item) {\n              if (item.variants._id === currentVariant._id) {\n                storedQuantity = item.quantity;\n              }\n            });\n          }\n\n          quantity = parseInt(_this.state.cartQuantity, 10);\n          totalQuantity = quantity + storedQuantity;\n          maxQuantity = currentVariant.inventoryQuantity;\n\n          if (quantity < 1) {\n            quantity = 1;\n          }\n\n          if (currentVariant.inventoryPolicy && quantity > maxQuantity && storedQuantity < maxQuantity) {\n            Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n              placement: \"productDetail\",\n              i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n              autoHide: 10000\n            });\n            quantity = maxQuantity - storedQuantity;\n            totalQuantity = maxQuantity;\n          }\n\n          if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity && storedQuantity < maxQuantity && quantity < maxQuantity) {\n            Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n              placement: \"productDetail\",\n              i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n              autoHide: 10000\n            });\n            quantity = maxQuantity - storedQuantity;\n            totalQuantity = maxQuantity;\n          }\n\n          if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity) {\n            Alerts.inline(\"Sorry, this item is out of stock!\", \"error\", {\n              placement: \"productDetail\",\n              i18nKey: \"productDetail.outOfStock\",\n              autoHide: 10000\n            });\n            return [];\n          }\n\n          if (!currentProduct.isVisible) {\n            Alerts.inline(\"Publish product before adding to cart.\", \"error\", {\n              placement: \"productDetail\",\n              i18nKey: \"productDetail.publishFirst\",\n              autoHide: 10000\n            });\n          } else {\n            productId = currentProduct._id;\n\n            if (productId) {\n              Meteor.call(\"cart/addToCart\", productId, currentVariant._id, quantity, function (error) {\n                if (error) {\n                  Logger.error(error, \"Failed to add to cart.\");\n                  return error;\n                } // Reset cart quantity on success\n\n\n                _this.handleCartQuantityChange(null, 1);\n\n                _this.setState(function (_ref) {\n                  var productClick = _ref.productClick;\n                  return {\n                    productClick: productClick + 1\n                  };\n                });\n\n                return true;\n              });\n            } // template.$(\".variant-select-option\").removeClass(\"active\");\n\n\n            ReactionProduct.setCurrentVariant(null); // qtyField.val(1);\n            // scroll to top on cart add\n\n            $(\"html,body\").animate({\n              scrollTop: 0\n            }, 0); // slide out label\n\n            var addToCartText = i18next.t(\"productDetail.addedToCart\");\n            var addToCartTitle = currentVariant.title || \"\"; // Grab and cache the width of the alert to be used in animation\n\n            var alertWidth = $(\".cart-alert\").width();\n            var direction = i18next.dir() === \"rtl\" ? \"left\" : \"right\";\n            var oppositeDirection = i18next.dir() === \"rtl\" ? \"right\" : \"left\";\n\n            if ($(\".cart-alert\").css(\"display\") === \"none\") {\n              $(\"#spin\").addClass(\"hidden\");\n              $(\".cart-alert-text\").text(quantity + \" \" + addToCartTitle + \" \" + addToCartText);\n\n              _this.handleSlideOut(alertWidth, direction, oppositeDirection);\n\n              _this.animationTimeOut = setTimeout(function () {\n                _this.handleSlideIn(alertWidth, direction, oppositeDirection);\n              }, 4000);\n            } else {\n              clearTimeout(_this.textTimeOut); // hides text and display spinner\n\n              $(\".cart-alert-text\").hide();\n              $(\"#spin\").removeClass(\"hidden\");\n              _this.textTimeOut = setTimeout(function () {\n                $(\"#spin\").addClass(\"hidden\");\n                $(\".cart-alert-text\").text(_this.state.productClick * quantity + \" \" + addToCartTitle + \" \" + addToCartText);\n                $(\".cart-alert-text\").fadeIn(\"slow\");\n\n                if (_this._isMounted) {\n                  _this.setState({\n                    productClick: 0\n                  });\n                }\n              }, 2000);\n              clearTimeout(_this.animationTimeOut);\n              _this.animationTimeOut = setTimeout(function () {\n                _this.handleSlideIn(alertWidth, direction, oppositeDirection);\n              }, 4000);\n            }\n          }\n        } else {\n          Alerts.inline(\"Select an option before adding to cart\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.selectOption\",\n            autoHide: 8000\n          });\n        }\n\n        return null;\n      };\n\n      _this.handleProductFieldChange = function (productId, fieldName, value) {\n        Meteor.call(\"products/updateProductField\", productId, fieldName, value, function (error) {\n          if (error) {\n            Alerts.toast(error.message, \"error\");\n\n            _this.forceUpdate();\n          }\n        });\n      };\n\n      _this.handleViewContextChange = function (event, value) {\n        Reaction.Router.setQueryParams({\n          as: value\n        });\n      };\n\n      _this.handleDeleteProduct = function () {\n        ReactionProduct.archiveProduct(_this.props.product);\n      };\n\n      _this.animationTimeOut = null;\n      _this.textTimeOut = null;\n      _this.state = {\n        cartQuantity: 1,\n        productClick: 0\n      };\n      return _this;\n    }\n\n    var _proto = ProductDetailContainer.prototype;\n\n    _proto.componentDidMount = function () {\n      function componentDidMount() {\n        this._isMounted = true;\n      }\n\n      return componentDidMount;\n    }();\n\n    _proto.componentWillUnmount = function () {\n      function componentWillUnmount() {\n        this._isMounted = false;\n      }\n\n      return componentWillUnmount;\n    }();\n\n    _proto.handleSlideOut = function () {\n      function handleSlideOut(alertWidth, direction, oppositeDirection) {\n        var _$$show$css, _$$show$css$animate;\n\n        // Animate slide out\n        return $(\".cart-alert\").show().css((_$$show$css = {}, _$$show$css[oppositeDirection] = \"auto\", _$$show$css[direction] = -alertWidth, _$$show$css)).animate((_$$show$css$animate = {}, _$$show$css$animate[oppositeDirection] = \"auto\", _$$show$css$animate[direction] = 0, _$$show$css$animate), 600);\n      }\n\n      return handleSlideOut;\n    }();\n\n    _proto.handleSlideIn = function () {\n      function handleSlideIn(alertWidth, direction, oppositeDirection) {\n        var _$$animate;\n\n        // Animate slide in\n        return $(\".cart-alert\").animate((_$$animate = {}, _$$animate[oppositeDirection] = \"auto\", _$$animate[direction] = -alertWidth, _$$animate), {\n          duration: 600,\n          complete: function () {\n            $(\".cart-alert\").hide();\n          }\n        });\n      }\n\n      return handleSlideIn;\n    }();\n\n    _proto.render = function () {\n      function render() {\n        var _props = this.props,\n            media = _props.media,\n            product = _props.product;\n\n        if (_isEmpty(product)) {\n          return React.createElement(Components.ProductNotFound, null);\n        }\n\n        return React.createElement(StyleRoot, null, React.createElement(Comp, (0, _extends2.default)({\n          cartQuantity: this.state.cartQuantity,\n          mediaGalleryComponent: React.createElement(Components.MediaGallery, {\n            media: media\n          }),\n          onAddToCart: this.handleAddToCart,\n          onCartQuantityChange: this.handleCartQuantityChange,\n          onViewContextChange: this.handleViewContextChange,\n          socialComponent: React.createElement(SocialContainer, null),\n          topVariantComponent: React.createElement(VariantListContainer, null),\n          onDeleteProduct: this.handleDeleteProduct,\n          onProductFieldChange: this.handleProductFieldChange\n        }, this.props)));\n      }\n\n      return render;\n    }();\n\n    return ProductDetailContainer;\n  }(Component), _class.propTypes = {\n    media: PropTypes.arrayOf(PropTypes.object),\n    product: PropTypes.object,\n    storedCart: PropTypes.object\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  var tagSub = Meteor.subscribe(\"Tags\");\n  var shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n  var productId = Reaction.Router.getParam(\"handle\");\n  var variantId = ReactionProduct.selectedVariantId();\n  var revisionType = Reaction.Router.getQueryParam(\"revision\");\n  var viewProductAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n  var productSub;\n\n  if (productId) {\n    productSub = Meteor.subscribe(\"Product\", productId, shopIdOrSlug);\n  }\n\n  if (productSub && productSub.ready() && tagSub.ready() && Reaction.Subscriptions.Cart.ready()) {\n    var product = ReactionProduct.setProduct(productId, variantId);\n\n    if (Reaction.hasPermission(\"createProduct\")) {\n      if (!Reaction.getActionView() && Reaction.isActionViewOpen() === true) {\n        Reaction.setActionView({\n          template: \"productAdmin\",\n          data: product\n        });\n      }\n    } // Get the product tags\n\n\n    if (product) {\n      var tags;\n\n      if (_isArray(product.hashtags)) {\n        tags = _map(product.hashtags, function (id) {\n          return Tags.findOne(id);\n        });\n      }\n\n      Meteor.subscribe(\"ProductMedia\", product._id);\n      var mediaArray = [];\n      var selectedVariant = ReactionProduct.selectedVariant();\n\n      if (selectedVariant) {\n        // Find the media for the selected variant\n        mediaArray = Media.findLocal({\n          \"metadata.variantId\": selectedVariant._id\n        }, {\n          sort: {\n            \"metadata.priority\": 1\n          }\n        }); // If no media found, broaden the search to include other media from parents\n\n        if (Array.isArray(mediaArray) && mediaArray.length === 0 && selectedVariant.ancestors) {\n          // Loop through ancestors in reverse to find a variant that has media to use\n          for (var _iterator = selectedVariant.ancestors.reverse(), _isArray2 = Array.isArray(_iterator), _i = 0, _iterator = _isArray2 ? _iterator : _iterator[Symbol.iterator]();;) {\n            var _ref2;\n\n            if (_isArray2) {\n              if (_i >= _iterator.length) break;\n              _ref2 = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref2 = _i.value;\n            }\n\n            var _ancestor = _ref2;\n            var media = Media.findLocal({\n              \"metadata.variantId\": _ancestor\n            }, {\n              sort: {\n                \"metadata.priority\": 1\n              }\n            }); // If we found some media, then stop here\n\n            if (Array.isArray(media) && media.length) {\n              mediaArray = media;\n              break;\n            }\n          }\n        }\n      }\n\n      var priceRange;\n\n      if (selectedVariant && (0, _typeof2.default)(selectedVariant) === \"object\") {\n        var childVariants = ReactionProduct.getVariants(selectedVariant._id); // when top variant has no child variants we display only its price\n\n        if (childVariants.length === 0) {\n          priceRange = selectedVariant.price;\n        } else {\n          // otherwise we want to show child variants price range\n          priceRange = ReactionProduct.getVariantPriceRange();\n        }\n      }\n\n      var productRevision;\n\n      if (revisionType === \"published\") {\n        productRevision = product.__published;\n      }\n\n      var editable;\n\n      if (viewProductAs === \"customer\") {\n        editable = false;\n      } else {\n        editable = Reaction.hasPermission([\"createProduct\"]);\n      }\n\n      var topVariants = ReactionProduct.getTopVariants();\n      var storedCart = Cart.findOne();\n      onData(null, {\n        variants: topVariants,\n        layout: product.template || \"productDetailSimple\",\n        product: productRevision || product,\n        priceRange: priceRange,\n        tags: tags,\n        media: mediaArray,\n        editable: editable,\n        viewAs: viewProductAs,\n        hasAdminPermission: Reaction.hasPermission([\"createProduct\"]),\n        storedCart: storedCart\n      });\n    } else {\n      // onData must be called with composeWithTracker, or else the loading icon will show forever.\n      onData(null, {});\n    }\n  }\n}\n\nregisterComponent(\"ProductDetail\", ProductDetail, [composeWithTracker(composer), wrapComponent]); // Decorate component and export\n\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductDetail));","map":{"version":3,"sources":["imports/plugins/included/product-detail-simple/client/containers/productDetail.js"],"names":["_compose","module","watch","require","v","_map","_isArray","_isEmpty","React","Component","PropTypes","StyleRoot","Components","registerComponent","composeWithTracker","$","Meteor","ReactionProduct","Reaction","i18next","Logger","Tags","Cart","ProductDetail","SocialContainer","VariantListContainer","Media","wrapComponent","Comp","props","handleCartQuantityChange","event","quantity","setState","cartQuantity","Math","max","handleAddToCart","productId","maxQuantity","totalQuantity","storedQuantity","currentVariant","selectedVariant","currentProduct","selectedProduct","ancestors","length","options","getVariants","_id","Alerts","inline","placement","i18nKey","autoHide","inventoryPolicy","inventoryQuantity","storedCart","items","forEach","item","variants","parseInt","state","isVisible","call","error","productClick","setCurrentVariant","animate","scrollTop","addToCartText","t","addToCartTitle","title","alertWidth","width","direction","dir","oppositeDirection","css","addClass","text","handleSlideOut","animationTimeOut","setTimeout","handleSlideIn","clearTimeout","textTimeOut","hide","removeClass","fadeIn","_isMounted","handleProductFieldChange","fieldName","value","toast","message","forceUpdate","handleViewContextChange","Router","setQueryParams","as","handleDeleteProduct","archiveProduct","product","componentDidMount","componentWillUnmount","show","duration","complete","render","media","propTypes","arrayOf","object","composer","onData","tagSub","subscribe","shopIdOrSlug","getParam","variantId","selectedVariantId","revisionType","getQueryParam","viewProductAs","getUserPreferences","productSub","ready","Subscriptions","setProduct","hasPermission","getActionView","isActionViewOpen","setActionView","template","data","tags","hashtags","id","findOne","mediaArray","findLocal","sort","Array","isArray","reverse","ancestor","priceRange","childVariants","price","getVariantPriceRange","productRevision","__published","editable","topVariants","getTopVariants","layout","viewAs","hasAdminPermission","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport _ from \"lodash\";\nimport { StyleRoot } from \"radium\";\nimport { compose } from \"recompose\";\nimport { Components, registerComponent, composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport { $ } from \"meteor/jquery\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Reaction, i18next, Logger } from \"/client/api\";\nimport { Tags, Cart } from \"/lib/collections\";\nimport { ProductDetail } from \"../components\";\nimport { SocialContainer, VariantListContainer } from \"./\";\nimport { Media } from \"/imports/plugins/core/files/client\";\n\nconst wrapComponent = (Comp) => (\n  class ProductDetailContainer extends Component {\n    static propTypes = {\n      media: PropTypes.arrayOf(PropTypes.object),\n      product: PropTypes.object,\n      storedCart: PropTypes.object\n    }\n\n    constructor(props) {\n      super(props);\n\n      this.animationTimeOut = null;\n      this.textTimeOut = null;\n\n      this.state = {\n        cartQuantity: 1,\n        productClick: 0\n      };\n    }\n\n    componentDidMount() {\n      this._isMounted = true;\n    }\n\n    componentWillUnmount() {\n      this._isMounted = false;\n    }\n\n    handleCartQuantityChange = (event, quantity) => {\n      this.setState({\n        cartQuantity: Math.max(quantity, 1)\n      });\n    }\n\n    handleAddToCart = () => {\n      let productId;\n      let quantity;\n      let maxQuantity;\n      let totalQuantity;\n      let storedQuantity = 0;\n      const currentVariant = ReactionProduct.selectedVariant();\n      const currentProduct = ReactionProduct.selectedProduct();\n\n      if (currentVariant) {\n        if (currentVariant.ancestors.length === 1) {\n          const options = ReactionProduct.getVariants(currentVariant._id);\n\n          if (options.length > 0) {\n            Alerts.inline(\"Please choose options before adding to cart\", \"warning\", {\n              placement: \"productDetail\",\n              i18nKey: \"productDetail.chooseOptions\",\n              autoHide: 10000\n            });\n            return [];\n          }\n        }\n\n        if (currentVariant.inventoryPolicy && currentVariant.inventoryQuantity < 1) {\n          Alerts.inline(\"Sorry, this item is out of stock!\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.outOfStock\",\n            autoHide: 10000\n          });\n          return [];\n        }\n\n        if (this.props.storedCart && this.props.storedCart.items) {\n          this.props.storedCart.items.forEach((item) => {\n            if (item.variants._id === currentVariant._id) {\n              storedQuantity = item.quantity;\n            }\n          });\n        }\n\n        quantity = parseInt(this.state.cartQuantity, 10);\n        totalQuantity = quantity + storedQuantity;\n        maxQuantity = currentVariant.inventoryQuantity;\n\n        if (quantity < 1) {\n          quantity = 1;\n        }\n\n        if (currentVariant.inventoryPolicy && quantity > maxQuantity && storedQuantity < maxQuantity) {\n          Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n            autoHide: 10000\n          });\n          quantity = maxQuantity - storedQuantity;\n          totalQuantity = maxQuantity;\n        }\n\n        if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity && storedQuantity < maxQuantity && quantity < maxQuantity) {\n          Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n            autoHide: 10000\n          });\n          quantity = maxQuantity - storedQuantity;\n          totalQuantity = maxQuantity;\n        }\n\n        if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity) {\n          Alerts.inline(\"Sorry, this item is out of stock!\", \"error\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.outOfStock\",\n            autoHide: 10000\n          });\n          return [];\n        }\n\n        if (!currentProduct.isVisible) {\n          Alerts.inline(\"Publish product before adding to cart.\", \"error\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.publishFirst\",\n            autoHide: 10000\n          });\n        } else {\n          productId = currentProduct._id;\n\n          if (productId) {\n            Meteor.call(\"cart/addToCart\", productId, currentVariant._id, quantity, (error) => {\n              if (error) {\n                Logger.error(error, \"Failed to add to cart.\");\n                return error;\n              }\n              // Reset cart quantity on success\n              this.handleCartQuantityChange(null, 1);\n\n              this.setState(({ productClick }) => ({\n                productClick: productClick + 1\n              }));\n\n              return true;\n            });\n          }\n\n          // template.$(\".variant-select-option\").removeClass(\"active\");\n          ReactionProduct.setCurrentVariant(null);\n          // qtyField.val(1);\n          // scroll to top on cart add\n          $(\"html,body\").animate({\n            scrollTop: 0\n          }, 0);\n          // slide out label\n          const addToCartText = i18next.t(\"productDetail.addedToCart\");\n          const addToCartTitle = currentVariant.title || \"\";\n          // Grab and cache the width of the alert to be used in animation\n          const alertWidth = $(\".cart-alert\").width();\n          const direction = i18next.dir() === \"rtl\" ? \"left\" : \"right\";\n          const oppositeDirection = i18next.dir() === \"rtl\" ? \"right\" : \"left\";\n          if ($(\".cart-alert\").css(\"display\") === \"none\") {\n            $(\"#spin\").addClass(\"hidden\");\n            $(\".cart-alert-text\").text(`${quantity} ${addToCartTitle} ${addToCartText}`);\n            this.handleSlideOut(alertWidth, direction, oppositeDirection);\n            this.animationTimeOut = setTimeout(() => {\n              this.handleSlideIn(alertWidth, direction, oppositeDirection);\n            }, 4000);\n          } else {\n            clearTimeout(this.textTimeOut);\n\n            // hides text and display spinner\n            $(\".cart-alert-text\").hide();\n            $(\"#spin\").removeClass(\"hidden\");\n\n            this.textTimeOut = setTimeout(() => {\n              $(\"#spin\").addClass(\"hidden\");\n              $(\".cart-alert-text\").text(`${this.state.productClick * quantity} ${addToCartTitle} ${addToCartText}`);\n              $(\".cart-alert-text\").fadeIn(\"slow\");\n              if (this._isMounted) {\n                this.setState({ productClick: 0 });\n              }\n            }, 2000);\n\n            clearTimeout(this.animationTimeOut);\n            this.animationTimeOut = setTimeout(() => {\n              this.handleSlideIn(alertWidth, direction, oppositeDirection);\n            }, 4000);\n          }\n        }\n      } else {\n        Alerts.inline(\"Select an option before adding to cart\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.selectOption\",\n          autoHide: 8000\n        });\n      }\n\n      return null;\n    }\n\n    handleSlideOut(alertWidth, direction, oppositeDirection) {\n      // Animate slide out\n      return $(\".cart-alert\")\n        .show()\n        .css({\n          [oppositeDirection]: \"auto\",\n          [direction]: -alertWidth\n        })\n        .animate({\n          [oppositeDirection]: \"auto\",\n          [direction]: 0\n        }, 600);\n    }\n\n    handleSlideIn(alertWidth, direction, oppositeDirection) {\n      // Animate slide in\n      return $(\".cart-alert\").animate({\n        [oppositeDirection]: \"auto\",\n        [direction]: -alertWidth\n      }, {\n        duration: 600,\n        complete() {\n          $(\".cart-alert\").hide();\n        }\n      });\n    }\n\n    handleProductFieldChange = (productId, fieldName, value) => {\n      Meteor.call(\"products/updateProductField\", productId, fieldName, value, (error) => {\n        if (error) {\n          Alerts.toast(error.message, \"error\");\n          this.forceUpdate();\n        }\n      });\n    }\n\n    handleViewContextChange = (event, value) => {\n      Reaction.Router.setQueryParams({ as: value });\n    }\n\n    handleDeleteProduct = () => {\n      ReactionProduct.archiveProduct(this.props.product);\n    }\n\n    render() {\n      const { media, product } = this.props;\n\n      if (_.isEmpty(product)) {\n        return (\n          <Components.ProductNotFound />\n        );\n      }\n\n      return (\n        <StyleRoot>\n          <Comp\n            cartQuantity={this.state.cartQuantity}\n            mediaGalleryComponent={<Components.MediaGallery media={media} />}\n            onAddToCart={this.handleAddToCart}\n            onCartQuantityChange={this.handleCartQuantityChange}\n            onViewContextChange={this.handleViewContextChange}\n            socialComponent={<SocialContainer />}\n            topVariantComponent={<VariantListContainer />}\n            onDeleteProduct={this.handleDeleteProduct}\n            onProductFieldChange={this.handleProductFieldChange}\n            {...this.props}\n          />\n        </StyleRoot>\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  const tagSub = Meteor.subscribe(\"Tags\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n  const productId = Reaction.Router.getParam(\"handle\");\n  const variantId = ReactionProduct.selectedVariantId();\n  const revisionType = Reaction.Router.getQueryParam(\"revision\");\n  const viewProductAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n\n  let productSub;\n  if (productId) {\n    productSub = Meteor.subscribe(\"Product\", productId, shopIdOrSlug);\n  }\n  if (productSub && productSub.ready()\n    && tagSub.ready() && Reaction.Subscriptions.Cart.ready()) {\n    const product = ReactionProduct.setProduct(productId, variantId);\n    if (Reaction.hasPermission(\"createProduct\")) {\n      if (!Reaction.getActionView() && Reaction.isActionViewOpen() === true) {\n        Reaction.setActionView({\n          template: \"productAdmin\",\n          data: product\n        });\n      }\n    }\n\n    // Get the product tags\n    if (product) {\n      let tags;\n      if (_.isArray(product.hashtags)) {\n        tags = _.map(product.hashtags, (id) => Tags.findOne(id));\n      }\n\n      Meteor.subscribe(\"ProductMedia\", product._id);\n\n      let mediaArray = [];\n      const selectedVariant = ReactionProduct.selectedVariant();\n\n      if (selectedVariant) {\n        // Find the media for the selected variant\n        mediaArray = Media.findLocal({\n          \"metadata.variantId\": selectedVariant._id\n        }, {\n          sort: {\n            \"metadata.priority\": 1\n          }\n        });\n\n        // If no media found, broaden the search to include other media from parents\n        if (Array.isArray(mediaArray) && mediaArray.length === 0 && selectedVariant.ancestors) {\n          // Loop through ancestors in reverse to find a variant that has media to use\n          for (const ancestor of selectedVariant.ancestors.reverse()) {\n            const media = Media.findLocal({\n              \"metadata.variantId\": ancestor\n            }, {\n              sort: {\n                \"metadata.priority\": 1\n              }\n            });\n\n            // If we found some media, then stop here\n            if (Array.isArray(media) && media.length) {\n              mediaArray = media;\n              break;\n            }\n          }\n        }\n      }\n\n      let priceRange;\n      if (selectedVariant && typeof selectedVariant === \"object\") {\n        const childVariants = ReactionProduct.getVariants(selectedVariant._id);\n        // when top variant has no child variants we display only its price\n        if (childVariants.length === 0) {\n          priceRange = selectedVariant.price;\n        } else {\n          // otherwise we want to show child variants price range\n          priceRange = ReactionProduct.getVariantPriceRange();\n        }\n      }\n\n      let productRevision;\n\n      if (revisionType === \"published\") {\n        productRevision = product.__published;\n      }\n\n      let editable;\n\n      if (viewProductAs === \"customer\") {\n        editable = false;\n      } else {\n        editable = Reaction.hasPermission([\"createProduct\"]);\n      }\n\n      const topVariants = ReactionProduct.getTopVariants();\n\n      const storedCart = Cart.findOne();\n\n      onData(null, {\n        variants: topVariants,\n        layout: product.template || \"productDetailSimple\",\n        product: productRevision || product,\n        priceRange,\n        tags,\n        media: mediaArray,\n        editable,\n        viewAs: viewProductAs,\n        hasAdminPermission: Reaction.hasPermission([\"createProduct\"]),\n        storedCart\n      });\n    } else {\n      // onData must be called with composeWithTracker, or else the loading icon will show forever.\n      onData(null, {});\n    }\n  }\n}\n\nregisterComponent(\"ProductDetail\", ProductDetail, [\n  composeWithTracker(composer),\n  wrapComponent\n]);\n\n// Decorate component and export\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductDetail);\n"]},"sourceType":"script","hash":"b01ad97020b87ee6eeeb61347c045ed867e3d3f4"}
