{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-detail-simple/client/containers/variantList.js","filename":"imports/plugins/included/product-detail-simple/client/containers/variantList.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-detail-simple/client/containers/variantList.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-detail-simple/client/containers/variantList.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-detail-simple/client/containers/variantList.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 0);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 1);\nvar Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 2);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 3);\nvar composeWithTracker, Components;\nmodule.watch(require(\"../../../../core/components/lib\"), {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  },\n  Components: function (v) {\n    Components = v;\n  }\n}, 4);\nvar ReactionProduct;\nmodule.watch(require(\"../../../../../../lib/api\"), {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 5);\nvar Reaction, i18next;\nmodule.watch(require(\"../../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 6);\nvar getChildVariants;\nmodule.watch(require(\"../selectors/variants\"), {\n  getChildVariants: function (v) {\n    getChildVariants = v;\n  }\n}, 7);\nvar Products;\nmodule.watch(require(\"../../../../../../lib/collections\"), {\n  Products: function (v) {\n    Products = v;\n  }\n}, 8);\nvar update;\nmodule.watch(require(\"immutability-helper\"), {\n  \"default\": function (v) {\n    update = v;\n  }\n}, 9);\nvar getVariantIds;\nmodule.watch(require(\"../../../../../../lib/selectors/variants\"), {\n  getVariantIds: function (v) {\n    getVariantIds = v;\n  }\n}, 10);\nvar Media;\nmodule.watch(require(\"../../../../core/files/client\"), {\n  Media: function (v) {\n    Media = v;\n  }\n}, 11);\n\nfunction variantIsSelected(variantId) {\n  var current = ReactionProduct.selectedVariant();\n\n  if (current && (0, _typeof2.default)(current) === \"object\" && (variantId === current._id || current.ancestors.indexOf(variantId) >= 0)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction variantIsInActionView(variantId) {\n  var actionViewVariant = Reaction.getActionView().data;\n\n  if (actionViewVariant) {\n    // Check if the variant is selected, and also visible & selected in the action view\n    return variantIsSelected(variantId) && variantIsSelected(actionViewVariant._id) && Reaction.isActionViewOpen();\n  }\n\n  return false;\n}\n\nfunction getTopVariants() {\n  var inventoryTotal = 0;\n  var variants = ReactionProduct.getTopVariants();\n\n  if (variants.length) {\n    // calculate inventory total for all variants\n    for (var _iterator = variants, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var _variant2 = _ref;\n\n      if (_variant2.inventoryManagement) {\n        var qty = ReactionProduct.getVariantQuantity(_variant2);\n\n        if (typeof qty === \"number\") {\n          inventoryTotal += qty;\n        }\n      }\n    } // calculate percentage of total inventory of this product\n\n\n    for (var _iterator2 = variants, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var _variant3 = _ref2;\n\n      var _qty = ReactionProduct.getVariantQuantity(_variant3);\n\n      _variant3.inventoryTotal = inventoryTotal;\n\n      if (_variant3.inventoryManagement && inventoryTotal) {\n        _variant3.inventoryPercentage = parseInt(_qty / inventoryTotal * 100, 10);\n      } else {\n        // for cases when sellers doesn't use inventory we should always show\n        // \"green\" progress bar\n        _variant3.inventoryPercentage = 100;\n      }\n\n      if (_variant3.title) {\n        _variant3.inventoryWidth = parseInt(_variant3.inventoryPercentage - _variant3.title.length, 10);\n      } else {\n        _variant3.inventoryWidth = 0;\n      }\n    } // sort variants in correct order\n\n\n    variants.sort(function (a, b) {\n      return a.index - b.index;\n    });\n    return variants;\n  }\n\n  return [];\n}\n\nfunction isSoldOut(variant) {\n  return ReactionProduct.getVariantQuantity(variant) < 1;\n}\n\nvar VariantListContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inheritsLoose2.default)(VariantListContainer, _Component);\n\n  function VariantListContainer() {\n    var _temp, _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return (_temp = _this = _Component.call.apply(_Component, [this].concat(args)) || this, _this.handleCreateVariant = function () {\n      var selectedProduct = ReactionProduct.selectedProduct();\n      Meteor.call(\"products/createVariant\", selectedProduct._id, function (error) {\n        if (error) {\n          Alerts.alert({\n            text: i18next.t(\"productDetailEdit.addVariantFail\", {\n              title: selectedProduct.title\n            }),\n            confirmButtonText: i18next.t(\"app.close\", {\n              defaultValue: \"Close\"\n            })\n          });\n        }\n      });\n    }, _this.handleVariantClick = function (event, variant) {\n      var ancestors = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -1;\n\n      _this.handleEditVariant(event, variant, ancestors);\n    }, _this.handleEditVariant = function (event, variant) {\n      var ancestors = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -1;\n      var editVariant = variant;\n\n      if (ancestors >= 0) {\n        editVariant = Products.findOne(variant.ancestors[ancestors]);\n      }\n\n      var cardName = \"variant-\" + variant._id;\n      Reaction.state.set(\"edit/focus\", cardName);\n      ReactionProduct.setCurrentVariant(variant._id);\n      Session.set(\"variant-form-\" + editVariant._id, true);\n\n      if (Reaction.hasPermission(\"createProduct\") && !Reaction.isPreview()) {\n        Reaction.showActionView({\n          label: \"Edit Variant\",\n          i18nKeyLabel: \"productDetailEdit.editVariant\",\n          template: \"variantForm\",\n          data: editVariant\n        });\n      } // Prevent the default edit button `onEditButtonClick` function from running\n\n\n      return false;\n    }, _this.handleVariantVisibilityToggle = function (event, variant, variantIsVisible) {\n      Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", variantIsVisible);\n    }, _this.handleMoveVariant = function (dragIndex, hoverIndex) {\n      var variant = _this.props.variants[dragIndex]; // Apply new sort order to variant list\n\n      var newVariantOrder = update(_this.props.variants, {\n        $splice: [[dragIndex, 1], [hoverIndex, 0, variant]]\n      }); // Set local state so the component does't have to wait for a round-trip\n      // to the server to get the updated list of variants\n\n      _this.setState({\n        variants: newVariantOrder\n      }); // Save the updated positions\n\n\n      Meteor.defer(function () {\n        Meteor.call(\"products/updateVariantsPosition\", getVariantIds(newVariantOrder));\n      });\n    }, _temp) || (0, _assertThisInitialized2.default)(_this);\n  }\n\n  var _proto = VariantListContainer.prototype;\n\n  _proto.componentWillReceiveProps = function () {\n    function componentWillReceiveProps() {\n      this.setState({});\n    }\n\n    return componentWillReceiveProps;\n  }();\n\n  _proto.render = function () {\n    function render() {\n      return React.createElement(Components.DragDropProvider, null, React.createElement(Components.VariantList, (0, _extends2.default)({\n        onEditVariant: this.handleEditVariant,\n        onMoveVariant: this.handleMoveVariant,\n        onVariantClick: this.handleVariantClick,\n        onVariantVisibiltyToggle: this.handleVariantVisibilityToggle,\n        onCreateVariant: this.handleCreateVariant\n      }, this.props, {\n        variants: this.variants\n      })));\n    }\n\n    return render;\n  }();\n\n  (0, _createClass2.default)(VariantListContainer, [{\n    key: \"variants\",\n    get: function () {\n      return this.state && this.state.variants || this.props.variants;\n    }\n  }, {\n    key: \"productHandle\",\n    get: function () {\n      var selectedProduct = ReactionProduct.selectedProduct();\n      return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n    }\n  }]);\n  return VariantListContainer;\n}(Component);\n\nfunction composer(props, onData) {\n  var childVariantMedia = [];\n  var childVariants = getChildVariants();\n\n  if (Array.isArray(childVariants)) {\n    childVariantMedia = Media.findLocal({\n      \"metadata.variantId\": {\n        $in: getVariantIds(childVariants)\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n  }\n\n  var editable;\n\n  if (Reaction.isPreview() === true) {\n    editable = false;\n  } else {\n    editable = Reaction.hasPermission([\"createProduct\"]);\n  }\n\n  onData(null, {\n    variants: getTopVariants(),\n    variantIsSelected: variantIsSelected,\n    variantIsInActionView: variantIsInActionView,\n    childVariants: childVariants,\n    childVariantMedia: childVariantMedia,\n    displayPrice: ReactionProduct.getVariantPriceRange,\n    isSoldOut: isSoldOut,\n    editable: editable\n  });\n}\n\nVariantListContainer.propTypes = {\n  variants: PropTypes.arrayOf(PropTypes.object)\n};\nmodule.exportDefault(composeWithTracker(composer)(VariantListContainer));","map":{"version":3,"sources":["imports/plugins/included/product-detail-simple/client/containers/variantList.js"],"names":["React","Component","module","watch","require","v","PropTypes","Session","Meteor","composeWithTracker","Components","ReactionProduct","Reaction","i18next","getChildVariants","Products","update","getVariantIds","Media","variantIsSelected","variantId","current","selectedVariant","_id","ancestors","indexOf","variantIsInActionView","actionViewVariant","getActionView","data","isActionViewOpen","getTopVariants","inventoryTotal","variants","length","variant","inventoryManagement","qty","getVariantQuantity","inventoryPercentage","parseInt","title","inventoryWidth","sort","a","b","index","isSoldOut","VariantListContainer","handleCreateVariant","selectedProduct","call","error","Alerts","alert","text","t","confirmButtonText","defaultValue","handleVariantClick","event","handleEditVariant","editVariant","findOne","cardName","state","set","setCurrentVariant","hasPermission","isPreview","showActionView","label","i18nKeyLabel","template","handleVariantVisibilityToggle","variantIsVisible","handleMoveVariant","dragIndex","hoverIndex","props","newVariantOrder","$splice","setState","defer","componentWillReceiveProps","render","__published","handle","composer","onData","childVariantMedia","childVariants","Array","isArray","findLocal","$in","editable","displayPrice","getVariantPriceRange","propTypes","arrayOf","object","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Session } from \"meteor/session\";\nimport { Meteor } from \"meteor/meteor\";\nimport { composeWithTracker, Components } from \"@reactioncommerce/reaction-components\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { getChildVariants } from \"../selectors/variants\";\nimport { Products } from \"/lib/collections\";\nimport update from \"immutability-helper\";\nimport { getVariantIds } from \"/lib/selectors/variants\";\nimport { Media } from \"/imports/plugins/core/files/client\";\n\nfunction variantIsSelected(variantId) {\n  const current = ReactionProduct.selectedVariant();\n  if (current && typeof current === \"object\" && (variantId === current._id || current.ancestors.indexOf(variantId) >= 0)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction variantIsInActionView(variantId) {\n  const actionViewVariant = Reaction.getActionView().data;\n\n  if (actionViewVariant) {\n    // Check if the variant is selected, and also visible & selected in the action view\n    return variantIsSelected(variantId) && variantIsSelected(actionViewVariant._id) && Reaction.isActionViewOpen();\n  }\n\n  return false;\n}\n\nfunction getTopVariants() {\n  let inventoryTotal = 0;\n  const variants = ReactionProduct.getTopVariants();\n  if (variants.length) {\n    // calculate inventory total for all variants\n    for (const variant of variants) {\n      if (variant.inventoryManagement) {\n        const qty = ReactionProduct.getVariantQuantity(variant);\n        if (typeof qty === \"number\") {\n          inventoryTotal += qty;\n        }\n      }\n    }\n    // calculate percentage of total inventory of this product\n    for (const variant of variants) {\n      const qty = ReactionProduct.getVariantQuantity(variant);\n      variant.inventoryTotal = inventoryTotal;\n      if (variant.inventoryManagement && inventoryTotal) {\n        variant.inventoryPercentage = parseInt(qty / inventoryTotal * 100, 10);\n      } else {\n        // for cases when sellers doesn't use inventory we should always show\n        // \"green\" progress bar\n        variant.inventoryPercentage = 100;\n      }\n      if (variant.title) {\n        variant.inventoryWidth = parseInt(variant.inventoryPercentage -\n          variant.title.length, 10);\n      } else {\n        variant.inventoryWidth = 0;\n      }\n    }\n    // sort variants in correct order\n    variants.sort((a, b) => a.index - b.index);\n\n    return variants;\n  }\n  return [];\n}\n\nfunction isSoldOut(variant) {\n  return ReactionProduct.getVariantQuantity(variant) < 1;\n}\n\nclass VariantListContainer extends Component {\n  componentWillReceiveProps() {\n    this.setState({});\n  }\n\n  get variants() {\n    return (this.state && this.state.variants) || this.props.variants;\n  }\n\n  get productHandle() {\n    const selectedProduct = ReactionProduct.selectedProduct();\n    return (selectedProduct.__published && selectedProduct.__published.handle) || selectedProduct.handle;\n  }\n\n  handleCreateVariant = () => {\n    const selectedProduct = ReactionProduct.selectedProduct();\n\n    Meteor.call(\"products/createVariant\", selectedProduct._id, (error) => {\n      if (error) {\n        Alerts.alert({\n          text: i18next.t(\"productDetailEdit.addVariantFail\", { title: selectedProduct.title }),\n          confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n        });\n      }\n    });\n  }\n\n  handleVariantClick = (event, variant, ancestors = -1) => {\n    this.handleEditVariant(event, variant, ancestors);\n  }\n\n  handleEditVariant = (event, variant, ancestors = -1) => {\n    let editVariant = variant;\n    if (ancestors >= 0) {\n      editVariant = Products.findOne(variant.ancestors[ancestors]);\n    }\n\n    const cardName = `variant-${variant._id}`;\n    Reaction.state.set(\"edit/focus\", cardName);\n\n    ReactionProduct.setCurrentVariant(variant._id);\n    Session.set(`variant-form-${editVariant._id}`, true);\n\n    if (Reaction.hasPermission(\"createProduct\") && !Reaction.isPreview()) {\n      Reaction.showActionView({\n        label: \"Edit Variant\",\n        i18nKeyLabel: \"productDetailEdit.editVariant\",\n        template: \"variantForm\",\n        data: editVariant\n      });\n    }\n\n    // Prevent the default edit button `onEditButtonClick` function from running\n    return false;\n  }\n\n  handleVariantVisibilityToggle = (event, variant, variantIsVisible) => {\n    Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", variantIsVisible);\n  }\n\n  handleMoveVariant = (dragIndex, hoverIndex) => {\n    const variant = this.props.variants[dragIndex];\n\n    // Apply new sort order to variant list\n    const newVariantOrder = update(this.props.variants, {\n      $splice: [\n        [dragIndex, 1],\n        [hoverIndex, 0, variant]\n      ]\n    });\n\n    // Set local state so the component does't have to wait for a round-trip\n    // to the server to get the updated list of variants\n    this.setState({\n      variants: newVariantOrder\n    });\n\n    // Save the updated positions\n    Meteor.defer(() => {\n      Meteor.call(\"products/updateVariantsPosition\", getVariantIds(newVariantOrder));\n    });\n  }\n\n  render() {\n    return (\n      <Components.DragDropProvider>\n        <Components.VariantList\n          onEditVariant={this.handleEditVariant}\n          onMoveVariant={this.handleMoveVariant}\n          onVariantClick={this.handleVariantClick}\n          onVariantVisibiltyToggle={this.handleVariantVisibilityToggle}\n          onCreateVariant={this.handleCreateVariant}\n          {...this.props}\n          variants={this.variants}\n        />\n      </Components.DragDropProvider>\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  let childVariantMedia = [];\n  const childVariants = getChildVariants();\n\n  if (Array.isArray(childVariants)) {\n    childVariantMedia = Media.findLocal({\n      \"metadata.variantId\": {\n        $in: getVariantIds(childVariants)\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n  }\n\n  let editable;\n\n  if (Reaction.isPreview() === true) {\n    editable = false;\n  } else {\n    editable = Reaction.hasPermission([\"createProduct\"]);\n  }\n\n  onData(null, {\n    variants: getTopVariants(),\n    variantIsSelected,\n    variantIsInActionView,\n    childVariants,\n    childVariantMedia,\n    displayPrice: ReactionProduct.getVariantPriceRange,\n    isSoldOut,\n    editable\n  });\n}\n\nVariantListContainer.propTypes = {\n  variants: PropTypes.arrayOf(PropTypes.object)\n};\n\nexport default composeWithTracker(composer)(VariantListContainer);\n"]},"sourceType":"script","hash":"0d54af27e048bbaff60f75cef502b683a6ac6fa5"}
