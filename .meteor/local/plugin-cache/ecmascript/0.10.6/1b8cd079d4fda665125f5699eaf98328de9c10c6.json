{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/core/orders/client/templates/workflow/shippingInvoice.js","filename":"imports/plugins/core/orders/client/templates/workflow/shippingInvoice.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/core/orders/client/templates/workflow/shippingInvoice.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/core/orders/client/templates/workflow/shippingInvoice.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/core/orders/client/templates/workflow/shippingInvoice.js"}},"code":"var _includes;\n\nmodule.watch(require(\"lodash/includes\"), {\n  \"default\": function (v) {\n    _includes = v;\n  }\n}, 0);\nvar accounting;\nmodule.watch(require(\"accounting-js\"), {\n  \"default\": function (v) {\n    accounting = v;\n  }\n}, 1);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar $;\nmodule.watch(require(\"meteor/jquery\"), {\n  $: function (v) {\n    $ = v;\n  }\n}, 3);\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 4);\nvar ReactiveVar;\nmodule.watch(require(\"meteor/reactive-var\"), {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 5);\nvar ReactiveDict;\nmodule.watch(require(\"meteor/reactive-dict\"), {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 6);\nvar i18next, Logger, Reaction;\nmodule.watch(require(\"../../../../../../../client/api\"), {\n  i18next: function (v) {\n    i18next = v;\n  },\n  Logger: function (v) {\n    Logger = v;\n  },\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 7);\nvar Orders, Shops, Packages;\nmodule.watch(require(\"../../../../../../../lib/collections\"), {\n  Orders: function (v) {\n    Orders = v;\n  },\n  Shops: function (v) {\n    Shops = v;\n  },\n  Packages: function (v) {\n    Packages = v;\n  }\n}, 8);\nvar InvoiceContainer;\nmodule.watch(require(\"../../containers/invoiceContainer.js\"), {\n  \"default\": function (v) {\n    InvoiceContainer = v;\n  }\n}, 9);\nvar getBillingInfo;\nmodule.watch(require(\"../../helpers\"), {\n  getBillingInfo: function (v) {\n    getBillingInfo = v;\n  }\n}, 10);\n\n// helper to return the order payment object\n// the first credit paymentMethod on the order\n// returns entire payment method\nfunction orderCreditMethod(order) {\n  var creditMethods = order.billing && order.billing.filter(function (value) {\n    return value && value.paymentMethod && value.paymentMethod.method === \"credit\";\n  });\n  var creditMethod = creditMethods && creditMethods.find(function (billing) {\n    return billing && billing.shopId === Reaction.getShopId();\n  });\n  return creditMethod || {};\n} //\n// core order shipping invoice templates\n//\n\n\nTemplate.coreOrderShippingInvoice.onCreated(function () {\n  var _this = this;\n\n  this.state = new ReactiveDict();\n  this.refunds = new ReactiveVar([]);\n  this.refundAmount = new ReactiveVar(0.00);\n  this.state.setDefault({\n    isCapturing: false,\n    isRefunding: false,\n    isFetching: false\n  });\n  this.autorun(function () {\n    var currentData = Template.currentData();\n    var order = Orders.findOne(currentData.orderId);\n    var shop = Shops.findOne({});\n\n    _this.state.set(\"order\", order);\n\n    _this.state.set(\"currency\", shop.currencies[shop.currency]);\n\n    _this.state.set(\"isFetching\", true);\n\n    if (order) {\n      Meteor.call(\"orders/refunds/list\", order, function (error, result) {\n        if (error) Logger.warn(error);\n\n        _this.refunds.set(result);\n\n        _this.state.set(\"isFetching\", false);\n      });\n    }\n  });\n});\nTemplate.coreOrderShippingInvoice.helpers({\n  currentData: function () {\n    var currentData = Template.currentData();\n    return currentData;\n  },\n  order: function () {\n    var instance = Template.instance();\n    var order = instance.state.get(\"order\");\n    return order;\n  },\n  currency: function () {\n    var instance = Template.instance();\n    var currency = instance.state.get(\"currency\");\n    return currency;\n  },\n  refunds: function () {\n    var refunds = Template.instance().refunds.get();\n\n    if (Array.isArray(refunds)) {\n      return refunds.reverse();\n    }\n\n    return refunds;\n  },\n  isCapturing: function () {\n    var instance = Template.instance();\n\n    if (instance.state.get(\"isCapturing\")) {\n      instance.$(\":input\").attr(\"disabled\", true);\n      instance.$(\"#btn-capture-payment\").text(\"Capturing\");\n      return true;\n    }\n\n    return false;\n  },\n  isRefunding: function () {\n    var instance = Template.instance();\n\n    if (instance.state.get(\"isRefunding\")) {\n      instance.$(\"#btn-refund-payment\").text(i18next.t(\"order.refunding\"));\n      return true;\n    }\n\n    return false;\n  },\n  isFetching: function () {\n    var instance = Template.instance();\n\n    if (instance.state.get(\"isFetching\")) {\n      return true;\n    }\n\n    return false;\n  },\n  InvoiceContainer: function () {\n    return InvoiceContainer;\n  }\n});\n/**\n * coreOrderAdjustments events\n */\n\nTemplate.coreOrderShippingInvoice.events({\n  /**\n   * Click Start Cancel Order\n   * @param {Event} event - Event Object\n   * @param {Template} instance - Blaze Template\n   * @return {void}\n   */\n  \"click [data-event-action=cancelOrder]\": function (event, instance) {\n    event.preventDefault();\n    var order = instance.state.get(\"order\");\n    var invoiceTotal = getBillingInfo(order).invoice && getBillingInfo(order).invoice.total;\n    var currencySymbol = instance.state.get(\"currency\").symbol;\n\n    var _getBillingInfo = getBillingInfo(order),\n        paymentMethod = _getBillingInfo.paymentMethod;\n\n    Meteor.subscribe(\"Packages\", Reaction.getShopId());\n    var packageId = paymentMethod && paymentMethod.paymentPackageId;\n    var settingsKey = paymentMethod && paymentMethod.paymentSettingsKey; // check if payment provider supports de-authorize\n\n    var checkSupportedMethods = Packages.findOne({\n      _id: packageId\n    }).settings[settingsKey].support;\n    var orderStatus = paymentMethod && paymentMethod.status;\n    var orderMode = paymentMethod && paymentMethod.mode;\n    var alertText;\n\n    if (_includes(checkSupportedMethods, \"de-authorize\") || orderStatus === \"completed\" && orderMode === \"capture\") {\n      alertText = i18next.t(\"order.applyRefundDuringCancelOrder\", {\n        currencySymbol: currencySymbol,\n        invoiceTotal: invoiceTotal\n      });\n    }\n\n    Alerts.alert({\n      title: i18next.t(\"order.cancelOrder\"),\n      text: alertText,\n      type: \"warning\",\n      showCancelButton: true,\n      showCloseButton: true,\n      confirmButtonColor: \"#98afbc\",\n      cancelButtonColor: \"#98afbc\",\n      confirmButtonText: i18next.t(\"order.cancelOrderNoRestock\"),\n      cancelButtonText: i18next.t(\"order.cancelOrderThenRestock\")\n    }, function (isConfirm, cancel) {\n      var returnToStock;\n\n      if (isConfirm) {\n        returnToStock = false;\n        return Meteor.call(\"orders/cancelOrder\", order, returnToStock, function (err) {\n          if (err) {\n            $(\".alert\").removeClass(\"hidden\").text(err.message);\n          }\n        });\n      }\n\n      if (cancel === \"cancel\") {\n        returnToStock = true;\n        return Meteor.call(\"orders/cancelOrder\", order, returnToStock, function (err) {\n          if (err) {\n            $(\".alert\").removeClass(\"hidden\").text(err.message);\n          }\n        });\n      }\n    });\n  },\n  \"click [data-event-action=makeAdjustments]\": function (event, instance) {\n    event.preventDefault();\n    Meteor.call(\"orders/makeAdjustmentsToInvoice\", instance.state.get(\"order\"));\n  },\n  \"change input[name=refund_amount], keyup input[name=refund_amount]\": function (event, instance) {\n    instance.refundAmount.set(accounting.unformat(event.target.value));\n  }\n});\n/**\n * coreOrderShippingInvoice helpers\n */\n\nTemplate.coreOrderShippingInvoice.helpers({\n  refundAmount: function () {\n    return Template.instance().refundAmount;\n  },\n  disabled: function () {\n    var instance = Template.instance();\n    var order = instance.state.get(\"order\");\n    var status = orderCreditMethod(order).paymentMethod && orderCreditMethod(order).paymentMethod.status;\n\n    if (status === \"approved\" || status === \"completed\") {\n      return \"disabled\";\n    }\n\n    return \"\";\n  },\n  capturedDisabled: function () {\n    var isLoading = Template.instance().state.get(\"isCapturing\");\n\n    if (isLoading) {\n      return \"disabled\";\n    }\n\n    return null;\n  }\n});","map":{"version":3,"sources":["imports/plugins/core/orders/client/templates/workflow/shippingInvoice.js"],"names":["_includes","module","watch","require","v","accounting","Meteor","$","Template","ReactiveVar","ReactiveDict","i18next","Logger","Reaction","Orders","Shops","Packages","InvoiceContainer","getBillingInfo","orderCreditMethod","order","creditMethods","billing","filter","value","paymentMethod","method","creditMethod","find","shopId","getShopId","coreOrderShippingInvoice","onCreated","state","refunds","refundAmount","setDefault","isCapturing","isRefunding","isFetching","autorun","currentData","findOne","orderId","shop","set","currencies","currency","call","error","result","warn","helpers","instance","get","Array","isArray","reverse","attr","text","t","events","event","preventDefault","invoiceTotal","invoice","total","currencySymbol","symbol","subscribe","packageId","paymentPackageId","settingsKey","paymentSettingsKey","checkSupportedMethods","_id","settings","support","orderStatus","status","orderMode","mode","alertText","Alerts","alert","title","type","showCancelButton","showCloseButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","isConfirm","cancel","returnToStock","err","removeClass","message","unformat","target","disabled","capturedDisabled","isLoading"],"mappings":"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","sourcesContent":["import accounting from \"accounting-js\";\nimport _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { $ } from \"meteor/jquery\";\nimport { Template } from \"meteor/templating\";\nimport { ReactiveVar } from \"meteor/reactive-var\";\nimport { ReactiveDict } from \"meteor/reactive-dict\";\nimport { i18next, Logger, Reaction } from \"/client/api\";\nimport { Orders, Shops, Packages } from \"/lib/collections\";\nimport InvoiceContainer from \"../../containers/invoiceContainer.js\";\nimport { getBillingInfo } from \"../../helpers\";\n\n// helper to return the order payment object\n// the first credit paymentMethod on the order\n// returns entire payment method\nfunction orderCreditMethod(order) {\n  const creditMethods = order.billing && order.billing.filter((value) => value && value.paymentMethod && value.paymentMethod.method === \"credit\");\n  const creditMethod = creditMethods && creditMethods.find((billing) => billing && billing.shopId === Reaction.getShopId());\n  return creditMethod || {};\n}\n\n//\n// core order shipping invoice templates\n//\nTemplate.coreOrderShippingInvoice.onCreated(function () {\n  this.state = new ReactiveDict();\n  this.refunds = new ReactiveVar([]);\n  this.refundAmount = new ReactiveVar(0.00);\n  this.state.setDefault({\n    isCapturing: false,\n    isRefunding: false,\n    isFetching: false\n  });\n\n  this.autorun(() => {\n    const currentData = Template.currentData();\n    const order = Orders.findOne(currentData.orderId);\n    const shop = Shops.findOne({});\n\n    this.state.set(\"order\", order);\n    this.state.set(\"currency\", shop.currencies[shop.currency]);\n    this.state.set(\"isFetching\", true);\n\n    if (order) {\n      Meteor.call(\"orders/refunds/list\", order, (error, result) => {\n        if (error) Logger.warn(error);\n        this.refunds.set(result);\n        this.state.set(\"isFetching\", false);\n      });\n    }\n  });\n});\n\nTemplate.coreOrderShippingInvoice.helpers({\n  currentData() {\n    const currentData = Template.currentData();\n    return currentData;\n  },\n  order() {\n    const instance = Template.instance();\n    const order = instance.state.get(\"order\");\n    return order;\n  },\n  currency() {\n    const instance = Template.instance();\n    const currency = instance.state.get(\"currency\");\n    return currency;\n  },\n  refunds() {\n    const refunds = Template.instance().refunds.get();\n    if (Array.isArray(refunds)) {\n      return refunds.reverse();\n    }\n\n    return refunds;\n  },\n  isCapturing() {\n    const instance = Template.instance();\n    if (instance.state.get(\"isCapturing\")) {\n      instance.$(\":input\").attr(\"disabled\", true);\n      instance.$(\"#btn-capture-payment\").text(\"Capturing\");\n      return true;\n    }\n    return false;\n  },\n  isRefunding() {\n    const instance = Template.instance();\n    if (instance.state.get(\"isRefunding\")) {\n      instance.$(\"#btn-refund-payment\").text(i18next.t(\"order.refunding\"));\n      return true;\n    }\n    return false;\n  },\n  isFetching() {\n    const instance = Template.instance();\n    if (instance.state.get(\"isFetching\")) {\n      return true;\n    }\n    return false;\n  },\n\n  InvoiceContainer() {\n    return InvoiceContainer;\n  }\n});\n\n/**\n * coreOrderAdjustments events\n */\nTemplate.coreOrderShippingInvoice.events({\n  /**\n   * Click Start Cancel Order\n   * @param {Event} event - Event Object\n   * @param {Template} instance - Blaze Template\n   * @return {void}\n   */\n  \"click [data-event-action=cancelOrder]\": (event, instance) => {\n    event.preventDefault();\n    const order = instance.state.get(\"order\");\n    const invoiceTotal = getBillingInfo(order).invoice && getBillingInfo(order).invoice.total;\n    const currencySymbol = instance.state.get(\"currency\").symbol;\n    const { paymentMethod } = getBillingInfo(order);\n\n    Meteor.subscribe(\"Packages\", Reaction.getShopId());\n    const packageId = paymentMethod && paymentMethod.paymentPackageId;\n    const settingsKey = paymentMethod && paymentMethod.paymentSettingsKey;\n    // check if payment provider supports de-authorize\n    const checkSupportedMethods = Packages.findOne({\n      _id: packageId\n    }).settings[settingsKey].support;\n\n    const orderStatus = paymentMethod && paymentMethod.status;\n    const orderMode = paymentMethod && paymentMethod.mode;\n\n    let alertText;\n    if (_.includes(checkSupportedMethods, \"de-authorize\") ||\n      (orderStatus === \"completed\" && orderMode === \"capture\")) {\n      alertText = i18next.t(\"order.applyRefundDuringCancelOrder\", { currencySymbol, invoiceTotal });\n    }\n\n    Alerts.alert({\n      title: i18next.t(\"order.cancelOrder\"),\n      text: alertText,\n      type: \"warning\",\n      showCancelButton: true,\n      showCloseButton: true,\n      confirmButtonColor: \"#98afbc\",\n      cancelButtonColor: \"#98afbc\",\n      confirmButtonText: i18next.t(\"order.cancelOrderNoRestock\"),\n      cancelButtonText: i18next.t(\"order.cancelOrderThenRestock\")\n    }, (isConfirm, cancel) => {\n      let returnToStock;\n      if (isConfirm) {\n        returnToStock = false;\n        return Meteor.call(\"orders/cancelOrder\", order, returnToStock, (err) => {\n          if (err) {\n            $(\".alert\").removeClass(\"hidden\").text(err.message);\n          }\n        });\n      }\n      if (cancel === \"cancel\") {\n        returnToStock = true;\n        return Meteor.call(\"orders/cancelOrder\", order, returnToStock, (err) => {\n          if (err) {\n            $(\".alert\").removeClass(\"hidden\").text(err.message);\n          }\n        });\n      }\n    });\n  },\n\n  \"click [data-event-action=makeAdjustments]\": (event, instance) => {\n    event.preventDefault();\n    Meteor.call(\"orders/makeAdjustmentsToInvoice\", instance.state.get(\"order\"));\n  },\n\n  \"change input[name=refund_amount], keyup input[name=refund_amount]\": (event, instance) => {\n    instance.refundAmount.set(accounting.unformat(event.target.value));\n  }\n});\n\n\n/**\n * coreOrderShippingInvoice helpers\n */\nTemplate.coreOrderShippingInvoice.helpers({\n  refundAmount() {\n    return Template.instance().refundAmount;\n  },\n\n  disabled() {\n    const instance = Template.instance();\n    const order = instance.state.get(\"order\");\n    const status = orderCreditMethod(order).paymentMethod && orderCreditMethod(order).paymentMethod.status;\n\n    if (status === \"approved\" || status === \"completed\") {\n      return \"disabled\";\n    }\n\n    return \"\";\n  },\n\n  capturedDisabled() {\n    const isLoading = Template.instance().state.get(\"isCapturing\");\n    if (isLoading) {\n      return \"disabled\";\n    }\n    return null;\n  }\n});\n"]},"sourceType":"script","hash":"1b8cd079d4fda665125f5699eaf98328de9c10c6"}
