{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/core/components/lib/hoc.js","filename":"imports/plugins/core/components/lib/hoc.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/core/components/lib/hoc.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/core/components/lib/hoc.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/core/components/lib/hoc.js"}},"code":"module.export({\n  withCurrentUser: function () {\n    return withCurrentUser;\n  },\n  withMoment: function () {\n    return withMoment;\n  },\n  withMomentTimezone: function () {\n    return withMomentTimezone;\n  },\n  withCurrentAccount: function () {\n    return withCurrentAccount;\n  },\n  withIsAdmin: function () {\n    return withIsAdmin;\n  },\n  withPermissions: function () {\n    return withPermissions;\n  },\n  withIsOwner: function () {\n    return withIsOwner;\n  }\n});\n\nvar _lifecycle;\n\nmodule.watch(require(\"recompose/lifecycle\"), {\n  \"default\": function (v) {\n    _lifecycle = v;\n  }\n}, 0);\n\nvar _difference;\n\nmodule.watch(require(\"lodash/difference\"), {\n  \"default\": function (v) {\n    _difference = v;\n  }\n}, 1);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Roles;\nmodule.watch(require(\"meteor/alanning:roles\"), {\n  Roles: function (v) {\n    Roles = v;\n  }\n}, 3);\nvar Accounts, Groups;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Accounts: function (v) {\n    Accounts = v;\n  },\n  Groups: function (v) {\n    Groups = v;\n  }\n}, 4);\nvar composeWithTracker;\nmodule.watch(require(\"./composer\"), {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 5);\nvar Logger;\nvar Reaction;\n\nif (Meteor.isClient) {\n  var _require = require(\"../../../../../client/api\");\n\n  Logger = _require.Logger;\n\n  var _require2 = require(\"../../../../../client/api\");\n\n  Reaction = _require2.Reaction;\n} else {\n  var _require3 = require(\"../../../../../server/api\");\n\n  Logger = _require3.Logger;\n\n  var _require4 = require(\"../../../../../server/api\");\n\n  Reaction = _require4.Reaction;\n}\n/**\n * @name withCurrentUser\n * @method\n * @summary A wrapper to reactively inject the current user into a component\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with a \"currentUser\" prop\n * @memberof Components\n */\n\n\nfunction withCurrentUser(component) {\n  return composeWithTracker(function (props, onData) {\n    onData(null, {\n      currentUser: Meteor.user()\n    });\n  })(component);\n}\n\nfunction withMoment(component) {\n  return _lifecycle({\n    componentDidMount: function () {\n      var _this = this;\n\n      Promise.resolve().then(function () {\n        return require(\"moment\");\n      }).then(function (moment) {\n        moment.locale(Reaction.Locale.get().language);\n\n        _this.setState({\n          moment: moment\n        });\n      }).catch(function (error) {\n        Logger.debug(error, \"moment.js async import error\");\n      });\n    }\n  })(component);\n}\n\nfunction withMomentTimezone(component) {\n  return _lifecycle({\n    componentDidMount: function () {\n      var _this2 = this;\n\n      Promise.resolve().then(function () {\n        return require(\"moment-timezone\");\n      }).then(function (moment) {\n        _this2.setState({\n          momentTimezone: moment.tz\n        });\n      }).catch(function (error) {\n        Logger.debug(error, \"moment.js async import error\");\n      });\n    }\n  })(component);\n}\n\nfunction withCurrentAccount(component) {\n  return composeWithTracker(function (props, onData) {\n    var shopId = Reaction.getShopId();\n    var user = Meteor.user();\n\n    if (!shopId || !user) {\n      return null;\n    }\n\n    var accSub = Meteor.subscribe(\"Accounts\", user._id);\n\n    if (accSub.ready()) {\n      // shoppers should always be guests\n      var isGuest = Reaction.hasPermission(\"guest\"); // but if a user has never logged in then they are anonymous\n\n      var isAnonymous = Roles.userIsInRole(user, \"anonymous\", shopId); // this check for \"anonymous\" uses userIsInRole instead of hasPermission because hasPermission\n      // always return `true` when logged in as the owner.\n      // But in this case, the anonymous check should be false when a user is logged in\n\n      var account = Accounts.findOne(user._id);\n      onData(null, {\n        currentAccount: isGuest && !isAnonymous && account\n      });\n    }\n  }, false)(component);\n}\n\nfunction withIsAdmin(component) {\n  return composeWithTracker(function (props, onData) {\n    onData(null, {\n      isAdmin: Reaction.hasAdminAccess()\n    });\n  })(component);\n}\n\nfunction withPermissions(_ref) {\n  var _ref$roles = _ref.roles,\n      roles = _ref$roles === void 0 ? [\"guest\", \"anonymous\"] : _ref$roles,\n      group = _ref.group;\n  return composeWithTracker(function (props, onData) {\n    var hasPermissions = Reaction.hasPermission(roles);\n\n    if (!group) {\n      return onData(null, {\n        hasPermissions: hasPermissions\n      });\n    } // if group is passed, use group access instead\n\n\n    var grpSub = Meteor.subscribe(\"Groups\");\n\n    if (grpSub.ready()) {\n      var grp = Groups.findOne({\n        slug: group\n      });\n\n      if (grp && grp.permissions) {\n        var user = Meteor.user();\n        var permissions = user.roles[Reaction.getShopId()] || []; // checks that userPermissions includes all elements from groupPermissions\n\n        hasPermissions = _difference(grp.permissions, permissions).length === 0;\n      }\n\n      onData(null, {\n        hasPermissions: hasPermissions\n      });\n    }\n  });\n}\n\nfunction withIsOwner(component) {\n  return composeWithTracker(function (props, onData) {\n    onData(null, {\n      isOwner: Reaction.hasOwnerAccess()\n    });\n  })(component);\n}","map":{"version":3,"sources":["imports/plugins/core/components/lib/hoc.js"],"names":["module","export","withCurrentUser","withMoment","withMomentTimezone","withCurrentAccount","withIsAdmin","withPermissions","withIsOwner","_lifecycle","watch","require","v","_difference","Meteor","Roles","Accounts","Groups","composeWithTracker","Logger","Reaction","isClient","component","props","onData","currentUser","user","componentDidMount","then","moment","locale","Locale","get","language","setState","catch","error","debug","momentTimezone","tz","shopId","getShopId","accSub","subscribe","_id","ready","isGuest","hasPermission","isAnonymous","userIsInRole","account","findOne","currentAccount","isAdmin","hasAdminAccess","roles","group","hasPermissions","grpSub","grp","slug","permissions","length","isOwner","hasOwnerAccess"],"mappings":"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","sourcesContent":["import _ from \"lodash\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport { Accounts, Groups } from \"/lib/collections\";\nimport { lifecycle } from \"recompose\";\nimport { composeWithTracker } from \"./composer\";\n\nlet Logger;\nlet Reaction;\n\nif (Meteor.isClient) {\n  ({ Logger } = require(\"/client/api\"));\n  ({ Reaction } = require(\"/client/api\"));\n} else {\n  ({ Logger } = require(\"/server/api\"));\n  ({ Reaction } = require(\"/server/api\"));\n}\n\n\n/**\n * @name withCurrentUser\n * @method\n * @summary A wrapper to reactively inject the current user into a component\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with a \"currentUser\" prop\n * @memberof Components\n */\nexport function withCurrentUser(component) {\n  return composeWithTracker((props, onData) => {\n    onData(null, { currentUser: Meteor.user() });\n  })(component);\n}\n\n\n/**\n * @name withMoment\n * @method\n * @summary A wrapper to reactively inject the moment package into a component\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with a \"moment\" prop\n * @memberof Components\n */\nexport function withMoment(component) {\n  return lifecycle({\n    componentDidMount() {\n      import(\"moment\")\n        .then((moment) => {\n          moment.locale(Reaction.Locale.get().language);\n          this.setState({\n            moment\n          });\n        })\n        .catch((error) => {\n          Logger.debug(error, \"moment.js async import error\");\n        });\n    }\n  })(component);\n}\n\n\n/**\n * @name withMomentTimezone\n * @method\n * @summary A wrapper to reactively inject the moment package into a component\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with a \"moment\" prop\n * @memberof Components\n */\nexport function withMomentTimezone(component) {\n  return lifecycle({\n    componentDidMount() {\n      import(\"moment-timezone\")\n        .then((moment) => {\n          this.setState({\n            momentTimezone: moment.tz\n          });\n        })\n        .catch((error) => {\n          Logger.debug(error, \"moment.js async import error\");\n        });\n    }\n  })(component);\n}\n\n\n/**\n * @name withCurrentAccount\n * @method\n * @summary A wrapper to reactively inject the current account into a component.\n * This assumes you have signed up and are not an anonymous user.\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with a \"currentAccount\" prop\n * @memberof Components\n */\nexport function withCurrentAccount(component) {\n  return composeWithTracker((props, onData) => {\n    const shopId = Reaction.getShopId();\n    const user = Meteor.user();\n\n    if (!shopId || !user) {\n      return null;\n    }\n\n    const accSub = Meteor.subscribe(\"Accounts\", user._id);\n    if (accSub.ready()) {\n      // shoppers should always be guests\n      const isGuest = Reaction.hasPermission(\"guest\");\n      // but if a user has never logged in then they are anonymous\n      const isAnonymous = Roles.userIsInRole(user, \"anonymous\", shopId);\n      // this check for \"anonymous\" uses userIsInRole instead of hasPermission because hasPermission\n      // always return `true` when logged in as the owner.\n      // But in this case, the anonymous check should be false when a user is logged in\n      const account = Accounts.findOne(user._id);\n\n      onData(null, { currentAccount: isGuest && !isAnonymous && account });\n    }\n  }, false)(component);\n}\n\n\n/**\n * @name withIsAdmin\n * @method\n * @summary A wrapper to reactively inject the current user's admin status.\n * Sets a boolean 'isAdmin' prop on the wrapped component.\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with an \"isAdmin\" prop\n * @memberof Components\n */\nexport function withIsAdmin(component) {\n  return composeWithTracker((props, onData) => {\n    onData(null, { isAdmin: Reaction.hasAdminAccess() });\n  })(component);\n}\n\n/**\n * @name withPermissions\n * @method\n * @summary A wrapper to reactively inject a user's permission based on group or roles\n * Group access is given to users at that group level and above\n * @param  {Array|String} roles String or array of strings of permissions to check. default: roles=[\"guest\", \"anonymous\"]\n * @param  {String} group Slug title of a group to check against. Group option supercedes roles option. default: group=\"customer\".\n * @return {Function} the new wrapped component with a \"hasPermissions\" prop\n * @memberof Components\n */\nexport function withPermissions({ roles = [\"guest\", \"anonymous\"], group }) {\n  return composeWithTracker((props, onData) => {\n    let hasPermissions = Reaction.hasPermission(roles);\n\n    if (!group) {\n      return onData(null, { hasPermissions });\n    }\n\n    // if group is passed, use group access instead\n    const grpSub = Meteor.subscribe(\"Groups\");\n\n    if (grpSub.ready()) {\n      const grp = Groups.findOne({ slug: group });\n\n      if (grp && grp.permissions) {\n        const user = Meteor.user();\n        const permissions = user.roles[Reaction.getShopId()] || [];\n        // checks that userPermissions includes all elements from groupPermissions\n        hasPermissions = _.difference(grp.permissions, permissions).length === 0;\n      }\n\n      onData(null, { hasPermissions });\n    }\n  });\n}\n\n\n/**\n * @name withIsOwner\n * @method\n * @summary A wrapper to reactively inject the current user's owner status.\n * Sets a boolean 'isOwner' prop on the wrapped component.\n * @param {Function|React.Component} component - the component to wrap\n * @return {Function} the new wrapped component with an \"isOwner\" prop\n * @memberof Components\n */\nexport function withIsOwner(component) {\n  return composeWithTracker((props, onData) => {\n    onData(null, { isOwner: Reaction.hasOwnerAccess() });\n  })(component);\n}\n"]},"sourceType":"script","hash":"a43998524f430ca7159e50d724607cd6651b2f39"}
