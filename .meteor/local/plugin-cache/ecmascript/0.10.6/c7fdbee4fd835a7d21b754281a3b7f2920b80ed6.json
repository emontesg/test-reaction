{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","filename":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"presets":[],"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","plugins":["jsx","jsx","flow","flow","objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/builtin/extends\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nlet _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  default(v) {\n    _compose = v;\n  }\n\n}, 0);\nlet React, Component;\nmodule.watch(require(\"react\"), {\n  default(v) {\n    React = v;\n  },\n\n  Component(v) {\n    Component = v;\n  }\n\n}, 1);\nlet PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  default(v) {\n    PropTypes = v;\n  }\n\n}, 2);\nlet registerComponent, composeWithTracker;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  registerComponent(v) {\n    registerComponent = v;\n  },\n\n  composeWithTracker(v) {\n    composeWithTracker = v;\n  }\n\n}, 3);\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 4);\nlet ReactiveVar;\nmodule.watch(require(\"meteor/reactive-var\"), {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 5);\nlet Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session(v) {\n    Session = v;\n  }\n\n}, 6);\nlet Tracker;\nmodule.watch(require(\"meteor/tracker\"), {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 7);\nlet Reaction;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction(v) {\n    Reaction = v;\n  }\n\n}, 8);\nlet ITEMS_INCREMENT;\nmodule.watch(require(\"../../../../../client/config/defaults\"), {\n  ITEMS_INCREMENT(v) {\n    ITEMS_INCREMENT = v;\n  }\n\n}, 9);\nlet ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct(v) {\n    ReactionProduct = v;\n  }\n\n}, 10);\nlet applyProductRevision, resubscribeAfterCloning;\nmodule.watch(require(\"../../../../../lib/api/products\"), {\n  applyProductRevision(v) {\n    applyProductRevision = v;\n  },\n\n  resubscribeAfterCloning(v) {\n    resubscribeAfterCloning = v;\n  }\n\n}, 11);\nlet Products, Tags, Shops;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Products(v) {\n    Products = v;\n  },\n\n  Tags(v) {\n    Tags = v;\n  },\n\n  Shops(v) {\n    Shops = v;\n  }\n\n}, 12);\nlet ProductsComponent;\nmodule.watch(require(\"../components/products\"), {\n  default(v) {\n    ProductsComponent = v;\n  }\n\n}, 13);\nconst reactiveProductIds = new ReactiveVar([], (oldVal, newVal) => JSON.stringify(oldVal.sort()) === JSON.stringify(newVal.sort())); // Isolated resubscribe to product grid images, only when the list of product IDs changes\n\nTracker.autorun(() => {\n  Meteor.subscribe(\"ProductGridMedia\", reactiveProductIds.get());\n});\n/**\n * loadMoreProducts\n * @summary whenever #productScrollLimitLoader becomes visible, retrieve more results\n * this basically runs this:\n * Session.set('productScrollLimit', Session.get('productScrollLimit') + ITEMS_INCREMENT);\n * @return {undefined}\n */\n\nfunction loadMoreProducts() {\n  let threshold;\n  const target = document.querySelectorAll(\"#productScrollLimitLoader\");\n  let scrollContainer = document.querySelectorAll(\"#container-main\");\n\n  if (scrollContainer.length === 0) {\n    scrollContainer = window;\n  }\n\n  if (target.length) {\n    threshold = scrollContainer[0].scrollHeight - scrollContainer[0].scrollTop === scrollContainer[0].clientHeight;\n\n    if (threshold) {\n      if (!target[0].getAttribute(\"visible\")) {\n        target[0].setAttribute(\"productScrollLimit\", true);\n        Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n      }\n    } else if (target[0].getAttribute(\"visible\")) {\n      target[0].setAttribute(\"visible\", false);\n    }\n  }\n}\n\nconst wrapComponent = Comp => {\n  var _class, _temp;\n\n  return _temp = _class = class ProductsContainer extends Component {\n    constructor(props) {\n      super(props);\n\n      this.ready = () => {\n        if (this.props.showNotFound === true) {\n          return false;\n        }\n\n        const isInitialLoad = this.state.initialLoad === true;\n        const isReady = this.props.productsSubscription.ready();\n\n        if (isInitialLoad === false) {\n          return true;\n        }\n\n        if (isReady) {\n          return true;\n        }\n\n        return false;\n      };\n\n      this.loadMoreProducts = () => this.props.canLoadMoreProducts === true;\n\n      this.loadProducts = event => {\n        event.preventDefault();\n        this.setState({\n          initialLoad: false\n        });\n        loadMoreProducts();\n      };\n\n      this.state = {\n        initialLoad: true\n      };\n      this.ready = this.ready.bind(this);\n      this.loadMoreProducts = this.loadMoreProducts.bind(this);\n    }\n\n    render() {\n      return React.createElement(Comp, (0, _extends2.default)({}, this.props, {\n        ready: this.ready,\n        loadMoreProducts: this.loadMoreProducts,\n        loadProducts: this.loadProducts\n      }));\n    }\n\n  }, _class.propTypes = {\n    canLoadMoreProducts: PropTypes.bool,\n    productsSubscription: PropTypes.object,\n    showNotFound: PropTypes.bool\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  window.prerenderReady = false;\n  let canLoadMoreProducts = false;\n  const slug = Reaction.Router.getParam(\"slug\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n  const tag = Tags.findOne({\n    slug\n  }) || Tags.findOne(slug);\n  const scrollLimit = Session.get(\"productScrollLimit\");\n  let tags = {}; // this could be shop default implementation needed\n\n  let shopIds = {};\n\n  if (tag) {\n    tags = {\n      tags: [tag._id]\n    };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = {\n      shops: [shopIdOrSlug]\n    };\n  } // if we get an invalid slug, don't return all products\n\n\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n    return;\n  }\n\n  const currentTag = ReactionProduct.getTag();\n  const sort = {\n    [`positions.${currentTag}.position`]: 1,\n    [`positions.${currentTag}.createdAt`]: 1,\n    createdAt: 1\n  };\n  const viewAsPref = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\"); // Edit mode is true by default\n\n  let editMode = true; // if we have a \"viewAs\" preference and the preference is not set to \"administrator\", then edit mode is false\n\n  if (viewAsPref && viewAsPref !== \"administrator\") {\n    editMode = false;\n  }\n\n  const queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  const productsSubscription = Meteor.subscribe(\"Products\", scrollLimit, queryParams, sort, editMode);\n\n  if (resubscribeAfterCloning.get()) {\n    resubscribeAfterCloning.set(false);\n    productsSubscription.stop();\n  }\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  const activeShopsIds = Shops.find({\n    $or: [{\n      \"workflow.status\": \"active\"\n    }, {\n      _id: Reaction.getPrimaryShopId()\n    }]\n  }).map(activeShop => activeShop._id);\n  const productCursor = Products.find({\n    ancestors: [],\n    type: {\n      $in: [\"simple\"]\n    },\n    shopId: {\n      $in: activeShopsIds\n    }\n  });\n  const productIds = [];\n  const products = productCursor.map(product => {\n    productIds.push(product._id);\n    return applyProductRevision(product);\n  });\n  const sortedProducts = ReactionProduct.sortProducts(products, currentTag);\n  Session.set(\"productGrid/products\", sortedProducts);\n  reactiveProductIds.set(productIds);\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n  const isActionViewOpen = Reaction.isActionViewOpen();\n\n  if (isActionViewOpen === false) {\n    Session.set(\"productGrid/selectedProducts\", []);\n  }\n\n  onData(null, {\n    canLoadMoreProducts,\n    products: sortedProducts,\n    productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsAdmin\", ProductsComponent, [composeWithTracker(composer), wrapComponent]);\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductsComponent));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/productsContainerAdmin.js"],"names":["_compose","module","watch","require","default","v","React","Component","PropTypes","registerComponent","composeWithTracker","Meteor","ReactiveVar","Session","Tracker","Reaction","ITEMS_INCREMENT","ReactionProduct","applyProductRevision","resubscribeAfterCloning","Products","Tags","Shops","ProductsComponent","reactiveProductIds","oldVal","newVal","JSON","stringify","sort","autorun","subscribe","get","loadMoreProducts","threshold","target","document","querySelectorAll","scrollContainer","length","window","scrollHeight","scrollTop","clientHeight","getAttribute","setAttribute","set","wrapComponent","Comp","ProductsContainer","constructor","props","ready","showNotFound","isInitialLoad","state","initialLoad","isReady","productsSubscription","canLoadMoreProducts","loadProducts","event","preventDefault","setState","bind","render","propTypes","bool","object","composer","onData","prerenderReady","slug","Router","getParam","shopIdOrSlug","tag","findOne","scrollLimit","tags","shopIds","_id","shops","currentTag","getTag","createdAt","viewAsPref","getUserPreferences","editMode","queryParams","Object","assign","current","query","stop","activeShopsIds","find","$or","getPrimaryShopId","map","activeShop","productCursor","ancestors","type","$in","shopId","productIds","products","product","push","sortedProducts","sortProducts","count","isActionViewOpen","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { compose } from \"recompose\";\nimport { registerComponent, composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactiveVar } from \"meteor/reactive-var\";\nimport { Session } from \"meteor/session\";\nimport { Tracker } from \"meteor/tracker\";\nimport { Reaction } from \"/client/api\";\nimport { ITEMS_INCREMENT } from \"/client/config/defaults\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { applyProductRevision, resubscribeAfterCloning } from \"/lib/api/products\";\nimport { Products, Tags, Shops } from \"/lib/collections\";\nimport ProductsComponent from \"../components/products\";\n\nconst reactiveProductIds = new ReactiveVar([], (oldVal, newVal) => JSON.stringify(oldVal.sort()) === JSON.stringify(newVal.sort()));\n\n// Isolated resubscribe to product grid images, only when the list of product IDs changes\nTracker.autorun(() => {\n  Meteor.subscribe(\"ProductGridMedia\", reactiveProductIds.get());\n});\n\n\n/**\n * loadMoreProducts\n * @summary whenever #productScrollLimitLoader becomes visible, retrieve more results\n * this basically runs this:\n * Session.set('productScrollLimit', Session.get('productScrollLimit') + ITEMS_INCREMENT);\n * @return {undefined}\n */\nfunction loadMoreProducts() {\n  let threshold;\n  const target = document.querySelectorAll(\"#productScrollLimitLoader\");\n  let scrollContainer = document.querySelectorAll(\"#container-main\");\n  if (scrollContainer.length === 0) {\n    scrollContainer = window;\n  }\n\n  if (target.length) {\n    threshold = scrollContainer[0].scrollHeight - scrollContainer[0].scrollTop === scrollContainer[0].clientHeight;\n\n    if (threshold) {\n      if (!target[0].getAttribute(\"visible\")) {\n        target[0].setAttribute(\"productScrollLimit\", true);\n        Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n      }\n    } else if (target[0].getAttribute(\"visible\")) {\n      target[0].setAttribute(\"visible\", false);\n    }\n  }\n}\n\nconst wrapComponent = (Comp) => (\n  class ProductsContainer extends Component {\n    static propTypes = {\n      canLoadMoreProducts: PropTypes.bool,\n      productsSubscription: PropTypes.object,\n      showNotFound: PropTypes.bool\n    };\n\n    constructor(props) {\n      super(props);\n      this.state = {\n        initialLoad: true\n      };\n\n      this.ready = this.ready.bind(this);\n      this.loadMoreProducts = this.loadMoreProducts.bind(this);\n    }\n\n    ready = () => {\n      if (this.props.showNotFound === true) {\n        return false;\n      }\n      const isInitialLoad = this.state.initialLoad === true;\n      const isReady = this.props.productsSubscription.ready();\n\n      if (isInitialLoad === false) {\n        return true;\n      }\n\n      if (isReady) {\n        return true;\n      }\n      return false;\n    }\n\n    loadMoreProducts = () => this.props.canLoadMoreProducts === true\n\n    loadProducts = (event) => {\n      event.preventDefault();\n      this.setState({\n        initialLoad: false\n      });\n      loadMoreProducts();\n    }\n\n    render() {\n      return (\n        <Comp\n          {...this.props}\n          ready={this.ready}\n          loadMoreProducts={this.loadMoreProducts}\n          loadProducts={this.loadProducts}\n        />\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  window.prerenderReady = false;\n\n  let canLoadMoreProducts = false;\n\n  const slug = Reaction.Router.getParam(\"slug\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n\n  const tag = Tags.findOne({ slug }) || Tags.findOne(slug);\n  const scrollLimit = Session.get(\"productScrollLimit\");\n  let tags = {}; // this could be shop default implementation needed\n  let shopIds = {};\n\n  if (tag) {\n    tags = { tags: [tag._id] };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = { shops: [shopIdOrSlug] };\n  }\n\n  // if we get an invalid slug, don't return all products\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n\n    return;\n  }\n\n  const currentTag = ReactionProduct.getTag();\n\n  const sort = {\n    [`positions.${currentTag}.position`]: 1,\n    [`positions.${currentTag}.createdAt`]: 1,\n    createdAt: 1\n  };\n\n  const viewAsPref = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\");\n\n  // Edit mode is true by default\n  let editMode = true;\n\n  // if we have a \"viewAs\" preference and the preference is not set to \"administrator\", then edit mode is false\n  if (viewAsPref && viewAsPref !== \"administrator\") {\n    editMode = false;\n  }\n\n  const queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  const productsSubscription = Meteor.subscribe(\"Products\", scrollLimit, queryParams, sort, editMode);\n  if (resubscribeAfterCloning.get()) {\n    resubscribeAfterCloning.set(false);\n    productsSubscription.stop();\n  }\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  const activeShopsIds = Shops.find({\n    $or: [\n      { \"workflow.status\": \"active\" },\n      { _id: Reaction.getPrimaryShopId() }\n    ]\n  }).map((activeShop) => activeShop._id);\n\n  const productCursor = Products.find({\n    ancestors: [],\n    type: { $in: [\"simple\"] },\n    shopId: { $in: activeShopsIds }\n  });\n\n  const productIds = [];\n  const products = productCursor.map((product) => {\n    productIds.push(product._id);\n\n    return applyProductRevision(product);\n  });\n\n  const sortedProducts = ReactionProduct.sortProducts(products, currentTag);\n  Session.set(\"productGrid/products\", sortedProducts);\n\n  reactiveProductIds.set(productIds);\n\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n\n  const isActionViewOpen = Reaction.isActionViewOpen();\n  if (isActionViewOpen === false) {\n    Session.set(\"productGrid/selectedProducts\", []);\n  }\n\n  onData(null, {\n    canLoadMoreProducts,\n    products: sortedProducts,\n    productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsAdmin\", ProductsComponent, [\n  composeWithTracker(composer),\n  wrapComponent\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductsComponent);\n"]},"sourceType":"script","hash":"c7fdbee4fd835a7d21b754281a3b7f2920b80ed6"}
