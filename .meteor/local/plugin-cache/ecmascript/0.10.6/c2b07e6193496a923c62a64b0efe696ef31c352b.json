{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"server/startup/index.js","filename":"server/startup/index.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"presets":[],"parserOpts":{"sourceType":"module","sourceFileName":"server/startup/index.js","plugins":["jsx","jsx","flow","flow","objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties"]},"generatorOpts":{"filename":"server/startup/index.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/startup/index.js"}},"code":"module.export({\n  default: () => startup\n});\nlet SimpleSchema;\nmodule.watch(require(\"simpl-schema\"), {\n  default(v) {\n    SimpleSchema = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet Accounts;\nmodule.watch(require(\"./accounts\"), {\n  default(v) {\n    Accounts = v;\n  }\n\n}, 2);\nmodule.watch(require(\"./browser-policy\"));\nlet CollectionSecurity;\nmodule.watch(require(\"./collection-security\"), {\n  default(v) {\n    CollectionSecurity = v;\n  }\n\n}, 3);\nlet importAllTranslations;\nmodule.watch(require(\"./i18n\"), {\n  importAllTranslations(v) {\n    importAllTranslations = v;\n  }\n\n}, 4);\nlet LoadFixtureData;\nmodule.watch(require(\"./load-data\"), {\n  default(v) {\n    LoadFixtureData = v;\n  }\n\n}, 5);\nlet Prerender;\nmodule.watch(require(\"./prerender\"), {\n  default(v) {\n    Prerender = v;\n  }\n\n}, 6);\nlet RateLimiters;\nmodule.watch(require(\"./rate-limits\"), {\n  default(v) {\n    RateLimiters = v;\n  }\n\n}, 7);\nlet RegisterCore;\nmodule.watch(require(\"./register-core\"), {\n  default(v) {\n    RegisterCore = v;\n  }\n\n}, 8);\nlet RegisterRouter;\nmodule.watch(require(\"./register-router\"), {\n  default(v) {\n    RegisterRouter = v;\n  }\n\n}, 9);\nlet initTemplates;\nmodule.watch(require(\"../api/core/templates\"), {\n  initTemplates(v) {\n    initTemplates = v;\n  }\n\n}, 10);\nlet Reaction, Logger;\nmodule.watch(require(\"../api\"), {\n  Reaction(v) {\n    Reaction = v;\n  },\n\n  Logger(v) {\n    Logger = v;\n  }\n\n}, 11);\nlet Shops;\nmodule.watch(require(\"../../lib/collections\"), {\n  Shops(v) {\n    Shops = v;\n  }\n\n}, 12);\n// This is needed so that it throws a Meteor.Error as `check()` would do\n// when we call schema.validate() in a Meteor method.\n// https://github.com/aldeed/node-simple-schema/#customize-the-error-that-is-thrown\nSimpleSchema.defineValidationErrorTransform(error => {\n  const ddpError = new Meteor.Error(error.message);\n  ddpError.error = \"validation-error\";\n  ddpError.details = error.details;\n  return ddpError;\n});\n\nfunction startup() {\n  const startTime = Date.now();\n  Accounts();\n  initTemplates();\n  RegisterCore();\n  RegisterRouter(); // initialize shop registry when a new shop is added\n\n  Shops.find().observe({\n    added(doc) {\n      Reaction.setShopName(doc);\n      Reaction.setDomain();\n    },\n\n    removed() {// TODO SHOP REMOVAL CLEANUP FOR #357\n    }\n\n  });\n  LoadFixtureData();\n  Reaction.init();\n  importAllTranslations();\n  Prerender();\n  CollectionSecurity();\n  RateLimiters();\n  const endTime = Date.now();\n  Logger.info(`Reaction initialization finished: ${endTime - startTime}ms`);\n}","map":{"version":3,"sources":["server/startup/index.js"],"names":["module","export","default","startup","SimpleSchema","watch","require","v","Meteor","Accounts","CollectionSecurity","importAllTranslations","LoadFixtureData","Prerender","RateLimiters","RegisterCore","RegisterRouter","initTemplates","Reaction","Logger","Shops","defineValidationErrorTransform","error","ddpError","Error","message","details","startTime","Date","now","find","observe","added","doc","setShopName","setDomain","removed","init","endTime","info"],"mappings":"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","sourcesContent":["import SimpleSchema from \"simpl-schema\";\nimport { Meteor } from \"meteor/meteor\";\nimport Accounts from \"./accounts\";\nimport \"./browser-policy\";\nimport CollectionSecurity from \"./collection-security\";\nimport { importAllTranslations } from \"./i18n\";\nimport LoadFixtureData from \"./load-data\";\nimport Prerender from \"./prerender\";\nimport RateLimiters from \"./rate-limits\";\nimport RegisterCore from \"./register-core\";\nimport RegisterRouter from \"./register-router\";\nimport { initTemplates } from \"/server/api/core/templates\";\nimport { Reaction, Logger } from \"/server/api\";\nimport { Shops } from \"/lib/collections\";\n\n// This is needed so that it throws a Meteor.Error as `check()` would do\n// when we call schema.validate() in a Meteor method.\n// https://github.com/aldeed/node-simple-schema/#customize-the-error-that-is-thrown\nSimpleSchema.defineValidationErrorTransform((error) => {\n  const ddpError = new Meteor.Error(error.message);\n  ddpError.error = \"validation-error\";\n  ddpError.details = error.details;\n  return ddpError;\n});\n\nexport default function startup() {\n  const startTime = Date.now();\n\n  Accounts();\n  initTemplates();\n  RegisterCore();\n  RegisterRouter();\n\n  // initialize shop registry when a new shop is added\n  Shops.find().observe({\n    added(doc) {\n      Reaction.setShopName(doc);\n      Reaction.setDomain();\n    },\n    removed() {\n      // TODO SHOP REMOVAL CLEANUP FOR #357\n    }\n  });\n\n  LoadFixtureData();\n  Reaction.init();\n\n  importAllTranslations();\n\n  Prerender();\n  CollectionSecurity();\n  RateLimiters();\n\n  const endTime = Date.now();\n  Logger.info(`Reaction initialization finished: ${endTime - startTime}ms`);\n}\n"]},"sourceType":"script","hash":"c2b07e6193496a923c62a64b0efe696ef31c352b"}
