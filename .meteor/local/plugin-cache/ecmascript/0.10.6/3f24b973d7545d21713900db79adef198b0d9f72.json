{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","filename":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  \"default\": function (v) {\n    _compose = v;\n  }\n}, 0);\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 1);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 2);\nvar registerComponent, composeWithTracker;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  registerComponent: function (v) {\n    registerComponent = v;\n  },\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 3);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 4);\nvar Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 5);\nvar Reaction;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 6);\nvar ITEMS_INCREMENT;\nmodule.watch(require(\"../../../../../client/config/defaults\"), {\n  ITEMS_INCREMENT: function (v) {\n    ITEMS_INCREMENT = v;\n  }\n}, 7);\nvar ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 8);\nvar Catalog, Tags, Shops;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Catalog: function (v) {\n    Catalog = v;\n  },\n  Tags: function (v) {\n    Tags = v;\n  },\n  Shops: function (v) {\n    Shops = v;\n  }\n}, 9);\nvar ProductGridCustomer;\nmodule.watch(require(\"../components/customer/productGrid\"), {\n  \"default\": function (v) {\n    ProductGridCustomer = v;\n  }\n}, 10);\n\nvar wrapComponent = function (Comp) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    (0, _inheritsLoose2.default)(ProductsContainer, _Component);\n\n    function ProductsContainer(props) {\n      var _this;\n\n      _this = _Component.call(this, props) || this;\n\n      _this.loadProducts = function () {\n        _this.setState({\n          initialLoad: false\n        }); // load in the next set of products\n\n\n        Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n      };\n\n      _this.state = {\n        initialLoad: true\n      };\n      return _this;\n    }\n\n    var _proto = ProductsContainer.prototype;\n\n    _proto.render = function () {\n      function render() {\n        return React.createElement(Comp, (0, _extends2.default)({}, this.props, {\n          loadProducts: this.loadProducts\n        }));\n      }\n\n      return render;\n    }();\n\n    return ProductsContainer;\n  }(Component), _class.propTypes = {\n    canLoadMoreProducts: PropTypes.bool,\n    productsSubscription: PropTypes.object,\n    showNotFound: PropTypes.bool\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  var _sort;\n\n  window.prerenderReady = false;\n  var canLoadMoreProducts = false;\n  var slug = Reaction.Router.getParam(\"slug\");\n  var shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n  var tag = Tags.findOne({\n    slug: slug\n  }) || Tags.findOne(slug);\n  var scrollLimit = Session.get(\"productScrollLimit\");\n  var tags = {}; // this could be shop default implementation needed\n\n  var shopIds = {};\n\n  if (tag) {\n    tags = {\n      tags: [tag._id]\n    };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = {\n      shops: [shopIdOrSlug]\n    };\n  } // if we get an invalid slug, don't return all products\n\n\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n    return;\n  }\n\n  var currentTag = ReactionProduct.getTag();\n  var sort = (_sort = {}, _sort[\"positions.\" + currentTag + \".position\"] = 1, _sort[\"positions.\" + currentTag + \".createdAt\"] = 1, _sort.createdAt = 1, _sort);\n  var queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  var productsSubscription = Meteor.subscribe(\"Products/grid\", scrollLimit, queryParams, sort);\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  var activeShopsIds = Shops.find({\n    $or: [{\n      \"workflow.status\": \"active\"\n    }, {\n      _id: Reaction.getPrimaryShopId()\n    }]\n  }).map(function (activeShop) {\n    return activeShop._id;\n  });\n  var productCursor = Catalog.find({\n    ancestors: [],\n    type: {\n      $in: [\"product-simple\"]\n    },\n    shopId: {\n      $in: activeShopsIds\n    }\n  }, {\n    $sort: sort\n  });\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n  var products = productCursor.fetch();\n  onData(null, {\n    canLoadMoreProducts: canLoadMoreProducts,\n    products: products,\n    productsSubscription: productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsCustomer\", ProductGridCustomer, [composeWithTracker(composer)]);\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductGridCustomer));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/productsContainerCustomer.js"],"names":["_compose","module","watch","require","v","React","Component","PropTypes","registerComponent","composeWithTracker","Meteor","Session","Reaction","ITEMS_INCREMENT","ReactionProduct","Catalog","Tags","Shops","ProductGridCustomer","wrapComponent","Comp","props","loadProducts","setState","initialLoad","set","get","state","render","propTypes","canLoadMoreProducts","bool","productsSubscription","object","showNotFound","composer","onData","window","prerenderReady","slug","Router","getParam","shopIdOrSlug","tag","findOne","scrollLimit","tags","shopIds","_id","shops","currentTag","getTag","sort","createdAt","queryParams","Object","assign","current","query","subscribe","ready","activeShopsIds","find","$or","getPrimaryShopId","map","activeShop","productCursor","ancestors","type","$in","shopId","$sort","count","products","fetch","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { compose } from \"recompose\";\nimport { registerComponent, composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { Reaction } from \"/client/api\";\nimport { ITEMS_INCREMENT } from \"/client/config/defaults\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Catalog, Tags, Shops } from \"/lib/collections\";\nimport ProductGridCustomer from \"../components/customer/productGrid\";\n\nconst wrapComponent = (Comp) => (\n  class ProductsContainer extends Component {\n    static propTypes = {\n      canLoadMoreProducts: PropTypes.bool,\n      productsSubscription: PropTypes.object,\n      showNotFound: PropTypes.bool\n    };\n\n    constructor(props) {\n      super(props);\n      this.state = {\n        initialLoad: true\n      };\n    }\n\n    loadProducts = () => {\n      this.setState({\n        initialLoad: false\n      });\n      // load in the next set of products\n      Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n    }\n\n    render() {\n      return (\n        <Comp\n          {...this.props}\n          loadProducts={this.loadProducts}\n        />\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  window.prerenderReady = false;\n\n  let canLoadMoreProducts = false;\n\n  const slug = Reaction.Router.getParam(\"slug\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n\n  const tag = Tags.findOne({ slug }) || Tags.findOne(slug);\n  const scrollLimit = Session.get(\"productScrollLimit\");\n  let tags = {}; // this could be shop default implementation needed\n  let shopIds = {};\n\n  if (tag) {\n    tags = { tags: [tag._id] };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = { shops: [shopIdOrSlug] };\n  }\n\n  // if we get an invalid slug, don't return all products\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n\n    return;\n  }\n\n  const currentTag = ReactionProduct.getTag();\n\n  const sort = {\n    [`positions.${currentTag}.position`]: 1,\n    [`positions.${currentTag}.createdAt`]: 1,\n    createdAt: 1\n  };\n\n  const queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  const productsSubscription = Meteor.subscribe(\"Products/grid\", scrollLimit, queryParams, sort);\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  const activeShopsIds = Shops.find({\n    $or: [\n      { \"workflow.status\": \"active\" },\n      { _id: Reaction.getPrimaryShopId() }\n    ]\n  }).map((activeShop) => activeShop._id);\n\n  const productCursor = Catalog.find({\n    ancestors: [],\n    type: { $in: [\"product-simple\"] },\n    shopId: { $in: activeShopsIds }\n  }, {\n    $sort: sort\n  });\n\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n\n  const products = productCursor.fetch();\n  onData(null, {\n    canLoadMoreProducts,\n    products,\n    productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsCustomer\", ProductGridCustomer, [\n  composeWithTracker(composer)\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductGridCustomer);\n"]},"sourceType":"script","hash":"3f24b973d7545d21713900db79adef198b0d9f72"}
