{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"packages/mdg:validated-method/validated-method-tests.js","filename":"packages/mdg:validated-method/validated-method-tests.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"packages/mdg:validated-method/validated-method-tests.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"packages/mdg:validated-method/validated-method-tests.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/mdg:validated-method/validated-method-tests.js"}},"code":"var plainMethod = new ValidatedMethod({\n  name: 'plainMethod',\n  validate: new SimpleSchema({}).validator(),\n  run: function () {\n    return 'result';\n  }\n});\nvar noArgsMethod = new ValidatedMethod({\n  name: 'noArgsMethod',\n  validate: null,\n  run: function () {\n    return 'result';\n  }\n});\nvar methodWithArgs = new ValidatedMethod({\n  name: 'methodWithArgs',\n  validate: new SimpleSchema({\n    \"int\": {\n      type: Number\n    },\n    string: {\n      type: String\n    }\n  }).validator(),\n  run: function () {\n    return 'result';\n  }\n});\nvar methodThrowsImmediately = new ValidatedMethod({\n  name: 'methodThrowsImmediately',\n  validate: null,\n  run: function () {\n    throw new Meteor.Error('error');\n  }\n});\nvar methodReturnsName = new ValidatedMethod({\n  name: 'methodReturnsName',\n  validate: null,\n  run: function () {\n    return this.name;\n  }\n});\nvar methodWithSchemaMixin = new ValidatedMethod({\n  name: 'methodWithSchemaMixin',\n  mixins: [schemaMixin],\n  schema: new SimpleSchema({\n    \"int\": {\n      type: Number\n    },\n    string: {\n      type: String\n    }\n  }),\n  run: function () {\n    return 'result';\n  }\n});\nvar resultReceived = false;\nvar methodWithApplyOptions = new ValidatedMethod({\n  name: 'methodWithApplyOptions',\n  validate: new SimpleSchema({}).validator(),\n  applyOptions: {\n    onResultReceived: function () {\n      resultReceived = true;\n    }\n  },\n  run: function () {\n    return 'result';\n  }\n});\n\nfunction schemaMixin(methodOptions) {\n  methodOptions.validate = methodOptions.schema.validator();\n  return methodOptions;\n}\n\ndescribe('mdg:method', function () {\n  it('defines a method that can be called', function (done) {\n    plainMethod.call({}, function (error, result) {\n      assert.equal(result, 'result');\n      Meteor.call(plainMethod.name, {}, function (error, result) {\n        assert.equal(result, 'result');\n        done();\n      });\n    });\n  });\n  it('allows methods that take no arguments', function (done) {\n    noArgsMethod.call(function (error, result) {\n      assert.equal(result, 'result');\n      Meteor.call(noArgsMethod.name, function (error, result) {\n        assert.equal(result, 'result');\n        done();\n      });\n    });\n  });\n  it('checks schema', function (done) {\n    [methodWithArgs, methodWithSchemaMixin].forEach(function (method) {\n      method.call({}, function (error, result) {\n        // 2 invalid fields\n        assert.equal(error.errors.length, 2);\n        method.call({\n          \"int\": 5,\n          string: \"what\"\n        }, function (error, result) {\n          // All good!\n          assert.equal(result, 'result');\n          done();\n        });\n      });\n    });\n  });\n  it('throws error if no callback passed', function (done) {\n    methodThrowsImmediately.call({}, function (err) {\n      // If you pass a callback, you get the error in the callback\n      assert.ok(err); // If no callback, the error is thrown\n\n      assert.throws(function () {\n        methodThrowsImmediately.call({});\n      }, /error/);\n      done();\n    });\n  });\n  it('throws error if a mixin does not return the options object', function () {\n    assert.throws(function () {\n      new ValidatedMethod({\n        name: 'methodWithFaultySchemaMixin',\n        mixins: [function () {\n          function nonReturningFunction() {}\n\n          return nonReturningFunction;\n        }()],\n        schema: null,\n        run: function () {\n          return 'result';\n        }\n      });\n    }, /Error in methodWithFaultySchemaMixin method: The function 'nonReturningFunction' didn't return the options object/);\n    assert.throws(function () {\n      new ValidatedMethod({\n        name: 'methodWithFaultySchemaMixin',\n        mixins: [function (args) {\n          return args;\n        }, function () {}],\n        schema: null,\n        run: function () {\n          return 'result';\n        }\n      });\n    }, /Error in methodWithFaultySchemaMixin method: One of the mixins didn't return the options object/);\n  });\n  it('has access to the name on this.name', function (done) {\n    var ret = methodReturnsName._execute();\n\n    assert.equal(ret, 'methodReturnsName');\n    methodReturnsName.call({}, function (err, res) {\n      // The Method knows its own name\n      assert.equal(res, 'methodReturnsName');\n      done();\n    });\n  });\n  it('can accept Meteor.apply options', function (done) {\n    if (Meteor.isServer) {\n      // the only apply option that I can think of to test is client side only\n      return done();\n    }\n\n    resultReceived = false;\n    methodWithApplyOptions.call({}, function (err, res) {\n      // The Method knows its own name\n      assert.equal(resultReceived, true);\n      done();\n    });\n  });\n});","map":{"version":3,"sources":["packages/mdg:validated-method/validated-method-tests.js"],"names":["plainMethod","ValidatedMethod","name","validate","SimpleSchema","validator","run","noArgsMethod","methodWithArgs","type","Number","string","String","methodThrowsImmediately","Meteor","Error","methodReturnsName","methodWithSchemaMixin","mixins","schemaMixin","schema","resultReceived","methodWithApplyOptions","applyOptions","onResultReceived","methodOptions","describe","it","done","call","error","result","assert","equal","forEach","method","errors","length","err","ok","throws","nonReturningFunction","args","ret","_execute","res","isServer"],"mappings":"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","sourcesContent":["const plainMethod = new ValidatedMethod({\n  name: 'plainMethod',\n  validate: new SimpleSchema({}).validator(),\n  run() {\n    return 'result';\n  }\n});\n\nconst noArgsMethod = new ValidatedMethod({\n  name: 'noArgsMethod',\n  validate: null,\n  run() {\n    return 'result';\n  }\n});\n\nconst methodWithArgs = new ValidatedMethod({\n  name: 'methodWithArgs',\n  validate: new SimpleSchema({\n    int: { type: Number },\n    string: { type: String },\n  }).validator(),\n  run() {\n    return 'result';\n  }\n});\n\nconst methodThrowsImmediately = new ValidatedMethod({\n  name: 'methodThrowsImmediately',\n  validate: null,\n  run() {\n    throw new Meteor.Error('error');\n  }\n});\n\nconst methodReturnsName = new ValidatedMethod({\n  name: 'methodReturnsName',\n  validate: null,\n  run() {\n    return this.name;\n  }\n});\n\nconst methodWithSchemaMixin = new ValidatedMethod({\n  name: 'methodWithSchemaMixin',\n  mixins: [schemaMixin],\n  schema: new SimpleSchema({\n    int: { type: Number },\n    string: { type: String },\n  }),\n  run() {\n    return 'result';\n  }\n});\n\nlet resultReceived = false;\nconst methodWithApplyOptions = new ValidatedMethod({\n  name: 'methodWithApplyOptions',\n  validate: new SimpleSchema({}).validator(),\n  applyOptions: {\n    onResultReceived: function() {\n      resultReceived = true;\n    }\n  },\n  run() {\n    return 'result';\n  }\n});\n\nfunction schemaMixin(methodOptions) {\n  methodOptions.validate = methodOptions.schema.validator();\n  return methodOptions;\n}\n\ndescribe('mdg:method', () => {\n  it('defines a method that can be called', (done) => {\n    plainMethod.call({}, (error, result) => {\n      assert.equal(result, 'result');\n\n      Meteor.call(plainMethod.name, {}, (error, result) => {\n        assert.equal(result, 'result');\n        done();\n      });\n    });\n  });\n\n  it('allows methods that take no arguments', (done) => {\n    noArgsMethod.call((error, result) => {\n      assert.equal(result, 'result');\n\n      Meteor.call(noArgsMethod.name, (error, result) => {\n        assert.equal(result, 'result');\n        done();\n      });\n    });\n  });\n\n  it('checks schema', (done) => {\n    [methodWithArgs, methodWithSchemaMixin].forEach((method) => {\n      method.call({}, (error, result) => {\n        // 2 invalid fields\n        assert.equal(error.errors.length, 2);\n\n        method.call({\n          int: 5,\n          string: \"what\",\n        }, (error, result) => {\n          // All good!\n          assert.equal(result, 'result');\n\n          done();\n        });\n      });\n    });\n  });\n\n  it('throws error if no callback passed', (done) => {\n    methodThrowsImmediately.call({}, (err) => {\n      // If you pass a callback, you get the error in the callback\n      assert.ok(err);\n\n      // If no callback, the error is thrown\n      assert.throws(() => {\n        methodThrowsImmediately.call({});\n      }, /error/);\n\n      done();\n    });\n  });\n\n  it('throws error if a mixin does not return the options object', () => {\n    assert.throws(() => {\n      new ValidatedMethod({\n        name: 'methodWithFaultySchemaMixin',\n        mixins: [function nonReturningFunction() {}],\n        schema: null,\n        run() {\n          return 'result';\n        }\n      });\n    }, /Error in methodWithFaultySchemaMixin method: The function 'nonReturningFunction' didn't return the options object/);\n\n    assert.throws(() => {\n      new ValidatedMethod({\n        name: 'methodWithFaultySchemaMixin',\n        mixins: [function (args) { return args}, function () {}],\n        schema: null,\n        run() {\n          return 'result';\n        }\n      });\n    }, /Error in methodWithFaultySchemaMixin method: One of the mixins didn't return the options object/);\n  });\n\n  it('has access to the name on this.name', (done) => {\n    const ret = methodReturnsName._execute();\n    assert.equal(ret, 'methodReturnsName');\n\n    methodReturnsName.call({}, (err, res) => {\n      // The Method knows its own name\n      assert.equal(res, 'methodReturnsName');\n\n      done();\n    });\n  });\n\n  it('can accept Meteor.apply options', (done) => {\n    if (Meteor.isServer) {\n      // the only apply option that I can think of to test is client side only\n      return done();\n    }\n\n    resultReceived = false;\n    methodWithApplyOptions.call({}, (err, res) => {\n      // The Method knows its own name\n      assert.equal(resultReceived, true);\n\n      done();\n    });\n  });\n});\n"]},"sourceType":"script","hash":"846c3628cf2baecc7f560d4f8c3249923ce4777d"}
