{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/productGridContainer.js","filename":"imports/plugins/included/product-variant/containers/productGridContainer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/productGridContainer.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/productGridContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/productGridContainer.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  \"default\": function (v) {\n    _compose = v;\n  }\n}, 0);\n\nvar _get;\n\nmodule.watch(require(\"lodash/get\"), {\n  \"default\": function (v) {\n    _get = v;\n  }\n}, 1);\n\nvar _without;\n\nmodule.watch(require(\"lodash/without\"), {\n  \"default\": function (v) {\n    _without = v;\n  }\n}, 2);\n\nvar _uniq;\n\nmodule.watch(require(\"lodash/uniq\"), {\n  \"default\": function (v) {\n    _uniq = v;\n  }\n}, 3);\n\nvar _isEmpty;\n\nmodule.watch(require(\"lodash/isEmpty\"), {\n  \"default\": function (v) {\n    _isEmpty = v;\n  }\n}, 4);\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 5);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 6);\nvar update;\nmodule.watch(require(\"immutability-helper\"), {\n  \"default\": function (v) {\n    update = v;\n  }\n}, 7);\nvar Components, composeWithTracker, registerComponent;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  Components: function (v) {\n    Components = v;\n  },\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  },\n  registerComponent: function (v) {\n    registerComponent = v;\n  }\n}, 8);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 9);\nvar Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 10);\nvar Reaction;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 11);\nvar Media;\nmodule.watch(require(\"../../../core/files/client\"), {\n  Media: function (v) {\n    Media = v;\n  }\n}, 12);\nvar Logger;\nmodule.watch(require(\"../../../../../client/modules/logger\"), {\n  \"default\": function (v) {\n    Logger = v;\n  }\n}, 13);\nvar ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 14);\nvar ProductGrid;\nmodule.watch(require(\"../components/productGrid\"), {\n  \"default\": function (v) {\n    ProductGrid = v;\n  }\n}, 15);\n\nvar wrapComponent = function (Comp) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    (0, _inheritsLoose2.default)(ProductGridContainer, _Component);\n\n    function ProductGridContainer(props) {\n      var _this;\n\n      _this = _Component.call(this, props) || this;\n\n      _this.componentWillReceiveProps = function (nextProps) {\n        _this.setState({\n          products: nextProps.products,\n          productIds: nextProps.productIds,\n          productsByKey: nextProps.productsByKey\n        });\n      };\n\n      _this.handleSelectProductItem = function (isChecked, productId) {\n        var selectedProducts = Session.get(\"productGrid/selectedProducts\");\n\n        if (isChecked) {\n          selectedProducts.push(productId);\n        } else {\n          selectedProducts = _without(selectedProducts, productId);\n        }\n\n        Reaction.setUserPreferences(\"reaction-product-variant\", \"selectedGridItems\", selectedProducts); // Save the selected items to the Session\n\n        Session.set(\"productGrid/selectedProducts\", _uniq(selectedProducts));\n\n        var _assertThisInitialize = (0, _assertThisInitialized2.default)(_this),\n            products = _assertThisInitialize.products;\n\n        if (products) {\n          var filteredProducts = products.filter(function (product) {\n            return selectedProducts.includes(product._id);\n          });\n          Reaction.showActionView({\n            label: \"Grid Settings\",\n            i18nKeyLabel: \"gridSettingsPanel.title\",\n            template: \"productSettings\",\n            type: \"product\",\n            data: {\n              products: filteredProducts\n            }\n          });\n        }\n      };\n\n      _this.handleProductDrag = function (dragIndex, hoverIndex) {\n        var _positions, _positions2, _productsByKey;\n\n        var tag = ReactionProduct.getTag();\n        var dragProductId = _this.state.productIds[dragIndex];\n        var hoverProductId = _this.state.productIds[hoverIndex];\n\n        var dragProductWeight = _get((0, _assertThisInitialized2.default)(_this), \"state.productsByKey[\" + dragProductId + \"].positions[\" + tag + \"].weight\", 0);\n\n        var dropProductWeight = _get((0, _assertThisInitialized2.default)(_this), \"state.productsByKey[\" + hoverProductId + \"].positions[\" + tag + \"].weight\", 0);\n\n        var newState = update(_this.state, {\n          productsByKey: (_productsByKey = {}, _productsByKey[dragProductId] = {\n            $merge: {\n              positions: (_positions = {}, _positions[tag] = {\n                weight: dropProductWeight\n              }, _positions)\n            }\n          }, _productsByKey[hoverProductId] = {\n            $merge: {\n              positions: (_positions2 = {}, _positions2[tag] = {\n                weight: dragProductWeight\n              }, _positions2)\n            }\n          }, _productsByKey),\n          productIds: {\n            $splice: [[dragIndex, 1], [hoverIndex, 0, dragProductId]]\n          }\n        });\n\n        _this.setState(newState);\n      };\n\n      _this.handleProductDrop = function () {\n        var tag = ReactionProduct.getTag();\n\n        _this.state.productIds.map(function (productId, index) {\n          var position = {\n            position: index,\n            updatedAt: new Date()\n          };\n          return Meteor.call(\"products/updateProductPosition\", productId, position, tag, function (error) {\n            if (error) {\n              Logger.error(error);\n              throw new Meteor.Error(\"error-occurred\", error);\n            }\n          });\n        });\n      };\n\n      _this.state = {\n        products: props.products,\n        productsByKey: props.productsByKey,\n        productIds: props.productIds,\n        initialLoad: true,\n        slug: \"\",\n        canLoadMoreProducts: false\n      };\n      return _this;\n    }\n\n    var _proto = ProductGridContainer.prototype;\n\n    _proto.componentWillMount = function () {\n      function componentWillMount() {\n        var selectedProducts = Reaction.getUserPreferences(\"reaction-product-variant\", \"selectedGridItems\");\n        var products = this.products;\n\n        if (_isEmpty(selectedProducts)) {\n          return Reaction.hideActionView();\n        } // Save the selected items to the Session\n\n\n        Session.set(\"productGrid/selectedProducts\", _uniq(selectedProducts));\n\n        if (products) {\n          var filteredProducts = products.filter(function (product) {\n            return selectedProducts.includes(product._id);\n          });\n\n          if (Reaction.isPreview() === false) {\n            Reaction.showActionView({\n              label: \"Grid Settings\",\n              i18nKeyLabel: \"gridSettingsPanel.title\",\n              template: \"productSettings\",\n              type: \"product\",\n              data: {\n                products: filteredProducts\n              }\n            });\n          }\n        }\n      }\n\n      return componentWillMount;\n    }();\n\n    _proto.render = function () {\n      function render() {\n        return React.createElement(Components.DragDropProvider, null, React.createElement(Comp, (0, _extends2.default)({}, this.props, {\n          products: this.products,\n          onMove: this.handleProductDrag,\n          onDrop: this.handleProductDrop,\n          itemSelectHandler: this.handleSelectProductItem\n        })));\n      }\n\n      return render;\n    }();\n\n    (0, _createClass2.default)(ProductGridContainer, [{\n      key: \"products\",\n      get: function () {\n        var _this2 = this;\n\n        if (this.props.isSearch) {\n          return this.state.products;\n        }\n\n        return this.state.productIds.map(function (id) {\n          return _this2.state.productsByKey[id];\n        });\n      }\n    }]);\n    return ProductGridContainer;\n  }(Component), _class.propTypes = {\n    isSearch: PropTypes.bool,\n    productIds: PropTypes.array,\n    products: PropTypes.array,\n    productsByKey: PropTypes.object\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  // Instantiate an object for use as a map. This object does not inherit prototype or methods from `Object`\n  var productMediaById = Object.create(null);\n  (props.products || []).forEach(function (product) {\n    var primaryMedia = Media.findOneLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.toGrid\": 1,\n      \"metadata.workflow\": {\n        $nin: [\"archived\", \"unpublished\"]\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1,\n        \"uploadedAt\": 1\n      }\n    });\n    var variantIds = ReactionProduct.getVariants(product._id).map(function (variant) {\n      return variant._id;\n    });\n    var additionalMedia = Media.findLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.variantId\": {\n        $in: variantIds\n      },\n      \"metadata.workflow\": {\n        $nin: [\"archived\", \"unpublished\"]\n      }\n    }, {\n      limit: 3,\n      sort: {\n        \"metadata.priority\": 1,\n        \"uploadedAt\": 1\n      }\n    });\n    if (additionalMedia.length < 2) additionalMedia = null;\n    productMediaById[product._id] = {\n      additionalMedia: additionalMedia,\n      primaryMedia: primaryMedia\n    };\n  });\n  onData(null, {\n    productMediaById: productMediaById\n  });\n}\n\nregisterComponent(\"ProductGrid\", ProductGrid, [composeWithTracker(composer), wrapComponent]);\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductGrid));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/productGridContainer.js"],"names":["_compose","module","watch","require","v","_get","_without","_uniq","_isEmpty","React","Component","PropTypes","update","Components","composeWithTracker","registerComponent","Meteor","Session","Reaction","Media","Logger","ReactionProduct","ProductGrid","wrapComponent","Comp","props","componentWillReceiveProps","nextProps","setState","products","productIds","productsByKey","handleSelectProductItem","isChecked","productId","selectedProducts","get","push","setUserPreferences","set","filteredProducts","filter","product","includes","_id","showActionView","label","i18nKeyLabel","template","type","data","handleProductDrag","dragIndex","hoverIndex","tag","getTag","dragProductId","state","hoverProductId","dragProductWeight","dropProductWeight","newState","$merge","positions","weight","$splice","handleProductDrop","map","index","position","updatedAt","Date","call","error","Error","initialLoad","slug","canLoadMoreProducts","componentWillMount","getUserPreferences","hideActionView","isPreview","render","isSearch","id","propTypes","bool","array","object","composer","onData","productMediaById","Object","create","forEach","primaryMedia","findOneLocal","$nin","sort","variantIds","getVariants","variant","additionalMedia","findLocal","$in","limit","length","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport update from \"immutability-helper\";\nimport _ from \"lodash\";\nimport { compose } from \"recompose\";\nimport { Components, composeWithTracker, registerComponent } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { Reaction } from \"/client/api\";\nimport { Media } from \"/imports/plugins/core/files/client\";\nimport Logger from \"/client/modules/logger\";\nimport { ReactionProduct } from \"/lib/api\";\nimport ProductGrid from \"../components/productGrid\";\n\nconst wrapComponent = (Comp) => (\n  class ProductGridContainer extends Component {\n    static propTypes = {\n      isSearch: PropTypes.bool,\n      productIds: PropTypes.array,\n      products: PropTypes.array,\n      productsByKey: PropTypes.object\n    }\n\n    constructor(props) {\n      super(props);\n\n      this.state = {\n        products: props.products,\n        productsByKey: props.productsByKey,\n        productIds: props.productIds,\n        initialLoad: true,\n        slug: \"\",\n        canLoadMoreProducts: false\n      };\n    }\n\n    componentWillMount() {\n      const selectedProducts = Reaction.getUserPreferences(\"reaction-product-variant\", \"selectedGridItems\");\n      const { products } = this;\n\n      if (_.isEmpty(selectedProducts)) {\n        return Reaction.hideActionView();\n      }\n\n      // Save the selected items to the Session\n      Session.set(\"productGrid/selectedProducts\", _.uniq(selectedProducts));\n\n      if (products) {\n        const filteredProducts = products.filter((product) => selectedProducts.includes(product._id));\n\n        if (Reaction.isPreview() === false) {\n          Reaction.showActionView({\n            label: \"Grid Settings\",\n            i18nKeyLabel: \"gridSettingsPanel.title\",\n            template: \"productSettings\",\n            type: \"product\",\n            data: { products: filteredProducts }\n          });\n        }\n      }\n    }\n\n    componentWillReceiveProps = (nextProps) => {\n      this.setState({\n        products: nextProps.products,\n        productIds: nextProps.productIds,\n        productsByKey: nextProps.productsByKey\n      });\n    }\n\n    handleSelectProductItem = (isChecked, productId) => {\n      let selectedProducts = Session.get(\"productGrid/selectedProducts\");\n\n      if (isChecked) {\n        selectedProducts.push(productId);\n      } else {\n        selectedProducts = _.without(selectedProducts, productId);\n      }\n\n      Reaction.setUserPreferences(\"reaction-product-variant\", \"selectedGridItems\", selectedProducts);\n\n      // Save the selected items to the Session\n      Session.set(\"productGrid/selectedProducts\", _.uniq(selectedProducts));\n\n      const { products } = this;\n\n      if (products) {\n        const filteredProducts = products.filter((product) => selectedProducts.includes(product._id));\n\n        Reaction.showActionView({\n          label: \"Grid Settings\",\n          i18nKeyLabel: \"gridSettingsPanel.title\",\n          template: \"productSettings\",\n          type: \"product\",\n          data: { products: filteredProducts }\n        });\n      }\n    }\n\n    handleProductDrag = (dragIndex, hoverIndex) => {\n      const tag = ReactionProduct.getTag();\n      const dragProductId = this.state.productIds[dragIndex];\n      const hoverProductId = this.state.productIds[hoverIndex];\n      const dragProductWeight = _.get(this, `state.productsByKey[${dragProductId}].positions[${tag}].weight`, 0);\n      const dropProductWeight = _.get(this, `state.productsByKey[${hoverProductId}].positions[${tag}].weight`, 0);\n\n      const newState = update(this.state, {\n        productsByKey: {\n          [dragProductId]: {\n            $merge: {\n              positions: {\n                [tag]: {\n                  weight: dropProductWeight\n                }\n              }\n            }\n          },\n          [hoverProductId]: {\n            $merge: {\n              positions: {\n                [tag]: {\n                  weight: dragProductWeight\n                }\n              }\n            }\n          }\n        },\n        productIds: {\n          $splice: [\n            [dragIndex, 1],\n            [hoverIndex, 0, dragProductId]\n          ]\n        }\n      });\n\n      this.setState(newState);\n    }\n\n    handleProductDrop = () => {\n      const tag = ReactionProduct.getTag();\n      this.state.productIds.map((productId, index) => {\n        const position = { position: index, updatedAt: new Date() };\n\n        return Meteor.call(\"products/updateProductPosition\", productId, position, tag, (error) => {\n          if (error) {\n            Logger.error(error);\n            throw new Meteor.Error(\"error-occurred\", error);\n          }\n        });\n      });\n    }\n\n    get products() {\n      if (this.props.isSearch) {\n        return this.state.products;\n      }\n      return this.state.productIds.map((id) => this.state.productsByKey[id]);\n    }\n\n    render() {\n      return (\n        <Components.DragDropProvider>\n          <Comp\n            {...this.props}\n            products={this.products}\n            onMove={this.handleProductDrag}\n            onDrop={this.handleProductDrop}\n            itemSelectHandler={this.handleSelectProductItem}\n          />\n        </Components.DragDropProvider>\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  // Instantiate an object for use as a map. This object does not inherit prototype or methods from `Object`\n  const productMediaById = Object.create(null);\n  (props.products || []).forEach((product) => {\n    const primaryMedia = Media.findOneLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.toGrid\": 1,\n      \"metadata.workflow\": { $nin: [\"archived\", \"unpublished\"] }\n    }, {\n      sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 }\n    });\n\n    const variantIds = ReactionProduct.getVariants(product._id).map((variant) => variant._id);\n    let additionalMedia = Media.findLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.variantId\": { $in: variantIds },\n      \"metadata.workflow\": { $nin: [\"archived\", \"unpublished\"] }\n    }, {\n      limit: 3,\n      sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 }\n    });\n\n    if (additionalMedia.length < 2) additionalMedia = null;\n\n    productMediaById[product._id] = {\n      additionalMedia,\n      primaryMedia\n    };\n  });\n\n  onData(null, {\n    productMediaById\n  });\n}\n\nregisterComponent(\"ProductGrid\", ProductGrid, [\n  composeWithTracker(composer),\n  wrapComponent\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductGrid);\n"]},"sourceType":"script","hash":"a9c4b71bc2639b3405c06a515566da0b9a5a2abb"}
