{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"client/modules/i18n/main.js","filename":"client/modules/i18n/main.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"client/modules/i18n/main.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"client/modules/i18n/main.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/modules/i18n/main.js"}},"code":"module.export({\n  getBrowserLanguage: function () {\n    return getBrowserLanguage;\n  },\n  getLabelsFor: function () {\n    return getLabelsFor;\n  },\n  getValidationErrorMessages: function () {\n    return getValidationErrorMessages;\n  },\n  i18nextDep: function () {\n    return i18nextDep;\n  },\n  localeDep: function () {\n    return localeDep;\n  },\n  currencyDep: function () {\n    return currencyDep;\n  }\n});\n\nvar _values;\n\nmodule.watch(require(\"lodash/values\"), {\n  \"default\": function (v) {\n    _values = v;\n  }\n}, 0);\nvar i18next;\nmodule.watch(require(\"i18next\"), {\n  \"default\": function (v) {\n    i18next = v;\n  }\n}, 1);\nvar SimpleSchema;\nmodule.watch(require(\"simpl-schema\"), {\n  \"default\": function (v) {\n    SimpleSchema = v;\n  }\n}, 2);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 3);\nvar Tracker;\nmodule.watch(require(\"meteor/tracker\"), {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 4);\nvar Logger, Reaction;\nmodule.watch(require(\"../../api\"), {\n  Logger: function (v) {\n    Logger = v;\n  },\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 5);\n\nfunction getBrowserLanguage() {\n  if (typeof navigator.languages !== \"undefined\") {\n    if (navigator.languages[0].indexOf(\"-\") >= 0) {\n      return navigator.languages[0].split(\"-\")[0];\n    } else if (navigator.languages[0].indexOf(\"_\") >= 0) {\n      return navigator.languages[0].split(\"_\")[0];\n    }\n\n    return navigator.languages[0];\n  }\n\n  return navigator.language || navigator.browserLanguage;\n}\n\nfunction getLabelsFor(schema, name) {\n  var titleCaseName = name.charAt(0).toLowerCase() + name.slice(1);\n  var labels = {}; // loop through all the rendered form fields and generate i18n keys\n\n  Object.keys(schema.mergedSchema()).forEach(function (fieldName) {\n    var i18nKey = titleCaseName + \".\" + fieldName.split(\".$\").join(\"\"); // translate autoform label\n\n    var t = i18next.t(i18nKey);\n\n    if (t && new RegExp(\"string\").test(t) !== true && t !== i18nKey) {\n      labels[fieldName] = t;\n    }\n  });\n  return labels;\n}\n\nfunction getValidationErrorMessages() {\n  var messages = {};\n\n  _values(SimpleSchema.ErrorTypes).forEach(function (errorType) {\n    var i18nKey = \"globalMessages.\" + errorType;\n    var message = i18next.t(i18nKey);\n\n    if (new RegExp(\"string\").test(message) !== true && message !== i18nKey) {\n      messages[errorType] = message;\n    }\n  });\n\n  return messages;\n}\n\nvar i18nextDep = new Tracker.Dependency();\nvar localeDep = new Tracker.Dependency();\nvar currencyDep = new Tracker.Dependency();\nMeteor.startup(function () {\n  Tracker.autorun(function (c) {\n    var merchantShopsReadyOrSkipped = false; // Choose shopSubscription based on marketplace settings\n\n    if (Reaction.marketplaceEnabled && Reaction.merchantLanguage) {\n      merchantShopsReadyOrSkipped = Reaction.Subscriptions.MerchantShops.ready();\n    } else {\n      merchantShopsReadyOrSkipped = true;\n    } // setting local and active packageNamespaces\n    // packageNamespaces are used to determine i18n namespace\n\n\n    if (Reaction.Subscriptions.PrimaryShop.ready() && merchantShopsReadyOrSkipped) {\n      // use i18n detected language to getLocale info and set it client side\n      Meteor.call(\"shop/getLocale\", function (error, result) {\n        if (error || !result) {\n          Logger.error(error, \"Unable to get shop locale\");\n          return;\n        }\n\n        var locale = result;\n        locale.language = getBrowserLanguage();\n        Reaction.Locale.set(locale);\n        localeDep.changed(); // Stop the tracker\n\n        c.stop();\n      });\n    }\n  });\n});\nmodule.exportDefault(i18next);","map":{"version":3,"sources":["client/modules/i18n/main.js"],"names":["module","export","getBrowserLanguage","getLabelsFor","getValidationErrorMessages","i18nextDep","localeDep","currencyDep","_values","watch","require","v","i18next","SimpleSchema","Meteor","Tracker","Logger","Reaction","navigator","languages","indexOf","split","language","browserLanguage","schema","name","titleCaseName","charAt","toLowerCase","slice","labels","Object","keys","mergedSchema","forEach","fieldName","i18nKey","join","t","RegExp","test","messages","ErrorTypes","errorType","message","Dependency","startup","autorun","c","merchantShopsReadyOrSkipped","marketplaceEnabled","merchantLanguage","Subscriptions","MerchantShops","ready","PrimaryShop","call","error","result","locale","Locale","set","changed","stop","exportDefault"],"mappings":"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","sourcesContent":["import i18next from \"i18next\";\nimport { values } from \"lodash\";\nimport SimpleSchema from \"simpl-schema\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Tracker } from \"meteor/tracker\";\nimport { Logger, Reaction } from \"/client/api\";\n\n/**\n * @file **Internationalization**\n * Methods and template helpers for i18n, translations, right-to-left (RTL) and currency exchange support\n * @namespace i18n\n */\n\n/**\n * @name getBrowserLanguage\n * @method\n * @memberof i18n\n * @summary Detects device default language\n * @return {String} language code\n */\nexport function getBrowserLanguage() {\n  if (typeof navigator.languages !== \"undefined\") {\n    if (navigator.languages[0].indexOf(\"-\") >= 0) {\n      return navigator.languages[0].split(\"-\")[0];\n    } else if (navigator.languages[0].indexOf(\"_\") >= 0) {\n      return navigator.languages[0].split(\"_\")[0];\n    }\n    return navigator.languages[0];\n  }\n  return navigator.language || navigator.browserLanguage;\n}\n\n/**\n * @name getLabelsFor\n * @method\n * @memberof i18n\n * @summary Get Labels for simple.schema keys\n * @param  {Object} schema - schema\n * @param  {String} name - name\n * @return {Object} return schema label object\n */\nexport function getLabelsFor(schema, name) {\n  const titleCaseName = name.charAt(0).toLowerCase() + name.slice(1);\n  const labels = {};\n  // loop through all the rendered form fields and generate i18n keys\n  Object.keys(schema.mergedSchema()).forEach((fieldName) => {\n    const i18nKey = `${titleCaseName}.${fieldName.split(\".$\").join(\"\")}`;\n    // translate autoform label\n    const t = i18next.t(i18nKey);\n    if (t && new RegExp(\"string\").test(t) !== true && t !== i18nKey) {\n      labels[fieldName] = t;\n    }\n  });\n  return labels;\n}\n\n/**\n * @name getValidationErrorMessages\n * @method\n * @memberof i18n\n * @summary Get i18n messages for autoform messages. Currently using a globalMessage namespace only.\n * 1. Use schema-specific message for specific key\n * 2. Use schema-specific message for generic key\n * 3. Use schema-specific message for type\n * @todo Implement messaging hierarchy from simple-schema\n * @return {Object} returns i18n translated message for schema labels\n */\nexport function getValidationErrorMessages() {\n  const messages = {};\n  values(SimpleSchema.ErrorTypes).forEach((errorType) => {\n    const i18nKey = `globalMessages.${errorType}`;\n    const message = i18next.t(i18nKey);\n    if (new RegExp(\"string\").test(message) !== true && message !== i18nKey) {\n      messages[errorType] = message;\n    }\n  });\n  return messages;\n}\n\n// set language and autorun on change of language\n// initialize i18n and load data resources for the current language and fallback \"EN\"\nexport const i18nextDep = new Tracker.Dependency();\nexport const localeDep = new Tracker.Dependency();\nexport const currencyDep = new Tracker.Dependency();\n\nMeteor.startup(() => {\n  Tracker.autorun((c) => {\n    let merchantShopsReadyOrSkipped = false;\n\n    // Choose shopSubscription based on marketplace settings\n    if (Reaction.marketplaceEnabled && Reaction.merchantLanguage) {\n      merchantShopsReadyOrSkipped = Reaction.Subscriptions.MerchantShops.ready();\n    } else {\n      merchantShopsReadyOrSkipped = true;\n    }\n\n    // setting local and active packageNamespaces\n    // packageNamespaces are used to determine i18n namespace\n    if (Reaction.Subscriptions.PrimaryShop.ready() && merchantShopsReadyOrSkipped) {\n      // use i18n detected language to getLocale info and set it client side\n      Meteor.call(\"shop/getLocale\", (error, result) => {\n        if (error || !result) {\n          Logger.error(error, \"Unable to get shop locale\");\n          return;\n        }\n\n        const locale = result;\n        locale.language = getBrowserLanguage();\n\n        Reaction.Locale.set(locale);\n        localeDep.changed();\n\n        // Stop the tracker\n        c.stop();\n      });\n    }\n  });\n});\n\nexport default i18next;\n"]},"sourceType":"script","hash":"31f18369d4046d8043cd4cf8eac001c5688b2378"}
