{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","filename":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"presets":[],"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","plugins":["jsx","jsx","flow","flow","objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerCustomer.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/builtin/extends\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nlet _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  default(v) {\n    _compose = v;\n  }\n\n}, 0);\nlet React, Component;\nmodule.watch(require(\"react\"), {\n  default(v) {\n    React = v;\n  },\n\n  Component(v) {\n    Component = v;\n  }\n\n}, 1);\nlet PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  default(v) {\n    PropTypes = v;\n  }\n\n}, 2);\nlet registerComponent, composeWithTracker;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  registerComponent(v) {\n    registerComponent = v;\n  },\n\n  composeWithTracker(v) {\n    composeWithTracker = v;\n  }\n\n}, 3);\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 4);\nlet Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session(v) {\n    Session = v;\n  }\n\n}, 5);\nlet Reaction;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction(v) {\n    Reaction = v;\n  }\n\n}, 6);\nlet ITEMS_INCREMENT;\nmodule.watch(require(\"../../../../../client/config/defaults\"), {\n  ITEMS_INCREMENT(v) {\n    ITEMS_INCREMENT = v;\n  }\n\n}, 7);\nlet ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct(v) {\n    ReactionProduct = v;\n  }\n\n}, 8);\nlet Catalog, Tags, Shops;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Catalog(v) {\n    Catalog = v;\n  },\n\n  Tags(v) {\n    Tags = v;\n  },\n\n  Shops(v) {\n    Shops = v;\n  }\n\n}, 9);\nlet ProductGridCustomer;\nmodule.watch(require(\"../components/customer/productGrid\"), {\n  default(v) {\n    ProductGridCustomer = v;\n  }\n\n}, 10);\n\nconst wrapComponent = Comp => {\n  var _class, _temp;\n\n  return _temp = _class = class ProductsContainer extends Component {\n    constructor(props) {\n      super(props);\n\n      this.loadProducts = () => {\n        this.setState({\n          initialLoad: false\n        }); // load in the next set of products\n\n        Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n      };\n\n      this.state = {\n        initialLoad: true\n      };\n    }\n\n    render() {\n      return React.createElement(Comp, (0, _extends2.default)({}, this.props, {\n        loadProducts: this.loadProducts\n      }));\n    }\n\n  }, _class.propTypes = {\n    canLoadMoreProducts: PropTypes.bool,\n    productsSubscription: PropTypes.object,\n    showNotFound: PropTypes.bool\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  window.prerenderReady = false;\n  let canLoadMoreProducts = false;\n  const slug = Reaction.Router.getParam(\"slug\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n  const tag = Tags.findOne({\n    slug\n  }) || Tags.findOne(slug);\n  const scrollLimit = Session.get(\"productScrollLimit\");\n  let tags = {}; // this could be shop default implementation needed\n\n  let shopIds = {};\n\n  if (tag) {\n    tags = {\n      tags: [tag._id]\n    };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = {\n      shops: [shopIdOrSlug]\n    };\n  } // if we get an invalid slug, don't return all products\n\n\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n    return;\n  }\n\n  const currentTag = ReactionProduct.getTag();\n  const sort = {\n    [`positions.${currentTag}.position`]: 1,\n    [`positions.${currentTag}.createdAt`]: 1,\n    createdAt: 1\n  };\n  const queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  const productsSubscription = Meteor.subscribe(\"Products/grid\", scrollLimit, queryParams, sort);\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  const activeShopsIds = Shops.find({\n    $or: [{\n      \"workflow.status\": \"active\"\n    }, {\n      _id: Reaction.getPrimaryShopId()\n    }]\n  }).map(activeShop => activeShop._id);\n  const productCursor = Catalog.find({\n    ancestors: [],\n    type: {\n      $in: [\"product-simple\"]\n    },\n    shopId: {\n      $in: activeShopsIds\n    }\n  }, {\n    $sort: sort\n  });\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n  const products = productCursor.fetch();\n  onData(null, {\n    canLoadMoreProducts,\n    products,\n    productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsCustomer\", ProductGridCustomer, [composeWithTracker(composer)]);\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductGridCustomer));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/productsContainerCustomer.js"],"names":["_compose","module","watch","require","default","v","React","Component","PropTypes","registerComponent","composeWithTracker","Meteor","Session","Reaction","ITEMS_INCREMENT","ReactionProduct","Catalog","Tags","Shops","ProductGridCustomer","wrapComponent","Comp","ProductsContainer","constructor","props","loadProducts","setState","initialLoad","set","get","state","render","propTypes","canLoadMoreProducts","bool","productsSubscription","object","showNotFound","composer","onData","window","prerenderReady","slug","Router","getParam","shopIdOrSlug","tag","findOne","scrollLimit","tags","shopIds","_id","shops","currentTag","getTag","sort","createdAt","queryParams","Object","assign","current","query","subscribe","ready","activeShopsIds","find","$or","getPrimaryShopId","map","activeShop","productCursor","ancestors","type","$in","shopId","$sort","count","products","fetch","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { compose } from \"recompose\";\nimport { registerComponent, composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { Reaction } from \"/client/api\";\nimport { ITEMS_INCREMENT } from \"/client/config/defaults\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Catalog, Tags, Shops } from \"/lib/collections\";\nimport ProductGridCustomer from \"../components/customer/productGrid\";\n\nconst wrapComponent = (Comp) => (\n  class ProductsContainer extends Component {\n    static propTypes = {\n      canLoadMoreProducts: PropTypes.bool,\n      productsSubscription: PropTypes.object,\n      showNotFound: PropTypes.bool\n    };\n\n    constructor(props) {\n      super(props);\n      this.state = {\n        initialLoad: true\n      };\n    }\n\n    loadProducts = () => {\n      this.setState({\n        initialLoad: false\n      });\n      // load in the next set of products\n      Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n    }\n\n    render() {\n      return (\n        <Comp\n          {...this.props}\n          loadProducts={this.loadProducts}\n        />\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  window.prerenderReady = false;\n\n  let canLoadMoreProducts = false;\n\n  const slug = Reaction.Router.getParam(\"slug\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n\n  const tag = Tags.findOne({ slug }) || Tags.findOne(slug);\n  const scrollLimit = Session.get(\"productScrollLimit\");\n  let tags = {}; // this could be shop default implementation needed\n  let shopIds = {};\n\n  if (tag) {\n    tags = { tags: [tag._id] };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = { shops: [shopIdOrSlug] };\n  }\n\n  // if we get an invalid slug, don't return all products\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n\n    return;\n  }\n\n  const currentTag = ReactionProduct.getTag();\n\n  const sort = {\n    [`positions.${currentTag}.position`]: 1,\n    [`positions.${currentTag}.createdAt`]: 1,\n    createdAt: 1\n  };\n\n  const queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  const productsSubscription = Meteor.subscribe(\"Products/grid\", scrollLimit, queryParams, sort);\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  const activeShopsIds = Shops.find({\n    $or: [\n      { \"workflow.status\": \"active\" },\n      { _id: Reaction.getPrimaryShopId() }\n    ]\n  }).map((activeShop) => activeShop._id);\n\n  const productCursor = Catalog.find({\n    ancestors: [],\n    type: { $in: [\"product-simple\"] },\n    shopId: { $in: activeShopsIds }\n  }, {\n    $sort: sort\n  });\n\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n\n  const products = productCursor.fetch();\n  onData(null, {\n    canLoadMoreProducts,\n    products,\n    productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsCustomer\", ProductGridCustomer, [\n  composeWithTracker(composer)\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductGridCustomer);\n"]},"sourceType":"script","hash":"61a8fc03009ea64b54a2eb90529271524c917958"}
