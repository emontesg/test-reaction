{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/variantFormContainer.js","filename":"imports/plugins/included/product-variant/containers/variantFormContainer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/variantFormContainer.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/variantFormContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/variantFormContainer.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  \"default\": function (v) {\n    _compose = v;\n  }\n}, 0);\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 1);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 2);\nvar registerComponent;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  registerComponent: function (v) {\n    registerComponent = v;\n  }\n}, 3);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 4);\nvar Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 5);\nvar Validation;\nmodule.watch(require(\"@reactioncommerce/schemas\"), {\n  Validation: function (v) {\n    Validation = v;\n  }\n}, 6);\nvar ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 7);\nvar Packages;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Packages: function (v) {\n    Packages = v;\n  }\n}, 8);\nvar Reaction, i18next;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 9);\nvar TaxCodes;\nmodule.watch(require(\"../../../core/taxes/lib/collections\"), {\n  TaxCodes: function (v) {\n    TaxCodes = v;\n  }\n}, 10);\nvar ProductVariant;\nmodule.watch(require(\"../../../../../lib/collections/schemas/products\"), {\n  ProductVariant: function (v) {\n    ProductVariant = v;\n  }\n}, 11);\nvar VariantForm;\nmodule.watch(require(\"../components/variantForm\"), {\n  \"default\": function (v) {\n    VariantForm = v;\n  }\n}, 12);\n\nvar wrapComponent = function (Comp) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    (0, _inheritsLoose2.default)(VariantFormContainer, _Component);\n\n    function VariantFormContainer(props) {\n      var _this;\n\n      _this = _Component.call(this, props) || this;\n\n      _this.isProviderEnabled = function () {\n        var shopId = Reaction.getShopId();\n        var provider = Packages.findOne({\n          shopId: shopId,\n          \"registry.provides\": \"taxCodes\",\n          \"$where\": function () {\n            var providerName = this.name.split(\"-\")[1];\n            return this.settings[providerName].enabled;\n          }\n        });\n\n        if (provider) {\n          return true;\n        }\n\n        return false;\n      };\n\n      _this.fetchTaxCodes = function () {\n        var shopId = Reaction.getShopId();\n        var provider = Packages.findOne({\n          shopId: shopId,\n          \"registry.provides\": \"taxCodes\",\n          \"$where\": function () {\n            var providers = this.registry.filter(function (o) {\n              return o.provides && o.provides.includes(\"taxCodes\");\n            });\n            var providerName = providers[0].name.split(\"/\")[2];\n            return this.settings[providerName].enabled;\n          }\n        });\n        var taxCodesArray = [];\n        var codes = TaxCodes.find({\n          shopId: shopId,\n          taxCodeProvider: provider.name\n        });\n        codes.forEach(function (code) {\n          taxCodesArray.push({\n            value: code.taxCode,\n            label: code.taxCode + \" | \" + code.label\n          });\n        });\n        return taxCodesArray;\n      };\n\n      _this.hasChildVariants = function (variant) {\n        if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n          return true;\n        }\n\n        return false;\n      };\n\n      _this.greyDisabledFields = function (variant) {\n        if (_this.hasChildVariants(variant)) {\n          return {\n            backgroundColor: \"lightgrey\",\n            cursor: \"not-allowed\"\n          };\n        }\n      };\n\n      _this.restoreVariant = function (variant) {\n        var title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n        Alerts.alert({\n          title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", {\n            title: title\n          }),\n          showCancelButton: true,\n          confirmButtonText: \"Restore\"\n        }, function (isConfirm) {\n          if (isConfirm) {\n            var id = variant._id;\n            Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, function (error) {\n              if (error) {\n                Alerts.alert({\n                  text: i18next.t(\"productDetailEdit.restoreVariantFail\", {\n                    title: title\n                  }),\n                  confirmButtonText: i18next.t(\"app.close\", {\n                    defaultValue: \"Close\"\n                  })\n                });\n              }\n\n              _this.setState({\n                isDeleted: !_this.state.isDeleted\n              });\n            });\n          }\n        });\n      };\n\n      _this.removeVariant = function (variant) {\n        var title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n        Alerts.alert({\n          title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", {\n            title: title\n          }),\n          showCancelButton: true,\n          confirmButtonText: \"Archive\"\n        }, function (isConfirm) {\n          if (isConfirm) {\n            _this.setState({\n              isDeleted: !_this.state.isDeleted\n            });\n\n            var id = variant._id;\n            Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n              if (result && ReactionProduct.selectedVariantId() === id) {\n                return ReactionProduct.setCurrentVariant(null);\n              }\n            });\n          }\n        });\n      };\n\n      _this.cloneVariant = function (variant) {\n        var title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n        var productId = ReactionProduct.selectedProductId();\n\n        if (!productId) {\n          return;\n        }\n\n        Meteor.call(\"products/cloneVariant\", productId, variant._id, function (error, result) {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.cloneVariantFail\", {\n                title: title\n              }),\n              confirmButtonText: i18next.t(\"app.close\", {\n                defaultValue: \"Close\"\n              })\n            });\n          } else if (result) {\n            var variantId = result[0];\n            ReactionProduct.setCurrentVariant(variantId);\n            Session.set(\"variant-form-\" + variantId, true);\n          }\n        });\n      };\n\n      _this.handleVariantFieldSave = function (variantId, fieldName, value, variant) {\n        var validationStatus = _this.runVariantValidation(variant);\n\n        if (validationStatus.isFieldValid(fieldName)) {\n          Meteor.call(\"products/updateProductField\", variantId, fieldName, value, function (error) {\n            if (error) {\n              Alerts.toast(error.message, \"error\");\n            }\n\n            if (fieldName === \"inventoryPolicy\") {\n              _this.updateInventoryPolicyIfChildVariants(variant);\n            }\n          });\n        }\n      };\n\n      _this.handleCardExpand = function (cardName) {\n        Reaction.state.set(\"edit/focus\", cardName);\n      };\n\n      _this.handleVariantVisibilityToggle = function (variant) {\n        Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", !variant.isVisible);\n      };\n\n      _this.updateInventoryPolicyIfChildVariants = function (variant) {\n        // Get all siblings, including current variant\n        var options = ReactionProduct.getSiblings(variant); // Get parent\n\n        var parent = ReactionProduct.getVariantParent(variant); // If this is not a top-level variant, update top-level inventory policy as well\n\n        if (parent && options && options.length) {\n          // Check to see if every variant option inventory policy is true\n          var inventoryPolicy = options.every(function (option) {\n            return option.inventoryPolicy === true;\n          }); // If all inventory policies on children are true, update parent to be true\n\n          if (inventoryPolicy === true) {\n            return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", true, function (error) {\n              if (error) {\n                Alerts.toast(error.message, \"error\");\n              }\n            });\n          } // If any child has a false inventoryPolicy, update parent to be false\n\n\n          return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", false, function (error) {\n            if (error) {\n              Alerts.toast(error.message, \"error\");\n            }\n          });\n        }\n      };\n\n      _this.updateQuantityIfChildVariants = function (variant) {\n        if (_this.hasChildVariants(variant)) {\n          var variantQuantity = ReactionProduct.getVariantQuantity(variant);\n          return variantQuantity;\n        }\n      };\n\n      _this.validation = new Validation(ProductVariant);\n      _this.state = {\n        validationStatus: _this.validation.validationStatus,\n        isDeleted: props.variant && props.variant.isDeleted\n      };\n      return _this;\n    }\n\n    var _proto = VariantFormContainer.prototype;\n\n    _proto.componentDidMount = function () {\n      function componentDidMount() {\n        this.runVariantValidation(this.props.variant);\n      }\n\n      return componentDidMount;\n    }();\n\n    _proto.componentWillReceiveProps = function () {\n      function componentWillReceiveProps(nextProps) {\n        this.setState({\n          isDeleted: nextProps.variant && nextProps.variant.isDeleted\n        });\n      }\n\n      return componentWillReceiveProps;\n    }();\n\n    _proto.runVariantValidation = function () {\n      function runVariantValidation(variant) {\n        if (variant) {\n          var validationStatus = this.validation.validate(variant);\n          this.setState(function () {\n            return {\n              validationStatus: validationStatus\n            };\n          });\n          return validationStatus;\n        }\n      }\n\n      return runVariantValidation;\n    }();\n\n    _proto.render = function () {\n      function render() {\n        if (this.props.variant) {\n          return React.createElement(Comp, (0, _extends2.default)({\n            isProviderEnabled: this.isProviderEnabled,\n            fetchTaxCodes: this.fetchTaxCodes,\n            hasChildVariants: this.hasChildVariants,\n            greyDisabledFields: this.greyDisabledFields,\n            restoreVariant: this.restoreVariant,\n            removeVariant: this.removeVariant,\n            cloneVariant: this.cloneVariant,\n            onVariantFieldSave: this.handleVariantFieldSave,\n            onVisibilityButtonClick: this.handleVariantVisibilityToggle,\n            onCardExpand: this.handleCardExpand,\n            onUpdateQuantityField: this.updateQuantityIfChildVariants,\n            validation: this.state.validationStatus,\n            isDeleted: this.state.isDeleted\n          }, this.props, {\n            variant: this.props.variant\n          }));\n        }\n\n        return null;\n      }\n\n      return render;\n    }();\n\n    return VariantFormContainer;\n  }(Component), _class.propTypes = {\n    variant: PropTypes.object\n  }, _temp;\n};\n\nregisterComponent(\"VariantForm\", VariantForm, wrapComponent);\nmodule.exportDefault(_compose(wrapComponent)(VariantForm));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/variantFormContainer.js"],"names":["_compose","module","watch","require","v","React","Component","PropTypes","registerComponent","Meteor","Session","Validation","ReactionProduct","Packages","Reaction","i18next","TaxCodes","ProductVariant","VariantForm","wrapComponent","Comp","props","isProviderEnabled","shopId","getShopId","provider","findOne","providerName","name","split","settings","enabled","fetchTaxCodes","providers","registry","filter","o","provides","includes","taxCodesArray","codes","find","taxCodeProvider","forEach","code","push","value","taxCode","label","hasChildVariants","variant","checkChildVariants","_id","greyDisabledFields","backgroundColor","cursor","restoreVariant","title","t","Alerts","alert","showCancelButton","confirmButtonText","isConfirm","id","call","error","text","defaultValue","setState","isDeleted","state","removeVariant","result","selectedVariantId","setCurrentVariant","cloneVariant","productId","selectedProductId","variantId","set","handleVariantFieldSave","fieldName","validationStatus","runVariantValidation","isFieldValid","toast","message","updateInventoryPolicyIfChildVariants","handleCardExpand","cardName","handleVariantVisibilityToggle","isVisible","options","getSiblings","parent","getVariantParent","length","inventoryPolicy","every","option","updateQuantityIfChildVariants","variantQuantity","getVariantQuantity","validation","componentDidMount","componentWillReceiveProps","nextProps","validate","render","propTypes","object","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { compose } from \"recompose\";\nimport { registerComponent } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { Validation } from \"@reactioncommerce/schemas\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Packages } from \"/lib/collections\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { TaxCodes } from \"/imports/plugins/core/taxes/lib/collections\";\nimport { ProductVariant } from \"/lib/collections/schemas/products\";\nimport VariantForm from \"../components/variantForm\";\n\nconst wrapComponent = (Comp) => (\n  class VariantFormContainer extends Component {\n    static propTypes = {\n      variant: PropTypes.object\n    }\n\n    constructor(props) {\n      super(props);\n\n      this.validation = new Validation(ProductVariant);\n\n      this.state = {\n        validationStatus: this.validation.validationStatus,\n        isDeleted: props.variant && props.variant.isDeleted\n      };\n    }\n\n    componentDidMount() {\n      this.runVariantValidation(this.props.variant);\n    }\n\n    componentWillReceiveProps(nextProps) {\n      this.setState({\n        isDeleted: nextProps.variant && nextProps.variant.isDeleted\n      });\n    }\n\n    runVariantValidation(variant) {\n      if (variant) {\n        const validationStatus = this.validation.validate(variant);\n\n        this.setState(() => ({\n          validationStatus\n        }));\n\n        return validationStatus;\n      }\n    }\n\n    isProviderEnabled = () => {\n      const shopId = Reaction.getShopId();\n\n      const provider = Packages.findOne({\n        shopId,\n        \"registry.provides\": \"taxCodes\",\n        \"$where\"() {\n          const providerName = this.name.split(\"-\")[1];\n          return this.settings[providerName].enabled;\n        }\n      });\n\n      if (provider) {\n        return true;\n      }\n      return false;\n    }\n\n    fetchTaxCodes = () => {\n      const shopId = Reaction.getShopId();\n      const provider = Packages.findOne({\n        shopId,\n        \"registry.provides\": \"taxCodes\",\n        \"$where\"() {\n          const providers = this.registry.filter((o) => o.provides && o.provides.includes(\"taxCodes\"));\n          const providerName = providers[0].name.split(\"/\")[2];\n\n          return this.settings[providerName].enabled;\n        }\n      });\n      const taxCodesArray = [];\n\n      const codes = TaxCodes.find({\n        shopId,\n        taxCodeProvider: provider.name\n      });\n\n      codes.forEach((code) => {\n        taxCodesArray.push({\n          value: code.taxCode,\n          label: `${code.taxCode} | ${code.label}`\n        });\n      });\n      return taxCodesArray;\n    }\n\n    hasChildVariants = (variant) => {\n      if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n        return true;\n      }\n      return false;\n    }\n\n    greyDisabledFields = (variant) => {\n      if (this.hasChildVariants(variant)) {\n        return { backgroundColor: \"lightgrey\", cursor: \"not-allowed\" };\n      }\n    }\n\n    restoreVariant = (variant) => {\n      const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n      Alerts.alert({\n        title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", { title }),\n        showCancelButton: true,\n        confirmButtonText: \"Restore\"\n      }, (isConfirm) => {\n        if (isConfirm) {\n          const id = variant._id;\n          Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, (error) => {\n            if (error) {\n              Alerts.alert({\n                text: i18next.t(\"productDetailEdit.restoreVariantFail\", { title }),\n                confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n              });\n            }\n            this.setState({\n              isDeleted: !this.state.isDeleted\n            });\n          });\n        }\n      });\n    }\n\n    removeVariant = (variant) => {\n      const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n      Alerts.alert({\n        title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", { title }),\n        showCancelButton: true,\n        confirmButtonText: \"Archive\"\n      }, (isConfirm) => {\n        if (isConfirm) {\n          this.setState({\n            isDeleted: !this.state.isDeleted\n          });\n          const id = variant._id;\n          Meteor.call(\"products/deleteVariant\", id, (error, result) => {\n            if (result && ReactionProduct.selectedVariantId() === id) {\n              return ReactionProduct.setCurrentVariant(null);\n            }\n          });\n        }\n      });\n    }\n\n    cloneVariant = (variant) => {\n      const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n      const productId = ReactionProduct.selectedProductId();\n      if (!productId) {\n        return;\n      }\n      Meteor.call(\"products/cloneVariant\", productId, variant._id, (error, result) => {\n        if (error) {\n          Alerts.alert({\n            text: i18next.t(\"productDetailEdit.cloneVariantFail\", { title }),\n            confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n          });\n        } else if (result) {\n          const variantId = result[0];\n\n          ReactionProduct.setCurrentVariant(variantId);\n          Session.set(`variant-form-${variantId}`, true);\n        }\n      });\n    }\n\n    handleVariantFieldSave = (variantId, fieldName, value, variant) => {\n      const validationStatus = this.runVariantValidation(variant);\n\n      if (validationStatus.isFieldValid(fieldName)) {\n        Meteor.call(\"products/updateProductField\", variantId, fieldName, value, (error) => {\n          if (error) {\n            Alerts.toast(error.message, \"error\");\n          }\n\n          if (fieldName === \"inventoryPolicy\") {\n            this.updateInventoryPolicyIfChildVariants(variant);\n          }\n        });\n      }\n    }\n\n    handleCardExpand = (cardName) => {\n      Reaction.state.set(\"edit/focus\", cardName);\n    }\n\n    handleVariantVisibilityToggle = (variant) => {\n      Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", !variant.isVisible);\n    }\n\n    /**\n     * @method updateInventoryPolicyIfChildVariants\n     * @description update parent inventory policy if variant has children\n     * @param {Object} variant product or variant document\n     * @return {undefined} return nothing\n     */\n    updateInventoryPolicyIfChildVariants = (variant) => {\n      // Get all siblings, including current variant\n      const options = ReactionProduct.getSiblings(variant);\n      // Get parent\n      const parent = ReactionProduct.getVariantParent(variant);\n\n      // If this is not a top-level variant, update top-level inventory policy as well\n      if (parent && options && options.length) {\n        // Check to see if every variant option inventory policy is true\n        const inventoryPolicy = options.every((option) => option.inventoryPolicy === true);\n\n        // If all inventory policies on children are true, update parent to be true\n        if (inventoryPolicy === true) {\n          return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", true, (error) => {\n            if (error) {\n              Alerts.toast(error.message, \"error\");\n            }\n          });\n        }\n        // If any child has a false inventoryPolicy, update parent to be false\n        return Meteor.call(\"products/updateProductField\", parent._id, \"inventoryPolicy\", false, (error) => {\n          if (error) {\n            Alerts.toast(error.message, \"error\");\n          }\n        });\n      }\n    }\n\n    updateQuantityIfChildVariants = (variant) => {\n      if (this.hasChildVariants(variant)) {\n        const variantQuantity = ReactionProduct.getVariantQuantity(variant);\n        return variantQuantity;\n      }\n    }\n\n    render() {\n      if (this.props.variant) {\n        return (\n          <Comp\n            isProviderEnabled={this.isProviderEnabled}\n            fetchTaxCodes={this.fetchTaxCodes}\n            hasChildVariants={this.hasChildVariants}\n            greyDisabledFields={this.greyDisabledFields}\n            restoreVariant={this.restoreVariant}\n            removeVariant={this.removeVariant}\n            cloneVariant={this.cloneVariant}\n            onVariantFieldSave={this.handleVariantFieldSave}\n            onVisibilityButtonClick={this.handleVariantVisibilityToggle}\n            onCardExpand={this.handleCardExpand}\n            onUpdateQuantityField={this.updateQuantityIfChildVariants}\n            validation={this.state.validationStatus}\n            isDeleted={this.state.isDeleted}\n            {...this.props}\n            variant={this.props.variant}\n          />\n        );\n      }\n\n      return null;\n    }\n  }\n);\n\nregisterComponent(\"VariantForm\", VariantForm, wrapComponent);\n\nexport default compose(wrapComponent)(VariantForm);\n"]},"sourceType":"script","hash":"aa39671a177097de935c5940b7b64f9c3bb7d930"}
