{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/client/templates/products/productSettings/productSettings.js","filename":"imports/plugins/included/product-variant/client/templates/products/productSettings/productSettings.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/client/templates/products/productSettings/productSettings.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/client/templates/products/productSettings/productSettings.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/client/templates/products/productSettings/productSettings.js"}},"code":"var _isArray;\n\nmodule.watch(require(\"lodash/isArray\"), {\n  \"default\": function (v) {\n    _isArray = v;\n  }\n}, 0);\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 1);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar ReactiveDict;\nmodule.watch(require(\"meteor/reactive-dict\"), {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 3);\nvar Reaction;\nmodule.watch(require(\"../../../../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 4);\nvar Logger;\nmodule.watch(require(\"../../../../../../../../client/modules/logger\"), {\n  \"default\": function (v) {\n    Logger = v;\n  }\n}, 5);\nvar getPrimaryMediaForItem, ReactionProduct;\nmodule.watch(require(\"../../../../../../../../lib/api\"), {\n  getPrimaryMediaForItem: function (v) {\n    getPrimaryMediaForItem = v;\n  },\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 6);\nvar Products;\nmodule.watch(require(\"../../../../../../../../lib/collections\"), {\n  Products: function (v) {\n    Products = v;\n  }\n}, 7);\nvar isRevisionControlEnabled;\nmodule.watch(require(\"../../../../../../core/revisions/lib/api\"), {\n  isRevisionControlEnabled: function (v) {\n    isRevisionControlEnabled = v;\n  }\n}, 8);\nvar applyProductRevision;\nmodule.watch(require(\"../../../../../../../../lib/api/products\"), {\n  applyProductRevision: function (v) {\n    applyProductRevision = v;\n  }\n}, 9);\n\nfunction updateVariantProductField(variants, field, value) {\n  return variants.map(function (variant) {\n    return Meteor.call(\"products/updateProductField\", variant._id, field, value);\n  });\n}\n\nTemplate.productSettings.onCreated(function () {\n  var _this = this;\n\n  this.state = new ReactiveDict();\n  this.state.setDefault({\n    products: [],\n    productIds: []\n  });\n  this.autorun(function () {\n    var currentData = Template.currentData();\n\n    if (_isArray(currentData.products)) {\n      var productIds = currentData.products.map(function (product) {\n        return product._id;\n      });\n\n      var _products = Products.find({\n        _id: {\n          $in: productIds\n        }\n      }).map(function (product) {\n        return applyProductRevision(product);\n      });\n\n      _this.state.set(\"productIds\", productIds);\n\n      _this.state.set(\"products\", _products);\n    }\n  });\n});\nTemplate.productSettings.helpers({\n  isVisible: function () {\n    var instance = Template.instance();\n    var products = instance.state.get(\"products\") || []; // Use the first selected product to determin status of bulk, isVisible button\n\n    if (Array.isArray(products) && products.length) {\n      return products[0].isVisible;\n    }\n\n    return false;\n  },\n  hasSelectedProducts: function () {\n    return this.products && this.products.length > 0;\n  },\n  itemWeightActive: function (weight) {\n    var instance = Template.instance();\n    var products = instance.state.get(\"products\");\n    var tag = ReactionProduct.getTag();\n\n    for (var _iterator = products, _isArray2 = Array.isArray(_iterator), _i = 0, _iterator = _isArray2 ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray2) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var _product = _ref;\n      var positions = _product.positions && _product.positions[tag] || {};\n      var currentWeight = positions.weight || 0;\n\n      if (currentWeight === weight) {\n        return \"active\";\n      }\n    }\n\n    return \"\";\n  }\n});\nTemplate.productSettingsListItem.events({\n  \"click [data-event-action=product-click]\": function () {\n    Reaction.Router.go(\"product\", {\n      handle: this.__published && this.__published.handle || this.handle\n    });\n    Reaction.state.set(\"edit/focus\", \"productDetails\"); // Set actionView to product admin\n\n    Reaction.setActionView({\n      i18nKeyLabel: \"productDetailEdit.productSettings\",\n      label: \"Product Settings\",\n      template: \"ProductAdmin\"\n    });\n  }\n});\nTemplate.productSettingsListItem.helpers({\n  displayPrice: function () {\n    if (this._id) {\n      return ReactionProduct.getProductPriceRange(this._id).range;\n    }\n\n    return null;\n  },\n  mediaUrl: function () {\n    var variants = ReactionProduct.getTopVariants(this._id);\n    if (!variants || variants.length === 0) return \"/resources/placeholder.gif\";\n    var media = getPrimaryMediaForItem({\n      productId: this._id,\n      variantId: variants[0]._id\n    });\n    if (!media) return \"/resources/placeholder.gif\";\n    return media.url({\n      store: \"thumbnail\"\n    });\n  },\n  listItemActiveClassName: function (productId) {\n    var handle = Reaction.Router.current().params.handle;\n\n    if (ReactionProduct.equals(\"productId\", productId) && handle) {\n      return \"active\";\n    }\n\n    return \"\";\n  }\n});\n/**\n * productExtendedControls events\n */\n\nTemplate.productSettings.events({\n  \"click [data-event-action=publishProduct]\": function () {\n    var instance = Template.instance();\n    var products = instance.state.get(\"products\") || [];\n\n    if (isRevisionControlEnabled()) {\n      for (var _iterator2 = products, _isArray3 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray3 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n        var _ref2;\n\n        if (_isArray3) {\n          if (_i2 >= _iterator2.length) break;\n          _ref2 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) break;\n          _ref2 = _i2.value;\n        }\n\n        var _product2 = _ref2;\n        // Update the visibility using the first selected product to determine the proper\n        // visibility toggle. This is to ensure that all selected products will become visible or not visible\n        // at the same time so it's not confusing.\n        Meteor.call(\"products/updateProductField\", _product2._id, \"isVisible\", !products[0].isVisible); // update the variants visibility\n\n        var variants = Products.find({\n          ancestors: {\n            $in: [_product2._id]\n          }\n        });\n        updateVariantProductField(variants, \"isVisible\", !products[0].isVisible);\n      }\n    } else {\n      // The legacy behavior will bulk toggle visibilty of each product seperatly.\n      //\n      // Example:\n      // If you selected 10 products, and 5 were visible and 5 were not visible, and then\n      // clicked the visibility button, 5 products would switched from not visible to visible, and the other 5\n      // would be swiched from visible to not visible.\n      ReactionProduct.publishProduct(products);\n    }\n  },\n  \"click [data-event-action=cloneProduct]\": function () {\n    ReactionProduct.cloneProduct(this.products);\n  },\n  \"click [data-event-action=archiveProduct]\": function () {\n    ReactionProduct.archiveProduct(this.products);\n  },\n  \"click [data-event-action=changeProductWeight]\": function (event) {\n    event.preventDefault();\n    var tag = ReactionProduct.getTag();\n\n    for (var _iterator3 = this.products, _isArray4 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray4 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n      var _ref3;\n\n      if (_isArray4) {\n        if (_i3 >= _iterator3.length) break;\n        _ref3 = _iterator3[_i3++];\n      } else {\n        _i3 = _iterator3.next();\n        if (_i3.done) break;\n        _ref3 = _i3.value;\n      }\n\n      var _product3 = _ref3;\n      var weight = Template.instance().$(event.currentTarget).data(\"event-data\") || 0;\n      var positions = {\n        weight: weight,\n        updatedAt: new Date()\n      };\n      /* eslint no-loop-func: 1 */\n      //\n      //\n\n      Meteor.call(\"products/updateProductPosition\", _product3._id, positions, tag, function (error) {\n        // eslint-disable-line no-loop-func\n        if (error) {\n          Logger.warn(error);\n          throw new Meteor.Error(\"access-denied\", error);\n        }\n      });\n    }\n  }\n});","map":{"version":3,"sources":["imports/plugins/included/product-variant/client/templates/products/productSettings/productSettings.js"],"names":["_isArray","module","watch","require","v","Template","Meteor","ReactiveDict","Reaction","Logger","getPrimaryMediaForItem","ReactionProduct","Products","isRevisionControlEnabled","applyProductRevision","updateVariantProductField","variants","field","value","map","variant","call","_id","productSettings","onCreated","state","setDefault","products","productIds","autorun","currentData","product","find","$in","set","helpers","isVisible","instance","get","Array","isArray","length","hasSelectedProducts","itemWeightActive","weight","tag","getTag","positions","currentWeight","productSettingsListItem","events","Router","go","handle","__published","setActionView","i18nKeyLabel","label","template","displayPrice","getProductPriceRange","range","mediaUrl","getTopVariants","media","productId","variantId","url","store","listItemActiveClassName","current","params","equals","ancestors","publishProduct","cloneProduct","archiveProduct","event","preventDefault","$","currentTarget","data","updatedAt","Date","error","warn","Error"],"mappings":"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","sourcesContent":["import _ from \"lodash\";\nimport { Template } from \"meteor/templating\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactiveDict } from \"meteor/reactive-dict\";\nimport { Reaction } from \"/client/api\";\nimport Logger from \"/client/modules/logger\";\nimport { getPrimaryMediaForItem, ReactionProduct } from \"/lib/api\";\nimport { Products } from \"/lib/collections\";\nimport { isRevisionControlEnabled } from \"/imports/plugins/core/revisions/lib/api\";\nimport { applyProductRevision } from \"/lib/api/products\";\n\nfunction updateVariantProductField(variants, field, value) {\n  return variants.map((variant) => Meteor.call(\"products/updateProductField\", variant._id, field, value));\n}\n\nTemplate.productSettings.onCreated(function () {\n  this.state = new ReactiveDict();\n  this.state.setDefault({\n    products: [],\n    productIds: []\n  });\n\n  this.autorun(() => {\n    const currentData = Template.currentData();\n\n    if (_.isArray(currentData.products)) {\n      const productIds = currentData.products.map((product) => product._id);\n\n      const products = Products.find({\n        _id: {\n          $in: productIds\n        }\n      }).map((product) => applyProductRevision(product));\n\n      this.state.set(\"productIds\", productIds);\n      this.state.set(\"products\", products);\n    }\n  });\n});\n\nTemplate.productSettings.helpers({\n  isVisible() {\n    const instance = Template.instance();\n    const products = instance.state.get(\"products\") || [];\n\n    // Use the first selected product to determin status of bulk, isVisible button\n    if (Array.isArray(products) && products.length) {\n      return products[0].isVisible;\n    }\n\n    return false;\n  },\n  hasSelectedProducts() {\n    return this.products && this.products.length > 0;\n  },\n  itemWeightActive(weight) {\n    const instance = Template.instance();\n    const products = instance.state.get(\"products\");\n    const tag = ReactionProduct.getTag();\n\n    for (const product of products) {\n      const positions = (product.positions && product.positions[tag]) || {};\n      const currentWeight = positions.weight || 0;\n      if (currentWeight === weight) {\n        return \"active\";\n      }\n    }\n    return \"\";\n  }\n});\n\nTemplate.productSettingsListItem.events({\n  \"click [data-event-action=product-click]\"() {\n    Reaction.Router.go(\"product\", {\n      handle: (this.__published && this.__published.handle) || this.handle\n    });\n\n    Reaction.state.set(\"edit/focus\", \"productDetails\");\n\n    // Set actionView to product admin\n    Reaction.setActionView({\n      i18nKeyLabel: \"productDetailEdit.productSettings\",\n      label: \"Product Settings\",\n      template: \"ProductAdmin\"\n    });\n  }\n});\n\nTemplate.productSettingsListItem.helpers({\n  displayPrice() {\n    if (this._id) {\n      return ReactionProduct.getProductPriceRange(this._id).range;\n    }\n    return null;\n  },\n\n  mediaUrl() {\n    const variants = ReactionProduct.getTopVariants(this._id);\n    if (!variants || variants.length === 0) return \"/resources/placeholder.gif\";\n    const media = getPrimaryMediaForItem({ productId: this._id, variantId: variants[0]._id });\n    if (!media) return \"/resources/placeholder.gif\";\n    return media.url({ store: \"thumbnail\" });\n  },\n\n  listItemActiveClassName(productId) {\n    const { handle } = Reaction.Router.current().params;\n\n    if (ReactionProduct.equals(\"productId\", productId) && handle) {\n      return \"active\";\n    }\n\n    return \"\";\n  }\n});\n\n/**\n * productExtendedControls events\n */\n\nTemplate.productSettings.events({\n  \"click [data-event-action=publishProduct]\"() {\n    const instance = Template.instance();\n    const products = instance.state.get(\"products\") || [];\n\n    if (isRevisionControlEnabled()) {\n      for (const product of products) {\n        // Update the visibility using the first selected product to determine the proper\n        // visibility toggle. This is to ensure that all selected products will become visible or not visible\n        // at the same time so it's not confusing.\n        Meteor.call(\"products/updateProductField\", product._id, \"isVisible\", !products[0].isVisible);\n        // update the variants visibility\n        const variants = Products.find({\n          ancestors: {\n            $in: [product._id]\n          }\n        });\n        updateVariantProductField(variants, \"isVisible\", !products[0].isVisible);\n      }\n    } else {\n      // The legacy behavior will bulk toggle visibilty of each product seperatly.\n      //\n      // Example:\n      // If you selected 10 products, and 5 were visible and 5 were not visible, and then\n      // clicked the visibility button, 5 products would switched from not visible to visible, and the other 5\n      // would be swiched from visible to not visible.\n      ReactionProduct.publishProduct(products);\n    }\n  },\n  \"click [data-event-action=cloneProduct]\"() {\n    ReactionProduct.cloneProduct(this.products);\n  },\n  \"click [data-event-action=archiveProduct]\"() {\n    ReactionProduct.archiveProduct(this.products);\n  },\n  \"click [data-event-action=changeProductWeight]\"(event) {\n    event.preventDefault();\n    const tag = ReactionProduct.getTag();\n    for (const product of this.products) {\n      const weight = Template.instance().$(event.currentTarget).data(\"event-data\") || 0;\n      const positions = {\n        weight,\n        updatedAt: new Date()\n      };\n      /* eslint no-loop-func: 1 */\n      //\n      //\n      Meteor.call(\n        \"products/updateProductPosition\", product._id, positions, tag,\n        (error) => { // eslint-disable-line no-loop-func\n          if (error) {\n            Logger.warn(error);\n            throw new Meteor.Error(\"access-denied\", error);\n          }\n        }\n      );\n    }\n  }\n});\n"]},"sourceType":"script","hash":"a3eee1dbaf23d851515bca42eec3f4781b04ba14"}
