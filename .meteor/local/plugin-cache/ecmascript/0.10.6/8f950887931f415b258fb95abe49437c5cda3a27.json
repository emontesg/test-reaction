{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/productGridContainer.js","filename":"imports/plugins/included/product-variant/containers/productGridContainer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"presets":[],"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/productGridContainer.js","plugins":["jsx","jsx","flow","flow","objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/productGridContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/productGridContainer.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/builtin/extends\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nlet _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  default(v) {\n    _compose = v;\n  }\n\n}, 0);\n\nlet _get;\n\nmodule.watch(require(\"lodash/get\"), {\n  default(v) {\n    _get = v;\n  }\n\n}, 1);\n\nlet _without;\n\nmodule.watch(require(\"lodash/without\"), {\n  default(v) {\n    _without = v;\n  }\n\n}, 2);\n\nlet _uniq;\n\nmodule.watch(require(\"lodash/uniq\"), {\n  default(v) {\n    _uniq = v;\n  }\n\n}, 3);\n\nlet _isEmpty;\n\nmodule.watch(require(\"lodash/isEmpty\"), {\n  default(v) {\n    _isEmpty = v;\n  }\n\n}, 4);\nlet React, Component;\nmodule.watch(require(\"react\"), {\n  default(v) {\n    React = v;\n  },\n\n  Component(v) {\n    Component = v;\n  }\n\n}, 5);\nlet PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  default(v) {\n    PropTypes = v;\n  }\n\n}, 6);\nlet update;\nmodule.watch(require(\"immutability-helper\"), {\n  default(v) {\n    update = v;\n  }\n\n}, 7);\nlet Components, composeWithTracker, registerComponent;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  Components(v) {\n    Components = v;\n  },\n\n  composeWithTracker(v) {\n    composeWithTracker = v;\n  },\n\n  registerComponent(v) {\n    registerComponent = v;\n  }\n\n}, 8);\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 9);\nlet Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session(v) {\n    Session = v;\n  }\n\n}, 10);\nlet Reaction;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction(v) {\n    Reaction = v;\n  }\n\n}, 11);\nlet Media;\nmodule.watch(require(\"../../../core/files/client\"), {\n  Media(v) {\n    Media = v;\n  }\n\n}, 12);\nlet Logger;\nmodule.watch(require(\"../../../../../client/modules/logger\"), {\n  default(v) {\n    Logger = v;\n  }\n\n}, 13);\nlet ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct(v) {\n    ReactionProduct = v;\n  }\n\n}, 14);\nlet ProductGrid;\nmodule.watch(require(\"../components/productGrid\"), {\n  default(v) {\n    ProductGrid = v;\n  }\n\n}, 15);\n\nconst wrapComponent = Comp => {\n  var _class, _temp;\n\n  return _temp = _class = class ProductGridContainer extends Component {\n    constructor(props) {\n      super(props);\n\n      this.componentWillReceiveProps = nextProps => {\n        this.setState({\n          products: nextProps.products,\n          productIds: nextProps.productIds,\n          productsByKey: nextProps.productsByKey\n        });\n      };\n\n      this.handleSelectProductItem = (isChecked, productId) => {\n        let selectedProducts = Session.get(\"productGrid/selectedProducts\");\n\n        if (isChecked) {\n          selectedProducts.push(productId);\n        } else {\n          selectedProducts = _without(selectedProducts, productId);\n        }\n\n        Reaction.setUserPreferences(\"reaction-product-variant\", \"selectedGridItems\", selectedProducts); // Save the selected items to the Session\n\n        Session.set(\"productGrid/selectedProducts\", _uniq(selectedProducts));\n        const {\n          products\n        } = this;\n\n        if (products) {\n          const filteredProducts = products.filter(product => selectedProducts.includes(product._id));\n          Reaction.showActionView({\n            label: \"Grid Settings\",\n            i18nKeyLabel: \"gridSettingsPanel.title\",\n            template: \"productSettings\",\n            type: \"product\",\n            data: {\n              products: filteredProducts\n            }\n          });\n        }\n      };\n\n      this.handleProductDrag = (dragIndex, hoverIndex) => {\n        const tag = ReactionProduct.getTag();\n        const dragProductId = this.state.productIds[dragIndex];\n        const hoverProductId = this.state.productIds[hoverIndex];\n\n        const dragProductWeight = _get(this, `state.productsByKey[${dragProductId}].positions[${tag}].weight`, 0);\n\n        const dropProductWeight = _get(this, `state.productsByKey[${hoverProductId}].positions[${tag}].weight`, 0);\n\n        const newState = update(this.state, {\n          productsByKey: {\n            [dragProductId]: {\n              $merge: {\n                positions: {\n                  [tag]: {\n                    weight: dropProductWeight\n                  }\n                }\n              }\n            },\n            [hoverProductId]: {\n              $merge: {\n                positions: {\n                  [tag]: {\n                    weight: dragProductWeight\n                  }\n                }\n              }\n            }\n          },\n          productIds: {\n            $splice: [[dragIndex, 1], [hoverIndex, 0, dragProductId]]\n          }\n        });\n        this.setState(newState);\n      };\n\n      this.handleProductDrop = () => {\n        const tag = ReactionProduct.getTag();\n        this.state.productIds.map((productId, index) => {\n          const position = {\n            position: index,\n            updatedAt: new Date()\n          };\n          return Meteor.call(\"products/updateProductPosition\", productId, position, tag, error => {\n            if (error) {\n              Logger.error(error);\n              throw new Meteor.Error(\"error-occurred\", error);\n            }\n          });\n        });\n      };\n\n      this.state = {\n        products: props.products,\n        productsByKey: props.productsByKey,\n        productIds: props.productIds,\n        initialLoad: true,\n        slug: \"\",\n        canLoadMoreProducts: false\n      };\n    }\n\n    componentWillMount() {\n      const selectedProducts = Reaction.getUserPreferences(\"reaction-product-variant\", \"selectedGridItems\");\n      const {\n        products\n      } = this;\n\n      if (_isEmpty(selectedProducts)) {\n        return Reaction.hideActionView();\n      } // Save the selected items to the Session\n\n\n      Session.set(\"productGrid/selectedProducts\", _uniq(selectedProducts));\n\n      if (products) {\n        const filteredProducts = products.filter(product => selectedProducts.includes(product._id));\n\n        if (Reaction.isPreview() === false) {\n          Reaction.showActionView({\n            label: \"Grid Settings\",\n            i18nKeyLabel: \"gridSettingsPanel.title\",\n            template: \"productSettings\",\n            type: \"product\",\n            data: {\n              products: filteredProducts\n            }\n          });\n        }\n      }\n    }\n\n    get products() {\n      if (this.props.isSearch) {\n        return this.state.products;\n      }\n\n      return this.state.productIds.map(id => this.state.productsByKey[id]);\n    }\n\n    render() {\n      return React.createElement(Components.DragDropProvider, null, React.createElement(Comp, (0, _extends2.default)({}, this.props, {\n        products: this.products,\n        onMove: this.handleProductDrag,\n        onDrop: this.handleProductDrop,\n        itemSelectHandler: this.handleSelectProductItem\n      })));\n    }\n\n  }, _class.propTypes = {\n    isSearch: PropTypes.bool,\n    productIds: PropTypes.array,\n    products: PropTypes.array,\n    productsByKey: PropTypes.object\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  // Instantiate an object for use as a map. This object does not inherit prototype or methods from `Object`\n  const productMediaById = Object.create(null);\n  (props.products || []).forEach(product => {\n    const primaryMedia = Media.findOneLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.toGrid\": 1,\n      \"metadata.workflow\": {\n        $nin: [\"archived\", \"unpublished\"]\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1,\n        \"uploadedAt\": 1\n      }\n    });\n    const variantIds = ReactionProduct.getVariants(product._id).map(variant => variant._id);\n    let additionalMedia = Media.findLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.variantId\": {\n        $in: variantIds\n      },\n      \"metadata.workflow\": {\n        $nin: [\"archived\", \"unpublished\"]\n      }\n    }, {\n      limit: 3,\n      sort: {\n        \"metadata.priority\": 1,\n        \"uploadedAt\": 1\n      }\n    });\n    if (additionalMedia.length < 2) additionalMedia = null;\n    productMediaById[product._id] = {\n      additionalMedia,\n      primaryMedia\n    };\n  });\n  onData(null, {\n    productMediaById\n  });\n}\n\nregisterComponent(\"ProductGrid\", ProductGrid, [composeWithTracker(composer), wrapComponent]);\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductGrid));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/productGridContainer.js"],"names":["_compose","module","watch","require","default","v","_get","_without","_uniq","_isEmpty","React","Component","PropTypes","update","Components","composeWithTracker","registerComponent","Meteor","Session","Reaction","Media","Logger","ReactionProduct","ProductGrid","wrapComponent","Comp","ProductGridContainer","constructor","props","componentWillReceiveProps","nextProps","setState","products","productIds","productsByKey","handleSelectProductItem","isChecked","productId","selectedProducts","get","push","setUserPreferences","set","filteredProducts","filter","product","includes","_id","showActionView","label","i18nKeyLabel","template","type","data","handleProductDrag","dragIndex","hoverIndex","tag","getTag","dragProductId","state","hoverProductId","dragProductWeight","dropProductWeight","newState","$merge","positions","weight","$splice","handleProductDrop","map","index","position","updatedAt","Date","call","error","Error","initialLoad","slug","canLoadMoreProducts","componentWillMount","getUserPreferences","hideActionView","isPreview","isSearch","id","render","propTypes","bool","array","object","composer","onData","productMediaById","Object","create","forEach","primaryMedia","findOneLocal","$nin","sort","variantIds","getVariants","variant","additionalMedia","findLocal","$in","limit","length","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport update from \"immutability-helper\";\nimport _ from \"lodash\";\nimport { compose } from \"recompose\";\nimport { Components, composeWithTracker, registerComponent } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { Reaction } from \"/client/api\";\nimport { Media } from \"/imports/plugins/core/files/client\";\nimport Logger from \"/client/modules/logger\";\nimport { ReactionProduct } from \"/lib/api\";\nimport ProductGrid from \"../components/productGrid\";\n\nconst wrapComponent = (Comp) => (\n  class ProductGridContainer extends Component {\n    static propTypes = {\n      isSearch: PropTypes.bool,\n      productIds: PropTypes.array,\n      products: PropTypes.array,\n      productsByKey: PropTypes.object\n    }\n\n    constructor(props) {\n      super(props);\n\n      this.state = {\n        products: props.products,\n        productsByKey: props.productsByKey,\n        productIds: props.productIds,\n        initialLoad: true,\n        slug: \"\",\n        canLoadMoreProducts: false\n      };\n    }\n\n    componentWillMount() {\n      const selectedProducts = Reaction.getUserPreferences(\"reaction-product-variant\", \"selectedGridItems\");\n      const { products } = this;\n\n      if (_.isEmpty(selectedProducts)) {\n        return Reaction.hideActionView();\n      }\n\n      // Save the selected items to the Session\n      Session.set(\"productGrid/selectedProducts\", _.uniq(selectedProducts));\n\n      if (products) {\n        const filteredProducts = products.filter((product) => selectedProducts.includes(product._id));\n\n        if (Reaction.isPreview() === false) {\n          Reaction.showActionView({\n            label: \"Grid Settings\",\n            i18nKeyLabel: \"gridSettingsPanel.title\",\n            template: \"productSettings\",\n            type: \"product\",\n            data: { products: filteredProducts }\n          });\n        }\n      }\n    }\n\n    componentWillReceiveProps = (nextProps) => {\n      this.setState({\n        products: nextProps.products,\n        productIds: nextProps.productIds,\n        productsByKey: nextProps.productsByKey\n      });\n    }\n\n    handleSelectProductItem = (isChecked, productId) => {\n      let selectedProducts = Session.get(\"productGrid/selectedProducts\");\n\n      if (isChecked) {\n        selectedProducts.push(productId);\n      } else {\n        selectedProducts = _.without(selectedProducts, productId);\n      }\n\n      Reaction.setUserPreferences(\"reaction-product-variant\", \"selectedGridItems\", selectedProducts);\n\n      // Save the selected items to the Session\n      Session.set(\"productGrid/selectedProducts\", _.uniq(selectedProducts));\n\n      const { products } = this;\n\n      if (products) {\n        const filteredProducts = products.filter((product) => selectedProducts.includes(product._id));\n\n        Reaction.showActionView({\n          label: \"Grid Settings\",\n          i18nKeyLabel: \"gridSettingsPanel.title\",\n          template: \"productSettings\",\n          type: \"product\",\n          data: { products: filteredProducts }\n        });\n      }\n    }\n\n    handleProductDrag = (dragIndex, hoverIndex) => {\n      const tag = ReactionProduct.getTag();\n      const dragProductId = this.state.productIds[dragIndex];\n      const hoverProductId = this.state.productIds[hoverIndex];\n      const dragProductWeight = _.get(this, `state.productsByKey[${dragProductId}].positions[${tag}].weight`, 0);\n      const dropProductWeight = _.get(this, `state.productsByKey[${hoverProductId}].positions[${tag}].weight`, 0);\n\n      const newState = update(this.state, {\n        productsByKey: {\n          [dragProductId]: {\n            $merge: {\n              positions: {\n                [tag]: {\n                  weight: dropProductWeight\n                }\n              }\n            }\n          },\n          [hoverProductId]: {\n            $merge: {\n              positions: {\n                [tag]: {\n                  weight: dragProductWeight\n                }\n              }\n            }\n          }\n        },\n        productIds: {\n          $splice: [\n            [dragIndex, 1],\n            [hoverIndex, 0, dragProductId]\n          ]\n        }\n      });\n\n      this.setState(newState);\n    }\n\n    handleProductDrop = () => {\n      const tag = ReactionProduct.getTag();\n      this.state.productIds.map((productId, index) => {\n        const position = { position: index, updatedAt: new Date() };\n\n        return Meteor.call(\"products/updateProductPosition\", productId, position, tag, (error) => {\n          if (error) {\n            Logger.error(error);\n            throw new Meteor.Error(\"error-occurred\", error);\n          }\n        });\n      });\n    }\n\n    get products() {\n      if (this.props.isSearch) {\n        return this.state.products;\n      }\n      return this.state.productIds.map((id) => this.state.productsByKey[id]);\n    }\n\n    render() {\n      return (\n        <Components.DragDropProvider>\n          <Comp\n            {...this.props}\n            products={this.products}\n            onMove={this.handleProductDrag}\n            onDrop={this.handleProductDrop}\n            itemSelectHandler={this.handleSelectProductItem}\n          />\n        </Components.DragDropProvider>\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  // Instantiate an object for use as a map. This object does not inherit prototype or methods from `Object`\n  const productMediaById = Object.create(null);\n  (props.products || []).forEach((product) => {\n    const primaryMedia = Media.findOneLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.toGrid\": 1,\n      \"metadata.workflow\": { $nin: [\"archived\", \"unpublished\"] }\n    }, {\n      sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 }\n    });\n\n    const variantIds = ReactionProduct.getVariants(product._id).map((variant) => variant._id);\n    let additionalMedia = Media.findLocal({\n      \"metadata.productId\": product._id,\n      \"metadata.variantId\": { $in: variantIds },\n      \"metadata.workflow\": { $nin: [\"archived\", \"unpublished\"] }\n    }, {\n      limit: 3,\n      sort: { \"metadata.priority\": 1, \"uploadedAt\": 1 }\n    });\n\n    if (additionalMedia.length < 2) additionalMedia = null;\n\n    productMediaById[product._id] = {\n      additionalMedia,\n      primaryMedia\n    };\n  });\n\n  onData(null, {\n    productMediaById\n  });\n}\n\nregisterComponent(\"ProductGrid\", ProductGrid, [\n  composeWithTracker(composer),\n  wrapComponent\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductGrid);\n"]},"sourceType":"script","hash":"8f950887931f415b258fb95abe49437c5cda3a27"}
