{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/discount-rates/client/settings/rates.js","filename":"imports/plugins/included/discount-rates/client/settings/rates.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/discount-rates/client/settings/rates.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/discount-rates/client/settings/rates.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/discount-rates/client/settings/rates.js"}},"code":"var Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 0);\nvar ReactiveDict;\nmodule.watch(require(\"meteor/reactive-dict\"), {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 1);\nvar $;\nmodule.watch(require(\"meteor/jquery\"), {\n  $: function (v) {\n    $ = v;\n  }\n}, 2);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 3);\nvar AutoForm;\nmodule.watch(require(\"meteor/aldeed:autoform\"), {\n  AutoForm: function (v) {\n    AutoForm = v;\n  }\n}, 4);\nvar DiscountRates;\nmodule.watch(require(\"../collections/rates\"), {\n  DiscountRates: function (v) {\n    DiscountRates = v;\n  }\n}, 5);\nvar DiscountRateSchema;\nmodule.watch(require(\"../../lib/collections/schemas/rates\"), {\n  DiscountRates: function (v) {\n    DiscountRateSchema = v;\n  }\n}, 6);\nvar i18next;\nmodule.watch(require(\"../../../../../../client/api\"), {\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 7);\nvar IconButton, Loading, SortableTable;\nmodule.watch(require(\"../../../../core/ui/client/components\"), {\n  IconButton: function (v) {\n    IconButton = v;\n  },\n  Loading: function (v) {\n    Loading = v;\n  },\n  SortableTable: function (v) {\n    SortableTable = v;\n  }\n}, 8);\n\n/* eslint no-shadow: [\"error\", { \"allow\": [\"options\"] }] */\n\n/* eslint no-unused-vars: [\"error\", { \"argsIgnorePattern\": \"[oO]ptions\" }] */\nTemplate.customDiscountRates.onCreated(function () {\n  var _this = this;\n\n  this.autorun(function () {\n    _this.subscribe(\"DiscountRates\");\n  });\n  this.state = new ReactiveDict();\n  this.state.setDefault({\n    isEditing: false,\n    editingId: null\n  });\n});\nTemplate.customDiscountRates.helpers({\n  editButton: function () {\n    var instance = Template.instance();\n    var state = instance.state;\n    var isEditing = state.equals(\"isEditing\", true);\n    var editingId = state.get(\"editingId\"); // toggle edit state\n\n    if (!isEditing) {\n      editingId = null;\n    } // return icon\n\n\n    return {\n      component: IconButton,\n      icon: \"fa fa-plus\",\n      onIcon: \"fa fa-pencil\",\n      toggle: true,\n      toggleOn: isEditing,\n      style: {\n        position: \"relative\",\n        top: \"-25px\",\n        right: \"8px\"\n      },\n      onClick: function () {\n        // remove active rows from grid\n        $(\".discount-rates-grid-row\").removeClass(\"active\");\n        return state.set({\n          isEditing: !isEditing,\n          editingId: editingId\n        });\n      }\n    };\n  },\n  discountGrid: function () {\n    var filteredFields = [\"label\", \"discountMethod\", \"discount\"];\n    var noDataMessage = i18next.t(\"admin.settings.noCustomDiscountRatesFound\");\n    var instance = Template.instance(); //\n    // helper to get and select row from griddle\n    // into blaze for to select discount row for editing\n    //\n\n    function editRow(options) {\n      var currentId = instance.state.get(\"editingId\"); // isEditing is discount rate object\n\n      instance.state.set(\"isEditing\", options.props.data);\n      instance.state.set(\"editingId\", options.props.data._id); // toggle edit mode clicking on same row\n\n      if (currentId === options.props.data._id) {\n        instance.state.set(\"isEditing\", null);\n        instance.state.set(\"editingId\", null);\n      }\n    } //\n    // helper adds a class to every grid row\n    //\n\n\n    var customRowMetaData = {\n      bodyCssClassName: function () {\n        return \"discount-rates-grid-row\";\n      }\n    }; // add i18n handling to headers\n\n    var customColumnMetadata = [];\n    filteredFields.forEach(function (field) {\n      var columnMeta = {\n        accessor: field,\n        Header: i18next.t(\"admin.discountGrid.\" + field)\n      };\n      customColumnMetadata.push(columnMeta);\n    }); // return discount Grid\n\n    return {\n      component: SortableTable,\n      publication: \"DiscountRates\",\n      collection: DiscountRates,\n      matchingResultsCount: \"discounts-count\",\n      showFilter: true,\n      rowMetadata: customRowMetaData,\n      filteredFields: filteredFields,\n      columns: filteredFields,\n      noDataMessage: noDataMessage,\n      onRowClick: editRow,\n      columnMetadata: customColumnMetadata,\n      externalLoadingComponent: Loading\n    };\n  },\n  instance: function () {\n    var instance = Template.instance();\n    return instance;\n  },\n  // schema for forms\n  discountRateSchema: function () {\n    return DiscountRateSchema;\n  },\n  discountRate: function () {\n    var instance = Template.instance();\n    var id = instance.state.get(\"editingId\");\n    var discount = DiscountRates.findOne(id) || {};\n    return discount;\n  }\n}); //\n// on submit lets clear the form state\n//\n\nTemplate.customDiscountRates.events({\n  \"submit #discount-rates-update-form\": function () {\n    var instance = Template.instance();\n    instance.state.set({\n      isEditing: false,\n      editingId: null\n    });\n  },\n  \"submit #discount-rates-insert-form\": function () {\n    var instance = Template.instance();\n    instance.state.set({\n      isEditing: true,\n      editingId: null\n    });\n  },\n  \"click .cancel, .discount-rates-grid-row.active\": function () {\n    var instance = Template.instance(); // remove active rows from grid\n\n    instance.state.set({\n      isEditing: false,\n      editingId: null\n    }); // ugly hack\n\n    $(\".discount-rates-grid-row\").removeClass(\"active\");\n  },\n  \"click .delete\": function () {\n    var confirmTitle = i18next.t(\"admin.settings.confirmRateDelete\");\n    var confirmButtonText = i18next.t(\"app.delete\");\n    var instance = Template.instance();\n    var id = instance.state.get(\"editingId\"); // confirm delete\n\n    Alerts.alert({\n      title: confirmTitle,\n      type: \"warning\",\n      showCancelButton: true,\n      confirmButtonText: confirmButtonText\n    }, function (isConfirm) {\n      if (isConfirm) {\n        if (id) {\n          Meteor.call(\"discounts/deleteRate\", id);\n          instance.state.set({\n            isEditing: false,\n            editingId: null\n          });\n        }\n      }\n    });\n  },\n  \"click .discount-rates-grid-row\": function (event) {\n    // toggle all rows off, then add our active row\n    $(\".discount-rates-grid-row\").removeClass(\"active\");\n    Template.instance().$(event.currentTarget).addClass(\"active\");\n  }\n});\nAutoForm.hooks({\n  \"discount-rates-update-form\": {\n    onSuccess: function () {\n      return Alerts.toast(i18next.t(\"admin.settings.settingsSaveSuccess\"), \"success\");\n    },\n    onError: function (operation, error) {\n      return Alerts.toast(i18next.t(\"admin.settings.settingsSaveFailure\") + \" \" + error, \"error\");\n    }\n  }\n});\nAutoForm.hooks({\n  \"discount-rates-insert-form\": {\n    onSuccess: function () {\n      return Alerts.toast(i18next.t(\"admin.settings.settingsSaveSuccess\"), \"success\");\n    },\n    onError: function (operation, error) {\n      return Alerts.toast(i18next.t(\"admin.settings.settingsSaveFailure\") + \" \" + error, \"error\");\n    }\n  }\n});","map":{"version":3,"sources":["imports/plugins/included/discount-rates/client/settings/rates.js"],"names":["Template","module","watch","require","v","ReactiveDict","$","Meteor","AutoForm","DiscountRates","DiscountRateSchema","i18next","IconButton","Loading","SortableTable","customDiscountRates","onCreated","autorun","subscribe","state","setDefault","isEditing","editingId","helpers","editButton","instance","equals","get","component","icon","onIcon","toggle","toggleOn","style","position","top","right","onClick","removeClass","set","discountGrid","filteredFields","noDataMessage","t","editRow","options","currentId","props","data","_id","customRowMetaData","bodyCssClassName","customColumnMetadata","forEach","field","columnMeta","accessor","Header","push","publication","collection","matchingResultsCount","showFilter","rowMetadata","columns","onRowClick","columnMetadata","externalLoadingComponent","discountRateSchema","discountRate","id","discount","findOne","events","confirmTitle","confirmButtonText","Alerts","alert","title","type","showCancelButton","isConfirm","call","event","currentTarget","addClass","hooks","onSuccess","toast","onError","operation","error"],"mappings":"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","sourcesContent":["import { Template } from \"meteor/templating\";\nimport { ReactiveDict } from \"meteor/reactive-dict\";\nimport { $ } from \"meteor/jquery\";\nimport { Meteor } from \"meteor/meteor\";\nimport { AutoForm } from \"meteor/aldeed:autoform\";\nimport { DiscountRates } from \"../collections/rates\";\nimport { DiscountRates as DiscountRateSchema } from \"../../lib/collections/schemas/rates\";\nimport { i18next } from \"/client/api\";\nimport { IconButton, Loading, SortableTable } from \"/imports/plugins/core/ui/client/components\";\n\n/* eslint no-shadow: [\"error\", { \"allow\": [\"options\"] }] */\n/* eslint no-unused-vars: [\"error\", { \"argsIgnorePattern\": \"[oO]ptions\" }] */\n\nTemplate.customDiscountRates.onCreated(function () {\n  this.autorun(() => {\n    this.subscribe(\"DiscountRates\");\n  });\n\n  this.state = new ReactiveDict();\n  this.state.setDefault({\n    isEditing: false,\n    editingId: null\n  });\n});\n\nTemplate.customDiscountRates.helpers({\n  editButton() {\n    const instance = Template.instance();\n    const { state } = instance;\n    const isEditing = state.equals(\"isEditing\", true);\n    let editingId = state.get(\"editingId\");\n    // toggle edit state\n    if (!isEditing) {\n      editingId = null;\n    }\n    // return icon\n    return {\n      component: IconButton,\n      icon: \"fa fa-plus\",\n      onIcon: \"fa fa-pencil\",\n      toggle: true,\n      toggleOn: isEditing,\n      style: {\n        position: \"relative\",\n        top: \"-25px\",\n        right: \"8px\"\n      },\n      onClick() {\n        // remove active rows from grid\n        $(\".discount-rates-grid-row\").removeClass(\"active\");\n        return state.set({\n          isEditing: !isEditing,\n          editingId\n        });\n      }\n    };\n  },\n  discountGrid() {\n    const filteredFields = [\"label\", \"discountMethod\", \"discount\"];\n    const noDataMessage = i18next.t(\"admin.settings.noCustomDiscountRatesFound\");\n    const instance = Template.instance();\n\n    //\n    // helper to get and select row from griddle\n    // into blaze for to select discount row for editing\n    //\n    function editRow(options) {\n      const currentId = instance.state.get(\"editingId\");\n      // isEditing is discount rate object\n      instance.state.set(\"isEditing\", options.props.data);\n      instance.state.set(\"editingId\", options.props.data._id);\n      // toggle edit mode clicking on same row\n      if (currentId === options.props.data._id) {\n        instance.state.set(\"isEditing\", null);\n        instance.state.set(\"editingId\", null);\n      }\n    }\n\n    //\n    // helper adds a class to every grid row\n    //\n    const customRowMetaData = {\n      bodyCssClassName: () => \"discount-rates-grid-row\"\n    };\n\n    // add i18n handling to headers\n    const customColumnMetadata = [];\n    filteredFields.forEach((field) => {\n      const columnMeta = {\n        accessor: field,\n        Header: i18next.t(`admin.discountGrid.${field}`)\n      };\n      customColumnMetadata.push(columnMeta);\n    });\n\n    // return discount Grid\n    return {\n      component: SortableTable,\n      publication: \"DiscountRates\",\n      collection: DiscountRates,\n      matchingResultsCount: \"discounts-count\",\n      showFilter: true,\n      rowMetadata: customRowMetaData,\n      filteredFields,\n      columns: filteredFields,\n      noDataMessage,\n      onRowClick: editRow,\n      columnMetadata: customColumnMetadata,\n      externalLoadingComponent: Loading\n    };\n  },\n\n  instance() {\n    const instance = Template.instance();\n    return instance;\n  },\n  // schema for forms\n  discountRateSchema() {\n    return DiscountRateSchema;\n  },\n  discountRate() {\n    const instance = Template.instance();\n    const id = instance.state.get(\"editingId\");\n    const discount = DiscountRates.findOne(id) || {};\n    return discount;\n  }\n});\n\n//\n// on submit lets clear the form state\n//\nTemplate.customDiscountRates.events({\n  \"submit #discount-rates-update-form\"() {\n    const instance = Template.instance();\n    instance.state.set({\n      isEditing: false,\n      editingId: null\n    });\n  },\n  \"submit #discount-rates-insert-form\"() {\n    const instance = Template.instance();\n    instance.state.set({\n      isEditing: true,\n      editingId: null\n    });\n  },\n  \"click .cancel, .discount-rates-grid-row.active\"() {\n    const instance = Template.instance();\n    // remove active rows from grid\n    instance.state.set({\n      isEditing: false,\n      editingId: null\n    });\n    // ugly hack\n    $(\".discount-rates-grid-row\").removeClass(\"active\");\n  },\n  \"click .delete\"() {\n    const confirmTitle = i18next.t(\"admin.settings.confirmRateDelete\");\n    const confirmButtonText = i18next.t(\"app.delete\");\n    const instance = Template.instance();\n    const id = instance.state.get(\"editingId\");\n    // confirm delete\n    Alerts.alert({\n      title: confirmTitle,\n      type: \"warning\",\n      showCancelButton: true,\n      confirmButtonText\n    }, (isConfirm) => {\n      if (isConfirm) {\n        if (id) {\n          Meteor.call(\"discounts/deleteRate\", id);\n          instance.state.set({\n            isEditing: false,\n            editingId: null\n          });\n        }\n      }\n    });\n  },\n  \"click .discount-rates-grid-row\"(event) {\n    // toggle all rows off, then add our active row\n    $(\".discount-rates-grid-row\").removeClass(\"active\");\n    Template.instance().$(event.currentTarget).addClass(\"active\");\n  }\n});\n\n\nAutoForm.hooks({\n  \"discount-rates-update-form\": {\n    onSuccess() {\n      return Alerts.toast(i18next.t(\"admin.settings.settingsSaveSuccess\"), \"success\");\n    },\n    onError(operation, error) {\n      return Alerts.toast(`${i18next.t(\"admin.settings.settingsSaveFailure\")} ${error}`, \"error\");\n    }\n  }\n});\n\nAutoForm.hooks({\n  \"discount-rates-insert-form\": {\n    onSuccess() {\n      return Alerts.toast(i18next.t(\"admin.settings.settingsSaveSuccess\"), \"success\");\n    },\n    onError(operation, error) {\n      return Alerts.toast(`${i18next.t(\"admin.settings.settingsSaveFailure\")} ${error}`, \"error\");\n    }\n  }\n});\n"]},"sourceType":"script","hash":"cddd4d44bc03ecc7fbb9c4313d9aac39d31d384f"}
