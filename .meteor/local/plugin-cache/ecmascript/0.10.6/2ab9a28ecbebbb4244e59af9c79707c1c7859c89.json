{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/core/revisions/client/containers/publishContainer.js","filename":"imports/plugins/core/revisions/client/containers/publishContainer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/core/revisions/client/containers/publishContainer.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/core/revisions/client/containers/publishContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/core/revisions/client/containers/publishContainer.js"}},"code":"var _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 0);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 1);\nvar composeWithTracker;\nmodule.watch(require(\"../../../components/lib\"), {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 2);\nvar PublishControls;\nmodule.watch(require(\"../components/publishControls\"), {\n  \"default\": function (v) {\n    PublishControls = v;\n  }\n}, 3);\nvar Revisions;\nmodule.watch(require(\"../../../../../../lib/collections\"), {\n  Revisions: function (v) {\n    Revisions = v;\n  }\n}, 4);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 5);\nvar TranslationProvider;\nmodule.watch(require(\"../../../ui/client/providers/translationProvider\"), {\n  \"default\": function (v) {\n    TranslationProvider = v;\n  }\n}, 6);\nvar isRevisionControlEnabled;\nmodule.watch(require(\"../../lib/api\"), {\n  isRevisionControlEnabled: function (v) {\n    isRevisionControlEnabled = v;\n  }\n}, 7);\nvar Reaction, i18next;\nmodule.watch(require(\"../../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 8);\n\n/*\n * PublishContainer is a container component connected to Meteor data source.\n */\nvar PublishContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inheritsLoose2.default)(PublishContainer, _Component);\n\n  function PublishContainer() {\n    var _temp, _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return (_temp = _this = _Component.call.apply(_Component, [this].concat(args)) || this, _this.handlePublishClick = function (revisions) {\n      var productIds = _this.props.documents.filter(function (doc) {\n        return doc.type === \"simple\";\n      }).map(function (doc) {\n        return doc._id;\n      });\n\n      if (Array.isArray(revisions) && revisions.length) {\n        var documentIds = revisions.map(function (revision) {\n          if (revision.parentDocument && revision.documentType !== \"product\") {\n            return revision.parentDocument;\n          }\n\n          return revision.documentId;\n        });\n        var documentIdsSet = new Set(documentIds); // ensures they are unique\n\n        documentIds = Array.from(documentIdsSet);\n        Meteor.call(\"revisions/publish\", documentIds, function (error, result) {\n          if (result && result.status === \"success\") {\n            var message = i18next.t(\"revisions.changedPublished\", {\n              defaultValue: \"Changes published successfully\"\n            });\n            Alerts.toast(message, \"success\");\n\n            if (_this.props.onPublishSuccess) {\n              _this.props.onPublishSuccess(result);\n            } // Publish to catalog after revisions have been published\n\n\n            _this.publishToCatalog(\"products\", productIds);\n          } else {\n            Alerts.toast(error && error.message || result && result.status || i18next.t(\"app.error\"), \"error\");\n          }\n        });\n      } else {\n        // Publish to catalog immediately if there are no revisions to publish beforehand\n        _this.publishToCatalog(\"products\", productIds);\n      }\n    }, _this.handlePublishActions = function (event, action, documentIds) {\n      switch (action) {\n        case \"archive\":\n          if (_this.props.onAction) {\n            _this.props.onAction(event, action, _this.props.documentIds);\n          }\n\n          break;\n\n        case \"discard\":\n          Meteor.call(\"revisions/discard\", documentIds, function (error, result) {\n            if (result === true) {\n              var message = i18next.t(\"revisions.changesDiscarded\", {\n                defaultValue: \"Changes discarded successfully\"\n              });\n              Alerts.toast(message, \"success\");\n            } else {\n              var _message = i18next.t(\"revisions.noChangesDiscarded\", {\n                defaultValue: \"There are no changes to discard\"\n              });\n\n              Alerts.toast(_message, \"warning\");\n            }\n          });\n          break;\n\n        default:\n      }\n    }, _temp) || (0, _assertThisInitialized2.default)(_this);\n  }\n\n  var _proto = PublishContainer.prototype;\n\n  _proto.publishToCatalog = function () {\n    function publishToCatalog(collection, documentIds) {\n      Meteor.call(\"catalog/publish/\" + collection, documentIds, function (error, result) {\n        if (result) {\n          Alerts.toast(i18next.t(\"admin.catalogProductPublishSuccess\", {\n            defaultValue: \"Product published to catalog\"\n          }), \"success\");\n        } else if (error) {\n          Alerts.toast(error.message, \"error\");\n        }\n      });\n    }\n\n    return publishToCatalog;\n  }();\n\n  _proto.render = function () {\n    function render() {\n      return React.createElement(TranslationProvider, null, React.createElement(PublishControls, {\n        documentIds: this.props.documentIds,\n        documents: this.props.documents,\n        isEnabled: this.props.isEnabled,\n        onPublishClick: this.handlePublishClick,\n        onAction: this.handlePublishActions,\n        onVisibilityChange: this.props.onVisibilityChange,\n        revisions: this.props.revisions,\n        isPreview: this.props.isPreview\n      }));\n    }\n\n    return render;\n  }();\n\n  return PublishContainer;\n}(Component);\n\nPublishContainer.propTypes = {\n  documentIds: PropTypes.arrayOf(PropTypes.string),\n  documents: PropTypes.arrayOf(PropTypes.object),\n  isEnabled: PropTypes.bool,\n  isPreview: PropTypes.bool,\n  onAction: PropTypes.func,\n  onPublishSuccess: PropTypes.func,\n  onVisibilityChange: PropTypes.func,\n  product: PropTypes.object,\n  revisions: PropTypes.arrayOf(PropTypes.object)\n};\n\nfunction composer(props, onData) {\n  var viewAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n\n  if (Array.isArray(props.documentIds) && props.documentIds.length) {\n    var subscription = Meteor.subscribe(\"ProductRevisions\", props.documentIds);\n\n    if (subscription.ready()) {\n      var revisions = Revisions.find({\n        \"$or\": [{\n          documentId: {\n            $in: props.documentIds\n          }\n        }, {\n          \"documentData.ancestors\": {\n            $in: props.documentIds\n          }\n        }, {\n          parentDocument: {\n            $in: props.documentIds\n          }\n        }],\n        \"workflow.status\": {\n          $nin: [\"revision/published\"]\n        }\n      }).fetch();\n      onData(null, {\n        isEnabled: isRevisionControlEnabled(),\n        documentIds: props.documentIds,\n        documents: props.documents,\n        revisions: revisions,\n        isPreview: viewAs === \"customer\"\n      });\n      return;\n    }\n  }\n\n  onData(null, {\n    isEnabled: isRevisionControlEnabled(),\n    isPreview: viewAs === \"customer\"\n  });\n}\n\nmodule.exportDefault(composeWithTracker(composer)(PublishContainer));","map":{"version":3,"sources":["imports/plugins/core/revisions/client/containers/publishContainer.js"],"names":["React","Component","module","watch","require","v","PropTypes","composeWithTracker","PublishControls","Revisions","Meteor","TranslationProvider","isRevisionControlEnabled","Reaction","i18next","PublishContainer","handlePublishClick","revisions","productIds","props","documents","filter","doc","type","map","_id","Array","isArray","length","documentIds","revision","parentDocument","documentType","documentId","documentIdsSet","Set","from","call","error","result","status","message","t","defaultValue","Alerts","toast","onPublishSuccess","publishToCatalog","handlePublishActions","event","action","onAction","collection","render","isEnabled","onVisibilityChange","isPreview","propTypes","arrayOf","string","object","bool","func","product","composer","onData","viewAs","getUserPreferences","subscription","subscribe","ready","find","$in","$nin","fetch","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport PublishControls from \"../components/publishControls\";\nimport { Revisions } from \"/lib/collections\";\nimport { Meteor } from \"meteor/meteor\";\nimport TranslationProvider from \"/imports/plugins/core/ui/client/providers/translationProvider\";\nimport { isRevisionControlEnabled } from \"../../lib/api\";\nimport { Reaction, i18next } from \"/client/api\";\n\n/*\n * PublishContainer is a container component connected to Meteor data source.\n */\nclass PublishContainer extends Component {\n  publishToCatalog(collection, documentIds) {\n    Meteor.call(`catalog/publish/${collection}`, documentIds, (error, result) => {\n      if (result) {\n        Alerts.toast(i18next.t(\"admin.catalogProductPublishSuccess\", { defaultValue: \"Product published to catalog\" }), \"success\");\n      } else if (error) {\n        Alerts.toast(error.message, \"error\");\n      }\n    });\n  }\n\n  handlePublishClick = (revisions) => {\n    const productIds = this.props.documents\n      .filter((doc) => doc.type === \"simple\")\n      .map((doc) => doc._id);\n\n    if (Array.isArray(revisions) && revisions.length) {\n      let documentIds = revisions.map((revision) => {\n        if (revision.parentDocument && revision.documentType !== \"product\") {\n          return revision.parentDocument;\n        }\n        return revision.documentId;\n      });\n\n      const documentIdsSet = new Set(documentIds); // ensures they are unique\n      documentIds = Array.from(documentIdsSet);\n      Meteor.call(\"revisions/publish\", documentIds, (error, result) => {\n        if (result && result.status === \"success\") {\n          const message = i18next.t(\"revisions.changedPublished\", {\n            defaultValue: \"Changes published successfully\"\n          });\n          Alerts.toast(message, \"success\");\n\n          if (this.props.onPublishSuccess) {\n            this.props.onPublishSuccess(result);\n          }\n\n          // Publish to catalog after revisions have been published\n          this.publishToCatalog(\"products\", productIds);\n        } else {\n          Alerts.toast((error && error.message) || (result && result.status) || i18next.t(\"app.error\"), \"error\");\n        }\n      });\n    } else {\n      // Publish to catalog immediately if there are no revisions to publish beforehand\n      this.publishToCatalog(\"products\", productIds);\n    }\n  }\n\n  handlePublishActions = (event, action, documentIds) => {\n    switch (action) {\n      case \"archive\":\n        if (this.props.onAction) {\n          this.props.onAction(event, action, this.props.documentIds);\n        }\n        break;\n      case \"discard\":\n        Meteor.call(\"revisions/discard\", documentIds, (error, result) => {\n          if (result === true) {\n            const message = i18next.t(\"revisions.changesDiscarded\", {\n              defaultValue: \"Changes discarded successfully\"\n            });\n\n            Alerts.toast(message, \"success\");\n          } else {\n            const message = i18next.t(\"revisions.noChangesDiscarded\", {\n              defaultValue: \"There are no changes to discard\"\n            });\n\n            Alerts.toast(message, \"warning\");\n          }\n        });\n        break;\n      default:\n    }\n  }\n\n  render() {\n    return (\n      <TranslationProvider>\n        <PublishControls\n          documentIds={this.props.documentIds}\n          documents={this.props.documents}\n          isEnabled={this.props.isEnabled}\n          onPublishClick={this.handlePublishClick}\n          onAction={this.handlePublishActions}\n          onVisibilityChange={this.props.onVisibilityChange}\n          revisions={this.props.revisions}\n          isPreview={this.props.isPreview}\n        />\n      </TranslationProvider>\n    );\n  }\n}\n\nPublishContainer.propTypes = {\n  documentIds: PropTypes.arrayOf(PropTypes.string),\n  documents: PropTypes.arrayOf(PropTypes.object),\n  isEnabled: PropTypes.bool,\n  isPreview: PropTypes.bool,\n  onAction: PropTypes.func,\n  onPublishSuccess: PropTypes.func,\n  onVisibilityChange: PropTypes.func,\n  product: PropTypes.object,\n  revisions: PropTypes.arrayOf(PropTypes.object)\n};\n\nfunction composer(props, onData) {\n  const viewAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n\n  if (Array.isArray(props.documentIds) && props.documentIds.length) {\n    const subscription = Meteor.subscribe(\"ProductRevisions\", props.documentIds);\n\n    if (subscription.ready()) {\n      const revisions = Revisions.find({\n        \"$or\": [\n          {\n            documentId: {\n              $in: props.documentIds\n            }\n          },\n          {\n            \"documentData.ancestors\": {\n              $in: props.documentIds\n            }\n          },\n          {\n            parentDocument: {\n              $in: props.documentIds\n            }\n          }\n        ],\n        \"workflow.status\": {\n          $nin: [\n            \"revision/published\"\n          ]\n        }\n      }).fetch();\n\n      onData(null, {\n        isEnabled: isRevisionControlEnabled(),\n        documentIds: props.documentIds,\n        documents: props.documents,\n        revisions,\n        isPreview: viewAs === \"customer\"\n      });\n\n      return;\n    }\n  }\n\n  onData(null, {\n    isEnabled: isRevisionControlEnabled(),\n    isPreview: viewAs === \"customer\"\n  });\n}\n\nexport default composeWithTracker(composer)(PublishContainer);\n"]},"sourceType":"script","hash":"2ab9a28ecbebbb4244e59af9c79707c1c7859c89"}
