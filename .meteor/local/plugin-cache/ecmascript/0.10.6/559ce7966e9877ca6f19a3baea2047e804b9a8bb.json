{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/connectors-shopify/client/settings/shopify.js","filename":"imports/plugins/included/connectors-shopify/client/settings/shopify.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/connectors-shopify/client/settings/shopify.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/connectors-shopify/client/settings/shopify.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/connectors-shopify/client/settings/shopify.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar AutoForm;\nmodule.watch(require(\"meteor/aldeed:autoform\"), {\n  AutoForm: function (v) {\n    AutoForm = v;\n  }\n}, 1);\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 2);\nvar $;\nmodule.watch(require(\"meteor/jquery\"), {\n  $: function (v) {\n    $ = v;\n  }\n}, 3);\nvar Reaction, Router, i18next;\nmodule.watch(require(\"/client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  Router: function (v) {\n    Router = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 4);\nvar Packages, Shops;\nmodule.watch(require(\"/lib/collections\"), {\n  Packages: function (v) {\n    Packages = v;\n  },\n  Shops: function (v) {\n    Shops = v;\n  }\n}, 5);\nvar ShopifyConnectPackageConfig;\nmodule.watch(require(\"../../lib/collections/schemas\"), {\n  ShopifyConnectPackageConfig: function (v) {\n    ShopifyConnectPackageConfig = v;\n  }\n}, 6);\nmodule.watch(require(\"./shopify.less\"));\nmodule.watch(require(\"./shopify.html\"));\nTemplate.shopifyConnectSettings.helpers({\n  packageData: function () {\n    return Packages.findOne({\n      name: \"reaction-connectors-shopify\",\n      shopId: Reaction.getShopId()\n    });\n  },\n  ShopifyConnectPackageConfig: function () {\n    return ShopifyConnectPackageConfig;\n  }\n});\nTemplate.shopifyImport.events({\n  \"click [data-event-action=importDataFromShopify]\": function (event) {\n    event.preventDefault();\n\n    if ($(\"#shopifyCheckboxCustomers\").is(\":checked\") || $(\"#shopifyCheckboxProducts\").is(\":checked\")) {\n      $(event.currentTarget).html(\"<i class='fa fa-circle-o-notch fa-spin'></i> \" + i18next.t(\"admin.shopifyConnectSettings.importing\"));\n      event.currentTarget.disabled = true;\n    } // If this is the primary shop, redirect to index\n\n\n    if (Reaction.getShopId() === Reaction.getPrimaryShopId()) {\n      Router.go(\"index\");\n    } else {\n      var shopId = Reaction.getShopId();\n      var shop = Shops.findOne({\n        _id: shopId\n      }); // Check to see if this shop has a slug, otherwise direct to shopId route\n\n      if (shop && shop.slug) {\n        Router.go(\"/shop/\" + shop.slug);\n      } else {\n        Router.go(\"/shop/\" + shopId);\n      }\n    } // If no option is selected, return error asking user to select type of import\n\n\n    if (!$(\"#shopifyCheckboxCustomers\").is(\":checked\") && !$(\"#shopifyCheckboxProducts\").is(\":checked\")) {\n      return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.chooseImportType\"), \"error\");\n    } // TODO transform these Meteor calls to jobs like we do for the products images\n    // we got customers checkbox checked ? if yes then download customers\n\n\n    if ($(\"#shopifyCheckboxCustomers\").is(\":checked\")) {\n      Meteor.call(\"connectors/shopify/import/customers\", function (err) {\n        $(event.currentTarget).html(\"\\n            <i class='fa fa-cloud-download'></i> \" + i18next.t(\"admin.shopifyConnectSettings.startImport\"));\n        event.currentTarget.disabled = false;\n\n        if (!err) {\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.importSuccess\"), \"success\");\n        }\n\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.importFailed\") + \": \" + err, \"error\");\n      });\n    } // we got products checkbox checked ? if yes then download products\n\n\n    if ($(\"#shopifyCheckboxProducts\").is(\":checked\")) {\n      Meteor.call(\"connectors/shopify/import/products\", function (err) {\n        $(event.currentTarget).html(\"\\n            <i class='fa fa-cloud-download'></i> \" + i18next.t(\"admin.shopifyConnectSettings.startImport\"));\n        event.currentTarget.disabled = false;\n\n        if (!err) {\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.importSuccess\"), \"success\");\n        }\n\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.importFailed\") + \": \" + err, \"error\");\n      });\n    }\n  }\n});\nTemplate.shopifySync.helpers({\n  activeWebhooks: function () {\n    var pkg = Packages.findOne({\n      name: \"reaction-connectors-shopify\",\n      shopId: Reaction.getShopId()\n    });\n\n    if (pkg && pkg.settings && Array.isArray(pkg.settings.webhooks) && pkg.settings.webhooks.length > 0) {\n      return true;\n    }\n\n    return false;\n  },\n  integrationIsActive: function (integration) {\n    var _Reaction$getPackageS = Reaction.getPackageSettings(\"reaction-connectors-shopify\"),\n        settings = _Reaction$getPackageS.settings; // If this package has webhooks, determine if there is a match for the `integration` passed in as an arg\n\n\n    if (settings && Array.isArray(settings.webhooks) && settings.webhooks.length > 0) {\n      var integrations = settings.webhooks.reduce(function (integrationsArray, webhook) {\n        // if this webhook doesn't have any integrations, skip it.\n        if (!Array.isArray(webhook.integrations)) {\n          return integrationsArray;\n        } // initialize with first webhook's integrations array\n\n\n        if (!integrationsArray) {\n          return webhook.integrations;\n        } // Append integrations to integrations array - not unique, but don't really care\n\n\n        return (0, _toConsumableArray2.default)(integrationsArray).concat((0, _toConsumableArray2.default)(webhook.integrations));\n      }, null); // Return \"checked\" if we found the integration, empty string otherwise\n\n      return integrations.indexOf(integration) !== -1 ? \"checked\" : \"\";\n    } // If no webhooks are found, this integration is inactive\n\n\n    return \"\";\n  },\n  currentDomain: function () {\n    var _Reaction$getPackageS2 = Reaction.getPackageSettings(\"reaction-connectors-shopify\"),\n        settings = _Reaction$getPackageS2.settings;\n\n    return settings.webhooksDomain || Meteor.absoluteUrl();\n  },\n  hookIsActive: function (hook) {\n    var _Reaction$getPackageS3 = Reaction.getPackageSettings(\"reaction-connectors-shopify\"),\n        settings = _Reaction$getPackageS3.settings;\n\n    var synchooks = settings.synchooks;\n\n    if (synchooks) {\n      var _hook$split = hook.split(\":\"),\n          _hook$split2 = (0, _slicedToArray2.default)(_hook$split, 3),\n          topic = _hook$split2[0],\n          _event = _hook$split2[1],\n          syncType = _hook$split2[2];\n\n      var matchingHooks = synchooks.filter(function (synchook) {\n        return synchook.topic === topic && synchook.event === _event && synchook.syncType === syncType;\n      });\n\n      if (matchingHooks.length > 0) {\n        return \"checked\";\n      }\n    }\n\n    return \"\";\n  }\n});\nTemplate.shopifySync.events({\n  \"submit [data-event-action=setupShopifySync]\": function (event) {\n    event.preventDefault(); // Don't permit default form submission behavior\n\n    var _Reaction$getPackageS4 = Reaction.getPackageSettings(\"reaction-connectors-shopify\"),\n        settings = _Reaction$getPackageS4.settings; // Our event target is the form we submitted\n\n\n    var form = event.target; // Get all selected options\n\n    var selectedOptionsNodeList = form.querySelectorAll('input[type=\"checkbox\"]:checked');\n    var webhooksDomain = document.getElementsByName(\"webhooksDomain\")[0].value;\n\n    if (!webhooksDomain) {\n      return Alerts.toast(\"\" + i18next.t(\"admin.shopifyConnectSettings.noDomainSelected\"), \"warning\");\n    }\n\n    if (settings.webhooksDomain !== webhooksDomain) {\n      settings.webhooksDomain = webhooksDomain;\n      Meteor.call(\"package/update\", \"reaction-connectors-shopify\", \"settings\", settings);\n    } // Create options array\n    // - create an array from the nodelist of checkboxes\n    // - map names from checkbox's html name into array\n    // - options should be in the form topic:integration\n    // - e.g. orders/create:updateInventory\n\n\n    var integrations = Array.from(selectedOptionsNodeList).map(function (integration) {\n      return integration.name;\n    }); // If there's at least one option\n\n    if (integrations && Array.isArray(integrations) && integrations.length > 0) {\n      // setup sync with provided integrations\n      return Meteor.call(\"connectors/shopify/sync/setup\", integrations, webhooksDomain, function (err) {\n        if (!err) {\n          // If there is no error, notify of success\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncSetupSuccess\"), \"success\");\n        } // Notify setup sync error if an error is returned\n\n\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncSetupFailure\"), \"error\");\n      });\n    } // If no options selected, warn user\n\n\n    return Alerts.toast(\"\" + i18next.t(\"admin.shopifyConnectSettings.noSyncIntegrationsSelected\"), \"warning\");\n  },\n  \"click [data-event-action=stopShopifySync]\": function () {\n    // setup sync with provided integrations\n    return Meteor.call(\"connectors/shopify/sync/teardown\", function (err) {\n      if (!err) {\n        // If there is no error, notify of success\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncStopSuccess\"), \"success\");\n      } // Notify setup sync error if an error is returned\n\n\n      return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncStopFailure\"), \"error\");\n    });\n  },\n  \"submit [data-event-action=setupShopifyHooks]\": function (formEvent) {\n    event.preventDefault();\n    var form = formEvent.target;\n    var optionsNodeList = form.querySelectorAll('input[type=\"checkbox\"]');\n    var optionsList = Array.from(optionsNodeList).map(function (hook) {\n      return {\n        name: hook.name,\n        checked: hook.checked\n      };\n    });\n    optionsList.forEach(function (node) {\n      if (node.checked) {\n        Meteor.call(\"synchooks/shopify/addHook\", node, function (error) {\n          if (!error) {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupSuccess\"), \"success\");\n          } else {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupFailure\"), \"error\");\n          }\n        });\n      } else {\n        Meteor.call(\"synchooks/shopify/removeHook\", node, function (error) {\n          if (!error) {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupSuccess\"), \"success\");\n          } else {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupFailure\"), \"error\");\n          }\n        });\n      }\n    });\n  }\n});\nAutoForm.hooks({\n  \"shopify-connect-update-form\": {\n    onSuccess: function () {\n      Meteor.call(\"connectors/shopify/api/credentials/test\", function (err, isValid) {\n        if (isValid) {\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.validCredentials\"), \"Valid API key and password\");\n        }\n\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.invalidCredentials\", \"Invalid API key/password\"), \"error\");\n      });\n    },\n    onError: function (error) {\n      return Alerts.toast(i18next.t(\"admin.settings.saveFailed\") + \" \" + error, \"error\");\n    }\n  }\n});","map":{"version":3,"sources":["imports/plugins/included/connectors-shopify/client/settings/shopify.js"],"names":["Meteor","module","watch","require","v","AutoForm","Template","$","Reaction","Router","i18next","Packages","Shops","ShopifyConnectPackageConfig","shopifyConnectSettings","helpers","packageData","findOne","name","shopId","getShopId","shopifyImport","events","event","preventDefault","is","currentTarget","html","t","disabled","getPrimaryShopId","go","shop","_id","slug","Alerts","toast","call","err","shopifySync","activeWebhooks","pkg","settings","Array","isArray","webhooks","length","integrationIsActive","integration","getPackageSettings","integrations","reduce","integrationsArray","webhook","indexOf","currentDomain","webhooksDomain","absoluteUrl","hookIsActive","hook","synchooks","split","topic","syncType","matchingHooks","filter","synchook","form","target","selectedOptionsNodeList","querySelectorAll","document","getElementsByName","value","from","map","formEvent","optionsNodeList","optionsList","checked","forEach","node","error","hooks","onSuccess","isValid","onError"],"mappings":"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","sourcesContent":["import { Meteor } from \"meteor/meteor\";\nimport { AutoForm } from \"meteor/aldeed:autoform\";\nimport { Template } from \"meteor/templating\";\nimport { $ } from \"meteor/jquery\";\nimport { Reaction, Router, i18next } from \"/client/api\";\nimport { Packages, Shops } from \"/lib/collections\";\nimport { ShopifyConnectPackageConfig } from \"../../lib/collections/schemas\";\nimport \"./shopify.less\";\nimport \"./shopify.html\";\n\nTemplate.shopifyConnectSettings.helpers({\n  packageData() {\n    return Packages.findOne({\n      name: \"reaction-connectors-shopify\",\n      shopId: Reaction.getShopId()\n    });\n  },\n  ShopifyConnectPackageConfig() {\n    return ShopifyConnectPackageConfig;\n  }\n});\n\nTemplate.shopifyImport.events({\n  \"click [data-event-action=importDataFromShopify]\"(event) {\n    event.preventDefault();\n\n    if ($(\"#shopifyCheckboxCustomers\").is(\":checked\") || $(\"#shopifyCheckboxProducts\").is(\":checked\")) {\n      $(event.currentTarget).html(`<i class='fa fa-circle-o-notch fa-spin'></i> ${i18next.t(\"admin.shopifyConnectSettings.importing\")}`);\n      event.currentTarget.disabled = true;\n    }\n\n    // If this is the primary shop, redirect to index\n    if (Reaction.getShopId() === Reaction.getPrimaryShopId()) {\n      Router.go(\"index\");\n    } else {\n      const shopId = Reaction.getShopId();\n      const shop = Shops.findOne({ _id: shopId });\n\n      // Check to see if this shop has a slug, otherwise direct to shopId route\n      if (shop && shop.slug) {\n        Router.go(`/shop/${shop.slug}`);\n      } else {\n        Router.go(`/shop/${shopId}`);\n      }\n    }\n\n    // If no option is selected, return error asking user to select type of import\n    if (!$(\"#shopifyCheckboxCustomers\").is(\":checked\") && !$(\"#shopifyCheckboxProducts\").is(\":checked\")) {\n      return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.chooseImportType\"), \"error\");\n    }\n    // TODO transform these Meteor calls to jobs like we do for the products images\n    // we got customers checkbox checked ? if yes then download customers\n    if ($(\"#shopifyCheckboxCustomers\").is(\":checked\")) {\n      Meteor.call(\"connectors/shopify/import/customers\", (err) => {\n        $(event.currentTarget).html(`\n            <i class='fa fa-cloud-download'></i> ${i18next.t(\"admin.shopifyConnectSettings.startImport\")}`);\n        event.currentTarget.disabled = false;\n\n        if (!err) {\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.importSuccess\"), \"success\");\n        }\n        return Alerts.toast(`${i18next.t(\"admin.shopifyConnectSettings.importFailed\")}: ${err}`, \"error\");\n      });\n    }\n    // we got products checkbox checked ? if yes then download products\n    if ($(\"#shopifyCheckboxProducts\").is(\":checked\")) {\n      Meteor.call(\"connectors/shopify/import/products\", (err) => {\n        $(event.currentTarget).html(`\n            <i class='fa fa-cloud-download'></i> ${i18next.t(\"admin.shopifyConnectSettings.startImport\")}`);\n        event.currentTarget.disabled = false;\n\n        if (!err) {\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.importSuccess\"), \"success\");\n        }\n        return Alerts.toast(`${i18next.t(\"admin.shopifyConnectSettings.importFailed\")}: ${err}`, \"error\");\n      });\n    }\n  }\n});\n\nTemplate.shopifySync.helpers({\n  activeWebhooks() {\n    const pkg = Packages.findOne({\n      name: \"reaction-connectors-shopify\",\n      shopId: Reaction.getShopId()\n    });\n\n    if (pkg && pkg.settings && Array.isArray(pkg.settings.webhooks) && pkg.settings.webhooks.length > 0) {\n      return true;\n    }\n    return false;\n  },\n\n  integrationIsActive(integration) {\n    const { settings } = Reaction.getPackageSettings(\"reaction-connectors-shopify\");\n    // If this package has webhooks, determine if there is a match for the `integration` passed in as an arg\n    if (settings && Array.isArray(settings.webhooks) && settings.webhooks.length > 0) {\n      const integrations = settings.webhooks.reduce((integrationsArray, webhook) => {\n        // if this webhook doesn't have any integrations, skip it.\n        if (!Array.isArray(webhook.integrations)) {\n          return integrationsArray;\n        }\n\n        // initialize with first webhook's integrations array\n        if (!integrationsArray) {\n          return webhook.integrations;\n        }\n\n        // Append integrations to integrations array - not unique, but don't really care\n        return [...integrationsArray, ...webhook.integrations];\n      }, null);\n\n      // Return \"checked\" if we found the integration, empty string otherwise\n      return integrations.indexOf(integration) !== -1 ? \"checked\" : \"\";\n    }\n\n    // If no webhooks are found, this integration is inactive\n    return \"\";\n  },\n\n  currentDomain() {\n    const { settings } = Reaction.getPackageSettings(\"reaction-connectors-shopify\");\n    return settings.webhooksDomain || Meteor.absoluteUrl();\n  },\n\n  hookIsActive(hook) {\n    const { settings } = Reaction.getPackageSettings(\"reaction-connectors-shopify\");\n    const { synchooks } = settings;\n    if (synchooks) {\n      const [topic, event, syncType] = hook.split(\":\");\n      const matchingHooks = synchooks.filter((synchook) => synchook.topic === topic && synchook.event === event && synchook.syncType === syncType);\n\n      if (matchingHooks.length > 0) {\n        return \"checked\";\n      }\n    }\n    return \"\";\n  }\n});\n\nTemplate.shopifySync.events({\n  \"submit [data-event-action=setupShopifySync]\"(event) {\n    event.preventDefault(); // Don't permit default form submission behavior\n\n    const { settings } = Reaction.getPackageSettings(\"reaction-connectors-shopify\");\n\n    // Our event target is the form we submitted\n    const form = event.target;\n\n    // Get all selected options\n    const selectedOptionsNodeList = form.querySelectorAll('input[type=\"checkbox\"]:checked');\n    const webhooksDomain = document.getElementsByName(\"webhooksDomain\")[0].value;\n\n    if (!webhooksDomain) {\n      return Alerts.toast(`${i18next.t(\"admin.shopifyConnectSettings.noDomainSelected\")}`, \"warning\");\n    }\n\n    if (settings.webhooksDomain !== webhooksDomain) {\n      settings.webhooksDomain = webhooksDomain;\n      Meteor.call(\"package/update\", \"reaction-connectors-shopify\", \"settings\", settings);\n    }\n\n    // Create options array\n    // - create an array from the nodelist of checkboxes\n    // - map names from checkbox's html name into array\n    // - options should be in the form topic:integration\n    // - e.g. orders/create:updateInventory\n    const integrations = Array.from(selectedOptionsNodeList).map((integration) => integration.name);\n    // If there's at least one option\n    if (integrations && Array.isArray(integrations) && integrations.length > 0) {\n      // setup sync with provided integrations\n      return Meteor.call(\"connectors/shopify/sync/setup\", integrations, webhooksDomain, (err) => {\n        if (!err) {\n          // If there is no error, notify of success\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncSetupSuccess\"), \"success\");\n        }\n        // Notify setup sync error if an error is returned\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncSetupFailure\"), \"error\");\n      });\n    }\n\n    // If no options selected, warn user\n    return Alerts.toast(`${i18next.t(\"admin.shopifyConnectSettings.noSyncIntegrationsSelected\")}`, \"warning\");\n  },\n  \"click [data-event-action=stopShopifySync]\"() {\n    // setup sync with provided integrations\n    return Meteor.call(\"connectors/shopify/sync/teardown\", (err) => {\n      if (!err) {\n        // If there is no error, notify of success\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncStopSuccess\"), \"success\");\n      }\n      // Notify setup sync error if an error is returned\n      return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.syncStopFailure\"), \"error\");\n    });\n  },\n\n  \"submit [data-event-action=setupShopifyHooks]\"(formEvent) {\n    event.preventDefault();\n    const form = formEvent.target;\n    const optionsNodeList = form.querySelectorAll('input[type=\"checkbox\"]');\n    const optionsList = Array.from(optionsNodeList).map((hook) => ({ name: hook.name, checked: hook.checked }));\n    optionsList.forEach((node) => {\n      if (node.checked) {\n        Meteor.call(\"synchooks/shopify/addHook\", node, (error) => {\n          if (!error) {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupSuccess\"), \"success\");\n          } else {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupFailure\"), \"error\");\n          }\n        });\n      } else {\n        Meteor.call(\"synchooks/shopify/removeHook\", node, (error) => {\n          if (!error) {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupSuccess\"), \"success\");\n          } else {\n            Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.hookSetupFailure\"), \"error\");\n          }\n        });\n      }\n    });\n  }\n});\n\nAutoForm.hooks({\n  \"shopify-connect-update-form\": {\n    onSuccess() {\n      Meteor.call(\"connectors/shopify/api/credentials/test\", (err, isValid) => {\n        if (isValid) {\n          return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.validCredentials\"), \"Valid API key and password\");\n        }\n        return Alerts.toast(i18next.t(\"admin.shopifyConnectSettings.invalidCredentials\", \"Invalid API key/password\"), \"error\");\n      });\n    },\n    onError(error) {\n      return Alerts.toast(`${i18next.t(\"admin.settings.saveFailed\")} ${error}`, \"error\");\n    }\n  }\n});\n"]},"sourceType":"script","hash":"559ce7966e9877ca6f19a3baea2047e804b9a8bb"}
