{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/core/accounts/client/templates/members/member.js","filename":"imports/plugins/core/accounts/client/templates/members/member.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/core/accounts/client/templates/members/member.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/core/accounts/client/templates/members/member.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/core/accounts/client/templates/members/member.js"}},"code":"var _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _get;\n\nmodule.watch(require(\"lodash/get\"), {\n  \"default\": function (v) {\n    _get = v;\n  }\n}, 0);\n\nvar _uniq;\n\nmodule.watch(require(\"lodash/uniq\"), {\n  \"default\": function (v) {\n    _uniq = v;\n  }\n}, 1);\n\nvar _each;\n\nmodule.watch(require(\"lodash/each\"), {\n  \"default\": function (v) {\n    _each = v;\n  }\n}, 2);\nvar Reaction;\nmodule.watch(require(\"../../../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 3);\nvar Packages, Shops;\nmodule.watch(require(\"../../../../../../../lib/collections\"), {\n  Packages: function (v) {\n    Packages = v;\n  },\n  Shops: function (v) {\n    Shops = v;\n  }\n}, 4);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 5);\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 6);\nvar $;\nmodule.watch(require(\"meteor/jquery\"), {\n  $: function (v) {\n    $ = v;\n  }\n}, 7);\nvar Roles;\nmodule.watch(require(\"meteor/alanning:roles\"), {\n  Roles: function (v) {\n    Roles = v;\n  }\n}, 8);\nvar AccountsDashboard;\nmodule.watch(require(\"../../containers/accountsDashboardContainer\"), {\n  \"default\": function (v) {\n    AccountsDashboard = v;\n  }\n}, 9);\nvar Components;\nmodule.watch(require(\"../../../../components/lib\"), {\n  Components: function (v) {\n    Components = v;\n  }\n}, 10);\n\nvar getPermissionMap = function (permissions) {\n  var permissionMap = {};\n\n  _each(permissions, function (existing) {\n    permissionMap[existing.permission] = existing.label;\n  });\n\n  return permissionMap;\n};\n/**\n * shopMember helpers\n * permissions / roles controls\n * we use userInRole instead of Reaction intentionally\n * to check each users permissions\n */\n\n\nTemplate.member.events({\n  \"click [data-event-action=showMemberSettings]\": function () {\n    $(\".customerUsageType input\").val(\"\"); // form reset\n\n    $(\".customerUsageType\").addClass(\"hide\"); // form reset\n\n    Reaction.setActionViewDetail({\n      label: \"Permissions\",\n      i18nKeyLabel: \"admin.settings.permissionsSettingsLabel\",\n      data: this,\n      template: \"memberSettings\"\n    });\n  }\n});\nTemplate.memberSettings.helpers({\n  isOwnerDisabled: function () {\n    if (Meteor.userId() === this.userId) {\n      if (Roles.userIsInRole(this.userId, \"owner\", this.shopId)) {\n        return true;\n      }\n    }\n  },\n  userId: function () {\n    return Meteor.userId();\n  },\n  hasPermissionChecked: function (permission, userId) {\n    if (userId && Roles.userIsInRole(userId, permission, this.shopId || Roles.userIsInRole(userId, permission, Roles.GLOBAL_GROUP))) {\n      return \"checked\";\n    }\n  },\n  groupsForUser: function (groupUserId) {\n    var userId = groupUserId || this.userId || Template.parentData(1).userId;\n    return Roles.getGroupsForUser(userId);\n  },\n  shopLabel: function (thisShopId) {\n    var shopId = thisShopId || Template.currentData();\n    var shop = Shops.findOne({\n      _id: shopId\n    });\n\n    if (shop && shop.name) {\n      return shop.name || \"Default Shop\";\n    }\n  },\n  permissionGroups: function (thisShopId) {\n    var permissionGroups = [];\n    var shopId = thisShopId || Template.currentData();\n    var packages = Packages.find({\n      shopId: shopId\n    });\n    packages.forEach(function (pkg) {\n      var permissions = [];\n\n      if (pkg.registry && pkg.enabled) {\n        for (var _iterator = pkg.registry, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n          var _ref;\n\n          if (_isArray) {\n            if (_i >= _iterator.length) break;\n            _ref = _iterator[_i++];\n          } else {\n            _i = _iterator.next();\n            if (_i.done) break;\n            _ref = _i.value;\n          }\n\n          var _registryItem = _ref;\n\n          // Skip entires with missing routes\n          if (!_registryItem.route) {\n            continue;\n          } // Get all permissions, add them to an array\n\n\n          if (_registryItem.permissions) {\n            for (var _iterator2 = _registryItem.permissions, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n              var _ref2;\n\n              if (_isArray2) {\n                if (_i2 >= _iterator2.length) break;\n                _ref2 = _iterator2[_i2++];\n              } else {\n                _i2 = _iterator2.next();\n                if (_i2.done) break;\n                _ref2 = _i2.value;\n              }\n\n              var _permission = _ref2;\n\n              // check needed because of non-object perms in the permissions array (e.g \"admin\", \"owner\")\n              if ((0, _typeof2.default)(_permission) === \"object\") {\n                _permission.shopId = shopId;\n                permissions.push(_permission);\n              }\n            }\n          } // Also create an object map of those same permissions as above\n\n\n          var permissionMap = getPermissionMap(permissions);\n\n          if (!permissionMap[_registryItem.route]) {\n            permissions.push({\n              shopId: pkg.shopId,\n              permission: _registryItem.name || pkg.name + \"/\" + _registryItem.template,\n              // launchdock-connect/connectDashboard\n              icon: _registryItem.icon,\n              label: _registryItem.label || _registryItem.provides || _registryItem.route\n            });\n          }\n        } // TODO review this, hardcoded WIP\n\n\n        var label = pkg.name.replace(\"reaction\", \"\").replace(/(-.)/g, function (x) {\n          return \" \" + x[1].toUpperCase();\n        });\n        return permissionGroups.push({\n          shopId: pkg.shopId,\n          icon: pkg.icon,\n          name: pkg.name,\n          label: label,\n          permissions: _uniq(permissions)\n        });\n      }\n    });\n    return permissionGroups;\n  },\n  hasManyPermissions: function (permissions) {\n    return Boolean(permissions.length);\n  },\n\n  /**\n   * showAvalaraTaxSettings\n   * @return {Boolean} True if avalara is enabled. Defaults to false if not found\n   */\n  showAvalaraTaxSettings: function () {\n    var avalara = Packages.findOne({\n      name: \"taxes-avalara\",\n      shopId: Reaction.getShopId()\n    });\n    return _get(avalara, \"settings.avalara.enabled\", false);\n  },\n  accountsDetail: function () {\n    return {\n      component: AccountsDashboard\n    };\n  },\n  ReactionAvatar: function () {\n    return {\n      component: Components.ReactionAvatar\n    };\n  }\n});\n/**\n * shopMember events\n *\n */\n\nTemplate.memberSettings.events({\n  \"change [data-event-action=toggleMemberPermission]\": function (event, template) {\n    var self = this;\n    var permissions = [];\n    var member = template.data;\n\n    if (!this.shopId) {\n      throw new Meteor.Error(\"invalid-parameter\", \"Shop is required\");\n    }\n\n    if (self.name) {\n      permissions.push(self.name);\n\n      for (var _iterator3 = self.permissions, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n        var _ref3;\n\n        if (_isArray3) {\n          if (_i3 >= _iterator3.length) break;\n          _ref3 = _iterator3[_i3++];\n        } else {\n          _i3 = _iterator3.next();\n          if (_i3.done) break;\n          _ref3 = _i3.value;\n        }\n\n        var _pkgPermissions = _ref3;\n        permissions.push(_pkgPermissions.permission);\n      }\n    } else {\n      permissions.push(self.permission);\n    }\n\n    if (Template.instance().$(event.currentTarget).is(\":checked\")) {\n      Meteor.call(\"accounts/addUserPermissions\", member.userId, permissions, this.shopId);\n    } else {\n      Meteor.call(\"accounts/removeUserPermissions\", member.userId, permissions, this.shopId);\n    }\n  },\n  \"click [data-event-action=resetMemberPermission]\": function (event, template) {\n    var $icon = Template.instance().$(event.currentTarget);\n\n    if (confirm($icon.data(\"confirm\"))) {\n      // eslint-disable-line no-alert\n      var results = [];\n\n      for (var _iterator4 = template.data.roles, _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n        var _ref4;\n\n        if (_isArray4) {\n          if (_i4 >= _iterator4.length) break;\n          _ref4 = _iterator4[_i4++];\n        } else {\n          _i4 = _iterator4.next();\n          if (_i4.done) break;\n          _ref4 = _i4.value;\n        }\n\n        var _role = _ref4;\n        results.push(Meteor.call(\"accounts/setUserPermissions\", this.userId, [\"guest\", \"account/profile\"], _role));\n      }\n\n      return results;\n    }\n  }\n});","map":{"version":3,"sources":["imports/plugins/core/accounts/client/templates/members/member.js"],"names":["_get","module","watch","require","v","_uniq","_each","Reaction","Packages","Shops","Meteor","Template","$","Roles","AccountsDashboard","Components","getPermissionMap","permissions","permissionMap","existing","permission","label","member","events","val","addClass","setActionViewDetail","i18nKeyLabel","data","template","memberSettings","helpers","isOwnerDisabled","userId","userIsInRole","shopId","hasPermissionChecked","GLOBAL_GROUP","groupsForUser","groupUserId","parentData","getGroupsForUser","shopLabel","thisShopId","currentData","shop","findOne","_id","name","permissionGroups","packages","find","forEach","pkg","registry","enabled","registryItem","route","push","icon","provides","replace","x","toUpperCase","hasManyPermissions","Boolean","length","showAvalaraTaxSettings","avalara","getShopId","accountsDetail","component","ReactionAvatar","event","self","Error","pkgPermissions","instance","currentTarget","is","call","$icon","confirm","results","roles","role"],"mappings":";;;;AAAA,IAAIA,IAAJ;;AAASC,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAAA,uBAASC,CAAT,EAAW;AAACJ,WAAKI,CAAL;AAAO;AAAnB,CAAnC,EAAwD,CAAxD;;AAA2D,IAAIC,KAAJ;;AAAUJ,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAAA,uBAASC,CAAT,EAAW;AAACC,YAAMD,CAAN;AAAQ;AAApB,CAApC,EAA0D,CAA1D;;AAA6D,IAAIE,KAAJ;;AAAUL,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAAA,uBAASC,CAAT,EAAW;AAACE,YAAMF,CAAN;AAAQ;AAApB,CAApC,EAA0D,CAA1D;AAA6D,IAAIG,QAAJ;AAAaN,OAAOC,KAAP,CAAaC,QAAQ,iCAAR,CAAb,EAAwD;AAACI,UAAD,YAAUH,CAAV,EAAY;AAACG,eAASH,CAAT;AAAW;AAAxB,CAAxD,EAAkF,CAAlF;AAAqF,IAAII,QAAJ,EAAaC,KAAb;AAAmBR,OAAOC,KAAP,CAAaC,QAAQ,sCAAR,CAAb,EAA6D;AAACK,UAAD,YAAUJ,CAAV,EAAY;AAACI,eAASJ,CAAT;AAAW,GAAxB;AAAyBK,OAAzB,YAA+BL,CAA/B,EAAiC;AAACK,YAAML,CAAN;AAAQ;AAA1C,CAA7D,EAAyG,CAAzG;AAA4G,IAAIM,MAAJ;AAAWT,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACO,QAAD,YAAQN,CAAR,EAAU;AAACM,aAAON,CAAP;AAAS;AAApB,CAAtC,EAA4D,CAA5D;AAA+D,IAAIO,QAAJ;AAAaV,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACQ,UAAD,YAAUP,CAAV,EAAY;AAACO,eAASP,CAAT;AAAW;AAAxB,CAA1C,EAAoE,CAApE;AAAuE,IAAIQ,CAAJ;AAAMX,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACS,GAAD,YAAGR,CAAH,EAAK;AAACQ,QAAER,CAAF;AAAI;AAAV,CAAtC,EAAkD,CAAlD;AAAqD,IAAIS,KAAJ;AAAUZ,OAAOC,KAAP,CAAaC,QAAQ,uBAAR,CAAb,EAA8C;AAACU,OAAD,YAAOT,CAAP,EAAS;AAACS,YAAMT,CAAN;AAAQ;AAAlB,CAA9C,EAAkE,CAAlE;AAAqE,IAAIU,iBAAJ;AAAsBb,OAAOC,KAAP,CAAaC,QAAQ,6CAAR,CAAb,EAAoE;AAAA,uBAASC,CAAT,EAAW;AAACU,wBAAkBV,CAAlB;AAAoB;AAAhC,CAApE,EAAsG,CAAtG;AAAyG,IAAIW,UAAJ;AAAed,OAAOC,KAAP,CAAaC,QAAQ,4BAAR,CAAb,EAAmD;AAACY,YAAD,YAAYX,CAAZ,EAAc;AAACW,iBAAWX,CAAX;AAAa;AAA5B,CAAnD,EAAiF,EAAjF;;AAUz2B,IAAMY,mBAAmB,UAACC,WAAD,EAAiB;AACxC,MAAMC,gBAAgB,EAAtB;;AACA,QAAOD,WAAP,EAAoB,UAACE,QAAD,EAAc;AAChCD,kBAAcC,SAASC,UAAvB,IAAqCD,SAASE,KAA9C;AACD,GAFD;;AAGA,SAAOH,aAAP;AACD,CAND;AAQA;;;;;;;;AAMAP,SAASW,MAAT,CAAgBC,MAAhB,CAAuB;AACrB,gDADqB,cAC4B;AAC/CX,MAAE,0BAAF,EAA8BY,GAA9B,CAAkC,EAAlC,EAD+C,CACR;;AACvCZ,MAAE,oBAAF,EAAwBa,QAAxB,CAAiC,MAAjC,EAF+C,CAEL;;AAC1ClB,aAASmB,mBAAT,CAA6B;AAC3BL,aAAO,aADoB;AAE3BM,oBAAc,yCAFa;AAG3BC,YAAM,IAHqB;AAI3BC,gBAAU;AAJiB,KAA7B;AAMD;AAVoB,CAAvB;AAaAlB,SAASmB,cAAT,CAAwBC,OAAxB,CAAgC;AAC9BC,iBAD8B,cACZ;AAChB,QAAItB,OAAOuB,MAAP,OAAoB,KAAKA,MAA7B,EAAqC;AACnC,UAAIpB,MAAMqB,YAAN,CAAmB,KAAKD,MAAxB,EAAgC,OAAhC,EAAyC,KAAKE,MAA9C,CAAJ,EAA2D;AACzD,eAAO,IAAP;AACD;AACF;AACF,GAP6B;AAQ9BF,QAR8B,cAQrB;AACP,WAAOvB,OAAOuB,MAAP,EAAP;AACD,GAV6B;AAW9BG,sBAX8B,YAWThB,UAXS,EAWGa,MAXH,EAWW;AACvC,QAAIA,UAAUpB,MAAMqB,YAAN,CAAmBD,MAAnB,EAA2Bb,UAA3B,EAAuC,KAAKe,MAAL,IAAetB,MAAMqB,YAAN,CAClED,MADkE,EAC1Db,UAD0D,EAElEP,MAAMwB,YAF4D,CAAtD,CAAd,EAGI;AACF,aAAO,SAAP;AACD;AACF,GAlB6B;AAmB9BC,eAnB8B,YAmBhBC,WAnBgB,EAmBH;AACzB,QAAMN,SAASM,eAAe,KAAKN,MAApB,IAA8BtB,SAAS6B,UAAT,CAAoB,CAApB,EAAuBP,MAApE;AACA,WAAOpB,MAAM4B,gBAAN,CAAuBR,MAAvB,CAAP;AACD,GAtB6B;AAuB9BS,WAvB8B,YAuBpBC,UAvBoB,EAuBR;AACpB,QAAMR,SAASQ,cAAchC,SAASiC,WAAT,EAA7B;AACA,QAAMC,OAAOpC,MAAMqC,OAAN,CAAc;AACzBC,WAAKZ;AADoB,KAAd,CAAb;;AAGA,QAAIU,QAAQA,KAAKG,IAAjB,EAAuB;AACrB,aAAOH,KAAKG,IAAL,IAAa,cAApB;AACD;AACF,GA/B6B;AAgC9BC,kBAhC8B,YAgCbN,UAhCa,EAgCD;AAC3B,QAAMM,mBAAmB,EAAzB;AACA,QAAMd,SAASQ,cAAchC,SAASiC,WAAT,EAA7B;AACA,QAAMM,WAAW1C,SAAS2C,IAAT,CAAc;AAC7BhB;AAD6B,KAAd,CAAjB;AAIAe,aAASE,OAAT,CAAiB,UAACC,GAAD,EAAS;AACxB,UAAMpC,cAAc,EAApB;;AACA,UAAIoC,IAAIC,QAAJ,IAAgBD,IAAIE,OAAxB,EAAiC;AAC/B,6BAA2BF,IAAIC,QAA/B,kHAAyC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,cAA9BE,aAA8B;;AACvC;AACA,cAAI,CAACA,cAAaC,KAAlB,EAAyB;AACvB;AACD,WAJsC,CAMvC;;;AACA,cAAID,cAAavC,WAAjB,EAA8B;AAC5B,kCAAyBuC,cAAavC,WAAtC,yHAAmD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,kBAAxCG,WAAwC;;AACjD;AACA,kBAAI,sBAAOA,WAAP,MAAsB,QAA1B,EAAoC;AAClCA,4BAAWe,MAAX,GAAoBA,MAApB;AACAlB,4BAAYyC,IAAZ,CAAiBtC,WAAjB;AACD;AACF;AACF,WAfsC,CAiBvC;;;AACA,cAAMF,gBAAgBF,iBAAiBC,WAAjB,CAAtB;;AACA,cAAI,CAACC,cAAcsC,cAAaC,KAA3B,CAAL,EAAwC;AACtCxC,wBAAYyC,IAAZ,CAAiB;AACfvB,sBAAQkB,IAAIlB,MADG;AAEff,0BAAYoC,cAAaR,IAAb,IAAwBK,IAAIL,IAA5B,SAAoCQ,cAAa3B,QAF9C;AAE0D;AACzE8B,oBAAMH,cAAaG,IAHJ;AAIftC,qBAAOmC,cAAanC,KAAb,IAAsBmC,cAAaI,QAAnC,IAA+CJ,cAAaC;AAJpD,aAAjB;AAMD;AACF,SA5B8B,CA6B/B;;;AACA,YAAMpC,QAAQgC,IAAIL,IAAJ,CAASa,OAAT,CAAiB,UAAjB,EAA6B,EAA7B,EAAiCA,OAAjC,CAAyC,OAAzC,EAAkD,UAACC,CAAD;AAAA,uBAAWA,EAAE,CAAF,EAAKC,WAAL,EAAX;AAAA,SAAlD,CAAd;AAEA,eAAOd,iBAAiBS,IAAjB,CAAsB;AAC3BvB,kBAAQkB,IAAIlB,MADe;AAE3BwB,gBAAMN,IAAIM,IAFiB;AAG3BX,gBAAMK,IAAIL,IAHiB;AAI3B3B,sBAJ2B;AAK3BJ,uBAAa,MAAOA,WAAP;AALc,SAAtB,CAAP;AAOD;AACF,KA1CD;AA4CA,WAAOgC,gBAAP;AACD,GApF6B;AAsF9Be,oBAtF8B,YAsFX/C,WAtFW,EAsFE;AAC9B,WAAOgD,QAAQhD,YAAYiD,MAApB,CAAP;AACD,GAxF6B;;AAyF9B;;;;AAIAC,wBA7F8B,cA6FL;AACvB,QAAMC,UAAU5D,SAASsC,OAAT,CAAiB;AAC/BE,YAAM,eADyB;AAE/Bb,cAAQ5B,SAAS8D,SAAT;AAFuB,KAAjB,CAAhB;AAKA,WAAO,KAAMD,OAAN,EAAe,0BAAf,EAA2C,KAA3C,CAAP;AACD,GApG6B;AAsG9BE,gBAtG8B,cAsGb;AACf,WAAO;AACLC,iBAAWzD;AADN,KAAP;AAGD,GA1G6B;AA4G9B0D,gBA5G8B,cA4Gb;AACf,WAAO;AACLD,iBAAWxD,WAAWyD;AADjB,KAAP;AAGD;AAhH6B,CAAhC;AAmHA;;;;;AAIA7D,SAASmB,cAAT,CAAwBP,MAAxB,CAA+B;AAC7B,qDAD6B,YACuBkD,KADvB,EAC8B5C,QAD9B,EACwC;AACnE,QAAM6C,OAAO,IAAb;AACA,QAAMzD,cAAc,EAApB;AACA,QAAMK,SAASO,SAASD,IAAxB;;AACA,QAAI,CAAC,KAAKO,MAAV,EAAkB;AAChB,YAAM,IAAIzB,OAAOiE,KAAX,CAAiB,mBAAjB,EAAsC,kBAAtC,CAAN;AACD;;AACD,QAAID,KAAK1B,IAAT,EAAe;AACb/B,kBAAYyC,IAAZ,CAAiBgB,KAAK1B,IAAtB;;AACA,4BAA6B0B,KAAKzD,WAAlC,yHAA+C;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,YAApC2D,eAAoC;AAC7C3D,oBAAYyC,IAAZ,CAAiBkB,gBAAexD,UAAhC;AACD;AACF,KALD,MAKO;AACLH,kBAAYyC,IAAZ,CAAiBgB,KAAKtD,UAAtB;AACD;;AACD,QAAIT,SAASkE,QAAT,GAAoBjE,CAApB,CAAsB6D,MAAMK,aAA5B,EAA2CC,EAA3C,CAA8C,UAA9C,CAAJ,EAA+D;AAC7DrE,aAAOsE,IAAP,CAAY,6BAAZ,EAA2C1D,OAAOW,MAAlD,EAA0DhB,WAA1D,EAAuE,KAAKkB,MAA5E;AACD,KAFD,MAEO;AACLzB,aAAOsE,IAAP,CAAY,gCAAZ,EAA8C1D,OAAOW,MAArD,EAA6DhB,WAA7D,EAA0E,KAAKkB,MAA/E;AACD;AACF,GArB4B;AAsB7B,mDAtB6B,YAsBqBsC,KAtBrB,EAsB4B5C,QAtB5B,EAsBsC;AACjE,QAAMoD,QAAQtE,SAASkE,QAAT,GAAoBjE,CAApB,CAAsB6D,MAAMK,aAA5B,CAAd;;AACA,QAAII,QAAQD,MAAMrD,IAAN,CAAW,SAAX,CAAR,CAAJ,EAAoC;AAAE;AACpC,UAAMuD,UAAU,EAAhB;;AACA,4BAAmBtD,SAASD,IAAT,CAAcwD,KAAjC,yHAAwC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,YAA7BC,KAA6B;AACtCF,gBAAQzB,IAAR,CAAahD,OAAOsE,IAAP,CAAY,6BAAZ,EAA2C,KAAK/C,MAAhD,EAAwD,CAAC,OAAD,EAAU,iBAAV,CAAxD,EAAsFoD,KAAtF,CAAb;AACD;;AACD,aAAOF,OAAP;AACD;AACF;AA/B4B,CAA/B","sourcesContent":["import _ from \"lodash\";\nimport { Reaction } from \"/client/api\";\nimport { Packages, Shops } from \"/lib/collections\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Template } from \"meteor/templating\";\nimport { $ } from \"meteor/jquery\";\nimport { Roles } from \"meteor/alanning:roles\";\nimport AccountsDashboard from \"/imports/plugins/core/accounts/client/containers/accountsDashboardContainer\";\nimport { Components } from \"@reactioncommerce/reaction-components\";\n\nconst getPermissionMap = (permissions) => {\n  const permissionMap = {};\n  _.each(permissions, (existing) => {\n    permissionMap[existing.permission] = existing.label;\n  });\n  return permissionMap;\n};\n\n/**\n * shopMember helpers\n * permissions / roles controls\n * we use userInRole instead of Reaction intentionally\n * to check each users permissions\n */\nTemplate.member.events({\n  \"click [data-event-action=showMemberSettings]\"() {\n    $(\".customerUsageType input\").val(\"\"); // form reset\n    $(\".customerUsageType\").addClass(\"hide\"); // form reset\n    Reaction.setActionViewDetail({\n      label: \"Permissions\",\n      i18nKeyLabel: \"admin.settings.permissionsSettingsLabel\",\n      data: this,\n      template: \"memberSettings\"\n    });\n  }\n});\n\nTemplate.memberSettings.helpers({\n  isOwnerDisabled() {\n    if (Meteor.userId() === this.userId) {\n      if (Roles.userIsInRole(this.userId, \"owner\", this.shopId)) {\n        return true;\n      }\n    }\n  },\n  userId() {\n    return Meteor.userId();\n  },\n  hasPermissionChecked(permission, userId) {\n    if (userId && Roles.userIsInRole(userId, permission, this.shopId || Roles.userIsInRole(\n      userId, permission,\n      Roles.GLOBAL_GROUP\n    ))) {\n      return \"checked\";\n    }\n  },\n  groupsForUser(groupUserId) {\n    const userId = groupUserId || this.userId || Template.parentData(1).userId;\n    return Roles.getGroupsForUser(userId);\n  },\n  shopLabel(thisShopId) {\n    const shopId = thisShopId || Template.currentData();\n    const shop = Shops.findOne({\n      _id: shopId\n    });\n    if (shop && shop.name) {\n      return shop.name || \"Default Shop\";\n    }\n  },\n  permissionGroups(thisShopId) {\n    const permissionGroups = [];\n    const shopId = thisShopId || Template.currentData();\n    const packages = Packages.find({\n      shopId\n    });\n\n    packages.forEach((pkg) => {\n      const permissions = [];\n      if (pkg.registry && pkg.enabled) {\n        for (const registryItem of pkg.registry) {\n          // Skip entires with missing routes\n          if (!registryItem.route) {\n            continue;\n          }\n\n          // Get all permissions, add them to an array\n          if (registryItem.permissions) {\n            for (const permission of registryItem.permissions) {\n              // check needed because of non-object perms in the permissions array (e.g \"admin\", \"owner\")\n              if (typeof permission === \"object\") {\n                permission.shopId = shopId;\n                permissions.push(permission);\n              }\n            }\n          }\n\n          // Also create an object map of those same permissions as above\n          const permissionMap = getPermissionMap(permissions);\n          if (!permissionMap[registryItem.route]) {\n            permissions.push({\n              shopId: pkg.shopId,\n              permission: registryItem.name || `${pkg.name}/${registryItem.template}`, // launchdock-connect/connectDashboard\n              icon: registryItem.icon,\n              label: registryItem.label || registryItem.provides || registryItem.route\n            });\n          }\n        }\n        // TODO review this, hardcoded WIP\n        const label = pkg.name.replace(\"reaction\", \"\").replace(/(-.)/g, (x) => ` ${x[1].toUpperCase()}`);\n\n        return permissionGroups.push({\n          shopId: pkg.shopId,\n          icon: pkg.icon,\n          name: pkg.name,\n          label,\n          permissions: _.uniq(permissions)\n        });\n      }\n    });\n\n    return permissionGroups;\n  },\n\n  hasManyPermissions(permissions) {\n    return Boolean(permissions.length);\n  },\n  /**\n   * showAvalaraTaxSettings\n   * @return {Boolean} True if avalara is enabled. Defaults to false if not found\n   */\n  showAvalaraTaxSettings() {\n    const avalara = Packages.findOne({\n      name: \"taxes-avalara\",\n      shopId: Reaction.getShopId()\n    });\n\n    return _.get(avalara, \"settings.avalara.enabled\", false);\n  },\n\n  accountsDetail() {\n    return {\n      component: AccountsDashboard\n    };\n  },\n\n  ReactionAvatar() {\n    return {\n      component: Components.ReactionAvatar\n    };\n  }\n});\n\n/**\n * shopMember events\n *\n */\nTemplate.memberSettings.events({\n  \"change [data-event-action=toggleMemberPermission]\"(event, template) {\n    const self = this;\n    const permissions = [];\n    const member = template.data;\n    if (!this.shopId) {\n      throw new Meteor.Error(\"invalid-parameter\", \"Shop is required\");\n    }\n    if (self.name) {\n      permissions.push(self.name);\n      for (const pkgPermissions of self.permissions) {\n        permissions.push(pkgPermissions.permission);\n      }\n    } else {\n      permissions.push(self.permission);\n    }\n    if (Template.instance().$(event.currentTarget).is(\":checked\")) {\n      Meteor.call(\"accounts/addUserPermissions\", member.userId, permissions, this.shopId);\n    } else {\n      Meteor.call(\"accounts/removeUserPermissions\", member.userId, permissions, this.shopId);\n    }\n  },\n  \"click [data-event-action=resetMemberPermission]\"(event, template) {\n    const $icon = Template.instance().$(event.currentTarget);\n    if (confirm($icon.data(\"confirm\"))) { // eslint-disable-line no-alert\n      const results = [];\n      for (const role of template.data.roles) {\n        results.push(Meteor.call(\"accounts/setUserPermissions\", this.userId, [\"guest\", \"account/profile\"], role));\n      }\n      return results;\n    }\n  }\n});\n"]},"sourceType":"script","hash":"eae733782295923c1206eb5f5ab6589f9232760e"}
