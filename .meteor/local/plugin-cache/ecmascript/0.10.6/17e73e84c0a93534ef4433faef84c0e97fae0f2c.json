{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/marketplace/client/templates/stripeConnectSignupButton/stripeConnectSignupButton.js","filename":"imports/plugins/included/marketplace/client/templates/stripeConnectSignupButton/stripeConnectSignupButton.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/marketplace/client/templates/stripeConnectSignupButton/stripeConnectSignupButton.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/marketplace/client/templates/stripeConnectSignupButton/stripeConnectSignupButton.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/marketplace/client/templates/stripeConnectSignupButton/stripeConnectSignupButton.js"}},"code":"function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 1);\nvar Reaction;\nmodule.watch(require(\"../../../../../../../lib/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 2);\nvar i18next;\nmodule.watch(require(\"../../../../../../../client/api\"), {\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 3);\nvar Shops;\nmodule.watch(require(\"../../../../../../../lib/collections\"), {\n  Shops: function (v) {\n    Shops = v;\n  }\n}, 4);\nTemplate.stripeConnectSignupButton.events({\n  \"click [data-event-action='button-click-stripe-signup']\": function () {\n    var shopId = Reaction.getShopId();\n    var primaryShopId = Reaction.getPrimaryShopId();\n    var primaryStripePackage = Reaction.getPackageSettingsWithOptions({\n      shopId: primaryShopId,\n      name: \"reaction-stripe\",\n      enabled: true\n    }); // eslint-disable-next-line\n    // debugger;\n\n    var clientId;\n\n    if (primaryStripePackage && primaryStripePackage.settings && primaryStripePackage.settings.public && typeof primaryStripePackage.settings.public.client_id === \"string\") {\n      // If the primaryshop has stripe enabled and set the client_id\n      clientId = primaryStripePackage.settings.public.client_id;\n    } else {\n      return Alerts.toast(\"\" + i18next.t(\"admin.connect.stripeConnectNotEnabled\"), \"error\");\n    }\n\n    var shop = Shops.findOne({\n      _id: shopId\n    });\n\n    if (!shop || !shop.workflow || shop.workflow.status !== \"active\") {\n      return Alerts.toast(\"\" + i18next.t(\"admin.connect.shopNotActive\"), \"error\");\n    }\n\n    if (!shop.emails || !Array.isArray(shop.emails) || shop.emails.length === 0) {\n      return Alerts.toast(\"\" + i18next.t(\"admin.connect.shopEmailNotConfigured\"), \"error\");\n    }\n\n    if (!shop.addressBook || !Array.isArray(shop.addressBook) || shop.addressBook.length === 0) {\n      return Alerts.toast(\"\" + i18next.t(\"admin.connect.shopAddressNotConfigured\"), \"error\");\n    }\n\n    var country = shop.addressBook[0].country;\n    var phoneNumber = shop.addressBook[0].phone;\n    var businessName = shop.addressBook[0].company;\n    var streetAddress = shop.addressBook[0].address1;\n    var city = shop.addressBook[0].city;\n    var state = shop.addressBook[0].region;\n    var zip = shop.addressBook[0].postal;\n    var user = Meteor.user() || {};\n    var defaultEmail = user.emails.find(function (email) {\n      return email.provides === \"default\";\n    });\n    var defaultEmailAddress = defaultEmail ? defaultEmail.address : \"\";\n\n    var _ref = user.name ? user.name.split(\" \") : [],\n        _ref2 = _toArray(_ref),\n        firstName = _ref2[0],\n        last = _ref2.slice(1);\n\n    var lastName = last.join(\" \");\n    var stripeConnectAuthorizeUrl = \"https://connect.stripe.com/oauth/authorize?response_type=code&state=\" + shopId + \"&client_id=\" + clientId + \"&scope=read_write\";\n    var autofillParams = \"&stripe_user[email]=\" + defaultEmailAddress + \"&stripe_user[country]=\" + country + \"&stripe_user[phone_number]=\" + phoneNumber + \"&stripe_user[business_name]=\" + businessName + \"&stripe_user[street_address]=\" + streetAddress + \"&stripe_user[city]=\" + city + \"&stripe_user[state]=\" + state + \"&stripe_user[zip]=\" + zip + \"&stripe_user[first_name]=\" + firstName + \"&stripe_user[last_name]=\" + lastName; // eslint-disable-line max-len\n\n    window.open(stripeConnectAuthorizeUrl + autofillParams, \"_blank\");\n  }\n});","map":{"version":3,"sources":["imports/plugins/included/marketplace/client/templates/stripeConnectSignupButton/stripeConnectSignupButton.js"],"names":["Meteor","module","watch","require","v","Template","Reaction","i18next","Shops","stripeConnectSignupButton","events","shopId","getShopId","primaryShopId","getPrimaryShopId","primaryStripePackage","getPackageSettingsWithOptions","name","enabled","clientId","settings","public","client_id","Alerts","toast","t","shop","findOne","_id","workflow","status","emails","Array","isArray","length","addressBook","country","phoneNumber","phone","businessName","company","streetAddress","address1","city","state","region","zip","postal","user","defaultEmail","find","email","provides","defaultEmailAddress","address","split","firstName","last","lastName","join","stripeConnectAuthorizeUrl","autofillParams","window","open"],"mappings":"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","sourcesContent":["import { Meteor } from \"meteor/meteor\";\nimport { Template } from \"meteor/templating\";\nimport { Reaction } from \"/lib/api\";\nimport { i18next } from \"/client/api\";\nimport { Shops } from \"/lib/collections\";\n\nTemplate.stripeConnectSignupButton.events({\n  \"click [data-event-action='button-click-stripe-signup']\"() {\n    const shopId = Reaction.getShopId();\n    const primaryShopId = Reaction.getPrimaryShopId();\n    const primaryStripePackage = Reaction.getPackageSettingsWithOptions({\n      shopId: primaryShopId,\n      name: \"reaction-stripe\",\n      enabled: true\n    });\n\n    // eslint-disable-next-line\n    // debugger;\n    let clientId;\n\n    if (primaryStripePackage &&\n        primaryStripePackage.settings &&\n        primaryStripePackage.settings.public &&\n        typeof primaryStripePackage.settings.public.client_id === \"string\") {\n      // If the primaryshop has stripe enabled and set the client_id\n      clientId = primaryStripePackage.settings.public.client_id;\n    } else {\n      return Alerts.toast(`${i18next.t(\"admin.connect.stripeConnectNotEnabled\")}`, \"error\");\n    }\n\n    const shop = Shops.findOne({ _id: shopId });\n\n    if (!shop || !shop.workflow || shop.workflow.status !== \"active\") {\n      return Alerts.toast(`${i18next.t(\"admin.connect.shopNotActive\")}`, \"error\");\n    }\n\n    if (!shop.emails || !Array.isArray(shop.emails) || shop.emails.length === 0) {\n      return Alerts.toast(`${i18next.t(\"admin.connect.shopEmailNotConfigured\")}`, \"error\");\n    }\n\n    if (!shop.addressBook || !Array.isArray(shop.addressBook) || shop.addressBook.length === 0) {\n      return Alerts.toast(`${i18next.t(\"admin.connect.shopAddressNotConfigured\")}`, \"error\");\n    }\n\n    const { country } = shop.addressBook[0];\n    const phoneNumber = shop.addressBook[0].phone;\n    const businessName = shop.addressBook[0].company;\n    const streetAddress = shop.addressBook[0].address1;\n    const { city } = shop.addressBook[0];\n    const state = shop.addressBook[0].region;\n    const zip = shop.addressBook[0].postal;\n\n    const user = Meteor.user() || {};\n\n    const defaultEmail =\n      user.emails.find((email) => email.provides === \"default\");\n    const defaultEmailAddress = defaultEmail ? defaultEmail.address : \"\";\n\n    const [firstName, ...last] = user.name ? user.name.split(\" \") : [];\n    const lastName = last.join(\" \");\n\n    const stripeConnectAuthorizeUrl = `https://connect.stripe.com/oauth/authorize?response_type=code&state=${shopId}&client_id=${clientId}&scope=read_write`;\n    const autofillParams = `&stripe_user[email]=${defaultEmailAddress}&stripe_user[country]=${country}&stripe_user[phone_number]=${phoneNumber}&stripe_user[business_name]=${businessName}&stripe_user[street_address]=${streetAddress}&stripe_user[city]=${city}&stripe_user[state]=${state}&stripe_user[zip]=${zip}&stripe_user[first_name]=${firstName}&stripe_user[last_name]=${lastName}`; // eslint-disable-line max-len\n    window.open(stripeConnectAuthorizeUrl + autofillParams, \"_blank\");\n  }\n});\n"]},"sourceType":"script","hash":"17e73e84c0a93534ef4433faef84c0e97fae0f2c"}
