{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/core/accounts/client/containers/addressBookContainer.js","filename":"imports/plugins/core/accounts/client/containers/addressBookContainer.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/core/accounts/client/containers/addressBookContainer.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/core/accounts/client/containers/addressBookContainer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/core/accounts/client/containers/addressBookContainer.js"}},"code":"var _withProps;\n\nmodule.watch(require(\"recompose/withProps\"), {\n  \"default\": function (v) {\n    _withProps = v;\n  }\n}, 0);\n\nvar _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  \"default\": function (v) {\n    _compose = v;\n  }\n}, 1);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Template;\nmodule.watch(require(\"meteor/templating\"), {\n  Template: function (v) {\n    Template = v;\n  }\n}, 3);\nvar i18next, Logger;\nmodule.watch(require(\"../../../../../../client/api\"), {\n  i18next: function (v) {\n    i18next = v;\n  },\n  Logger: function (v) {\n    Logger = v;\n  }\n}, 4);\nvar Countries;\nmodule.watch(require(\"../../../../../../client/collections\"), {\n  Countries: function (v) {\n    Countries = v;\n  }\n}, 5);\nvar Collections;\nmodule.watch(require(\"../../../../../../lib/collections\"), {\n  \"*\": function (v) {\n    Collections = v;\n  }\n}, 6);\nvar registerComponent, composeWithTracker;\nmodule.watch(require(\"../../../components/lib\"), {\n  registerComponent: function (v) {\n    registerComponent = v;\n  },\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 7);\nvar AddressBook;\nmodule.watch(require(\"../components/addressBook\"), {\n  \"default\": function (v) {\n    AddressBook = v;\n  }\n}, 8);\nvar handlers = {\n  /**\n   * @method updateAddress\n   * @summary helper function that validates and updates an address in the account's addressBook via a meteor method.\n   * @since 2.0.0\n   * @param {Object} address - address to be updated.\n   * @param{String} property - property to be updated.\n   * @return {Promise}\n   */\n  updateAddress: function (address, property) {\n    var validateAddress = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    return new Promise(function (resolve, reject) {\n      if (validateAddress) {\n        Meteor.call(\"accounts/validateAddress\", address, function (error, result) {\n          if (error || !result) {\n            var errorMessage = error && error.message || \"Validation Failed\";\n\n            if (error && error.error === \"validation-error\" && Array.isArray(error.details) && error.details.length) {\n              // Add details of first invalid field from SimpleSchema\n              errorMessage = error.details[0].message;\n            }\n\n            reject(i18next.t(\"addressBookAdd.failedToUpdateAddress\", {\n              err: errorMessage\n            }));\n            return;\n          } else if (result.validated === false && !result.suggestedAddress) {\n            reject(i18next.t(\"addressBookAdd.failedToUpdateAddress\", {\n              err: \"Unable to fetch corrected address\"\n            }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress && result.formErrors && result.formErrors.length > 0) {\n            reject(i18next.t(\"addressBookAdd.failedToUpdateAddress\", {\n              err: result.formErrors[0].summary\n            }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress) {\n            resolve(result);\n            return;\n          }\n\n          Meteor.call(\"accounts/addressBookUpdate\", address, null, property, function (err, res) {\n            if (err || !res) {\n              reject(i18next.t(\"addressBookGrid.somethingWentWrong\", {\n                err: err.message\n              }));\n            } else {\n              resolve(res);\n            }\n          });\n          return;\n        });\n      }\n\n      Meteor.call(\"accounts/addressBookUpdate\", address, null, property, function (err, res) {\n        if (err || !res) {\n          reject(i18next.t(\"addressBookGrid.somethingWentWrong\", {\n            err: err.message\n          }));\n        } else {\n          resolve(res);\n        }\n      });\n    });\n  },\n\n  /**\n  * @method removeAddress\n  * @summary helper function that updates an address in the account's addressBook via a meteor method.\n  * @since 2.0.0\n  * @param {String} _id - _id of address to be removed.\n  * @return {Promise}\n  */\n  removeAddress: function (_id) {\n    return new Promise(function (resolve, reject) {\n      Meteor.call(\"accounts/addressBookRemove\", _id, function (error, result) {\n        if (error || !result) {\n          reject(i18next.t(\"addressBookGrid.cantRemoveThisAddress\", {\n            err: error.message\n          }));\n        } else {\n          resolve(result);\n        }\n      });\n    });\n  },\n\n  /**\n  * @method addAddress\n  * @summary helper function that validates and adds an address in the account's addressBook via a meteor method.\n  * @since 2.0.0\n  * @param {Object} address - address to be added.\n  * @return {Promise}\n  */\n  addAddress: function (address) {\n    var validateAddress = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    return new Promise(function (resolve, reject) {\n      // This address was tried for validation\n      if (validateAddress) {\n        Meteor.call(\"accounts/validateAddress\", address, function (error, result) {\n          if (error || !result) {\n            var errorMessage = error && error.message || \"Validation Failed\";\n\n            if (error && error.error === \"validation-error\" && Array.isArray(error.details) && error.details.length) {\n              // Add details of first invalid field from SimpleSchema\n              errorMessage = error.details[0].message;\n            }\n\n            reject(i18next.t(\"addressBookAdd.failedToAddAddress\", {\n              err: errorMessage\n            }));\n            return;\n          } else if (result.validated === false && !result.suggestedAddress) {\n            reject(i18next.t(\"addressBookAdd.failedToAddAddress\", {\n              err: \"Unable to fetch corrected address\"\n            }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress && result.formErrors && result.formErrors.length > 0) {\n            reject(i18next.t(\"addressBookAdd.failedToAddAddress\", {\n              err: result.formErrors[0].summary\n            }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress) {\n            resolve(result);\n            return;\n          }\n\n          Meteor.call(\"accounts/addressBookAdd\", address, function (err, res) {\n            if (err || !res) {\n              reject(i18next.t(\"addressBookAdd.failedToAddAddress\", {\n                err: err.message\n              }));\n            } else {\n              resolve(res);\n            }\n          });\n        });\n      } else {\n        Meteor.call(\"accounts/addressBookAdd\", address, function (err, res) {\n          if (err || !res) reject(i18next.t(\"addressBookAdd.failedToAddAddress\", {\n            err: err.message\n          }));\n          if (res) resolve(res);\n        });\n      }\n    });\n  },\n  markCart: function (address, isEnteredSelected) {\n    if (!isEnteredSelected) {\n      Meteor.call(\"accounts/markAddressValidationBypassed\", false, function (error) {\n        if (error) {\n          return Logger.error(error, \"Unable to mark the cart\");\n        }\n\n        Meteor.call(\"accounts/markTaxCalculationFailed\", false, function (err) {\n          if (err) {\n            return Logger.error(err, \"Unable to mark the cart\");\n          }\n        });\n      });\n    } else {\n      Meteor.call(\"accounts/markAddressValidationBypassed\", true, function (error) {\n        if (error) {\n          return Logger.error(error, \"Unable to mark the cart\");\n        }\n      });\n    }\n  },\n\n  /**\n  * @method onError\n  * @summary helper function that shows an error message in an alert toast.\n  * @since 2.0.0\n  * @param {Object} errorMessage - error message object.\n  */\n  onError: function (errorMessage) {\n    Alerts.toast(errorMessage, \"error\");\n  }\n};\n\nfunction composer(props, onData) {\n  var handle = Meteor.subscribe(\"Accounts\", Meteor.userId());\n\n  if (!handle.ready()) {\n    return;\n  }\n\n  var account = Collections.Accounts.findOne({\n    _id: Meteor.userId()\n  });\n  var addressBook = account.profile.addressBook;\n  var countries = Countries.find().fetch();\n  var shop = Collections.Shops.findOne();\n  var shopCountries = shop.locales.countries;\n  var regionsByCountry = {};\n  Object.keys(shopCountries).forEach(function (key) {\n    var _ref = shopCountries[key] || {},\n        states = _ref.states;\n\n    var regions = [];\n\n    if (states) {\n      // states is an object that needs to be convered\n      // to an array of region labels and values\n      Object.keys(states).forEach(function (i) {\n        regions.push({\n          label: states[i].name,\n          value: i\n        });\n      });\n    }\n\n    regionsByCountry[key] = regions;\n  }); // The initial mode for addressBook\n\n  var initMode;\n  var cart = Collections.Cart.findOne(); // If we have passed the address step, show the grid\n\n  if (cart.workflow.status !== \"checkoutAddressBook\") {\n    initMode = \"grid\";\n  } // AddressBook heading will be different in different views\n  // If the view template that's using the AddressBook has a\n  // heading object, set it as the AddressBook heading\n\n\n  if (!this.heading) {\n    var template = Template.instance();\n\n    var _ref2 = template || {\n      data: undefined\n    },\n        data = _ref2.data;\n\n    var _ref3 = data || {\n      heading: undefined\n    },\n        templateHeading = _ref3.heading;\n\n    if (templateHeading) {\n      this.heading = templateHeading;\n    } else {\n      this.heading = {\n        defaultValue: \"Address Book\",\n        i18nKey: \"accountsUI.addressBook\"\n      };\n    }\n  }\n\n  onData(null, {\n    addressBook: addressBook,\n    countries: countries,\n    heading: this.heading,\n    initMode: initMode,\n    regionsByCountry: regionsByCountry\n  });\n}\n\nregisterComponent(\"AddressBook\", AddressBook, [composeWithTracker(composer), _withProps(handlers)]);\nmodule.exportDefault(_compose(composeWithTracker(composer), _withProps(handlers))(AddressBook));","map":{"version":3,"sources":["imports/plugins/core/accounts/client/containers/addressBookContainer.js"],"names":["_withProps","module","watch","require","v","_compose","Meteor","Template","i18next","Logger","Countries","Collections","registerComponent","composeWithTracker","AddressBook","handlers","updateAddress","address","property","validateAddress","Promise","resolve","reject","call","error","result","errorMessage","message","Array","isArray","details","length","t","err","validated","suggestedAddress","formErrors","summary","res","removeAddress","_id","addAddress","markCart","isEnteredSelected","onError","Alerts","toast","composer","props","onData","handle","subscribe","userId","ready","account","Accounts","findOne","addressBook","profile","countries","find","fetch","shop","Shops","shopCountries","locales","regionsByCountry","Object","keys","forEach","key","states","regions","i","push","label","name","value","initMode","cart","Cart","workflow","status","heading","template","instance","data","undefined","templateHeading","defaultValue","i18nKey","exportDefault"],"mappings":"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","sourcesContent":["import { compose, withProps } from \"recompose\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Template } from \"meteor/templating\";\nimport { i18next, Logger } from \"/client/api\";\nimport { Countries } from \"/client/collections\";\nimport * as Collections from \"/lib/collections\";\nimport { registerComponent, composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport AddressBook from \"../components/addressBook\";\n\n\nconst handlers = {\n/**\n * @method updateAddress\n * @summary helper function that validates and updates an address in the account's addressBook via a meteor method.\n * @since 2.0.0\n * @param {Object} address - address to be updated.\n * @param{String} property - property to be updated.\n * @return {Promise}\n */\n  updateAddress(address, property, validateAddress = true) {\n    return new Promise((resolve, reject) => {\n      if (validateAddress) {\n        Meteor.call(\"accounts/validateAddress\", address, (error, result) => {\n          if (error || !result) {\n            let errorMessage = (error && error.message) || \"Validation Failed\";\n            if (error && error.error === \"validation-error\" && Array.isArray(error.details) && error.details.length) {\n              // Add details of first invalid field from SimpleSchema\n              errorMessage = error.details[0].message;\n            }\n            reject(i18next.t(\"addressBookAdd.failedToUpdateAddress\", { err: errorMessage }));\n            return;\n          } else if (result.validated === false && !result.suggestedAddress) {\n            reject(i18next.t(\"addressBookAdd.failedToUpdateAddress\", { err: \"Unable to fetch corrected address\" }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress && result.formErrors && result.formErrors.length > 0) {\n            reject(i18next.t(\"addressBookAdd.failedToUpdateAddress\", { err: result.formErrors[0].summary }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress) {\n            resolve(result);\n            return;\n          }\n          Meteor.call(\"accounts/addressBookUpdate\", address, null, property, (err, res) => {\n            if (err || !res) {\n              reject(i18next.t(\"addressBookGrid.somethingWentWrong\", { err: err.message }));\n            } else {\n              resolve(res);\n            }\n          });\n          return;\n        });\n      }\n      Meteor.call(\"accounts/addressBookUpdate\", address, null, property, (err, res) => {\n        if (err || !res) {\n          reject(i18next.t(\"addressBookGrid.somethingWentWrong\", { err: err.message }));\n        } else {\n          resolve(res);\n        }\n      });\n    });\n  },\n\n  /**\n * @method removeAddress\n * @summary helper function that updates an address in the account's addressBook via a meteor method.\n * @since 2.0.0\n * @param {String} _id - _id of address to be removed.\n * @return {Promise}\n */\n  removeAddress(_id) {\n    return new Promise((resolve, reject) => {\n      Meteor.call(\"accounts/addressBookRemove\", _id, (error, result) => {\n        if (error || !result) {\n          reject(i18next.t(\"addressBookGrid.cantRemoveThisAddress\", { err: error.message }));\n        } else {\n          resolve(result);\n        }\n      });\n    });\n  },\n\n  /**\n * @method addAddress\n * @summary helper function that validates and adds an address in the account's addressBook via a meteor method.\n * @since 2.0.0\n * @param {Object} address - address to be added.\n * @return {Promise}\n */\n  addAddress(address, validateAddress = true) {\n    return new Promise((resolve, reject) => {\n    // This address was tried for validation\n      if (validateAddress) {\n        Meteor.call(\"accounts/validateAddress\", address, (error, result) => {\n          if (error || !result) {\n            let errorMessage = (error && error.message) || \"Validation Failed\";\n            if (error && error.error === \"validation-error\" && Array.isArray(error.details) && error.details.length) {\n              // Add details of first invalid field from SimpleSchema\n              errorMessage = error.details[0].message;\n            }\n            reject(i18next.t(\"addressBookAdd.failedToAddAddress\", { err: errorMessage }));\n            return;\n          } else if (result.validated === false && !result.suggestedAddress) {\n            reject(i18next.t(\"addressBookAdd.failedToAddAddress\", { err: \"Unable to fetch corrected address\" }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress && result.formErrors && result.formErrors.length > 0) {\n            reject(i18next.t(\"addressBookAdd.failedToAddAddress\", { err: result.formErrors[0].summary }));\n            return;\n          } else if (result.validated === false && result.suggestedAddress) {\n            resolve(result);\n            return;\n          }\n          Meteor.call(\"accounts/addressBookAdd\", address, (err, res) => {\n            if (err || !res) {\n              reject(i18next.t(\"addressBookAdd.failedToAddAddress\", { err: err.message }));\n            } else {\n              resolve(res);\n            }\n          });\n        });\n      } else {\n        Meteor.call(\"accounts/addressBookAdd\", address, (err, res) => {\n          if (err || !res) reject(i18next.t(\"addressBookAdd.failedToAddAddress\", { err: err.message }));\n          if (res) resolve(res);\n        });\n      }\n    });\n  },\n\n  markCart(address, isEnteredSelected) {\n    if (!isEnteredSelected) {\n      Meteor.call(\"accounts/markAddressValidationBypassed\", false, (error) => {\n        if (error) {\n          return Logger.error(error, \"Unable to mark the cart\");\n        }\n        Meteor.call(\"accounts/markTaxCalculationFailed\", false, (err) => {\n          if (err) {\n            return Logger.error(err, \"Unable to mark the cart\");\n          }\n        });\n      });\n    } else {\n      Meteor.call(\"accounts/markAddressValidationBypassed\", true, (error) => {\n        if (error) {\n          return Logger.error(error, \"Unable to mark the cart\");\n        }\n      });\n    }\n  },\n\n  /**\n * @method onError\n * @summary helper function that shows an error message in an alert toast.\n * @since 2.0.0\n * @param {Object} errorMessage - error message object.\n */\n  onError(errorMessage) {\n    Alerts.toast(errorMessage, \"error\");\n  }\n};\n\nfunction composer(props, onData) {\n  const handle = Meteor.subscribe(\"Accounts\", Meteor.userId());\n  if (!handle.ready()) {\n    return;\n  }\n  const account = Collections.Accounts.findOne({ _id: Meteor.userId() });\n  const { addressBook } = account.profile;\n  const countries = Countries.find().fetch();\n  const shop = Collections.Shops.findOne();\n  const shopCountries = shop.locales.countries;\n\n  const regionsByCountry = {};\n  Object.keys(shopCountries).forEach((key) => {\n    const { states } = shopCountries[key] || {};\n    const regions = [];\n    if (states) {\n      // states is an object that needs to be convered\n      // to an array of region labels and values\n      Object.keys(states).forEach((i) => {\n        regions.push({\n          label: states[i].name,\n          value: i\n        });\n      });\n    }\n    regionsByCountry[key] = regions;\n  });\n  // The initial mode for addressBook\n  let initMode;\n  const cart = Collections.Cart.findOne();\n  // If we have passed the address step, show the grid\n  if (cart.workflow.status !== \"checkoutAddressBook\") {\n    initMode = \"grid\";\n  }\n  // AddressBook heading will be different in different views\n  // If the view template that's using the AddressBook has a\n  // heading object, set it as the AddressBook heading\n  if (!this.heading) {\n    const template = Template.instance();\n    const { data } = template || { data: undefined };\n    const { heading: templateHeading } = data || { heading: undefined };\n    if (templateHeading) {\n      this.heading = templateHeading;\n    } else {\n      this.heading = {\n        defaultValue: \"Address Book\",\n        i18nKey: \"accountsUI.addressBook\"\n      };\n    }\n  }\n\n  onData(null, {\n    addressBook,\n    countries,\n    heading: this.heading,\n    initMode,\n    regionsByCountry\n  });\n}\n\nregisterComponent(\"AddressBook\", AddressBook, [\n  composeWithTracker(composer),\n  withProps(handlers)\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  withProps(handlers)\n)(AddressBook);\n"]},"sourceType":"script","hash":"aab305eb1fb4922c866fe6b91b6b7481d39eb38a"}
