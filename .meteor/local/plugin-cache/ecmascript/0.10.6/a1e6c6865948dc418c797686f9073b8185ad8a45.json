{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$1$2","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"ast":true,"babelrc":false,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","filename":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","sourceMaps":true,"envName":"development","cwd":"/Users/estebandev/test-knowledge","passPerPreset":false,"parserOpts":{"sourceType":"module","sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","plugins":["dynamicImport","classProperties","jsx","jsx","flow","asyncGenerators","objectRestSpread","objectRestSpread","flow","asyncGenerators"]},"generatorOpts":{"filename":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/plugins/included/product-variant/containers/productsContainerAdmin.js"}},"code":"var _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _compose;\n\nmodule.watch(require(\"recompose/compose\"), {\n  \"default\": function (v) {\n    _compose = v;\n  }\n}, 0);\nvar React, Component;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 1);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 2);\nvar registerComponent, composeWithTracker;\nmodule.watch(require(\"../../../core/components/lib\"), {\n  registerComponent: function (v) {\n    registerComponent = v;\n  },\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 3);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 4);\nvar ReactiveVar;\nmodule.watch(require(\"meteor/reactive-var\"), {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 5);\nvar Session;\nmodule.watch(require(\"meteor/session\"), {\n  Session: function (v) {\n    Session = v;\n  }\n}, 6);\nvar Tracker;\nmodule.watch(require(\"meteor/tracker\"), {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 7);\nvar Reaction;\nmodule.watch(require(\"../../../../../client/api\"), {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 8);\nvar ITEMS_INCREMENT;\nmodule.watch(require(\"../../../../../client/config/defaults\"), {\n  ITEMS_INCREMENT: function (v) {\n    ITEMS_INCREMENT = v;\n  }\n}, 9);\nvar ReactionProduct;\nmodule.watch(require(\"../../../../../lib/api\"), {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 10);\nvar applyProductRevision, resubscribeAfterCloning;\nmodule.watch(require(\"../../../../../lib/api/products\"), {\n  applyProductRevision: function (v) {\n    applyProductRevision = v;\n  },\n  resubscribeAfterCloning: function (v) {\n    resubscribeAfterCloning = v;\n  }\n}, 11);\nvar Products, Tags, Shops;\nmodule.watch(require(\"../../../../../lib/collections\"), {\n  Products: function (v) {\n    Products = v;\n  },\n  Tags: function (v) {\n    Tags = v;\n  },\n  Shops: function (v) {\n    Shops = v;\n  }\n}, 12);\nvar ProductsComponent;\nmodule.watch(require(\"../components/products\"), {\n  \"default\": function (v) {\n    ProductsComponent = v;\n  }\n}, 13);\nvar reactiveProductIds = new ReactiveVar([], function (oldVal, newVal) {\n  return JSON.stringify(oldVal.sort()) === JSON.stringify(newVal.sort());\n}); // Isolated resubscribe to product grid images, only when the list of product IDs changes\n\nTracker.autorun(function () {\n  Meteor.subscribe(\"ProductGridMedia\", reactiveProductIds.get());\n});\n/**\n * loadMoreProducts\n * @summary whenever #productScrollLimitLoader becomes visible, retrieve more results\n * this basically runs this:\n * Session.set('productScrollLimit', Session.get('productScrollLimit') + ITEMS_INCREMENT);\n * @return {undefined}\n */\n\nfunction loadMoreProducts() {\n  var threshold;\n  var target = document.querySelectorAll(\"#productScrollLimitLoader\");\n  var scrollContainer = document.querySelectorAll(\"#container-main\");\n\n  if (scrollContainer.length === 0) {\n    scrollContainer = window;\n  }\n\n  if (target.length) {\n    threshold = scrollContainer[0].scrollHeight - scrollContainer[0].scrollTop === scrollContainer[0].clientHeight;\n\n    if (threshold) {\n      if (!target[0].getAttribute(\"visible\")) {\n        target[0].setAttribute(\"productScrollLimit\", true);\n        Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n      }\n    } else if (target[0].getAttribute(\"visible\")) {\n      target[0].setAttribute(\"visible\", false);\n    }\n  }\n}\n\nvar wrapComponent = function (Comp) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    (0, _inheritsLoose2.default)(ProductsContainer, _Component);\n\n    function ProductsContainer(props) {\n      var _this;\n\n      _this = _Component.call(this, props) || this;\n\n      _this.ready = function () {\n        if (_this.props.showNotFound === true) {\n          return false;\n        }\n\n        var isInitialLoad = _this.state.initialLoad === true;\n\n        var isReady = _this.props.productsSubscription.ready();\n\n        if (isInitialLoad === false) {\n          return true;\n        }\n\n        if (isReady) {\n          return true;\n        }\n\n        return false;\n      };\n\n      _this.loadMoreProducts = function () {\n        return _this.props.canLoadMoreProducts === true;\n      };\n\n      _this.loadProducts = function (event) {\n        event.preventDefault();\n\n        _this.setState({\n          initialLoad: false\n        });\n\n        loadMoreProducts();\n      };\n\n      _this.state = {\n        initialLoad: true\n      };\n      _this.ready = _this.ready.bind((0, _assertThisInitialized2.default)(_this));\n      _this.loadMoreProducts = _this.loadMoreProducts.bind((0, _assertThisInitialized2.default)(_this));\n      return _this;\n    }\n\n    var _proto = ProductsContainer.prototype;\n\n    _proto.render = function () {\n      function render() {\n        return React.createElement(Comp, (0, _extends2.default)({}, this.props, {\n          ready: this.ready,\n          loadMoreProducts: this.loadMoreProducts,\n          loadProducts: this.loadProducts\n        }));\n      }\n\n      return render;\n    }();\n\n    return ProductsContainer;\n  }(Component), _class.propTypes = {\n    canLoadMoreProducts: PropTypes.bool,\n    productsSubscription: PropTypes.object,\n    showNotFound: PropTypes.bool\n  }, _temp;\n};\n\nfunction composer(props, onData) {\n  var _sort;\n\n  window.prerenderReady = false;\n  var canLoadMoreProducts = false;\n  var slug = Reaction.Router.getParam(\"slug\");\n  var shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n  var tag = Tags.findOne({\n    slug: slug\n  }) || Tags.findOne(slug);\n  var scrollLimit = Session.get(\"productScrollLimit\");\n  var tags = {}; // this could be shop default implementation needed\n\n  var shopIds = {};\n\n  if (tag) {\n    tags = {\n      tags: [tag._id]\n    };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = {\n      shops: [shopIdOrSlug]\n    };\n  } // if we get an invalid slug, don't return all products\n\n\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n    return;\n  }\n\n  var currentTag = ReactionProduct.getTag();\n  var sort = (_sort = {}, _sort[\"positions.\" + currentTag + \".position\"] = 1, _sort[\"positions.\" + currentTag + \".createdAt\"] = 1, _sort.createdAt = 1, _sort);\n  var viewAsPref = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\"); // Edit mode is true by default\n\n  var editMode = true; // if we have a \"viewAs\" preference and the preference is not set to \"administrator\", then edit mode is false\n\n  if (viewAsPref && viewAsPref !== \"administrator\") {\n    editMode = false;\n  }\n\n  var queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  var productsSubscription = Meteor.subscribe(\"Products\", scrollLimit, queryParams, sort, editMode);\n\n  if (resubscribeAfterCloning.get()) {\n    resubscribeAfterCloning.set(false);\n    productsSubscription.stop();\n  }\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  var activeShopsIds = Shops.find({\n    $or: [{\n      \"workflow.status\": \"active\"\n    }, {\n      _id: Reaction.getPrimaryShopId()\n    }]\n  }).map(function (activeShop) {\n    return activeShop._id;\n  });\n  var productCursor = Products.find({\n    ancestors: [],\n    type: {\n      $in: [\"simple\"]\n    },\n    shopId: {\n      $in: activeShopsIds\n    }\n  });\n  var productIds = [];\n  var products = productCursor.map(function (product) {\n    productIds.push(product._id);\n    return applyProductRevision(product);\n  });\n  var sortedProducts = ReactionProduct.sortProducts(products, currentTag);\n  Session.set(\"productGrid/products\", sortedProducts);\n  reactiveProductIds.set(productIds);\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n  var isActionViewOpen = Reaction.isActionViewOpen();\n\n  if (isActionViewOpen === false) {\n    Session.set(\"productGrid/selectedProducts\", []);\n  }\n\n  onData(null, {\n    canLoadMoreProducts: canLoadMoreProducts,\n    products: sortedProducts,\n    productsSubscription: productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsAdmin\", ProductsComponent, [composeWithTracker(composer), wrapComponent]);\nmodule.exportDefault(_compose(composeWithTracker(composer), wrapComponent)(ProductsComponent));","map":{"version":3,"sources":["imports/plugins/included/product-variant/containers/productsContainerAdmin.js"],"names":["_compose","module","watch","require","v","React","Component","PropTypes","registerComponent","composeWithTracker","Meteor","ReactiveVar","Session","Tracker","Reaction","ITEMS_INCREMENT","ReactionProduct","applyProductRevision","resubscribeAfterCloning","Products","Tags","Shops","ProductsComponent","reactiveProductIds","oldVal","newVal","JSON","stringify","sort","autorun","subscribe","get","loadMoreProducts","threshold","target","document","querySelectorAll","scrollContainer","length","window","scrollHeight","scrollTop","clientHeight","getAttribute","setAttribute","set","wrapComponent","Comp","props","ready","showNotFound","isInitialLoad","state","initialLoad","isReady","productsSubscription","canLoadMoreProducts","loadProducts","event","preventDefault","setState","bind","render","propTypes","bool","object","composer","onData","prerenderReady","slug","Router","getParam","shopIdOrSlug","tag","findOne","scrollLimit","tags","shopIds","_id","shops","currentTag","getTag","createdAt","viewAsPref","getUserPreferences","editMode","queryParams","Object","assign","current","query","stop","activeShopsIds","find","$or","getPrimaryShopId","map","activeShop","productCursor","ancestors","type","$in","shopId","productIds","products","product","push","sortedProducts","sortProducts","count","isActionViewOpen","exportDefault"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { compose } from \"recompose\";\nimport { registerComponent, composeWithTracker } from \"@reactioncommerce/reaction-components\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactiveVar } from \"meteor/reactive-var\";\nimport { Session } from \"meteor/session\";\nimport { Tracker } from \"meteor/tracker\";\nimport { Reaction } from \"/client/api\";\nimport { ITEMS_INCREMENT } from \"/client/config/defaults\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { applyProductRevision, resubscribeAfterCloning } from \"/lib/api/products\";\nimport { Products, Tags, Shops } from \"/lib/collections\";\nimport ProductsComponent from \"../components/products\";\n\nconst reactiveProductIds = new ReactiveVar([], (oldVal, newVal) => JSON.stringify(oldVal.sort()) === JSON.stringify(newVal.sort()));\n\n// Isolated resubscribe to product grid images, only when the list of product IDs changes\nTracker.autorun(() => {\n  Meteor.subscribe(\"ProductGridMedia\", reactiveProductIds.get());\n});\n\n\n/**\n * loadMoreProducts\n * @summary whenever #productScrollLimitLoader becomes visible, retrieve more results\n * this basically runs this:\n * Session.set('productScrollLimit', Session.get('productScrollLimit') + ITEMS_INCREMENT);\n * @return {undefined}\n */\nfunction loadMoreProducts() {\n  let threshold;\n  const target = document.querySelectorAll(\"#productScrollLimitLoader\");\n  let scrollContainer = document.querySelectorAll(\"#container-main\");\n  if (scrollContainer.length === 0) {\n    scrollContainer = window;\n  }\n\n  if (target.length) {\n    threshold = scrollContainer[0].scrollHeight - scrollContainer[0].scrollTop === scrollContainer[0].clientHeight;\n\n    if (threshold) {\n      if (!target[0].getAttribute(\"visible\")) {\n        target[0].setAttribute(\"productScrollLimit\", true);\n        Session.set(\"productScrollLimit\", Session.get(\"productScrollLimit\") + ITEMS_INCREMENT || 24);\n      }\n    } else if (target[0].getAttribute(\"visible\")) {\n      target[0].setAttribute(\"visible\", false);\n    }\n  }\n}\n\nconst wrapComponent = (Comp) => (\n  class ProductsContainer extends Component {\n    static propTypes = {\n      canLoadMoreProducts: PropTypes.bool,\n      productsSubscription: PropTypes.object,\n      showNotFound: PropTypes.bool\n    };\n\n    constructor(props) {\n      super(props);\n      this.state = {\n        initialLoad: true\n      };\n\n      this.ready = this.ready.bind(this);\n      this.loadMoreProducts = this.loadMoreProducts.bind(this);\n    }\n\n    ready = () => {\n      if (this.props.showNotFound === true) {\n        return false;\n      }\n      const isInitialLoad = this.state.initialLoad === true;\n      const isReady = this.props.productsSubscription.ready();\n\n      if (isInitialLoad === false) {\n        return true;\n      }\n\n      if (isReady) {\n        return true;\n      }\n      return false;\n    }\n\n    loadMoreProducts = () => this.props.canLoadMoreProducts === true\n\n    loadProducts = (event) => {\n      event.preventDefault();\n      this.setState({\n        initialLoad: false\n      });\n      loadMoreProducts();\n    }\n\n    render() {\n      return (\n        <Comp\n          {...this.props}\n          ready={this.ready}\n          loadMoreProducts={this.loadMoreProducts}\n          loadProducts={this.loadProducts}\n        />\n      );\n    }\n  }\n);\n\nfunction composer(props, onData) {\n  window.prerenderReady = false;\n\n  let canLoadMoreProducts = false;\n\n  const slug = Reaction.Router.getParam(\"slug\");\n  const shopIdOrSlug = Reaction.Router.getParam(\"shopSlug\");\n\n  const tag = Tags.findOne({ slug }) || Tags.findOne(slug);\n  const scrollLimit = Session.get(\"productScrollLimit\");\n  let tags = {}; // this could be shop default implementation needed\n  let shopIds = {};\n\n  if (tag) {\n    tags = { tags: [tag._id] };\n  }\n\n  if (shopIdOrSlug) {\n    shopIds = { shops: [shopIdOrSlug] };\n  }\n\n  // if we get an invalid slug, don't return all products\n  if (!tag && slug) {\n    onData(null, {\n      showNotFound: true\n    });\n\n    return;\n  }\n\n  const currentTag = ReactionProduct.getTag();\n\n  const sort = {\n    [`positions.${currentTag}.position`]: 1,\n    [`positions.${currentTag}.createdAt`]: 1,\n    createdAt: 1\n  };\n\n  const viewAsPref = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\");\n\n  // Edit mode is true by default\n  let editMode = true;\n\n  // if we have a \"viewAs\" preference and the preference is not set to \"administrator\", then edit mode is false\n  if (viewAsPref && viewAsPref !== \"administrator\") {\n    editMode = false;\n  }\n\n  const queryParams = Object.assign({}, tags, Reaction.Router.current().query, shopIds);\n  const productsSubscription = Meteor.subscribe(\"Products\", scrollLimit, queryParams, sort, editMode);\n  if (resubscribeAfterCloning.get()) {\n    resubscribeAfterCloning.set(false);\n    productsSubscription.stop();\n  }\n\n  if (productsSubscription.ready()) {\n    window.prerenderReady = true;\n  }\n\n  const activeShopsIds = Shops.find({\n    $or: [\n      { \"workflow.status\": \"active\" },\n      { _id: Reaction.getPrimaryShopId() }\n    ]\n  }).map((activeShop) => activeShop._id);\n\n  const productCursor = Products.find({\n    ancestors: [],\n    type: { $in: [\"simple\"] },\n    shopId: { $in: activeShopsIds }\n  });\n\n  const productIds = [];\n  const products = productCursor.map((product) => {\n    productIds.push(product._id);\n\n    return applyProductRevision(product);\n  });\n\n  const sortedProducts = ReactionProduct.sortProducts(products, currentTag);\n  Session.set(\"productGrid/products\", sortedProducts);\n\n  reactiveProductIds.set(productIds);\n\n  canLoadMoreProducts = productCursor.count() >= Session.get(\"productScrollLimit\");\n\n  const isActionViewOpen = Reaction.isActionViewOpen();\n  if (isActionViewOpen === false) {\n    Session.set(\"productGrid/selectedProducts\", []);\n  }\n\n  onData(null, {\n    canLoadMoreProducts,\n    products: sortedProducts,\n    productsSubscription\n  });\n}\n\nregisterComponent(\"ProductsAdmin\", ProductsComponent, [\n  composeWithTracker(composer),\n  wrapComponent\n]);\n\nexport default compose(\n  composeWithTracker(composer),\n  wrapComponent\n)(ProductsComponent);\n"]},"sourceType":"script","hash":"a1e6c6865948dc418c797686f9073b8185ad8a45"}
